<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä¸€ã€synchronized | é™†è¿œçš„çŸ¥è¯†åº“</title>
    <meta name="description" content="ä¸ªäººæŠ€æœ¯çŸ¥è¯†åº“ï¼Œè®°å½• & åˆ†äº«ä¸ªäººç¢ç‰‡åŒ–ã€ç»“æ„åŒ–ã€ä½“ç³»åŒ–çš„æŠ€æœ¯çŸ¥è¯†å†…å®¹ã€‚">
    <meta name="generator" content="VitePress v1.0.2">
    <link rel="preload stylesheet" href="/assets/style.BeCcSLxA.css" as="style">
    
    <script type="module" src="/assets/app.tq4OLF9I.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.BG61BEI0.js">
    <link rel="modulepreload" href="/assets/chunks/theme.B4v4eVU9.js">
    <link rel="modulepreload" href="/assets/01-Dev_01.01-Java_JUC_å¤šçº¿ç¨‹.md.CwRopwrg.lean.js">
    <link href="/favicon.jpg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-8bc02b95><!--[--><!--]--><!--[--><span tabindex="-1" data-v-5acf5501></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-5acf5501> Skip to content </a><!--]--><!----><header class="VPNav" data-v-8bc02b95 data-v-87a6899a><div class="VPNavBar has-sidebar top" data-v-87a6899a data-v-c3151ff2><div class="wrapper" data-v-c3151ff2><div class="container" data-v-c3151ff2><div class="title" data-v-c3151ff2><div class="VPNavBarTitle has-sidebar" data-v-c3151ff2 data-v-52673e39><a class="title" href="/" data-v-52673e39><!--[--><!--]--><!--[--><img class="VPImage logo" src="/favicon.jpg" alt data-v-53bbf572><!--]--><span data-v-52673e39>é™†è¿œçš„çŸ¥è¯†åº“</span><!--[--><!--]--></a></div></div><div class="content" data-v-c3151ff2><div class="content-body" data-v-c3151ff2><!--[--><!--]--><div class="VPNavBarSearch search" data-v-c3151ff2><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-c3151ff2 data-v-57d2160f><span id="main-nav-aria-label" class="visually-hidden" data-v-57d2160f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-57d2160f data-v-d56c0fcb><!--[--><span data-v-d56c0fcb>ğŸš€é¦–é¡µ</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-57d2160f data-v-d18fe690><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-d18fe690><span class="text" data-v-d18fe690><!----><span data-v-d18fe690>ğŸŒ±æŒ‡å—</span><span class="vpi-chevron-down text-icon" data-v-d18fe690></span></span></button><div class="menu" data-v-d18fe690><div class="VPMenu" data-v-d18fe690 data-v-bedc9cd4><div class="items" data-v-bedc9cd4><!--[--><!--[--><div class="VPMenuGroup" data-v-bedc9cd4 data-v-a1ad9fbb><p class="title" data-v-a1ad9fbb>Dev</p><!--[--><!--[--><div class="VPMenuLink" data-v-a1ad9fbb data-v-189719a1><a class="VPLink link" href="/01-Dev/" data-v-189719a1><!--[-->Dev<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-bedc9cd4 data-v-a1ad9fbb><p class="title" data-v-a1ad9fbb>ä¸ªäºº</p><!--[--><!--[--><div class="VPMenuLink" data-v-a1ad9fbb data-v-189719a1><a class="VPLink link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/01-%E7%AE%80%E4%BB%8B.html" data-v-189719a1><!--[-->ä¸šåŠ¡å­¦ä¹ <!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a1ad9fbb data-v-189719a1><a class="VPLink link" href="/02-Person/04-SEO/" data-v-189719a1><!--[-->SEO<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a1ad9fbb data-v-189719a1><a class="VPLink link" href="/02-Person/03-ç‹¬ç«‹å¼€å‘è€…/" data-v-189719a1><!--[-->ç‹¬ç«‹å¼€å‘è€…<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a1ad9fbb data-v-189719a1><a class="VPLink link" href="/02-Person/02-åšæ–‡æˆé•¿/" data-v-189719a1><!--[-->åšæ–‡æˆé•¿<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a1ad9fbb data-v-189719a1><a class="VPLink link" href="/02-Person/06-%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/VitePress.html" data-v-189719a1><!--[-->åšå®¢æ­å»º<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-57d2160f data-v-d18fe690><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-d18fe690><span class="text" data-v-d18fe690><!----><span data-v-d18fe690>ğŸ’«å…³äº</span><span class="vpi-chevron-down text-icon" data-v-d18fe690></span></span></button><div class="menu" data-v-d18fe690><div class="VPMenu" data-v-d18fe690 data-v-bedc9cd4><div class="items" data-v-bedc9cd4><!--[--><!--[--><div class="VPMenuLink" data-v-bedc9cd4 data-v-189719a1><a class="VPLink link" href="/03-Me/" data-v-189719a1><!--[-->ğŸ’«å…³äºæˆ‘<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-bedc9cd4 data-v-189719a1><a class="VPLink link" href="/rss.xml" data-v-189719a1><!--[-->ğŸ”ŠRSSè®¢é˜…<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-c3151ff2 data-v-8e1a18c0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼" aria-checked="false" data-v-8e1a18c0 data-v-c2b25b84 data-v-b065eea2><span class="check" data-v-b065eea2><span class="icon" data-v-b065eea2><!--[--><span class="vpi-sun sun" data-v-c2b25b84></span><span class="vpi-moon moon" data-v-c2b25b84></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-c3151ff2 data-v-54107397 data-v-e1be45b8><!--[--><a class="VPSocialLink no-icon" href="https://github.com/luyuan9870" aria-label="github" target="_blank" rel="noopener" data-v-e1be45b8 data-v-6cc961c3><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="https://gitee.com/luyuan9870" aria-label target="_blank" rel="noopener" data-v-e1be45b8 data-v-6cc961c3><svg t="1710470546803" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1442" width="200" height="200"><path d="M512 512m-494.933333 0a494.933333 494.933333 0 1 0 989.866666 0 494.933333 494.933333 0 1 0-989.866666 0Z" fill="#C71D23" p-id="1443"></path><path d="M762.538667 457.045333h-281.088a24.4736 24.4736 0 0 0-24.439467 24.405334v61.098666c-0.034133 13.5168 10.922667 24.439467 24.405333 24.439467h171.1104c13.5168 0 24.439467 10.922667 24.439467 24.439467v12.219733a73.3184 73.3184 0 0 1-73.3184 73.3184h-232.209067a24.439467 24.439467 0 0 1-24.439466-24.439467v-232.174933a73.3184 73.3184 0 0 1 73.3184-73.3184h342.152533c13.482667 0 24.405333-10.922667 24.439467-24.439467l0.034133-61.098666a24.405333 24.405333 0 0 0-24.405333-24.439467H420.352a183.296 183.296 0 0 0-183.296 183.296V762.538667c0 13.482667 10.922667 24.439467 24.405333 24.439466h360.516267a164.9664 164.9664 0 0 0 165.000533-165.000533v-140.526933a24.439467 24.439467 0 0 0-24.439466-24.439467z" fill="#FFFFFF" p-id="1444"></path></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-c3151ff2 data-v-5811488c data-v-d18fe690><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d18fe690><span class="vpi-more-horizontal icon" data-v-d18fe690></span></button><div class="menu" data-v-d18fe690><div class="VPMenu" data-v-d18fe690 data-v-bedc9cd4><!----><!--[--><!--[--><!----><div class="group" data-v-5811488c><div class="item appearance" data-v-5811488c><p class="label" data-v-5811488c>æµ…/æ·±è‰²æ¨¡å¼åˆ‡æ¢</p><div class="appearance-action" data-v-5811488c><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼" aria-checked="false" data-v-5811488c data-v-c2b25b84 data-v-b065eea2><span class="check" data-v-b065eea2><span class="icon" data-v-b065eea2><!--[--><span class="vpi-sun sun" data-v-c2b25b84></span><span class="vpi-moon moon" data-v-c2b25b84></span><!--]--></span></span></button></div></div></div><div class="group" data-v-5811488c><div class="item social-links" data-v-5811488c><div class="VPSocialLinks social-links-list" data-v-5811488c data-v-e1be45b8><!--[--><a class="VPSocialLink no-icon" href="https://github.com/luyuan9870" aria-label="github" target="_blank" rel="noopener" data-v-e1be45b8 data-v-6cc961c3><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="https://gitee.com/luyuan9870" aria-label target="_blank" rel="noopener" data-v-e1be45b8 data-v-6cc961c3><svg t="1710470546803" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1442" width="200" height="200"><path d="M512 512m-494.933333 0a494.933333 494.933333 0 1 0 989.866666 0 494.933333 494.933333 0 1 0-989.866666 0Z" fill="#C71D23" p-id="1443"></path><path d="M762.538667 457.045333h-281.088a24.4736 24.4736 0 0 0-24.439467 24.405334v61.098666c-0.034133 13.5168 10.922667 24.439467 24.405333 24.439467h171.1104c13.5168 0 24.439467 10.922667 24.439467 24.439467v12.219733a73.3184 73.3184 0 0 1-73.3184 73.3184h-232.209067a24.439467 24.439467 0 0 1-24.439466-24.439467v-232.174933a73.3184 73.3184 0 0 1 73.3184-73.3184h342.152533c13.482667 0 24.405333-10.922667 24.439467-24.439467l0.034133-61.098666a24.405333 24.405333 0 0 0-24.405333-24.439467H420.352a183.296 183.296 0 0 0-183.296 183.296V762.538667c0 13.482667 10.922667 24.439467 24.405333 24.439466h360.516267a164.9664 164.9664 0 0 0 165.000533-165.000533v-140.526933a24.439467 24.439467 0 0 0-24.439466-24.439467z" fill="#FFFFFF" p-id="1444"></path></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-c3151ff2 data-v-8a3583f8><span class="container" data-v-8a3583f8><span class="top" data-v-8a3583f8></span><span class="middle" data-v-8a3583f8></span><span class="bottom" data-v-8a3583f8></span></span></button></div></div></div></div><div class="divider" data-v-c3151ff2><div class="divider-line" data-v-c3151ff2></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-8bc02b95 data-v-14b6d604><div class="container" data-v-14b6d604><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-14b6d604><span class="vpi-align-left menu-icon" data-v-14b6d604></span><span class="menu-text" data-v-14b6d604>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-14b6d604 data-v-a4ccfa00><button data-v-a4ccfa00>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-8bc02b95 data-v-730aa0ad><div class="curtain" data-v-730aa0ad></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-730aa0ad><span class="visually-hidden" id="sidebar-aria-label" data-v-730aa0ad> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-730aa0ad><section class="VPSidebarItem level-0 collapsible collapsed" data-v-730aa0ad data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h2 class="text" data-v-feaad427>01 Dev</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.01 Java</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>Cloud</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-3 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h5 class="text" data-v-feaad427>Alibaba</h5><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-4 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h6 class="text" data-v-feaad427>Nacos</h6><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-5 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/Cloud/Alibaba/Nacos/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æºç åˆ†æ</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/Cloud/Alibaba/%E7%BB%84%E4%BB%B6.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç»„ä»¶</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/Cloud/Higress.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Higress</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/index.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Index</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>JavaåŸºç¡€</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/Java%E5%9F%BA%E7%A1%80/Serializable.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Serializable</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/Java%E5%9F%BA%E7%A1%80/%E6%B3%9B%E5%9E%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æ³›å‹</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>JUC</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-3 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h5 class="text" data-v-feaad427>01 å¹¶å‘ç¼–ç¨‹</h5><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/01-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-01.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¹¶å‘ç¼–ç¨‹ 01</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/01-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-02.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¹¶å‘ç¼–ç¨‹ 02</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/Callable%20%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Callable å®é™…åº”ç”¨åœºæ™¯</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/Condition%E6%8E%A5%E5%8F%A3.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Conditionæ¥å£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/Future.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Future</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/Volatile%E5%85%B3%E9%94%AE%E5%AD%97.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Volatileå…³é”®å­—</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/%E4%BF%A1%E5%8F%B7%E9%87%8F.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ä¿¡å·é‡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/%E5%A4%9A%E7%BA%BF%E7%A8%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¤šçº¿ç¨‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/%E7%BA%BF%E7%A8%8B%E6%B1%A0.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>çº¿ç¨‹æ± </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JUC/%E9%94%81.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>é”</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>JVM</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JVM/00-%E5%89%8D%E8%A8%80.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 å‰è¨€</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JVM/01-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 ç±»åŠ è½½æœºåˆ¶</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JVM/02-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>02 è¿è¡Œæ—¶æ•°æ®åŒº</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JVM/03-JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>03 JVMå†…å­˜æ¨¡å‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JVM/04-JVM%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>04 JVMçš„åƒåœ¾æ”¶é›†ç®—æ³•</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JVM/05-%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>05 åŒäº²å§”æ´¾æ¨¡å‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/JVM/06-Java%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E5%B8%83%E5%B1%80.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>06 Javaå¯¹è±¡çš„å†…å­˜æ¨¡å‹å¸ƒå±€</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.01-Java/%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç³»ç»Ÿä¼˜åŒ–</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.02 å‰ç«¯</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.02-%E5%89%8D%E7%AB%AF/01-%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 å‰ç«¯å­¦ä¹ è·¯çº¿</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.02-%E5%89%8D%E7%AB%AF/02-%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E6%AE%B5.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¸¸ç”¨ä»£ç æ®µ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.02-%E5%89%8D%E7%AB%AF/Node%E7%89%88%E6%9C%AC%E5%88%87%E6%8D%A2.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Nodeç‰ˆæœ¬åˆ‡æ¢</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>Npm</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.02-%E5%89%8D%E7%AB%AF/Npm/Npm%E9%95%9C%E5%83%8F%E5%88%87%E6%8D%A2.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Npmé•œåƒåˆ‡æ¢</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.02-%E5%89%8D%E7%AB%AF/Npm/pnpm.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Pnpm</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>Vue</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.02-%E5%89%8D%E7%AB%AF/Vue/00-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 å¿«é€Ÿå…¥é—¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.02-%E5%89%8D%E7%AB%AF/Vue/01-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 åŸºç¡€è¯­æ³•</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.02-%E5%89%8D%E7%AB%AF/%E7%96%91%E9%97%AE.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç–‘é—®</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.03 ç½‘ç»œå®‰å…¨</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.03-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/00-%E5%A4%A7%E7%BA%B2%E8%B7%AF%E7%BA%BF.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 å¤§çº²è·¯çº¿</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.03-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/00-%E5%B8%B8%E7%94%A8%E7%BD%91%E7%AB%99.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 å¸¸ç”¨ç½‘ç«™</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.03-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/01-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%AE%80%E4%BB%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 ç½‘ç»œå®‰å…¨ç®€ä»‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.03-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/02-%E5%B8%B8%E8%A7%81%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>02 å¸¸è§å®‰å…¨é—®é¢˜</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>å®‰å…¨æ¼æ´</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.03-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/Nacos-2.1%E4%BB%A5%E4%B8%8B%E7%9A%84%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Nacos 2.1ä»¥ä¸‹çš„æœªæˆæƒè®¿é—®æ¼æ´</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.04 è®¾è®¡æ¨¡å¼</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.04-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/00-%E5%89%8D%E8%A8%80.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 å‰è¨€</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>01 æ·±å…¥è®¾è®¡æ¨¡å¼</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.04-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/01-%E6%B7%B1%E5%85%A5%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/01-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AE%80%E4%BB%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ç®€ä»‹</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>02 åˆ›å»ºå‹</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.04-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/02-%E5%88%9B%E5%BB%BA%E5%9E%8B/%E5%8D%95%E4%BE%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å•ä¾‹</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>03 è¡Œä¸ºå‹</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.04-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/03-%E8%A1%8C%E4%B8%BA%E5%9E%8B/%E6%A8%A1%E6%9D%BF.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æ¨¡æ¿</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.04-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/03-%E8%A1%8C%E4%B8%BA%E5%9E%8B/%E7%AD%96%E7%95%A5.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç­–ç•¥</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.04-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/03-%E8%A1%8C%E4%B8%BA%E5%9E%8B/%E8%B4%A3%E4%BB%BB%E9%93%BE.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>è´£ä»»é“¾</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>04 ç»“æ„å‹</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.04-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/04-%E7%BB%93%E6%9E%84%E5%9E%8B/%E4%BB%A3%E7%90%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ä»£ç†</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.04-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/04-%E7%BB%93%E6%9E%84%E5%9E%8B/%E9%97%A8%E9%9D%A2.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>é—¨é¢</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.04-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E3%80%8A%E7%BE%8E%E5%9B%A2%E6%8A%80%E6%9C%AF%E3%80%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9C%A8%E5%A4%96%E5%8D%96%E8%90%A5%E9%94%80%E4%B8%9A%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ã€Šç¾å›¢æŠ€æœ¯ã€‹è®¾è®¡æ¨¡å¼åœ¨å¤–å–è¥é”€ä¸šåŠ¡ä¸­çš„å®è·µ</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.05 ç®—æ³•</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.05-%E7%AE%97%E6%B3%95/01-%E5%89%8D%E8%A8%80.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 å‰è¨€</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.05-%E7%AE%97%E6%B3%95/02-%E5%AF%BC%E8%AF%BB.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>02 å¯¼è¯»</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>ä¸šåŠ¡ç®—æ³•</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.05-%E7%AE%97%E6%B3%95/%E4%B8%9A%E5%8A%A1%E7%AE%97%E6%B3%95/DFA.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>DFA</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.05-%E7%AE%97%E6%B3%95/%E4%B8%9A%E5%8A%A1%E7%AE%97%E6%B3%95/%E8%A3%85%E7%AE%B1%E7%AE%97%E6%B3%95.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>è£…ç®±ç®—æ³•</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.05-%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%88%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>äºŒåˆ†</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.05-%E7%AE%97%E6%B3%95/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>åŸºç¡€çŸ¥è¯†</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>æ•°æ®ç»“æ„</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.05-%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æ•°æ®ç»“æ„</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.05-%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E8%B7%AF%E7%BA%BF.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç®—æ³•è·¯çº¿</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.06 Linux</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.06-Linux/Linux%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1-%E6%9C%8D%E5%8A%A1%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99%EF%BC%88%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%EF%BC%89.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Linuxè‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡ æœåŠ¡è„šæœ¬ç¼–å†™ï¼ˆå¼€æœºè‡ªå¯ï¼‰</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.06-Linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¸¸ç”¨å‘½ä»¤</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>ç¯å¢ƒå®‰è£…</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.06-Linux/%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/Linux%E5%AE%89%E8%A3%85jdk.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Linuxå®‰è£…jdk</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.06-Linux/%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/Ubuntu%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>UbuntuåŸºç¡€ç¯å¢ƒå®‰è£…</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.06-Linux/%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E9%97%AE%E9%A2%98.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>åŸºç¡€ç¯å¢ƒé—®é¢˜</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>è™šæ‹Ÿæœº</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.06-Linux/%E8%99%9A%E6%8B%9F%E6%9C%BA/VirtualBox.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>VirtualBox</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.06-Linux/%E8%99%9A%E6%8B%9F%E6%9C%BA/windows%E5%AE%89%E8%A3%85linux%E5%AD%90%E7%B3%BB%E7%BB%9F.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Windowså®‰è£…linuxå­ç³»ç»Ÿ</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.07 å¤§æ•°æ®</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.07-%E5%A4%A7%E6%95%B0%E6%8D%AE/%E6%95%B0%E4%BB%93.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æ•°ä»“</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.08 æ•°æ®åº“</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>00 ã€ŠMySQLæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/00-%E3%80%8AMySQL%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E8%A1%8C%E7%9A%84%E3%80%8B/01-%E3%80%8A%E8%A3%85%E4%BD%9C%E8%87%AA%E5%B7%B1%E6%98%AF%E4%B8%AA%E5%B0%8F%E7%99%BD%E3%80%8B-%E5%88%9D%E8%AF%86MySQL.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 ã€Šè£…ä½œè‡ªå·±æ˜¯ä¸ªå°ç™½ã€‹ åˆè¯†MySQL</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/00-%E3%80%8AMySQL%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E8%A1%8C%E7%9A%84%E3%80%8B/02-%E3%80%8AMysql%E7%9A%84%E8%B0%83%E6%8E%A7%E6%8C%89%E9%92%AE%E3%80%8B-%E5%90%AF%E5%8A%A8%E9%80%89%E9%A1%B9%E4%B8%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>02 ã€ŠMysqlçš„è°ƒæ§æŒ‰é’®ã€‹ å¯åŠ¨é€‰é¡¹ä¸ç¯å¢ƒå˜é‡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/00-%E3%80%8AMySQL%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E8%A1%8C%E7%9A%84%E3%80%8B/03-%E3%80%8A%E4%B9%B1%E7%A0%81%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%E3%80%8B-%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%AF%94%E8%BE%83%E8%A7%84%E5%88%99.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>03 ã€Šä¹±ç çš„å‰ä¸–ä»Šç”Ÿã€‹ å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/00-%E3%80%8AMySQL%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E8%A1%8C%E7%9A%84%E3%80%8B/04-%E3%80%8A%E4%BB%8E%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95%E8%AF%B4%E8%B5%B7%E3%80%8B-InnoDB%E8%AE%B0%E5%BD%95%E7%BB%93%E6%9E%84.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>04 ã€Šä»ä¸€æ¡è®°å½•è¯´èµ·ã€‹ InnoDBè®°å½•ç»“æ„</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>01 ã€ŠMysql BinLogç¥ç§˜é¢çº±ã€‹</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/01-%E3%80%8AMysql-BinLog%E7%A5%9E%E7%A7%98%E9%9D%A2%E7%BA%B1%E3%80%8B/01-MySQL-BinLog.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 MySQL BinLog</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>02 Mysql</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/02-Mysql/MySQL%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>MySQLæ•´ä½“æ¶æ„è§£æ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/02-Mysql/Mysql%E7%89%B9%E6%AE%8A%E5%91%BD%E4%BB%A4.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Mysqlç‰¹æ®Šå‘½ä»¤</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/02-Mysql/%E7%A2%8E%E7%89%87%E6%B8%85%E7%90%86%E6%96%B9%E6%A1%88.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç¢ç‰‡æ¸…ç†æ–¹æ¡ˆ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/02-Mysql/%E9%97%AE%E9%A2%98%E5%BC%95%E5%AF%BC%E5%AD%A6%E4%B9%A0.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>é—®é¢˜å¼•å¯¼å­¦ä¹ </p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>03 Redis</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/03-Redis/Redis-%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Redis å…¥é—¨åŸºç¡€</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/03-Redis/Redis.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Redis</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.08-%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql-MVCC.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Mysql MVCC</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.09 Docker</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>01 DockerCompose</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.09-Docker/01-DockerCompose/%E5%B8%B8%E7%94%A8-%E7%8E%AF%E5%A2%83%E6%9C%8D%E5%8A%A1-DockerFile.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¸¸ç”¨ ç¯å¢ƒæœåŠ¡ DockerFile</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>Dockerè½¯ä»¶å®‰è£…</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.09-Docker/docker%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/00-docker%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85%E5%8D%95%E6%9C%BA%E7%89%88es%E3%80%81kibana%E3%80%81ik%E5%88%86%E8%AF%8D%E3%80%81%E5%8F%AF%E8%A7%86%E5%8C%96.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 dockeræ–¹å¼å®‰è£…å•æœºç‰ˆesã€kibanaã€ikåˆ†è¯ã€å¯è§†åŒ–</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.09-Docker/docker%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/00-Docker%E9%95%9C%E5%83%8F%E6%96%B9%E5%BC%8F%E6%90%AD%E5%BB%BAXXL.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 Dockeré•œåƒæ–¹å¼æ­å»ºXXL</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.09-Docker/docker%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Linux%E5%AE%89%E8%A3%85docker.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Linuxå®‰è£…docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.09-Docker/docker%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/MinIo.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>MinIo</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.09-Docker/docker%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/PowerJob.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>PowerJob</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.10 DevOps</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.10-DevOps/%E4%BA%91%E6%95%88%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%9E%84%E5%BB%BA.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>äº‘æ•ˆæµæ°´çº¿æ„å»º</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.10-DevOps/%E5%89%8D%E8%A8%80.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å‰è¨€</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.13 Es</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.13-Es/01-ES%E5%85%A5%E9%97%A8.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 ESå…¥é—¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.13-Es/03-Es%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>03 Esæ•°æ®åŒæ­¥é—®é¢˜</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.60 ä¹¦ç±ç›¸å…³</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.60-%E4%B9%A6%E7%B1%8D%E7%9B%B8%E5%85%B3/%E7%BB%8F%E5%85%B8%E7%BC%96%E7%A8%8B%E4%B9%A6%E5%8D%95500MB.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç»å…¸ç¼–ç¨‹ä¹¦å•500MB</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.68 DDD</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.68-DDD/%E5%85%85%E8%A1%80%E6%A8%A1%E5%9E%8B%E4%B8%8E%E8%B4%AB%E8%A1%80%E6%A8%A1%E5%9E%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å……è¡€æ¨¡å‹ä¸è´«è¡€æ¨¡å‹</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.69 æŠ€æœ¯è§„èŒƒ</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.69-%E6%8A%80%E6%9C%AF%E8%A7%84%E8%8C%83/01-%E6%8E%A2%E7%B4%A2%E6%97%A5%E5%BF%97%E8%A7%84%E7%BA%A6.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 æ¢ç´¢æ—¥å¿—è§„çº¦</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.70 ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.70-%E4%B8%9A%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/Mybatis-DO%E5%AF%B9%E8%B1%A1%E5%B5%8C%E5%A5%97%E7%9A%84%E7%89%B9%E6%AE%8A%E5%A4%84%E7%90%86-%E6%8F%92%E4%BB%B6%E5%8A%9F%E8%83%BD.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Mybatis DOå¯¹è±¡åµŒå¥—çš„ç‰¹æ®Šå¤„ç† æ’ä»¶åŠŸèƒ½</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>SpringBoot</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.70-%E4%B8%9A%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/SpringBoot/Event%E8%A7%82%E5%AF%9F%E8%80%85.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Eventè§‚å¯Ÿè€…</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.70-%E4%B8%9A%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/SpringBoot/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>SpELè¡¨è¾¾å¼</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.70-%E4%B8%9A%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/SpringBoot/SpringBoot-Start.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>SpringBoot Start</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.70-%E4%B8%9A%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/SpringBoot/SpringBootApplication%E6%B3%A8%E8%A7%A3.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>SpringBootApplicationæ³¨è§£</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-3 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h5 class="text" data-v-feaad427>è‡ªå®šä¹‰ start</h5><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.70-%E4%B8%9A%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/SpringBoot/%E8%87%AA%E5%AE%9A%E4%B9%89-start/%E6%9C%AA%E5%91%BD%E5%90%8D.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æœªå‘½å</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>åŠ å¯†</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.70-%E4%B8%9A%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/%E5%8A%A0%E5%AF%86/Excel&amp;Word%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Excel&Wordæ–‡ä»¶åŠ å¯†</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.70-%E4%B8%9A%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/%E5%B9%82%E7%AD%89%E5%A4%84%E7%90%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¹‚ç­‰å¤„ç†</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>æ—¥å¿—</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.70-%E4%B8%9A%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/%E6%97%A5%E5%BF%97/TraceId%E9%97%AE%E9%A2%98.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>TraceIdé—®é¢˜</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01.99 PlugIns</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>Easy Inform</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.99-PlugIns/Easy-Inform/%E5%AF%BC%E5%9B%BE.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¯¼å›¾</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.99-PlugIns/Easy-Inform/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æœªå‘½åæ€ç»´å¯¼å›¾</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.99-PlugIns/MybatisCodeHelper%E7%A6%BB%E7%BA%BF%E6%BF%80%E6%B4%BB%E5%88%86%E6%9E%90.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>MybatisCodeHelperç¦»çº¿æ¿€æ´»åˆ†æ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.99-PlugIns/ob.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Ob</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>Obsidianæ’ä»¶å¼€å‘</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.99-PlugIns/obsidian%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/obsidian%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Obsidianæ’ä»¶å¼€å‘</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.99-PlugIns/obsidian%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¿«é€Ÿå…¥é—¨</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.99-PlugIns/site.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Site</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/01.99-PlugIns/%E5%BC%80%E5%8F%91%E7%9B%B8%E5%85%B3.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¼€å‘ç›¸å…³</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/01-Dev/index.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Index</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-730aa0ad><section class="VPSidebarItem level-0 collapsible collapsed" data-v-730aa0ad data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h2 class="text" data-v-feaad427>02 Person</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>00 ä¸šåŠ¡å­¦ä¹ </h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/01-%E7%AE%80%E4%BB%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 ç®€ä»‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/02-%E8%B7%A8%E5%A2%83%E7%94%B5%E5%95%86%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>02 è·¨å¢ƒç”µå•†å‰ç½®çŸ¥è¯†</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/03-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%8E%A5%E6%89%8B%E7%90%86%E8%A7%A3%E9%A1%B9%E7%9B%AE.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>03 å¦‚ä½•å¿«é€Ÿæ¥æ‰‹ç†è§£é¡¹ç›®</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>04 è·¨å¢ƒä¸šåŠ¡</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/04-%E8%B7%A8%E5%A2%83%E4%B8%9A%E5%8A%A1/%E4%BB%93%E9%85%8D%E9%80%BB%E8%BE%91%E8%BE%93%E5%87%BA.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ä»“é…é€»è¾‘è¾“å‡º</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/04-%E8%B7%A8%E5%A2%83%E4%B8%9A%E5%8A%A1/%E4%BB%93%E9%85%8D%E9%92%88%E5%AF%B9%E4%B8%9C%E5%8D%97%E4%BA%9A%E5%9C%B0%E5%8C%BA%E7%9A%84%E7%89%B9%E6%AE%8A%E9%80%BB%E8%BE%91.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ä»“é…é’ˆå¯¹ä¸œå—äºšåœ°åŒºçš„ç‰¹æ®Šé€»è¾‘</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/04-%E8%B7%A8%E5%A2%83%E4%B8%9A%E5%8A%A1/%E5%9F%BA%E7%A1%80%E6%89%AB%E7%9B%B2.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>åŸºç¡€æ‰«ç›²</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/04-%E8%B7%A8%E5%A2%83%E4%B8%9A%E5%8A%A1/%E7%BB%84%E7%BD%91%E4%BC%98%E5%85%88%E7%BA%A7.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç»„ç½‘ä¼˜å…ˆçº§</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>05 æœå¹¿æ¨</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-3 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h5 class="text" data-v-feaad427>01 æœç´¢</h5><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/01-%E6%90%9C%E7%B4%A2/00-%E7%AE%80%E4%BB%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 ç®€ä»‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/01-%E6%90%9C%E7%B4%A2/02.%E6%90%9C%E5%B9%BF%E6%8E%A8%E6%A0%B8%E5%BF%83%E4%B8%9A%E5%8A%A1%E9%93%BE%E8%B7%AF.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>02.æœå¹¿æ¨æ ¸å¿ƒä¸šåŠ¡é“¾è·¯</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/01-%E6%90%9C%E7%B4%A2/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4-%E6%99%BA%E8%83%BD%E5%BC%80%E6%94%BE%E6%90%9C%E7%B4%A2.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>é˜¿é‡Œå·´å·´ æ™ºèƒ½å¼€æ”¾æœç´¢</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-3 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h5 class="text" data-v-feaad427>02 æ¨è</h5><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-4 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h6 class="text" data-v-feaad427>00 ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹</h6><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-5 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/00-%E3%80%8A%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%8B/01-%E6%A6%82%E8%BF%B0.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 æ¦‚è¿°</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-5 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/00-%E3%80%8A%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%8B/02-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>02 åè¯è§£é‡Š</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-5 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/00-%E3%80%8A%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%8B/03-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>03 æ¶æ„è®¾è®¡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-5 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/00-%E3%80%8A%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%8B/04-%E7%AE%97%E6%B3%95%E7%AD%96%E7%95%A5.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>04 ç®—æ³•ç­–ç•¥</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-5 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/00-%E3%80%8A%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%8B/99-%E9%97%AE%E9%A2%98%E7%AD%94%E7%96%91.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>99 é—®é¢˜ç­”ç–‘</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-4 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h6 class="text" data-v-feaad427>01 äº¬ä¸œæ¨èç³»ç»Ÿ</h6><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-5 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/01-%E4%BA%AC%E4%B8%9C%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F-%E5%B9%BF%E5%91%8A%E6%8E%92%E5%BA%8F.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æ¨èç³»ç»Ÿ å¹¿å‘Šæ’åº</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/10-%E4%B9%B0%E4%BA%86%E5%8F%88%E4%B9%B0%E9%A1%B5%E9%80%BB%E8%BE%91.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>10 ä¹°äº†åˆä¹°é¡µé€»è¾‘</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/%E5%95%86%E5%9F%8E%E4%B8%BB%E9%A1%B5%E6%90%9C%E7%B4%A2%E4%B8%9A%E5%8A%A1.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å•†åŸä¸»é¡µæœç´¢ä¸šåŠ¡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å­¦ä¹ èµ„æº</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/02-%E6%8E%A8%E8%8D%90/%E6%90%9C%E6%8E%A8%E4%B8%9A%E5%8A%A1%E6%A2%B3%E7%90%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æœæ¨ä¸šåŠ¡æ¢³ç†</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-3 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h5 class="text" data-v-feaad427>03 ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€</h5><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/03-%E7%BD%91%E7%BA%A2%E8%81%94%E7%9B%9F%E5%B9%BF%E5%91%8A%E8%90%A5%E9%94%80/00-%E5%B9%BF%E5%91%8A%E5%89%8D%E7%BD%AE%E4%B8%9A%E5%8A%A1%E7%9F%A5%E8%AF%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 å¹¿å‘Šå‰ç½®ä¸šåŠ¡çŸ¥è¯†</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/03-%E7%BD%91%E7%BA%A2%E8%81%94%E7%9B%9F%E5%B9%BF%E5%91%8A%E8%90%A5%E9%94%80/00-%E7%AE%80%E4%BB%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>00 ç®€ä»‹</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-4 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h6 class="text" data-v-feaad427>01 ç½‘çº¢ç³»ç»Ÿ</h6><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-5 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/03-%E7%BD%91%E7%BA%A2%E8%81%94%E7%9B%9F%E5%B9%BF%E5%91%8A%E8%90%A5%E9%94%80/01-%E7%BD%91%E7%BA%A2%E7%B3%BB%E7%BB%9F/01-OBS%E7%9B%B8%E5%85%B3%E5%8A%9F%E8%83%BD%E7%AE%80%E4%BB%8B.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>01 OBSç›¸å…³åŠŸèƒ½ç®€ä»‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-5 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/05-%E6%90%9C%E5%B9%BF%E6%8E%A8/03-%E7%BD%91%E7%BA%A2%E8%81%94%E7%9B%9F%E5%B9%BF%E5%91%8A%E8%90%A5%E9%94%80/01-%E7%BD%91%E7%BA%A2%E7%B3%BB%E7%BB%9F/%E6%A0%B7%E5%93%81%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%A2%B3%E7%90%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æ ·å“ä¸šåŠ¡é€»è¾‘æ¢³ç†</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>06 Open</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/00-%E4%B8%9A%E5%8A%A1%E5%AD%A6%E4%B9%A0/06-Open/Open%20Api%20%E5%9C%A8%E7%94%B5%E5%95%86%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Open Api åœ¨ç”µå•†ä¸­çš„ä½œç”¨</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>01 é¡¹ç›®ç®¡ç†</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/01-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E5%88%98%E6%B6%A6%E5%AF%B9%E8%AF%9D%E6%A8%8A%E7%99%BB%EF%BC%9A%E5%81%9A%E5%9B%A2%E9%98%9F%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AA%E6%8B%9B%E6%88%90%E5%B9%B4%E4%BA%BA.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>åˆ˜æ¶¦å¯¹è¯æ¨Šç™»ï¼šåšå›¢é˜Ÿï¼Œæˆ‘ä»¬åªæ‹›æˆå¹´äºº</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>02 åšæ–‡æˆé•¿</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>Guide</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><section class="VPSidebarItem level-3 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h5 class="text" data-v-feaad427>ç¨‹åºäººç”Ÿ</h5><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-4 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/02-%E5%8D%9A%E6%96%87%E6%88%90%E9%95%BF/Guide/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/%E5%BC%80%E5%8F%91%E5%90%8C%E5%AD%A6%E9%A1%BB%E7%9F%A5.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>å¼€å‘åŒå­¦é¡»çŸ¥</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/02-%E5%8D%9A%E6%96%87%E6%88%90%E9%95%BF/index.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Index</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>ä¸ªäººæå‡</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/02-%E5%8D%9A%E6%96%87%E6%88%90%E9%95%BF/%E4%B8%AA%E4%BA%BA%E6%8F%90%E5%8D%87/%E6%8E%8C%E6%8F%A1%E4%B9%A0%E6%83%AF.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æŒæ¡ä¹ æƒ¯</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-2 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h4 class="text" data-v-feaad427>äº•åº•ä¹‹è›™</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/02-%E5%8D%9A%E6%96%87%E6%88%90%E9%95%BF/%E4%BA%95%E5%BA%95%E4%B9%8B%E8%9B%99/%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%BC%8F.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ä¸šåŠ¡æ¨¡å¼</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/02-%E5%8D%9A%E6%96%87%E6%88%90%E9%95%BF/%E4%BA%95%E5%BA%95%E4%B9%8B%E8%9B%99/%E6%8F%90%E5%89%8D%E5%81%9A%E7%9A%84%E6%80%9D%E6%83%B3%E5%87%86%E5%A4%87.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æå‰åšçš„æ€æƒ³å‡†å¤‡</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>03 ç‹¬ç«‹å¼€å‘è€…</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/03-%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91%E8%80%85/index.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Index</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/03-%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91%E8%80%85/%E6%88%91%E6%98%AF%E8%B0%81.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æˆ‘æ˜¯è°</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/03-%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91%E8%80%85/%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91%E5%A4%9A%E4%BA%BA%EF%BC%88%E8%BF%9C%E7%A8%8B%EF%BC%89%E5%8D%8F%E4%BD%9C%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç‹¬ç«‹å¼€å‘å¤šäººï¼ˆè¿œç¨‹ï¼‰åä½œç»éªŒåˆ†äº«</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/03-%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91%E8%80%85/%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E6%80%9D%E8%80%83.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç‹¬ç«‹å¼€å‘è€…çš„æ€è€ƒ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/03-%E7%8B%AC%E7%AB%8B%E5%BC%80%E5%8F%91%E8%80%85/%E8%B5%84%E6%BA%90%E7%AB%99%E7%82%B9.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>èµ„æºç«™ç‚¹</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>04 SEO</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/04-SEO/index.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Index</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>05 å¥‡æŠ€æ·«å·§</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/05-%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/Idea.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Idea</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/05-%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/Java%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96%E5%B0%8F%E6%8A%80%E5%B7%A7.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Javaä»£ç ä¼˜åŒ–å°æŠ€å·§</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/05-%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/%E6%9C%BA%E5%9C%BA.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>æœºåœº</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/05-%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>ç¬”è®°æ•´ç†</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-feaad427 data-v-feaad427><div class="item" role="button" tabindex="0" data-v-feaad427><div class="indicator" data-v-feaad427></div><h3 class="text" data-v-feaad427>06 åšå®¢æ­å»º</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-feaad427><span class="vpi-chevron-right caret-icon" data-v-feaad427></span></div></div><div class="items" data-v-feaad427><!--[--><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/06-%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/Rss%E5%A4%84%E7%90%86.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Rsså¤„ç†</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/06-%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/VitePress.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>VitePress</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/06-%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/%E5%9F%BA%E4%BA%8EGithubActions%E5%AE%9E%E7%8E%B0Github%E4%B8%8EGitee%E7%9A%84%E5%90%8C%E6%AD%A5.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>åŸºäºGithubActionså®ç°Githubä¸Giteeçš„åŒæ­¥</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-feaad427 data-v-feaad427><div class="item" data-v-feaad427><div class="indicator" data-v-feaad427></div><a class="VPLink link link" href="/02-Person/index.html" data-v-feaad427><!--[--><p class="text" data-v-feaad427>Index</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-8bc02b95 data-v-c28d6088><div class="VPDoc has-sidebar has-aside" data-v-c28d6088 data-v-767d2a17><!--[--><!--]--><div class="container" data-v-767d2a17><div class="aside" data-v-767d2a17><div class="aside-curtain" data-v-767d2a17></div><div class="aside-container" data-v-767d2a17><div class="aside-content" data-v-767d2a17><div class="VPDocAside" data-v-767d2a17 data-v-b81430ef><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-b81430ef data-v-346e0d9b><div class="content" data-v-346e0d9b><div class="outline-marker" data-v-346e0d9b></div><div class="outline-title" role="heading" aria-level="2" data-v-346e0d9b>ç›®å½•</div><nav aria-labelledby="doc-outline-aria-label" data-v-346e0d9b><span class="visually-hidden" id="doc-outline-aria-label" data-v-346e0d9b> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-346e0d9b data-v-4dcdae39><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-b81430ef></div><!--[--><!--]--><div class="VPDocAsideCarbonAds" data-v-b81430ef><div class="VPCarbonAds" data-v-b33901c9></div></div><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-767d2a17><div class="content-container" data-v-767d2a17><!--[--><!--]--><main class="main" data-v-767d2a17><div style="position:relative;" class="vp-doc _01-Dev_01_01-Java_JUC_%E5%A4%9A%E7%BA%BF%E7%A8%8B" data-v-767d2a17><div><h2 id="é”å‡çº§" tabindex="-1">é”å‡çº§ <a class="header-anchor" href="#é”å‡çº§" aria-label="Permalink to &quot;é”å‡çº§&quot;">â€‹</a></h2><h2 id="threadlocal" tabindex="-1">ThreadLocal <a class="header-anchor" href="#threadlocal" aria-label="Permalink to &quot;ThreadLocal&quot;">â€‹</a></h2><h2 id="cas" tabindex="-1">CAS <a class="header-anchor" href="#cas" aria-label="Permalink to &quot;CAS&quot;">â€‹</a></h2><p>æ¯”è¾ƒå¹¶æ›¿æ¢, å®ƒèƒ½å¤Ÿä¿è¯ å•ä¸ªæ–¹æ³•æ˜¯åŸå­çš„ ä½†æ˜¯ä¸èƒ½ä¿è¯ä½ è¿ç»­çš„å¤šä¸ªå®ƒçš„æ–¹æ³•éƒ½æ˜¯åŸå­çš„</p><p>CASä¼šå¸¦æ¥ ä¸€ä¸ªABAé—®é¢˜</p><p>ä¸¾ä¸ªä¾‹å­ çº¿ç¨‹1 : æƒ³ æŠŠ A æ”¹æˆB åˆšè¿›å» CPUè°ƒåº¦å°±æŠŠæ‰§è¡Œæƒæ‹¿èµ°äº†, æ­¤æ—¶ çº¿ç¨‹æŒ‚èµ· çº¿ç¨‹2: å®ƒå§Aæ”¹æˆäº†B åˆæ”¹å›A æ°å·§ è¿™ä¸ªè¿‡ç¨‹ åœ¨ çº¿ç¨‹1 çº¿ç¨‹æŒ‚èµ·çš„æ—¶å€™ å®Œæˆäº† æ­¤æ—¶ çº¿ç¨‹1 ä¸çŸ¥é“ Aå·²ç»å˜æˆäº†Båˆå˜æˆäº†A, æ‰€ä»¥ä»–æ­£å¸¸å¾€ä¸‹æ‰§è¡Œ æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜å‘¢ åŸºæœ¬æ•°æ®ç±»å‹, ä¸ç®¡ä»– éšå®ƒå» å¼•ç”¨æ•°æ®ç±»å‹, CASçš„æ—¶å€™é€šè¿‡Version å»å¤„ç†</p><h1 id="ä¸€ã€synchronized" tabindex="-1">ä¸€ã€synchronized <a class="header-anchor" href="#ä¸€ã€synchronized" aria-label="Permalink to &quot;ä¸€ã€synchronized&quot;">â€‹</a></h1><h3 id="ä¸€ã€åŸå­æ€§ã€æœ‰åºæ€§ã€å¯è§æ€§" tabindex="-1">ä¸€ã€åŸå­æ€§ã€æœ‰åºæ€§ã€å¯è§æ€§ <a class="header-anchor" href="#ä¸€ã€åŸå­æ€§ã€æœ‰åºæ€§ã€å¯è§æ€§" aria-label="Permalink to &quot;ä¸€ã€åŸå­æ€§ã€æœ‰åºæ€§ã€å¯è§æ€§&quot;">â€‹</a></h3><h4 id="_1-1-åŸå­æ€§" tabindex="-1">1.1 åŸå­æ€§ <a class="header-anchor" href="#_1-1-åŸå­æ€§" aria-label="Permalink to &quot;1.1 åŸå­æ€§&quot;">â€‹</a></h4><p>æ•°æ®åº“çš„äº‹åŠ¡ï¼šACID</p><p>Aï¼šåŸå­æ€§-äº‹åŠ¡æ˜¯ä¸€ä¸ªæœ€å°çš„æ‰§è¡Œçš„å•ä½ï¼Œä¸€æ¬¡äº‹åŠ¡çš„å¤šæ¬¡æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚</p><p>å¹¶å‘ç¼–ç¨‹çš„åŸå­æ€§ï¼šä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤åœ¨CPUæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å…è®¸ä¸­æ–­çš„ã€‚</p><p>i++;æ“ä½œæ˜¯åŸå­æ€§ï¼Ÿ</p><p>è‚¯å®šä¸æ˜¯ï¼ši++æ“ä½œä¸€å…±æœ‰ä¸‰ä¸ªæŒ‡ä»¤</p><p>getfieldï¼šä»ä¸»å†…å­˜æ‹‰å–æ•°æ®åˆ°CPUå¯„å­˜å™¨</p><p>iaddï¼šåœ¨å¯„å­˜å™¨å†…éƒ¨å¯¹æ•°æ®è¿›è¡Œ+1</p><p>putfieldï¼šå°†CPUå¯„å­˜å™¨ä¸­çš„ç»“æœç”©åˆ°ä¸»å†…å­˜ä¸­</p><p>å¦‚ä½•ä¿è¯i++æ˜¯åŸå­æ€§çš„ã€‚</p><p>é”ï¼šsynchronizedï¼Œlockï¼ŒAtomicï¼ˆCASï¼‰</p><p>ä½¿ç”¨locké”ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯åœ¨æ“ä½œi++çš„ä¸‰ä¸ªæŒ‡ä»¤å‰ï¼Œå…ˆåŸºäºAQSæˆåŠŸä¿®æ”¹stateåæ‰å¯ä»¥æ“ä½œ</p><p>ä½¿ç”¨synchronizedå’Œlocké”æ—¶ï¼Œå¯èƒ½ä¼šè§¦å‘å°†çº¿ç¨‹æŒ‚èµ·çš„æ“ä½œï¼Œè€Œè¿™ç§æ“ä½œä¼šè§¦å‘å†…æ ¸æ€å’Œç”¨æˆ·æ€çš„åˆ‡æ¢ï¼Œä»è€Œå¯¼è‡´æ¶ˆè€—èµ„æºã€‚</p><p>CASæ–¹å¼å°±ç›¸å¯¹synchronizedå’Œlocké”çš„æ•ˆç‡æ›´é«˜ï¼ˆä¹Ÿè¯´ä¸å®šï¼‰ï¼Œå› ä¸ºCASä¸ä¼šè§¦å‘çº¿ç¨‹æŒ‚èµ·æ“ä½œï¼</p><p>CASï¼šcompare and swap</p><p>çº¿ç¨‹åŸºäºCASä¿®æ”¹æ•°æ®çš„æ–¹å¼ï¼šå…ˆè·å–ä¸»å†…å­˜æ•°æ®ï¼Œåœ¨ä¿®æ”¹ä¹‹å‰ï¼Œå…ˆæ¯”è¾ƒæ•°æ®æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ä¿®æ”¹ä¸»å†…å­˜æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œæ”¾å¼ƒè¿™æ¬¡ä¿®æ”¹</p><p>CASå°±æ˜¯æ¯”è¾ƒå’Œäº¤æ¢ï¼Œè€Œæ¯”è¾ƒå’Œäº¤æ¢æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ</p><p>CASåœ¨Javaå±‚é¢å°±æ˜¯Unsafeç±»ä¸­æä¾›çš„ä¸€ä¸ªnativeæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åªæä¾›äº†CASæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›falseï¼Œå¦‚æœéœ€è¦é‡è¯•ç­–ç•¥ï¼Œè‡ªå·±å®ç°ï¼</p><p>CASé—®é¢˜ï¼š</p><ul><li><p>CASåªèƒ½å¯¹ä¸€ä¸ªå˜é‡çš„ä¿®æ”¹å®ç°åŸå­æ€§ã€‚</p></li><li><p>CASå­˜åœ¨ABAé—®é¢˜ã€‚</p></li><li><p>Açº¿ç¨‹ä¿®æ”¹ä¸»å†…å­˜æ•°æ®ä»1~2ï¼Œå¡åœ¨äº†è·å–1ä¹‹åã€‚</p></li><li><p>Bçº¿ç¨‹ä¿®æ”¹ä¸»å†…å­˜æ•°æ®ä»1~2ï¼Œå®Œæˆã€‚</p></li><li><p>Cçº¿ç¨‹ä¿®æ”¹ä¸»å†…å­˜æ•°æ®ä»2~1ï¼Œå®Œæˆã€‚</p></li><li><p>Açº¿ç¨‹æ‰§è¡ŒCASæ“ä½œï¼Œå‘ç°ä¸»å†…å­˜æ˜¯1ï¼Œæ²¡é—®é¢˜ï¼Œç›´æ¥ä¿®æ”¹</p></li><li><p>è§£å†³æ–¹æ¡ˆï¼šåŠ ç‰ˆæœ¬å·</p></li><li><p>åœ¨CASæ‰§è¡Œæ¬¡æ•°è¿‡å¤šï¼Œä½†æ˜¯ä¾æ—§æ— æ³•å®ç°å¯¹æ•°æ®çš„ä¿®æ”¹ï¼ŒCPUä¼šä¸€ç›´è°ƒåº¦è¿™ä¸ªçº¿ç¨‹ï¼Œé€ æˆå¯¹CPUçš„æ€§èƒ½æŸè€—</p></li><li><p>synchronizedçš„å®ç°æ–¹å¼ï¼šCASè‡ªæ—‹ä¸€å®šæ¬¡æ•°åï¼Œå¦‚æœè¿˜ä¸æˆï¼ŒæŒ‚èµ·çº¿ç¨‹</p></li><li><p>LongAdderçš„å®ç°æ–¹å¼ï¼šå½“CASå¤±è´¥åï¼Œå°†æ“ä½œçš„å€¼ï¼Œå­˜å‚¨èµ·æ¥ï¼Œåç»­ä¸€èµ·æ·»åŠ </p></li></ul><p>CASï¼šåœ¨å¤šæ ¸æƒ…å†µä¸‹ï¼Œæœ‰lockæŒ‡ä»¤ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œå½“å‰CAS</p><h4 id="_1-2-æœ‰åºæ€§" tabindex="-1">1.2 æœ‰åºæ€§ <a class="header-anchor" href="#_1-2-æœ‰åºæ€§" aria-label="Permalink to &quot;1.2 æœ‰åºæ€§&quot;">â€‹</a></h4><p>æŒ‡ä»¤åœ¨CPUè°ƒåº¦æ‰§è¡Œæ—¶ï¼ŒCPUä¼šä¸ºäº†æå‡æ‰§è¡Œæ•ˆç‡ï¼Œåœ¨ä¸å½±å“ç»“æœçš„å‰æä¸‹ï¼Œå¯¹CPUæŒ‡ä»¤è¿›è¡Œé‡æ–°æ’åºã€‚</p><p>å¦‚æœä¸å¸Œæœ›CPUå¯¹æŒ‡å®šè¿›è¡Œé‡æ’åºï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¯ä»¥å¯¹å±æ€§è¿½åŠ volatileä¿®é¥°ï¼Œå°±ä¸ä¼šå¯¹å½“å‰å±æ€§çš„æ“ä½œè¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚</p><p>ä»€ä¹ˆæ—¶å€™æŒ‡ä»¤é‡æ’ï¼šæ»¡è¶³happens-beforeåŸåˆ™ï¼Œå³å¯é‡æ’åº</p><p>å•ä¾‹æ¨¡å¼-DCLåŒé‡åˆ¤æ–­ã€‚</p><p>ç”³è¯·å†…å­˜ï¼Œåˆå§‹åŒ–ï¼Œå…³è”æ˜¯æ­£å¸¸é¡ºåºï¼Œå¦‚æœCPUå¯¹æŒ‡ä»¤é‡æ’ï¼Œå¯èƒ½ä¼šé€ æˆ</p><p>ç”³è¯·å†…å­˜ï¼Œå…³è”ï¼Œåˆå§‹åŒ–ï¼Œåœ¨è¿˜æ²¡æœ‰åˆå§‹åŒ–æ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ¥è·å–æ•°æ®ï¼Œå¯¼è‡´è·å–åˆ°çš„æ•°æ®è™½ç„¶æœ‰åœ°å€å¼•ç”¨ï¼Œä½†æ˜¯å†…éƒ¨çš„æ•°æ®è¿˜æ²¡åˆå§‹åŒ–ï¼Œéƒ½æ˜¯é»˜è®¤å€¼ï¼Œå¯¼è‡´ä½¿ç”¨æ—¶ï¼Œå¯èƒ½å‡ºç°ä¸é¢„æœŸä¸ç¬¦çš„ç»“æœ</p><h4 id="_1-3-å¯è§æ€§" tabindex="-1">1.3 å¯è§æ€§ <a class="header-anchor" href="#_1-3-å¯è§æ€§" aria-label="Permalink to &quot;1.3 å¯è§æ€§&quot;">â€‹</a></h4><p>å¯è§æ€§ï¼šå‰é¢è¯´è¿‡CPUåœ¨å¤„ç†æ—¶ï¼Œéœ€è¦å°†ä¸»å†…å­˜æ•°æ®ç”©åˆ°æˆ‘çš„å¯„å­˜æœºä¸­å†æ‰§è¡ŒæŒ‡ä»¤ï¼ŒæŒ‡å‘å®ŒæŒ‡ä»¤åï¼Œéœ€è¦å°†å¯„å­˜å™¨æ•°æ®æ‰”å›åˆ°ä¸»å†…å­˜ä¸­ã€‚å€’æ˜¯å¯„å­˜å™¨æ•°æ®åŒæ­¥åˆ°ä¸»å†…å­˜æ˜¯éµå¾ªMESIåè®®çš„ï¼Œè¯´äººè¯å°±æ˜¯ï¼Œ</p><p>ä¸æ˜¯æ¯æ¬¡æ“ä½œç»“æŸå°±å°†CPUç¼“å­˜æ•°æ®åŒæ­¥åˆ°ä¸»å†…å­˜ã€‚é€ æˆå¤šä¸ªçº¿ç¨‹çœ‹åˆ°çš„æ•°æ®ä¸ä¸€æ ·ã€‚</p><p>volatileæ¯æ¬¡æ“ä½œåï¼Œç«‹å³åŒæ­¥æ•°æ®åˆ°ä¸»å†…å­˜ã€‚</p><p>synchronizedï¼Œè§¦å‘åŒæ­¥æ•°æ®åˆ°ä¸»å†…å­˜ã€‚</p><p>finalï¼Œä¹Ÿå¯ä»¥è§£å†³å¯è§æ€§é—®é¢˜ã€‚</p><h3 id="äºŒã€synchronizedä½¿ç”¨" tabindex="-1">äºŒã€synchronizedä½¿ç”¨ <a class="header-anchor" href="#äºŒã€synchronizedä½¿ç”¨" aria-label="Permalink to &quot;äºŒã€synchronizedä½¿ç”¨&quot;">â€‹</a></h3><h4 id="_2-1-synchronizedçš„ä½¿ç”¨æ–¹å¼" tabindex="-1">2.1 synchronizedçš„ä½¿ç”¨æ–¹å¼ <a class="header-anchor" href="#_2-1-synchronizedçš„ä½¿ç”¨æ–¹å¼" aria-label="Permalink to &quot;2.1 synchronizedçš„ä½¿ç”¨æ–¹å¼&quot;">â€‹</a></h4><p>synchronizedæ–¹æ³•</p><p>synchronizedä»£ç å—</p><p>ç±»é”å’Œå¯¹è±¡é”ï¼š</p><p>ç±»é”ï¼šåŸºç¡€å½“å‰ç±»çš„ClassåŠ é”</p><p>å¯¹è±¡é”ï¼šåŸºäºthiså¯¹è±¡åŠ é”</p><p>synchronizedæ˜¯äº’æ–¥é”ï¼Œæ¯ä¸ªçº¿ç¨‹è·å–synchronizedæ—¶ï¼ŒåŸºäºsynchronizedç»‘å®šçš„å¯¹è±¡å»è·å–é”ï¼</p><p><strong>synchronizedé”æ˜¯åŸºäºå¯¹è±¡å®ç°çš„ï¼</strong></p><p>synchronizedæ˜¯å¦‚ä½•åŸºäºå¯¹è±¡å®ç°çš„äº’æ–¥é”ï¼Œå…ˆäº†è§£å¯¹è±¡å†å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚</p><p>åœ¨Javaä¸­æŸ¥çœ‹ã€‚</p><p>å¯¼å…¥ä¾èµ–ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;jol-core&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;0.9&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre></div><p>æŸ¥çœ‹å¯¹è±¡ä¿¡æ¯</p><p>åˆå§‹åŒ–çš„å¯¹è±¡æ˜¯æ— é”çŠ¶æ€</p><h3 id="ä¸‰ã€synchronizedé”å‡çº§" tabindex="-1">ä¸‰ã€synchronizedé”å‡çº§ <a class="header-anchor" href="#ä¸‰ã€synchronizedé”å‡çº§" aria-label="Permalink to &quot;ä¸‰ã€synchronizedé”å‡çº§&quot;">â€‹</a></h3><p>synchronizedåœ¨jdk1.6ä¹‹å‰ï¼Œä¸€ç›´æ˜¯é‡é‡çº§é”ï¼šåªè¦çº¿ç¨‹è·å–é”èµ„æºå¤±è´¥ï¼Œç›´æ¥æŒ‚èµ·çº¿ç¨‹ï¼ˆç”¨æˆ·-å†…æ ¸ï¼‰</p><p>åœ¨jdk1.6ä¹‹å‰synchronizedæ•ˆç‡è´¼ä½ï¼Œå†åŠ ä¸ŠDoug Leaæ¨å‡ºäº†ReentrantLockï¼Œæ•ˆç‡æ¯”synchronizedå¿«å¤šäº†ï¼Œå¯¼è‡´JDKå›¢é˜Ÿä¸å¾—ä¸åœ¨jdk1.6å°†synchronizedåšä¼˜åŒ–</p><p>é”å‡çº§ï¼š</p><ul><li><p>æ— é”çŠ¶æ€ã€åŒ¿ååå‘çŠ¶æ€ï¼šæ²¡æœ‰çº¿ç¨‹æ‹¿é”ã€‚</p></li><li><p>åå‘é”çŠ¶æ€ï¼šæ²¡æœ‰çº¿ç¨‹çš„ç«äº‰ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å†è·å–é”èµ„æºã€‚<br><strong>çº¿ç¨‹ç«äº‰é”èµ„æºæ—¶ï¼Œå‘ç°å½“å‰synchronizedæ²¡æœ‰çº¿ç¨‹å ç”¨é”èµ„æºï¼Œå¹¶ä¸”é”æ˜¯åå‘é”ï¼Œä½¿ç”¨CASçš„æ–¹å¼ï¼Œè®¾ç½®oçš„çº¿ç¨‹IDä¸ºå½“å‰çº¿ç¨‹ï¼Œè·å–åˆ°é”èµ„æºï¼Œä¸‹æ¬¡å½“å‰çº¿ç¨‹å†æ¬¡è·å–æ—¶ï¼Œåªéœ€è¦åˆ¤æ–­æ˜¯åå‘é”ï¼Œå¹¶ä¸”çº¿ç¨‹IDæ˜¯å½“å‰çº¿ç¨‹IDå³å¯ï¼Œç›´æ¥è·å¾—åˆ°é”èµ„æºã€‚</strong></p></li><li><p>è½»é‡çº§é”ï¼šåå‘é”å‡ºç°ç«äº‰æ—¶ï¼Œä¼šå‡çº§åˆ°è½»é‡çº§é”ï¼ˆè§¦å‘åå‘é”æ’¤é”€ï¼‰ã€‚<br><strong>è½»é‡çº§é”çš„çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹ä¼šåŸºäºCASçš„æ–¹å¼ï¼Œå°è¯•è·å–é”èµ„æºï¼ŒCASçš„æ¬¡æ•°æ˜¯åŸºäºè‡ªé€‚åº”è‡ªæ—‹é”å®ç°çš„ï¼ŒJVMä¼šè‡ªåŠ¨çš„åŸºäºä¸Šä¸€æ¬¡è·å–é”æ˜¯å¦æˆåŠŸï¼Œæ¥å†³å®šè¿™æ¬¡è·å–é”èµ„æºè¦CASå¤šå°‘æ¬¡ã€‚</strong></p></li><li><p>é‡é‡çº§é”ï¼šè½»é‡çº§é”CASä¸€æ®µæ¬¡æ•°åï¼Œæ²¡æœ‰æ‹¿åˆ°é”èµ„æºï¼Œå‡çº§ä¸ºé‡é‡çº§é”ï¼ˆå…¶å®CASæ“ä½œæ˜¯åœ¨é‡é‡çº§é”æ—¶æ‰§è¡Œçš„ï¼‰ã€‚<br><strong>é‡é‡çº§é”å°±æ˜¯çº¿ç¨‹æ‹¿ä¸åˆ°é”ï¼Œå°±æŒ‚èµ·ã€‚</strong></p></li></ul><p>åå‘é”æ˜¯å»¶è¿Ÿå¼€å¯çš„ï¼Œå¹¶ä¸”åœ¨å¼€å¯åå‘é”ä¹‹åï¼Œé»˜è®¤ä¸å­˜åœ¨æ— é”çŠ¶æ€ï¼Œåªå­˜åœ¨åŒ¿ååå‘synchronizedå› ä¸ºä¸å­˜åœ¨ä»é‡é‡çº§é”é™çº§åˆ°åå‘æˆ–è€…æ˜¯è½»é‡ã€‚</p><p>synchronizedåœ¨åå‘é”å‡çº§åˆ°è½»é‡é”æ—¶ï¼Œä¼šæ¶‰åŠåˆ°åå‘é”æ’¤é”€ï¼Œéœ€è¦ç­‰åˆ°ä¸€ä¸ªå®‰å…¨ç‚¹ï¼Œstwï¼Œæ‰å¯ä»¥æ’¤é”€ï¼Œå¹¶å‘åå‘é”æ’¤é”€æ¯”è¾ƒæ¶ˆè€—èµ„æº<br> åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œåå‘é”æœ‰ä¸€ä¸ªå»¶è¿Ÿå¼€å¯çš„æ“ä½œï¼Œå› ä¸ºé¡¹ç›®å¯åŠ¨æ—¶ï¼ŒClassLoaderä¼šåŠ è½½.classæ–‡ä»¶ï¼Œè¿™é‡Œä¼šæ¶‰åŠåˆ°synchronizedæ“ä½œï¼Œ<br> ä¸ºäº†é¿å…å¯åŠ¨æ—¶ï¼Œæ¶‰åŠåˆ°åå‘é”æ’¤é”€ï¼Œå¯¼è‡´å¯åŠ¨æ•ˆç‡å˜æ…¢ï¼Œæ‰€ä»¥ç¨‹åºå¯åŠ¨æ—¶ï¼Œé»˜è®¤ä¸æ˜¯å¼€å¯åå‘é”çš„ã€‚<br> å¦‚æœåœ¨å¼€å¯åå‘é”çš„æƒ…å†µä¸‹ï¼ŒæŸ¥çœ‹å¯¹è±¡ï¼Œé»˜è®¤å¯¹è±¡æ˜¯åŒ¿ååå‘ã€‚</p><p>ç¼–è¯‘å™¨ä¼˜åŒ–çš„ç»“æœï¼Œå‡ºç°äº†ä¸‹åˆ—æ•ˆæœ</p><p>é”æ¶ˆé™¤ï¼šçº¿ç¨‹åœ¨æ‰§è¡Œä¸€æ®µsynchronizedä»£ç å—æ—¶ï¼Œå‘ç°æ²¡æœ‰å…±äº«æ•°æ®çš„æ“ä½œï¼Œè‡ªåŠ¨å¸®ä½ æŠŠsynchronizedå»æ‰ã€‚</p><p>é”è†¨èƒ€ï¼šåœ¨ä¸€ä¸ªå¤šæ¬¡å¾ªç¯çš„æ“ä½œä¸­é¢‘ç¹çš„è·å–å’Œé‡Šæ”¾é”èµ„æºï¼Œsynchronizedåœ¨ç¼–è¯‘æ—¶ï¼Œå¯èƒ½ä¼šä¼˜åŒ–åˆ°å¾ªç¯å¤–éƒ¨ã€‚</p><h3 id="å››ã€synchronized-objectmonitor" tabindex="-1">å››ã€synchronized-ObjectMonitor <a class="header-anchor" href="#å››ã€synchronized-objectmonitor" aria-label="Permalink to &quot;å››ã€synchronized-ObjectMonitor&quot;">â€‹</a></h3><p>æ¶‰åŠObjectMonitorä¸€èˆ¬æ˜¯åˆ°è¾¾äº†é‡é‡çº§é”æ‰ä¼šæ¶‰åŠåˆ°ã€‚</p><p>åœ¨åˆ°è¾¾é‡é‡çº§é”ä¹‹åï¼Œé‡é‡çº§é”çš„æŒ‡é’ˆä¼šæŒ‡å‘ObjectMonitorå¯¹è±¡ã€‚</p><p><a href="http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/69087d08d473/src/share/vm/runtime/objectMonitor.hpp" target="_blank" rel="noreferrer">http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/69087d08d473/src/share/vm/runtime/objectMonitor.hpp</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>  ObjectMonitor() {</span></span>
<span class="line"><span>    _header       = NULL;</span></span>
<span class="line"><span>    _count        = 0;     // æŠ¢å é”èµ„æºçš„çº¿ç¨‹ä¸ªæ•°</span></span>
<span class="line"><span>    _waiters      = 0,     // è°ƒç”¨waitçš„çº¿ç¨‹ä¸ªæ•°ã€‚</span></span>
<span class="line"><span>    _recursions   = 0;     // å¯é‡å…¥é”æ ‡è®°ï¼Œ</span></span>
<span class="line"><span>    _object       = NULL; </span></span>
<span class="line"><span>    _owner        = NULL;  // æŒæœ‰é”çš„çº¿ç¨‹</span></span>
<span class="line"><span>    _WaitSet      = NULL;  // waitçš„çº¿ç¨‹  ï¼ˆåŒå‘é“¾è¡¨ï¼‰</span></span>
<span class="line"><span>    _WaitSetLock  = 0 ;</span></span>
<span class="line"><span>    _Responsible  = NULL ;</span></span>
<span class="line"><span>    _succ         = NULL ;  // å‡å®šçš„ç»§æ‰¿äººï¼ˆé”é‡Šæ”¾åï¼Œè¢«å”¤é†’çš„çº¿ç¨‹ï¼Œæœ‰å¯èƒ½æ‹¿åˆ°é”èµ„æºï¼‰</span></span>
<span class="line"><span>    _cxq          = NULL ;  // æŒ‚èµ·çº¿ç¨‹å­˜æ”¾çš„ä½ç½®ã€‚ï¼ˆå•å‘é“¾è¡¨ï¼‰</span></span>
<span class="line"><span>    FreeNext      = NULL ;</span></span>
<span class="line"><span>    _EntryList    = NULL ;  // _cxqä¼šåœ¨ä¸€å®šçš„æœºåˆ¶ä¸‹ï¼Œå°†_cxqé‡Œçš„ç­‰å¾…çº¿ç¨‹æ‰”åˆ°å½“å‰_EntryListé‡Œã€‚  ï¼ˆåŒå‘é“¾è¡¨ï¼‰</span></span>
<span class="line"><span>    _SpinFreq     = 0 ;</span></span>
<span class="line"><span>    _SpinClock    = 0 ;</span></span>
<span class="line"><span>    OwnerIsThread = 0 ;</span></span>
<span class="line"><span>    _previous_owner_tid = 0;</span></span>
<span class="line"><span>  }</span></span></code></pre></div><p>åå‘é”ä¼šé™çº§åˆ°æ— é”çŠ¶æ€å˜›ï¼Ÿæ€ä¹ˆé™ï¼Ÿ</p><p>ä¼šï¼Œå½“åå‘é”çŠ¶æ€ä¸‹ï¼Œè·å–å½“å‰å¯¹è±¡çš„hashcodeå€¼ï¼Œä¼šå› ä¸ºå¯¹è±¡å¤´ç©ºé—´æ— æ³•å­˜å‚¨hashcodeï¼Œå¯¼è‡´é™çº§åˆ°æ— é”çŠ¶æ€ã€‚</p><h1 id="äºŒã€reentrantlockæºç " tabindex="-1">äºŒã€<strong>ReentrantLockæºç </strong> <a class="header-anchor" href="#äºŒã€reentrantlockæºç " aria-label="Permalink to &quot;äºŒã€**ReentrantLockæºç **&quot;">â€‹</a></h1><h3 id="ä¸€ã€reentrantlockä»‹ç»" tabindex="-1"><strong>ä¸€ã€ReentrantLockä»‹ç»</strong> <a class="header-anchor" href="#ä¸€ã€reentrantlockä»‹ç»" aria-label="Permalink to &quot;**ä¸€ã€ReentrantLockä»‹ç»**&quot;">â€‹</a></h3><p>Javaä¸­æä¾›é”ï¼Œä¸€èˆ¬å°±æ˜¯synchronizedå’Œlocké”ï¼ŒReentrantLockæ˜¯äº’æ–¥é”ï¼Œè·Ÿsynchronizedä¸€æ ·ã€‚</p><p>å¦‚æœç«äº‰æ¯”è¾ƒæ¿€çƒˆï¼Œæ¨èlocké”ï¼Œæ•ˆç‡æ›´é«˜</p><p>å¦‚æœå‡ ä¹æ²¡æœ‰ç«äº‰ï¼Œæ¨èsynchronized</p><p>åŸå› ï¼šsynchronizedåªæœ‰é”å‡çº§ï¼Œå½“å‡çº§åˆ°é‡é‡çº§é”åï¼Œæ— æ³•é™çº§åˆ°è½»é‡çº§ã€åå‘é”ã€‚</p><p>locké”çš„ä½¿ç”¨ç›¸å¯¹synchronizedæˆæœ¬æ›´é«˜ã€‚</p><p>synchronizedæ˜¯éå…¬å¹³é”ï¼Œlockæ˜¯å…¬å¹³+éå…¬å¹³é”</p><p>locké”æä¾›çš„åŠŸèƒ½æ›´å®Œå–„ï¼Œlockå¯ä»¥ä½¿ç”¨tryLockæŒ‡å®šç­‰å¾…é”çš„æ—¶é—´</p><p>locké”è¿˜æä¾›äº†lockInterruptiblyå…è®¸çº¿ç¨‹åœ¨è·å–é”çš„æœŸé—´è¢«ä¸­æ–­ã€‚</p><p>synchronizedåŸºäºå¯¹è±¡å®ç°ï¼Œlocké”åŸºäºAQS+CASå®ç°</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) {</span></span>
<span class="line"><span>    ReentrantLock lock = new ReentrantLock();</span></span>
<span class="line"><span>    lock.lock();</span></span>
<span class="line"><span>    try{</span></span>
<span class="line"><span>        // ä¸šåŠ¡ä»£ç </span></span>
<span class="line"><span>    }finally{</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äºŒã€reentrantlockçš„lockæ–¹æ³•æºç " tabindex="-1">äºŒã€<strong>ReentrantLockçš„lockæ–¹æ³•æºç </strong> <a class="header-anchor" href="#äºŒã€reentrantlockçš„lockæ–¹æ³•æºç " aria-label="Permalink to &quot;äºŒã€**ReentrantLockçš„lockæ–¹æ³•æºç **&quot;">â€‹</a></h3><p>æ¸…æ¥šlockæ–¹æ³•æ˜¯å¦‚ä½•å®ç°è®©å½“å‰çº¿ç¨‹è·å–åˆ°é”èµ„æºï¼ˆä»€ä¹ˆæ•ˆæœç®—æ˜¯æ‹¿åˆ°äº†é”èµ„æºï¼‰</p><p>éå…¬å¹³é”ï¼šä¸Šæ¥å…ˆå°è¯•å°†stateä»0ä¿®æ”¹ä¸º1ï¼Œå¦‚æœæˆåŠŸï¼Œä»£è¡¨è·å–é”èµ„æºã€‚å¦‚æœæ²¡æœ‰æˆåŠŸï¼Œè°ƒç”¨acquire</p><p>å…¬å¹³é”ï¼šè°ƒç”¨acquire</p><p>stateæ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿ</p><p>stateæ˜¯AQSä¸­çš„ä¸€ä¸ªç”±volatileä¿®é¥°çš„intç±»å‹å˜é‡ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šé€šè¿‡CASçš„æ–¹å¼ä¿®æ”¹stateï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æˆåŠŸçš„ä¿®æ”¹stateï¼ˆä»0~1ï¼‰</p><p>å¦‚æœçº¿ç¨‹ä¿®æ”¹stateå¤±è´¥æ€ä¹ˆåŠï¼Ÿ</p><p>å¦‚æœçº¿ç¨‹æ²¡æœ‰æ‹¿åˆ°é”èµ„æºï¼Œä¼šåˆ°AQSçš„åŒå‘é“¾è¡¨ä¸­æ’é˜Ÿç­‰å¾…ï¼ˆåœ¨æœŸé—´ï¼Œçº¿ç¨‹å¯èƒ½ä¼šæŒ‚èµ·ï¼‰</p><p>AQSçš„åŒå‘é“¾è¡¨ï¼ˆé˜Ÿåˆ—ï¼‰æ˜¯ä¸ªå•¥ï¼Ÿ</p><p>AQSä¸­çš„åŒå‘é“¾è¡¨æ˜¯åŸºäºå†…éƒ¨ç±»Nodeåœ¨ç»´æŠ¤ï¼ŒNodeä¸­åŒ…å«prevï¼Œnextï¼Œthreadå±æ€§ï¼Œå¹¶ä¸”åœ¨AQSä¸­è¿˜æœ‰ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯headï¼Œtailã€‚</p><p>ç”»ä¸€ä¸‹AQSçš„æ ¸å¿ƒ</p><p>å…¬å¹³&amp;éå…¬å¹³çš„æ–¹æ³•æºç </p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å…¬å¹³é”çš„syncçš„lockæ–¹æ³•</span></span>
<span class="line"><span>final void lock() {</span></span>
<span class="line"><span>    acquire(1);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// éå…¬å¹³é”çš„syncçš„lockæ–¹æ³•</span></span>
<span class="line"><span>final void lock() {</span></span>
<span class="line"><span>    if (compareAndSetState(0, 1))</span></span>
<span class="line"><span>        setExclusiveOwnerThread(Thread.currentThread());</span></span>
<span class="line"><span>    else</span></span>
<span class="line"><span>        acquire(1);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="ä¸‰ã€reentrantlockçš„acquireæ–¹æ³•æºç " tabindex="-1">ä¸‰ã€<strong>ReentrantLockçš„acquireæ–¹æ³•æºç </strong> <a class="header-anchor" href="#ä¸‰ã€reentrantlockçš„acquireæ–¹æ³•æºç " aria-label="Permalink to &quot;ä¸‰ã€**ReentrantLockçš„acquireæ–¹æ³•æºç **&quot;">â€‹</a></h3><p>acquireæ˜¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•ï¼Œé‡Œé¢å¹¶æ²¡æœ‰å®é™…çš„ä¸šåŠ¡å¤„ç†ï¼Œéƒ½æ˜¯åœ¨è°ƒç”¨å…¶ä»–æ–¹æ³•</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ ¸å¿ƒacquire     arg = 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> acquire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> arg) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //1. è°ƒç”¨tryAcquireæ–¹æ³•ï¼šå°è¯•è·å–é”èµ„æºï¼ˆéå…¬å¹³ã€å…¬å¹³ï¼‰ï¼Œæ‹¿åˆ°é”èµ„æºï¼Œè¿”å›trueï¼Œç›´æ¥ç»“æŸæ–¹æ³•ã€‚ æ²¡æœ‰æ‹¿åˆ°é”èµ„æºï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   éœ€è¦æ‰§è¡Œ&amp;&amp;åé¢çš„æ–¹æ³•</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //2. å½“æ²¡æœ‰è·å–é”èµ„æºåï¼Œä¼šå…ˆè°ƒç”¨addWaiterï¼šä¼šå°†æ²¡æœ‰è·å–åˆ°é”èµ„æºçš„çº¿ç¨‹å°è£…ä¸ºNodeå¯¹è±¡ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   å¹¶ä¸”æ’å…¥åˆ°AQSçš„é˜Ÿåˆ—çš„æœ«å°¾ï¼Œå¹¶ä¸”ä½œä¸ºtail</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //3. ç»§ç»­è°ƒç”¨acquireQueuedæ–¹æ³•ï¼ŒæŸ¥çœ‹å½“å‰æ’é˜Ÿçš„Nodeæ˜¯å¦åœ¨é˜Ÿåˆ—çš„å‰é¢ï¼Œå¦‚æœåœ¨å‰é¢ï¼ˆheadçš„nextï¼‰ï¼Œå°è¯•è·å–é”èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   å¦‚æœæ²¡åœ¨å‰é¢ï¼Œå°è¯•å°†çº¿ç¨‹æŒ‚èµ·ï¼Œé˜»å¡èµ·æ¥ï¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tryAcquire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arg) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        acquireQueued</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addWaiter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Node.EXCLUSIVE), arg))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        selfInterrupt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="å››ã€reentrantlockçš„tryacquireæ–¹æ³•" tabindex="-1">å››ã€<strong>ReentrantLockçš„tryAcquireæ–¹æ³•</strong> <a class="header-anchor" href="#å››ã€reentrantlockçš„tryacquireæ–¹æ³•" aria-label="Permalink to &quot;å››ã€**ReentrantLockçš„tryAcquireæ–¹æ³•**&quot;">â€‹</a></h3><p>tryAcquireåˆ†ä¸ºå…¬å¹³å’Œéå…¬å¹³ä¸¤ç§ã€</p><p>tryAcquireä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š</p><ul><li><p>å¦‚æœstateä¸º0ï¼Œå°è¯•è·å–é”èµ„æº</p></li><li><p>å¦‚æœstateä¸ä¸º0ï¼Œçœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯é”é‡å…¥æ“ä½œ</p></li></ul><p>éå…¬å¹³ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// éå…¬å¹³é”å®ç°ï¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> nonfairTryAcquire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> acquires) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ‹¿åˆ°å½“å‰çº¿ç¨‹ï¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Thread current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ‹¿åˆ°AQSçš„state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¦‚æœstate == 0ï¼Œè¯´æ˜æ²¡æœ‰çº¿ç¨‹å ç”¨ç€å½“å‰çš„é”èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ²¡äººå ç”¨é”èµ„æºï¼Œæˆ‘ç›´æ¥æŠ¢ä¸€æ³¢ï¼ˆä¸ç®¡æœ‰æ²¡æœ‰çº¿ç¨‹åœ¨æ’é˜Ÿï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compareAndSetState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, acquires)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // å°†å½“å‰å ç”¨è¿™ä¸ªäº’æ–¥é”çš„çº¿ç¨‹å±æ€§è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            setExclusiveOwnerThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(current);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // è¿”å›trueï¼Œæ‹¿é”æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å½“å‰state != 0ï¼Œè¯´æ˜æœ‰çº¿ç¨‹å ç”¨ç€é”èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆ¤æ–­æ‹¿ç€é”çš„çº¿ç¨‹æ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼ˆé”é‡å…¥ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getExclusiveOwnerThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å°†stateå†æ¬¡+1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nextc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> acquires;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // é”é‡å…¥æ˜¯å¦è¶…è¿‡æœ€å¤§é™åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 01111111 11111111 11111111 11111111   + 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 10000000 00000000 00000000 00000000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æŠ›å‡ºerror</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (nextc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Maximum lock count exceeded&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å°†å€¼è®¾ç½®ç»™state</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nextc);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è¿”å›trueï¼Œæ‹¿é”æˆåŠŸ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å…¬å¹³é”ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å…¬å¹³é”å®ç°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tryAcquire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> acquires) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ‹¿åˆ°å½“å‰çº¿ç¨‹ï¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Thread current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Thread.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ‹¿åˆ°AQSçš„state</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é˜¿å·´é˜¿å·´~~~~</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // åˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹åœ¨æ’é˜Ÿï¼Œå¦‚æœæœ‰çº¿ç¨‹æ’é˜Ÿï¼Œè¿”å›trueï¼Œé…ä¸Šå‰é¢çš„!ï¼Œé‚£ä¼šç›´æ¥ä¸æ‰§è¡Œè¿”å›æœ€å¤–å±‚çš„false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hasQueuedPredecessors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // å¦‚æœæ²¡æœ‰çº¿ç¨‹æ’é˜Ÿï¼Œç›´æ¥CASå°è¯•è·å–é”èµ„æº</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            compareAndSetState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, acquires)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            setExclusiveOwnerThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(current);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (current </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getExclusiveOwnerThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nextc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> acquires;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (nextc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Maximum lock count exceeded&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nextc);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="äº”ã€reentrantlockçš„addwaiteræ–¹æ³•" tabindex="-1">äº”ã€<strong>ReentrantLockçš„addWaiteræ–¹æ³•</strong> <a class="header-anchor" href="#äº”ã€reentrantlockçš„addwaiteræ–¹æ³•" aria-label="Permalink to &quot;äº”ã€**ReentrantLockçš„addWaiteræ–¹æ³•**&quot;">â€‹</a></h3><p>åœ¨è·å–é”èµ„æºå¤±è´¥åï¼Œéœ€è¦å°†å½“å‰çº¿ç¨‹å°è£…ä¸ºNodeå¯¹è±¡ï¼Œå¹¶ä¸”æ’å…¥åˆ°AQSé˜Ÿåˆ—çš„æœ«å°¾</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å°†å½“å‰çº¿ç¨‹å°è£…ä¸ºNodeå¯¹è±¡ï¼Œå¹¶ä¸”æ’å…¥åˆ°AQSé˜Ÿåˆ—çš„æœ«å°¾</span></span>
<span class="line"><span>private Node addWaiter(Node mode) {</span></span>
<span class="line"><span>    // å°†å½“å‰çº¿ç¨‹å°è£…ä¸ºNodeå¯¹è±¡ï¼Œmodeä¸ºnullï¼Œä»£è¡¨äº’æ–¥é”</span></span>
<span class="line"><span>    Node node = new Node(Thread.currentThread(), mode);</span></span>
<span class="line"><span>    // predæ˜¯tailèŠ‚ç‚¹</span></span>
<span class="line"><span>    Node pred = tail;</span></span>
<span class="line"><span>    // å¦‚æœpredä¸ä¸ºnullï¼Œæœ‰çº¿ç¨‹æ­£åœ¨æ’é˜Ÿ</span></span>
<span class="line"><span>    if (pred != null) {</span></span>
<span class="line"><span>        // å°†å½“å‰èŠ‚ç‚¹çš„prevï¼ŒæŒ‡å®štailå°¾èŠ‚ç‚¹</span></span>
<span class="line"><span>        node.prev = pred;</span></span>
<span class="line"><span>        // ä»¥CASçš„æ–¹å¼ï¼Œå°†å½“å‰èŠ‚ç‚¹å˜ä¸ºtailèŠ‚ç‚¹</span></span>
<span class="line"><span>        if (compareAndSetTail(pred, node)) {</span></span>
<span class="line"><span>            // ä¹‹å‰çš„tailçš„nextæŒ‡å‘å½“å‰èŠ‚ç‚¹</span></span>
<span class="line"><span>            pred.next = node;</span></span>
<span class="line"><span>            return node;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // æ·»åŠ çš„æµç¨‹ä¸ºï¼Œ  è‡ªå·±prevæŒ‡å‘ã€tailæŒ‡å‘è‡ªå·±ã€å‰èŠ‚ç‚¹nextæŒ‡å‘æˆ‘</span></span>
<span class="line"><span>    // å¦‚æœä¸Šè¿°æ–¹å¼ï¼ŒCASæ“ä½œå¤±è´¥ï¼Œå¯¼è‡´åŠ å…¥åˆ°AQSæœ«å°¾å¤±è´¥ï¼Œå¦‚æœå¤±è´¥ï¼Œå°±åŸºäºenqçš„æ–¹å¼æ·»åŠ åˆ°AQSé˜Ÿåˆ—</span></span>
<span class="line"><span>    enq(node);</span></span>
<span class="line"><span>    return node;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// enqï¼Œæ— è®ºæ€æ ·éƒ½æ·»åŠ è¿›å…¥</span></span>
<span class="line"><span>private Node enq(final Node node) {</span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        // æ‹¿åˆ°tail</span></span>
<span class="line"><span>        Node t = tail;</span></span>
<span class="line"><span>        // å¦‚æœtailä¸ºnullï¼Œè¯´æ˜å½“å‰æ²¡æœ‰Nodeåœ¨é˜Ÿåˆ—ä¸­</span></span>
<span class="line"><span>        if (t == null) { </span></span>
<span class="line"><span>            // åˆ›å»ºä¸€ä¸ªæ–°çš„Nodeä½œä¸ºheadï¼Œå¹¶ä¸”å°†tailå’ŒheadæŒ‡å‘ä¸€ä¸ªNode</span></span>
<span class="line"><span>            if (compareAndSetHead(new Node()))</span></span>
<span class="line"><span>                tail = head;</span></span>
<span class="line"><span>        } else {</span></span>
<span class="line"><span>            // å’Œä¸Šè¿°ä»£ç ä¸€è‡´ï¼</span></span>
<span class="line"><span>            node.prev = t;</span></span>
<span class="line"><span>            if (compareAndSetTail(t, node)) {</span></span>
<span class="line"><span>                t.next = node;</span></span>
<span class="line"><span>                return t;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å…­ã€reentrantlockçš„acquirequeued" tabindex="-1">å…­ã€<strong>ReentrantLockçš„acquireQueued</strong> <a class="header-anchor" href="#å…­ã€reentrantlockçš„acquirequeued" aria-label="Permalink to &quot;å…­ã€**ReentrantLockçš„acquireQueued**&quot;">â€‹</a></h3><p>acquireQueuedæ–¹æ³•ä¼šæŸ¥çœ‹å½“å‰æ’é˜Ÿçš„Nodeæ˜¯å¦æ˜¯headçš„nextï¼Œå¦‚æœæ˜¯ï¼Œå°è¯•è·å–é”èµ„æºï¼Œå¦‚æœä¸æ˜¯æˆ–è€…è·å–é”èµ„æºå¤±è´¥é‚£ä¹ˆå°±å°è¯•å°†å½“å‰Nodeçš„çº¿ç¨‹æŒ‚èµ·ï¼ˆunsafe.park()ï¼‰</p><p>åœ¨æŒ‚èµ·çº¿ç¨‹å‰ï¼Œéœ€è¦ç¡®è®¤å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å¿…é¡»æ˜¯å°äºç­‰äº0ï¼Œ</p><p>å¦‚æœä¸º1ï¼Œä»£è¡¨æ˜¯å–æ¶ˆçš„èŠ‚ç‚¹ï¼Œä¸èƒ½æŒ‚èµ·</p><p>å¦‚æœä¸º-1ï¼Œä»£è¡¨æŒ‚èµ·å½“å‰çº¿ç¨‹</p><p>å¦‚æœä¸º-2ï¼Œ-3ï¼Œéœ€è¦å°†çŠ¶æ€æ”¹ä¸º-1ä¹‹åï¼Œæ‰èƒ½æŒ‚èµ·å½“å‰çº¿ç¨‹</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// acquireQueuedæ–¹æ³•</span></span>
<span class="line"><span>// æŸ¥çœ‹å½“å‰æ’é˜Ÿçš„Nodeæ˜¯å¦æ˜¯headçš„nextï¼Œ</span></span>
<span class="line"><span>// å¦‚æœæ˜¯ï¼Œå°è¯•è·å–é”èµ„æºï¼Œ</span></span>
<span class="line"><span>// å¦‚æœä¸æ˜¯æˆ–è€…è·å–é”èµ„æºå¤±è´¥é‚£ä¹ˆå°±å°è¯•å°†å½“å‰Nodeçš„çº¿ç¨‹æŒ‚èµ·ï¼ˆunsafe.park()ï¼‰</span></span>
<span class="line"><span>final boolean acquireQueued(final Node node, int arg) {</span></span>
<span class="line"><span>    // æ ‡è¯†ã€‚</span></span>
<span class="line"><span>    boolean failed = true;</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // å¾ªç¯èµ°èµ·</span></span>
<span class="line"><span>        for (;;) {</span></span>
<span class="line"><span>            // æ‹¿åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹</span></span>
<span class="line"><span>            final Node p = node.predecessor();</span></span>
<span class="line"><span>            if (p == head &amp;&amp; // è¯´æ˜å½“å‰èŠ‚ç‚¹æ˜¯headçš„next</span></span>
<span class="line"><span>                tryAcquire(arg)) { // ç«äº‰é”èµ„æºï¼ŒæˆåŠŸï¼štrueï¼Œå¤±è´¥ï¼šfalse</span></span>
<span class="line"><span>                // è¿›æ¥è¯´æ˜æ‹¿åˆ°é”èµ„æºæˆåŠŸ</span></span>
<span class="line"><span>                // å°†å½“å‰èŠ‚ç‚¹ç½®ä½headï¼Œthreadå’Œprevå±æ€§ç½®ä½null</span></span>
<span class="line"><span>                setHead(node);</span></span>
<span class="line"><span>                // å¸®åŠ©å¿«é€ŸGC</span></span>
<span class="line"><span>                p.next = null; </span></span>
<span class="line"><span>                // è®¾ç½®è·å–é”èµ„æºæˆåŠŸ</span></span>
<span class="line"><span>                failed = false;</span></span>
<span class="line"><span>                // ä¸ç®¡çº¿ç¨‹ä¸­æ–­ã€‚</span></span>
<span class="line"><span>                return interrupted;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // å¦‚æœä¸æ˜¯æˆ–è€…è·å–é”èµ„æºå¤±è´¥,å°è¯•å°†çº¿ç¨‹æŒ‚èµ·</span></span>
<span class="line"><span>            // ç¬¬ä¸€ä¸ªäº‹æƒ…ï¼Œå½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€æ­£å¸¸ï¼</span></span>
<span class="line"><span>            // ç¬¬äºŒä¸ªäº‹æƒ…ï¼ŒæŒ‚èµ·çº¿ç¨‹</span></span>
<span class="line"><span>            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span></span>
<span class="line"><span>				// é€šè¿‡LockSupportå°†å½“å‰çº¿ç¨‹æŒ‚èµ·</span></span>
<span class="line"><span>                parkAndCheckInterrupt())</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        if (failed)</span></span>
<span class="line"><span>            cancelAcquire(node);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// ç¡®ä¿ä¸Šä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€æ˜¯æ­£ç¡®çš„</span></span>
<span class="line"><span>private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {</span></span>
<span class="line"><span>    // æ‹¿åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€</span></span>
<span class="line"><span>    int ws = pred.waitStatus;</span></span>
<span class="line"><span>    // å¦‚æœä¸Šä¸€ä¸ªèŠ‚ç‚¹ä¸º -1</span></span>
<span class="line"><span>    if (ws == Node.SIGNAL)</span></span>
<span class="line"><span>        // è¿”å›trueï¼ŒæŒ‚èµ·çº¿ç¨‹</span></span>
<span class="line"><span>        return true;</span></span>
<span class="line"><span>    // å¦‚æœä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯å–æ¶ˆçŠ¶æ€</span></span>
<span class="line"><span>    if (ws &gt; 0) {</span></span>
<span class="line"><span>        // å¾ªç¯å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªçŠ¶æ€å°äºç­‰äº0çš„èŠ‚ç‚¹</span></span>
<span class="line"><span>        do {</span></span>
<span class="line"><span>            node.prev = pred = pred.prev;</span></span>
<span class="line"><span>        } while (pred.waitStatus &gt; 0);</span></span>
<span class="line"><span>        pred.next = node;</span></span>
<span class="line"><span>    } else {</span></span>
<span class="line"><span>        // å°†å°äºç­‰äº0çš„èŠ‚ç‚¹çŠ¶æ€è¯¥ä¸º-1</span></span>
<span class="line"><span>        compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return false;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="ä¸ƒã€reentrantlockçš„unlockæ–¹æ³•" tabindex="-1">ä¸ƒã€<strong>ReentrantLockçš„unlockæ–¹æ³•</strong> <a class="header-anchor" href="#ä¸ƒã€reentrantlockçš„unlockæ–¹æ³•" aria-label="Permalink to &quot;ä¸ƒã€**ReentrantLockçš„unlockæ–¹æ³•**&quot;">â€‹</a></h3><p>é‡Šæ”¾é”èµ„æºï¼š</p><ul><li><p>å°†state-1ã€‚</p></li><li><p>å¦‚æœstateå‡ä¸º0äº†ï¼Œå”¤é†’åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿçš„Nodeã€‚ï¼ˆä¸€å®šå”¤é†’ç¦»headæœ€è¿‘çš„ï¼‰</p></li></ul><p>é‡Šæ”¾é”ä¸åˆ†å…¬å¹³å’Œéå…¬å¹³ï¼Œå°±ä¸€ä¸ªæ–¹æ³•ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// çœŸæ­£é‡Šæ”¾é”èµ„æºçš„æ–¹æ³•</span></span>
<span class="line"><span>public final boolean release(int arg) {</span></span>
<span class="line"><span>    // æ ¸å¿ƒçš„é‡Šæ”¾é”èµ„æºæ–¹æ³•</span></span>
<span class="line"><span>    if (tryRelease(arg)) {</span></span>
<span class="line"><span>        // é‡Šæ”¾é”èµ„æºé‡Šæ”¾å¹²å‡€äº†ã€‚  ï¼ˆstate == 0ï¼‰</span></span>
<span class="line"><span>        Node h = head;</span></span>
<span class="line"><span>        // å¦‚æœå¤´èŠ‚ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´èŠ‚ç‚¹çš„çŠ¶æ€ä¸ä¸º0ï¼Œå”¤é†’æ’é˜Ÿçš„çº¿ç¨‹</span></span>
<span class="line"><span>        if (h != null &amp;&amp; h.waitStatus != 0)ã€</span></span>
<span class="line"><span>            // å”¤é†’çº¿ç¨‹</span></span>
<span class="line"><span>            unparkSuccessor(h);</span></span>
<span class="line"><span>        return true;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // é‡Šæ”¾é”æˆåŠŸï¼Œä½†æ˜¯state != 0</span></span>
<span class="line"><span>    return false;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>// æ ¸å¿ƒçš„é‡Šæ”¾é”èµ„æºæ–¹æ³•</span></span>
<span class="line"><span>protected final boolean tryRelease(int releases) {</span></span>
<span class="line"><span>    // è·å–state - 1</span></span>
<span class="line"><span>    int c = getState() - releases;</span></span>
<span class="line"><span>    // å¦‚æœé‡Šæ”¾é”çš„çº¿ç¨‹ä¸æ˜¯å ç”¨é”çš„çº¿ç¨‹ï¼ŒæŠ›å¼‚å¸¸</span></span>
<span class="line"><span>    if (Thread.currentThread() != getExclusiveOwnerThread())</span></span>
<span class="line"><span>        throw new IllegalMonitorStateException();</span></span>
<span class="line"><span>    // æ˜¯å¦æˆåŠŸçš„å°†é”èµ„æºé‡Šæ”¾åˆ©ç´¢ ï¼ˆstate == 0ï¼‰</span></span>
<span class="line"><span>    boolean free = false;</span></span>
<span class="line"><span>    if (c == 0) {</span></span>
<span class="line"><span>        // é”èµ„æºé‡Šæ”¾å¹²å‡€ã€‚</span></span>
<span class="line"><span>        free = true;</span></span>
<span class="line"><span>        // å°†å ç”¨é”èµ„æºçš„å±æ€§è®¾ç½®ä¸ºnull</span></span>
<span class="line"><span>        setExclusiveOwnerThread(null);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // å°†stateèµ‹å€¼</span></span>
<span class="line"><span>    setState(c);</span></span>
<span class="line"><span>    // è¿”å›trueï¼Œä»£è¡¨é‡Šæ”¾å¹²å‡€äº†</span></span>
<span class="line"><span>    return free;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å”¤é†’èŠ‚ç‚¹</span></span>
<span class="line"><span>private void unparkSuccessor(Node node) {</span></span>
<span class="line"><span>    // æ‹¿åˆ°å¤´èŠ‚ç‚¹çŠ¶æ€</span></span>
<span class="line"><span>    int ws = node.waitStatus;</span></span>
<span class="line"><span>    // å¦‚æœå¤´èŠ‚ç‚¹çŠ¶æ€å°äº0ï¼Œæ¢ä¸º0</span></span>
<span class="line"><span>    if (ws &lt; 0)</span></span>
<span class="line"><span>        compareAndSetWaitStatus(node, ws, 0);</span></span>
<span class="line"><span>    // æ‹¿åˆ°å½“å‰èŠ‚ç‚¹çš„next</span></span>
<span class="line"><span>    Node s = node.next;</span></span>
<span class="line"><span>    // å¦‚æœs == null ï¼Œæˆ–è€…sçš„çŠ¶æ€ä¸º1</span></span>
<span class="line"><span>    if (s == null || s.waitStatus &gt; 0) {</span></span>
<span class="line"><span>        // nextèŠ‚ç‚¹ä¸éœ€è¦å”¤é†’ï¼Œéœ€è¦å”¤é†’nextçš„next</span></span>
<span class="line"><span>        s = null;</span></span>
<span class="line"><span>        // ä»å°¾éƒ¨å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°çŠ¶æ€æ­£å¸¸çš„èŠ‚ç‚¹ã€‚ï¼ˆå°äºç­‰äº0ä»£è¡¨æ­£å¸¸çŠ¶æ€ï¼‰</span></span>
<span class="line"><span>        for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev)</span></span>
<span class="line"><span>            if (t.waitStatus &lt;= 0)</span></span>
<span class="line"><span>                s = t;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // ç»è¿‡å¾ªç¯çš„è·å–ï¼Œå¦‚æœæ‹¿åˆ°çŠ¶æ€æ­£å¸¸çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸ä¸ºnull</span></span>
<span class="line"><span>    if (s != null)</span></span>
<span class="line"><span>        // å”¤é†’çº¿ç¨‹</span></span>
<span class="line"><span>        LockSupport.unpark(s.thread);</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>ä¸ºä»€ä¹ˆå”¤é†’çº¿ç¨‹æ—¶ï¼Œä¸ºå•¥ä»å°¾éƒ¨å¾€å‰æ‰¾ï¼Œè€Œä¸æ˜¯ä»å‰å¾€åæ‰¾ï¼Ÿ</p><p>å› ä¸ºåœ¨addWaiteræ“ä½œæ—¶ï¼Œæ˜¯å…ˆå°†å½“å‰Nodeçš„prevæŒ‡é’ˆæŒ‡å‘å‰é¢çš„èŠ‚ç‚¹ï¼Œç„¶åæ˜¯å°†tailèµ‹å€¼ç»™å½“å‰Nodeï¼Œæœ€åæ‰æ˜¯èƒ½ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„nextæŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰Nodeã€‚</p><p>å¦‚æœä»å‰å¾€åï¼Œé€šè¿‡nextå»æ‰¾ï¼Œå¯èƒ½ä¼šä¸¢å¤±æŸä¸ªèŠ‚ç‚¹ï¼Œå¯¼è‡´è¿™ä¸ªèŠ‚ç‚¹ä¸ä¼šè¢«å”¤é†’~</p><p>å¦‚æœä»åå¾€å‰æ‰¾ï¼Œè‚¯å®šå¯ä»¥æ‰¾åˆ°å…¨éƒ¨çš„èŠ‚ç‚¹ã€‚</p><h1 id="ä¸‰ã€reentrantreadwritelockè¯»å†™é”æºç " tabindex="-1">ä¸‰ã€<strong>ReentrantReadWriteLockè¯»å†™é”æºç </strong> <a class="header-anchor" href="#ä¸‰ã€reentrantreadwritelockè¯»å†™é”æºç " aria-label="Permalink to &quot;ä¸‰ã€**ReentrantReadWriteLockè¯»å†™é”æºç **&quot;">â€‹</a></h1><h3 id="ä¸€ã€ä¸ºä»€ä¹ˆè¦å‡ºç°è¯»å†™é”" tabindex="-1">ä¸€ã€ä¸ºä»€ä¹ˆè¦å‡ºç°è¯»å†™é” <a class="header-anchor" href="#ä¸€ã€ä¸ºä»€ä¹ˆè¦å‡ºç°è¯»å†™é”" aria-label="Permalink to &quot;ä¸€ã€ä¸ºä»€ä¹ˆè¦å‡ºç°è¯»å†™é”&quot;">â€‹</a></h3><p>å› ä¸ºReentrantLockæ˜¯äº’æ–¥é”ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ“ä½œæ˜¯è¯»å¤šå†™å°‘ï¼ŒåŒæ—¶è¿˜éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œé‚£ä¹ˆä½¿ç”¨ReentrantLockä¼šå¯¼è‡´æ•ˆç‡æ¯”è¾ƒä½ã€‚</p><p>å› ä¸ºå¤šä¸ªçº¿ç¨‹åœ¨å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œè¯»æ“ä½œæ—¶ï¼Œä¹Ÿä¸ä¼šé€ æˆçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>æ‰€ä»¥å‡ºç°äº†ReentrantReadWriteLocké”ï¼š</p><p>è¯»è¯»æ“ä½œæ˜¯å…±äº«çš„ã€‚</p><p>å†™å†™æ“ä½œæ˜¯äº’æ–¥çš„ã€‚</p><p>è¯»å†™æ“ä½œæ˜¯äº’æ–¥çš„ã€‚</p><p>å†™è¯»æ“ä½œæ˜¯äº’æ–¥çš„ã€‚</p><p>å•ä¸ªçº¿ç¨‹è·å–å†™é”åï¼Œå†æ¬¡è·å–è¯»é”ï¼Œå¯ä»¥æ‹¿åˆ°ã€‚ï¼ˆå†™è¯»å¯é‡å…¥ï¼‰</p><p>å•ä¸ªçº¿ç¨‹è·å–è¯»é”åï¼Œå†æ¬¡è·å–å†™é”ï¼Œæ‹¿ä¸åˆ°ã€‚ï¼ˆè¯»å†™ä¸å¯é‡å…¥ï¼‰</p><p>ä½¿ç”¨æ–¹å¼ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public class XxxTest {</span></span>
<span class="line"><span>    // è¯»å†™é”ï¼</span></span>
<span class="line"><span>    static ReentrantReadWriteLock lock = new ReentrantReadWriteLock();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // å†™é”</span></span>
<span class="line"><span>    static ReentrantReadWriteLock.WriteLock writeLock = lock.writeLock();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // è¯»é”</span></span>
<span class="line"><span>    static ReentrantReadWriteLock.ReadLock readLock = lock.readLock();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    public static void main(String[] args) throws InterruptedException {</span></span>
<span class="line"><span>        readLock.lock();</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            System.out.println(&quot;æ‹¿åˆ°è¯»é”ï¼&quot;);</span></span>
<span class="line"><span>        } finally {</span></span>
<span class="line"><span>            readLock.unlock();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        writeLock.lock();</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            System.out.println(&quot;æ‹¿åˆ°å†™é”ï¼&quot;);</span></span>
<span class="line"><span>        } finally {</span></span>
<span class="line"><span>            writeLock.unlock();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äºŒã€è¯»å†™é”çš„æ ¸å¿ƒæ€æƒ³" tabindex="-1">äºŒã€è¯»å†™é”çš„æ ¸å¿ƒæ€æƒ³ <a class="header-anchor" href="#äºŒã€è¯»å†™é”çš„æ ¸å¿ƒæ€æƒ³" aria-label="Permalink to &quot;äºŒã€è¯»å†™é”çš„æ ¸å¿ƒæ€æƒ³&quot;">â€‹</a></h3><p>ReentrantReadWriteLockè¿˜æ˜¯åŸºäºAQSå®ç°çš„ã€‚å¾ˆå¤šåŠŸèƒ½çš„å®ç°å’ŒReentrantLockç±»ä¼¼</p><p>è¿˜æ˜¯åŸºäºAQSçš„stateæ¥ç¡®å®šå½“å‰çº¿ç¨‹æ˜¯å¦æ‹¿åˆ°é”èµ„æº</p><p>stateè¡¨ç¤ºè¯»é”ï¼šå°†stateçš„é«˜16ä½ä½œä¸ºè¯»é”çš„æ ‡è¯†</p><p>stateè¡¨ç¤ºå†™é”ï¼šå°†stateçš„ä½16ä½ä½œä¸ºå†™é”çš„æ ‡è¯†</p><p>é”é‡å…¥é—®é¢˜ï¼š</p><ul><li><p>å†™é”é‡å…¥æ€ä¹ˆç©ï¼šå› ä¸ºå†™æ“ä½œå’Œå…¶ä»–æ“ä½œæ˜¯äº’æ–¥çš„ï¼Œä»£è¡¨åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ç€å†™é”ï¼Œåªè¦é”é‡å…¥ï¼Œå°±å¯¹ä½ä½+1å³å¯ã€‚è€Œä¸”é”é‡å…¥çš„é™åˆ¶ï¼Œä»åŸæ¥çš„2^31 - 1ï¼Œå˜ä¸ºäº†2 ^ 16 -1ã€‚å˜çŸ­äº†~~</p></li><li><p>è¯»é”é‡å…¥æ€ä¹ˆç©ï¼šè¯»é”çš„é‡å…¥ä¸èƒ½ä»¿ç…§å†™é”çš„æ–¹å¼ï¼Œå› ä¸ºå†™é”å±äºäº’æ–¥é”ï¼ŒåŒä¸€æ—¶é—´åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”ï¼Œä½†æ˜¯è¯»é”æ˜¯å…±äº«é”ï¼ŒåŒä¸€æ—¶é—´ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æŒæœ‰è¯»é”ã€‚æ‰€ä»¥æ¯ä¸ªè·å–åˆ°è¯»é”çš„çº¿ç¨‹ï¼Œè®°å½•é”é‡å…¥çš„æ–¹å¼éƒ½æ˜¯åŸºäºè‡ªå·±çš„ThreadLocalå­˜å‚¨é”é‡å…¥æ¬¡æ•°ã€‚</p></li></ul><p>è¯»é”é‡å…¥çš„æ—¶å€™å°±ä¸æ“ä½œstateäº†ï¼Ÿä¸å¯¹ï¼Œæ¯æ¬¡é”é‡å…¥è¿˜è¦ä¿®æ”¹stateï¼Œåªæ˜¯è®°å½•å½“å‰çº¿ç¨‹é”é‡å…¥çš„æ¬¡æ•°ï¼Œéœ€è¦åŸºäºThreadLocalè®°å½•</p><p>00000000 00000000 00000000 00000000 ï¼š state</p><p>å†™é”ï¼š</p><p>00000000 00000000 00000000 00000001</p><p>å†™é”ï¼š</p><p>00000000 00000000 00000000 00000010</p><p>Aè¯»é”ï¼šæ‹¿ä¸åˆ°ï¼Œæ’é˜Ÿ</p><p>00000000 00000000 00000000 00000010</p><p>å†™é”å…¨éƒ¨é‡Šæ”¾ï¼ˆå”¤é†’ï¼‰</p><p>00000000 00000000 00000000 00000000</p><p>Aè¯»é”ï¼š</p><p>00000000 00000001 00000000 00000000</p><p>Bè¯»é”ï¼š</p><p>00000000 00000010 00000000 00000000</p><p>Bå†æ¬¡è¯»é”ï¼š</p><p>00000000 00000011 00000000 00000000</p><p>æ¯ä¸ªè¯»æ“ä½œçš„çº¿ç¨‹ï¼Œåœ¨è·å–è¯»é”æ—¶ï¼Œéƒ½éœ€è¦å¼€è¾Ÿä¸€ä¸ªThreadLocalã€‚è¯»å†™é”ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªäº‹æƒ…ï¼Œåšäº†ä¸¤æ‰‹æ“ä½œï¼š</p><ul><li><p>ç¬¬ä¸€ä¸ªæ‹¿åˆ°è¯»é”çš„çº¿ç¨‹ï¼Œä¸ç”¨ThreadLocalè®°å½•é‡å…¥æ¬¡æ•°ï¼Œåœ¨è¯»å†™é”å†…æœ‰æœ‰ä¸€ä¸ªfirstReadè®°å½•é‡å…¥æ¬¡æ•°</p></li><li><p>è¿˜è®°å½•äº†æœ€åä¸€ä¸ªæ‹¿åˆ°è¯»é”çš„çº¿ç¨‹çš„é‡å…¥æ¬¡æ•°ï¼Œäº¤ç»™cachedHoldCounterå±æ€§æ ‡è¯†ï¼Œå¯ä»¥é¿å…é¢‘ç¹çš„åœ¨é”é‡å…¥æ—¶ï¼Œä»TLä¸­è·å–</p></li></ul><h3 id="ä¸‰ã€å†™é”çš„æ“ä½œ" tabindex="-1">ä¸‰ã€å†™é”çš„æ“ä½œ <a class="header-anchor" href="#ä¸‰ã€å†™é”çš„æ“ä½œ" aria-label="Permalink to &quot;ä¸‰ã€å†™é”çš„æ“ä½œ&quot;">â€‹</a></h3><h4 id="_3-1-å†™é”åŠ é”-acquire" tabindex="-1">3.1 å†™é”åŠ é”-acquire <a class="header-anchor" href="#_3-1-å†™é”åŠ é”-acquire" aria-label="Permalink to &quot;3.1 å†™é”åŠ é”-acquire&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public final void acquire(int arg) {</span></span>
<span class="line"><span>    // å°è¯•è·å–é”èµ„æºï¼ˆçœ‹ä¸€ä¸‹ï¼Œèƒ½å¦ä»¥CASçš„æ–¹å¼å°†state ä»0 ~ 1ï¼Œæ”¹æˆåŠŸï¼Œæ‹¿é”æˆåŠŸï¼‰</span></span>
<span class="line"><span>    // æˆåŠŸèµ°äºº</span></span>
<span class="line"><span>    // ä¸æˆåŠŸæ‰§è¡Œä¸‹é¢æ–¹æ³•</span></span>
<span class="line"><span>    if (!tryAcquire(arg) &amp;&amp;</span></span>
<span class="line"><span>        // addWaiterï¼šå°†å½“å‰æ²¡æŒ‰åˆ°é”èµ„æºçš„ï¼Œå°è£…æˆNodeï¼Œæ’åˆ°AQSé‡Œ</span></span>
<span class="line"><span>        // acquireQueuedï¼šå½“å‰æ’é˜Ÿçš„èƒ½å¦ç«äº‰é”èµ„æºï¼Œä¸èƒ½æŒ‚èµ·çº¿ç¨‹é˜»å¡</span></span>
<span class="line"><span>        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span></span>
<span class="line"><span>        selfInterrupt();</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>å› ä¸ºéƒ½æ˜¯AQSçš„å®ç°ï¼Œä¸»è¦çœ‹tryAcquire</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// stateï¼Œé«˜16ï¼šè¯»ï¼Œä½16ï¼šå†™</span></span>
<span class="line"><span>00000000 00000000 00000000 00000000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>00000000 00000001 00000000 00000000 - SHARED_UNIT</span></span>
<span class="line"><span></span></span>
<span class="line"><span>00000000 00000000 11111111 11111111 - MAX_COUNT</span></span>
<span class="line"><span></span></span>
<span class="line"><span>00000000 00000000 11111111 11111111 - EXCLUSIVE_MASK</span></span>
<span class="line"><span>&amp;</span></span>
<span class="line"><span>00000000 00000000 00000000 00000001 </span></span>
<span class="line"><span></span></span>
<span class="line"><span>static final int SHARED_SHIFT   = 16;</span></span>
<span class="line"><span>static final int SHARED_UNIT    = (1 &lt;&lt; SHARED_SHIFT);</span></span>
<span class="line"><span>static final int MAX_COUNT      = (1 &lt;&lt; SHARED_SHIFT) - 1;</span></span>
<span class="line"><span>static final int EXCLUSIVE_MASK = (1 &lt;&lt; SHARED_SHIFT) - 1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// åªæ‹¿åˆ°è¡¨ç¤ºè¯»é”çš„é«˜16ä½ã€‚</span></span>
<span class="line"><span>static int sharedCount(int c)    { return c &gt;&gt;&gt; SHARED_SHIFT; }</span></span>
<span class="line"><span>// åªæ‹¿åˆ°è¡¨ç¤ºå†™é”çš„ä½16ä½ã€‚</span></span>
<span class="line"><span>static int exclusiveCount(int c) { return c &amp; EXCLUSIVE_MASK; }</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è¯»å†™é”çš„å†™é”ï¼Œè·å–æµç¨‹</span></span>
<span class="line"><span>protected final boolean tryAcquire(int acquires) {</span></span>
<span class="line"><span>    // æ‹¿åˆ°å½“å‰çº¿ç¨‹</span></span>
<span class="line"><span>    Thread current = Thread.currentThread();</span></span>
<span class="line"><span>    // æ‹¿åˆ°state</span></span>
<span class="line"><span>    int c = getState();</span></span>
<span class="line"><span>    // æ‹¿åˆ°äº†å†™é”çš„ä½16ä½æ ‡è¯†w</span></span>
<span class="line"><span>    int w = exclusiveCount(c);</span></span>
<span class="line"><span>    // c != 0ï¼šè¦ä¹ˆæœ‰è¯»æ“ä½œæ‹¿ç€é”ï¼Œè¦ä¹ˆæœ‰å†™æ“ä½œæ‹¿ç€é”</span></span>
<span class="line"><span>    if (c != 0) {</span></span>
<span class="line"><span>        // å¦‚æœw == 0ï¼Œä»£è¡¨æ²¡æœ‰å†™é”ï¼Œæ‹¿ä¸åˆ°ï¼æ‹œæ‹œï¼</span></span>
<span class="line"><span>        // å¦‚æœw != 0ï¼Œä»£è¡¨æœ‰å†™é”ï¼Œçœ‹ä¸€ä¸‹æ‹¿å ç”¨å†™é”æ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œæ‹¿ä¸åˆ°ï¼æ‹œæ‹œï¼</span></span>
<span class="line"><span>        if (w == 0 || current != getExclusiveOwnerThread())</span></span>
<span class="line"><span>            return false;</span></span>
<span class="line"><span>        // åˆ°è¿™ï¼Œè¯´æ˜è‚¯å®šæ˜¯å†™é”ï¼Œå¹¶ä¸”æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰</span></span>
<span class="line"><span>        // åˆ¤æ–­å¯¹ä½ä½ + 1ï¼Œæ˜¯å¦ä¼šè¶…è¿‡MAX_COUNTï¼Œè¶…è¿‡æŠ›Error</span></span>
<span class="line"><span>        if (w + exclusiveCount(acquires) &gt; MAX_COUNT)</span></span>
<span class="line"><span>            throw new Error(&quot;Maximum lock count exceeded&quot;);</span></span>
<span class="line"><span>        // å¦‚æœæ²¡è¶…è¿‡é”é‡å…¥æ¬¡æ•°ï¼Œ + 1ï¼Œè¿”å›trueï¼Œæ‹¿åˆ°é”èµ„æºã€‚</span></span>
<span class="line"><span>        setState(c + acquires);</span></span>
<span class="line"><span>        return true;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // åˆ°è¿™ï¼Œè¯´æ˜c == 0</span></span>
<span class="line"><span>    // è¯»å†™é”ä¹Ÿåˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”</span></span>
<span class="line"><span>    // å…¬å¹³ï¼šçœ‹ä¸‹æ’é˜Ÿä¸ï¼Œæ’é˜Ÿå°±ä¸æŠ¢äº†</span></span>
<span class="line"><span>    // èµ°hasQueuedPredecessorsæ–¹æ³•ï¼Œæœ‰æ’é˜Ÿçš„è¿”å›trueï¼Œæ²¡æ’é˜Ÿçš„è¿”å›false</span></span>
<span class="line"><span>    // éå…¬å¹³ï¼šç›´æ¥æŠ¢ï¼</span></span>
<span class="line"><span>    // æ–¹æ³•å®ç°ç›´æ¥è¿”å›false</span></span>
<span class="line"><span>    if (writerShouldBlock() ||</span></span>
<span class="line"><span>        // ä»¥CASçš„æ–¹å¼ï¼Œå°†stateä»0ä¿®æ”¹ä¸º 1</span></span>
<span class="line"><span>        !compareAndSetState(c, c + acquires))</span></span>
<span class="line"><span>        // è¦ä¹ˆä¸è®©æŠ¢ï¼Œè¦ä¹ˆCASæ“ä½œå¤±è´¥ï¼Œè¿”å›false</span></span>
<span class="line"><span>        return false;</span></span>
<span class="line"><span>    // å°†å½“å‰æŒæœ‰äº’æ–¥é”çš„çº¿ç¨‹ï¼Œè®¾ç½®ä¸ºè‡ªå·±</span></span>
<span class="line"><span>    setExclusiveOwnerThread(current);</span></span>
<span class="line"><span>    return true;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h5 id="å‰©ä¸‹çš„addwaiterå’Œacquirequeuedå’Œreentrantlockçœ‹çš„ä¸€æ ·-éƒ½æ˜¯aqsè‡ªèº«æä¾›çš„æ–¹æ³•" tabindex="-1">å‰©ä¸‹çš„addWaiterå’ŒacquireQueuedå’ŒReentrantLockçœ‹çš„ä¸€æ ·ï¼Œéƒ½æ˜¯AQSè‡ªèº«æä¾›çš„æ–¹æ³• <a class="header-anchor" href="#å‰©ä¸‹çš„addwaiterå’Œacquirequeuedå’Œreentrantlockçœ‹çš„ä¸€æ ·-éƒ½æ˜¯aqsè‡ªèº«æä¾›çš„æ–¹æ³•" aria-label="Permalink to &quot;å‰©ä¸‹çš„addWaiterå’ŒacquireQueuedå’ŒReentrantLockçœ‹çš„ä¸€æ ·ï¼Œéƒ½æ˜¯AQSè‡ªèº«æä¾›çš„æ–¹æ³•&quot;">â€‹</a></h5><h4 id="_3-2-å†™é”-é‡Šæ”¾é”æ“ä½œ" tabindex="-1">3.2 å†™é”-é‡Šæ”¾é”æ“ä½œ <a class="header-anchor" href="#_3-2-å†™é”-é‡Šæ”¾é”æ“ä½œ" aria-label="Permalink to &quot;3.2 å†™é”-é‡Šæ”¾é”æ“ä½œ&quot;">â€‹</a></h4><p>è¯»å†™é”çš„é‡Šæ”¾æ“ä½œï¼Œè·ŸReentrantLockä¸€è‡´ï¼Œåªæ˜¯éœ€è¦å•ç‹¬è·å–ä½16ä½ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º0ï¼Œä¸º0å°±é‡Šæ”¾æˆåŠŸ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å†™é”çš„é‡Šæ”¾é”</span></span>
<span class="line"><span>public final boolean release(int arg) {</span></span>
<span class="line"><span>    // åªæœ‰tryRealseæ˜¯è¯»å†™é”é‡æ–°å®ç°çš„æ–¹æ³•ï¼Œå…¶ä»–çš„å’ŒReentrantLockä¸€è‡´</span></span>
<span class="line"><span>    if (tryRelease(arg)) {</span></span>
<span class="line"><span>        Node h = head;</span></span>
<span class="line"><span>        if (h != null &amp;&amp; h.waitStatus != 0)</span></span>
<span class="line"><span>            unparkSuccessor(h);</span></span>
<span class="line"><span>        return true;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return false;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è¯»å†™é”çš„çœŸæ­£é‡Šæ”¾</span></span>
<span class="line"><span>protected final boolean tryRelease(int releases) {</span></span>
<span class="line"><span>    // åˆ¤æ–­é‡Šæ”¾é”çš„çº¿ç¨‹æ˜¯ä¸æ˜¯æŒæœ‰é”çš„çº¿ç¨‹</span></span>
<span class="line"><span>    if (!isHeldExclusively())</span></span>
<span class="line"><span>        // ä¸æ˜¯æŠ›å¼‚å¸¸</span></span>
<span class="line"><span>        throw new IllegalMonitorStateException();</span></span>
<span class="line"><span>    // å¯¹state - 1</span></span>
<span class="line"><span>    int nextc = getState() - releases;</span></span>
<span class="line"><span>    // æ‹¿ç€nextä»è·å–ä½16ä½çš„å€¼ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º0</span></span>
<span class="line"><span>    boolean free = exclusiveCount(nextc) == 0;</span></span>
<span class="line"><span>    // è¿”å›true</span></span>
<span class="line"><span>    if (free)</span></span>
<span class="line"><span>        // å°†æŒæœ‰äº’æ–¥é”çš„çº¿ç¨‹ä¿¡æ¯ç½®ä½null</span></span>
<span class="line"><span>        setExclusiveOwnerThread(null);</span></span>
<span class="line"><span>    // å°†-1ä¹‹åçš„nextcå¤åˆ¶ç»™state</span></span>
<span class="line"><span>    setState(nextc);</span></span>
<span class="line"><span>    return free;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å››ã€è¯»é”çš„æ“ä½œ" tabindex="-1">å››ã€è¯»é”çš„æ“ä½œ <a class="header-anchor" href="#å››ã€è¯»é”çš„æ“ä½œ" aria-label="Permalink to &quot;å››ã€è¯»é”çš„æ“ä½œ&quot;">â€‹</a></h3><h4 id="_4-1-è¯»é”çš„åŠ é”æ“ä½œ" tabindex="-1">4.1 è¯»é”çš„åŠ é”æ“ä½œ <a class="header-anchor" href="#_4-1-è¯»é”çš„åŠ é”æ“ä½œ" aria-label="Permalink to &quot;4.1 è¯»é”çš„åŠ é”æ“ä½œ&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// è¯»é”åŠ é”æ“ä½œ</span></span>
<span class="line"><span>public final void acquireShared(int arg) {</span></span>
<span class="line"><span>    // tryAcquireSharedï¼Œå°è¯•è·å–é”èµ„æºï¼Œè·å–åˆ°è¿”å›1ï¼Œæ²¡è·å–åˆ°è¿”å›-1</span></span>
<span class="line"><span>    if (tryAcquireShared(arg) &lt; 0)</span></span>
<span class="line"><span>        // doAcquireShared å‰é¢æ²¡æ‹¿åˆ°é”ï¼Œè¿™è¾¹éœ€è¦æ’é˜Ÿ~</span></span>
<span class="line"><span>        doAcquireShared(arg);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// tryAcquireSharedæ–¹æ³•</span></span>
<span class="line"><span>protected final int tryAcquireShared(int unused) {</span></span>
<span class="line"><span>    // è·å–å½“å‰çº¿ç¨‹</span></span>
<span class="line"><span>    Thread current = Thread.currentThread();</span></span>
<span class="line"><span>    // æ‹¿åˆ°state</span></span>
<span class="line"><span>    int c = getState();</span></span>
<span class="line"><span>    // é‚£å†™é”æ ‡è¯†ï¼Œå¦‚æœ !=0ï¼Œä»£è¡¨æœ‰å†™é”</span></span>
<span class="line"><span>    if (exclusiveCount(c) != 0 &amp;&amp;</span></span>
<span class="line"><span>        // å¦‚æœæŒæœ‰å†™é”çš„ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œæ’é˜Ÿå»ï¼</span></span>
<span class="line"><span>        getExclusiveOwnerThread() != current)</span></span>
<span class="line"><span>        // æ’é˜Ÿï¼</span></span>
<span class="line"><span>        return -1;</span></span>
<span class="line"><span>    // æ²¡æœ‰å†™é”ï¼</span></span>
<span class="line"><span>    // è·å–è¯»é”ä¿¡æ¯</span></span>
<span class="line"><span>    int r = sharedCount(c);</span></span>
<span class="line"><span>    // å…¬å¹³é”ï¼š æœ‰äººæ’é˜Ÿï¼Œè¿”å›trueï¼Œç›´æ¥æ‹œæ‹œï¼Œæ²¡äººæ’é˜Ÿï¼Œè¿”å›false</span></span>
<span class="line"><span>    // éå…¬å¹³é”ï¼šæ­£å¸¸çš„é€»è¾‘æ˜¯éå…¬å¹³ç›´æ¥æŠ¢ï¼Œå› ä¸ºæ˜¯è¯»é”ï¼Œæ¯æ¬¡æŠ¢å åªè¦CASæˆåŠŸï¼Œå¿…ç„¶æˆåŠŸ</span></span>
<span class="line"><span>    // è¿™å°±ä¼šå‡ºç°é—®é¢˜ï¼Œå†™æ“ä½œæ— æ³•åœ¨è¯»é”çš„æƒ…å†µæŠ¢å èµ„æºï¼Œå¯¼è‡´å†™çº¿ç¨‹é¥¥é¥¿ï¼Œä¸€è‡´é˜»å¡â€¦â€¦â€¦â€¦</span></span>
<span class="line"><span>    // éå…¬å¹³é”ä¼šæŸ¥çœ‹nextæ˜¯å¦æ˜¯å†™é”çš„ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›trueï¼Œå¦‚æœä¸æ˜¯è¿”å›false</span></span>
<span class="line"><span>    if (!readerShouldBlock() &amp;&amp;</span></span>
<span class="line"><span>        // æŸ¥çœ‹è¯»é”æ˜¯å¦å·²ç»è¾¾åˆ°äº†æœ€å¤§é™åˆ¶</span></span>
<span class="line"><span>        r &lt; MAX_COUNT &amp;&amp;</span></span>
<span class="line"><span>        // ä»¥CASçš„æ–¹å¼ï¼Œå¯¹stateçš„é«˜16ä½+1</span></span>
<span class="line"><span>        compareAndSetState(c, c + SHARED_UNIT)) {</span></span>
<span class="line"><span>        // æ‹¿åˆ°é”èµ„æºæˆåŠŸï¼ï¼ï¼</span></span>
<span class="line"><span>        if (r == 0) {</span></span>
<span class="line"><span>            // ç¬¬ä¸€ä¸ªæ‹¿åˆ°é”èµ„æºçš„çº¿ç¨‹ï¼Œç”¨firstå­˜å‚¨</span></span>
<span class="line"><span>            firstReader = current;</span></span>
<span class="line"><span>            firstReaderHoldCount = 1;</span></span>
<span class="line"><span>        } else if (firstReader == current) {</span></span>
<span class="line"><span>            // æˆ‘æ˜¯é”é‡å…¥ï¼Œæˆ‘å°±æ˜¯ç¬¬ä¸€ä¸ªæ‹¿åˆ°è¯»é”çš„çº¿ç¨‹ï¼Œç›´æ¥å¯¹firstReaderHoldCount++è®°å½•é‡å…¥çš„æ¬¡æ•°</span></span>
<span class="line"><span>            firstReaderHoldCount++;</span></span>
<span class="line"><span>        } else {</span></span>
<span class="line"><span>            // ä¸æ˜¯ç¬¬ä¸€ä¸ªæ‹¿åˆ°é”èµ„æºçš„</span></span>
<span class="line"><span>            // å…ˆæ‹¿åˆ°cachedHoldCounterï¼Œæœ€åä¸€ä¸ªçº¿ç¨‹çš„é‡å…¥æ¬¡æ•°</span></span>
<span class="line"><span>            HoldCounter rh = cachedHoldCounter;</span></span>
<span class="line"><span>            // rh == nullï¼š æˆ‘æ˜¯ç¬¬äºŒä¸ªæ‹¿åˆ°è¯»é”çš„ï¼</span></span>
<span class="line"><span>            // æˆ–è€…å‘ç°ä¹‹å‰æœ‰æœ€åä¸€ä¸ªæ¥çš„ï¼Œä½†æ˜¯ä¸æˆ‘ï¼Œå°†æˆ‘è®¾ç½®ä¸ºæœ€åä¸€ä¸ªã€‚</span></span>
<span class="line"><span>            if (rh == null || rh.tid != getThreadId(current))</span></span>
<span class="line"><span>                // è·å–è‡ªå·±çš„é‡å…¥æ¬¡æ•°ï¼Œå¹¶èµ‹å€¼ç»™cachedHoldCounter</span></span>
<span class="line"><span>                cachedHoldCounter = rh = readHolds.get();</span></span>
<span class="line"><span>            // ä¹‹å‰æ‹¿è¿‡ï¼Œç°åœ¨å¦‚æœä¸º0ï¼Œèµ‹å€¼ç»™TL</span></span>
<span class="line"><span>            else if (rh.count == 0)</span></span>
<span class="line"><span>                readHolds.set(rh);</span></span>
<span class="line"><span>            // é‡å…¥æ¬¡æ•°+1ï¼Œ</span></span>
<span class="line"><span>            // ç¬¬ä¸€ä¸ªï¼šå¯èƒ½æ˜¯ç¬¬ä¸€æ¬¡æ‹¿</span></span>
<span class="line"><span>            // ç¬¬äºŒä¸ªï¼šå¯èƒ½æ˜¯é‡å…¥æ“ä½œ</span></span>
<span class="line"><span>            rh.count++;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        return 1;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return fullTryAcquireShared(current);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// é€šè¿‡tryAcquireSharedæ²¡æ‹¿åˆ°é”èµ„æºï¼Œä¹Ÿæ²¡è¿”å›-1ï¼Œå°±èµ°è¿™</span></span>
<span class="line"><span>final int fullTryAcquireShared(Thread current) {</span></span>
<span class="line"><span>    HoldCounter rh = null;</span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        // æ‹¿state</span></span>
<span class="line"><span>        int c = getState();</span></span>
<span class="line"><span>        // ç°åœ¨æœ‰äº’æ–¥é”ï¼Œä¸æ˜¯è‡ªå·±ï¼Œæ‹œæ‹œï¼</span></span>
<span class="line"><span>        if (exclusiveCount(c) != 0) {</span></span>
<span class="line"><span>            if (getExclusiveOwnerThread() != current)</span></span>
<span class="line"><span>                return -1;</span></span>
<span class="line"><span>   </span></span>
<span class="line"><span>        // å…¬å¹³ï¼šæœ‰æ’é˜Ÿçš„ï¼Œè¿›å…¥é€»è¾‘ã€‚   æ²¡æ’é˜Ÿçš„ï¼Œè¿‡ï¼</span></span>
<span class="line"><span>        // éå…¬å¹³ï¼šheadçš„nextæ˜¯å†™ä¸ï¼Œæ˜¯ï¼Œè¿›å…¥é€»è¾‘ã€‚   å¦‚æœä¸æ˜¯ï¼Œè¿‡ï¼</span></span>
<span class="line"><span>        } else if (readerShouldBlock()) {</span></span>
<span class="line"><span>            // è¿™é‡Œä»£ç ç‰¹åˆ«ä¹±ï¼Œå› ä¸ºè¿™é‡Œçš„ä»£ç ä¸ºäº†å¤„ç†JDK1.5çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œä¿®æ”¹è¿‡~</span></span>
<span class="line"><span>            // è¿™ä¸ªé€»è¾‘é‡Œä¸ä¼šè®©ä½ æ‹¿åˆ°é”ï¼Œåšè¢«é˜»å¡å‰çš„å‡†å¤‡</span></span>
<span class="line"><span>            if (firstReader == current) {</span></span>
<span class="line"><span>                // ä»€ä¹ˆéƒ½ä¸åš</span></span>
<span class="line"><span>            } else {</span></span>
<span class="line"><span>                if (rh == null) {</span></span>
<span class="line"><span>                    // è·å–æœ€åä¸€ä¸ªæ‹¿åˆ°è¯»é”èµ„æºçš„</span></span>
<span class="line"><span>                    rh = cachedHoldCounter;</span></span>
<span class="line"><span>                    if (rh == null || rh.tid != getThreadId(current)) {</span></span>
<span class="line"><span>                        // æ‹¿åˆ°æˆ‘è‡ªå·±çš„è®°å½•é‡å…¥æ¬¡æ•°çš„ã€‚</span></span>
<span class="line"><span>                        rh = readHolds.get();</span></span>
<span class="line"><span>                        // å¦‚æœæˆ‘çš„æ¬¡æ•°æ˜¯0ï¼Œç»å¯¹ä¸æ˜¯é‡å…¥æ“ä½œï¼</span></span>
<span class="line"><span>                        if (rh.count == 0)</span></span>
<span class="line"><span>                            // å°†æˆ‘çš„TLä¸­çš„å€¼ç§»é™¤æ‰ï¼Œä¸ç§»é™¤ä¼šé€ æˆå†…å­˜æ³„æ¼</span></span>
<span class="line"><span>                            readHolds.remove();</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>                // å¦‚æœæˆ‘çš„æ¬¡æ•°æ˜¯0ï¼Œç»å¯¹ä¸æ˜¯é‡å…¥æ“ä½œï¼</span></span>
<span class="line"><span>                if (rh.count == 0)</span></span>
<span class="line"><span>                    // è¿”å›-1ï¼Œç­‰å¾…é˜»å¡å§ï¼</span></span>
<span class="line"><span>                    return -1;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        // è¶…è¿‡è¯»é”çš„æœ€å¤§å€¼äº†æ²¡ï¼Ÿ</span></span>
<span class="line"><span>        if (sharedCount(c) == MAX_COUNT)</span></span>
<span class="line"><span>            throw new Error(&quot;Maximum lock count exceeded&quot;);</span></span>
<span class="line"><span>        // åˆ°è¿™ï¼Œå°±CASç«äº‰é”èµ„æº</span></span>
<span class="line"><span>        if (compareAndSetState(c, c + SHARED_UNIT)) {</span></span>
<span class="line"><span>            // è·ŸtryAcquireSharedä¸€æ¨¡ä¸€æ ·</span></span>
<span class="line"><span>            if (sharedCount(c) == 0) {</span></span>
<span class="line"><span>                firstReader = current;</span></span>
<span class="line"><span>                firstReaderHoldCount = 1;</span></span>
<span class="line"><span>            } else if (firstReader == current) {</span></span>
<span class="line"><span>                firstReaderHoldCount++;</span></span>
<span class="line"><span>            } else {</span></span>
<span class="line"><span>                if (rh == null)</span></span>
<span class="line"><span>                    rh = cachedHoldCounter;</span></span>
<span class="line"><span>                if (rh == null || rh.tid != getThreadId(current))</span></span>
<span class="line"><span>                    rh = readHolds.get();</span></span>
<span class="line"><span>                else if (rh.count == 0)</span></span>
<span class="line"><span>                    readHolds.set(rh);</span></span>
<span class="line"><span>                rh.count++;</span></span>
<span class="line"><span>                cachedHoldCounter = rh; </span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            return 1;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_4-2-åŠ é”-æ‰”åˆ°é˜Ÿåˆ—å‡†å¤‡é˜»å¡æ“ä½œ" tabindex="-1">4.2 åŠ é”-æ‰”åˆ°é˜Ÿåˆ—å‡†å¤‡é˜»å¡æ“ä½œ <a class="header-anchor" href="#_4-2-åŠ é”-æ‰”åˆ°é˜Ÿåˆ—å‡†å¤‡é˜»å¡æ“ä½œ" aria-label="Permalink to &quot;4.2 åŠ é”-æ‰”åˆ°é˜Ÿåˆ—å‡†å¤‡é˜»å¡æ“ä½œ&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// æ²¡æ‹¿åˆ°é”ï¼Œå‡†å¤‡æŒ‚èµ·</span></span>
<span class="line"><span>private void doAcquireShared(int arg) {</span></span>
<span class="line"><span>    // å°†å½“å‰çº¿ç¨‹å°è£…ä¸ºNodeï¼Œå½“å‰Nodeä¸ºå…±äº«é”ï¼Œå¹¶æ·»åŠ åˆ°é˜Ÿåˆ—çš„æ¨¡å¼</span></span>
<span class="line"><span>    final Node node = addWaiter(Node.SHARED);</span></span>
<span class="line"><span>    boolean failed = true;</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        boolean interrupted = false;</span></span>
<span class="line"><span>        for (;;) {</span></span>
<span class="line"><span>            // è·å–ä¸Šä¸€ä¸ªèŠ‚ç‚¹</span></span>
<span class="line"><span>            final Node p = node.predecessor();</span></span>
<span class="line"><span>            if (p == head) {</span></span>
<span class="line"><span>                // å¦‚æœæˆ‘çš„ä¸Šä¸€ä¸ªæ˜¯headï¼Œå°è¯•å†æ¬¡è·å–é”èµ„æº</span></span>
<span class="line"><span>                int r = tryAcquireShared(arg);</span></span>
<span class="line"><span>                if (r &gt;= 0) {</span></span>
<span class="line"><span>                    // å¦‚æœrå¤§äºç­‰äº0ï¼Œä»£è¡¨è·å–é”èµ„æºæˆåŠŸ</span></span>
<span class="line"><span>                    // å”¤é†’AQSä¸­æˆ‘åé¢çš„è¦è·å–è¯»é”çš„çº¿ç¨‹ï¼ˆSHAREDæ¨¡å¼çš„Nodeï¼‰</span></span>
<span class="line"><span>                    setHeadAndPropagate(node, r);</span></span>
<span class="line"><span>                    p.next = null; </span></span>
<span class="line"><span>                    if (interrupted)</span></span>
<span class="line"><span>                        selfInterrupt();</span></span>
<span class="line"><span>                    failed = false;</span></span>
<span class="line"><span>                    return;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // èƒ½å¦æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œéœ€è¦ä¿è¯æˆ‘å‰é¢Nodeçš„çŠ¶æ€ä¸º-1ï¼Œæ‰èƒ½æ‰§è¡Œåé¢æ“ä½œ</span></span>
<span class="line"><span>            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span></span>
<span class="line"><span>                //LockSupport.parkæŒ‚èµ·~~</span></span>
<span class="line"><span>                parkAndCheckInterrupt())</span></span>
<span class="line"><span>                interrupted = true;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        if (failed)</span></span>
<span class="line"><span>            cancelAcquire(node);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h1 id="å››ã€çº¿ç¨‹æ± æºç " tabindex="-1">å››ã€<strong>çº¿ç¨‹æ± æºç </strong> <a class="header-anchor" href="#å››ã€çº¿ç¨‹æ± æºç " aria-label="Permalink to &quot;å››ã€**çº¿ç¨‹æ± æºç **&quot;">â€‹</a></h1><h3 id="ä¸€ã€çº¿ç¨‹æ± ä»‹ç»" tabindex="-1">ä¸€ã€çº¿ç¨‹æ± ä»‹ç» <a class="header-anchor" href="#ä¸€ã€çº¿ç¨‹æ± ä»‹ç»" aria-label="Permalink to &quot;ä¸€ã€çº¿ç¨‹æ± ä»‹ç»&quot;">â€‹</a></h3><p>Javaæ„å»ºçº¿ç¨‹çš„æ–¹å¼</p><ul><li><p>new Thread</p></li><li><p>new Â Runnable</p></li><li><p>new Callable</p></li></ul><p>ä¸ºäº†é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹é€ æˆä¸å¿…è¦çš„æ€§èƒ½ï¼Œä¸€èˆ¬åœ¨ä½¿ç”¨çº¿ç¨‹æ—¶ï¼Œä¼šé‡‡ç”¨çº¿ç¨‹æ± </p><p>æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®çš„æ–¹æ¡ˆï¼š</p><p>çº¿ç¨‹æ± ä½¿ç”¨æ–¹å¼ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) {</span></span>
<span class="line"><span>    // çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°å¦‚ä½•è®¾ç½®</span></span>
<span class="line"><span>    // ä»»åŠ¡å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šCPUå¯†é›†ï¼ŒIOå¯†é›†ã€‚</span></span>
<span class="line"><span>    ThreadPoolExecutor executor = new ThreadPoolExecutor(</span></span>
<span class="line"><span>            1,</span></span>
<span class="line"><span>            2,</span></span>
<span class="line"><span>            1,</span></span>
<span class="line"><span>            TimeUnit.SECONDS,</span></span>
<span class="line"><span>            new ArrayBlockingQueue&lt;&gt;(1),</span></span>
<span class="line"><span>            new ThreadFactory() {</span></span>
<span class="line"><span>                @Override</span></span>
<span class="line"><span>                public Thread newThread(Runnable r) {</span></span>
<span class="line"><span>                    Thread t = new Thread(r);</span></span>
<span class="line"><span>                    // ...</span></span>
<span class="line"><span>                    return t;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            },</span></span>
<span class="line"><span>            new ThreadPoolExecutor.AbortPolicy()</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    executor.execute(ä»»åŠ¡);</span></span>
<span class="line"><span>    executor.submit(æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äºŒã€çº¿ç¨‹æ± æ ¸å¿ƒå±æ€§è®¤çŸ¥" tabindex="-1">äºŒã€çº¿ç¨‹æ± æ ¸å¿ƒå±æ€§è®¤çŸ¥ <a class="header-anchor" href="#äºŒã€çº¿ç¨‹æ± æ ¸å¿ƒå±æ€§è®¤çŸ¥" aria-label="Permalink to &quot;äºŒã€çº¿ç¨‹æ± æ ¸å¿ƒå±æ€§è®¤çŸ¥&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// AtomicInteger,å°±æ˜¯ä¸€ä¸ªintï¼Œå†™æ“ä½œç”¨CASå®ç°ï¼Œä¿è¯äº†åŸå­æ€§</span></span>
<span class="line"><span>// ctlç»´æŠ¤è¿™çº¿ç¨‹æ± çš„2ä¸ªæ ¸å¿ƒå†…å®¹ï¼š</span></span>
<span class="line"><span>// 1ï¼šçº¿ç¨‹æ± çŠ¶æ€ï¼ˆé«˜3ä½ï¼Œç»´æŠ¤ç€çº¿ç¨‹æ± çŠ¶æ€ï¼‰</span></span>
<span class="line"><span>// 2ï¼šå·¥ä½œçº¿ç¨‹æ•°é‡ï¼ˆæ ¸å¿ƒçº¿ç¨‹+éæ ¸å¿ƒçº¿ç¨‹ï¼Œä½29ä½ï¼Œç»´æŠ¤ç€å·¥ä½œçº¿ç¨‹ä¸ªæ•°ï¼‰</span></span>
<span class="line"><span>private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));</span></span>
<span class="line"><span>// COUNT_BITS=29</span></span>
<span class="line"><span>private static final int COUNT_BITS = Integer.SIZE - 3;</span></span>
<span class="line"><span>// å·¥ä½œçº¿ç¨‹çš„æœ€å¤§ä¸ªæ•°</span></span>
<span class="line"><span>// 00100000 00000000 00000000 00000000 - 1</span></span>
<span class="line"><span>// 000111111111111111111111111111111  </span></span>
<span class="line"><span>private static final int CAPACITY   = (1 &lt;&lt; COUNT_BITS) - 1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>private static final int RUNNING    = -1 &lt;&lt; COUNT_BITS;</span></span>
<span class="line"><span>private static final int SHUTDOWN   =  0 &lt;&lt; COUNT_BITS;</span></span>
<span class="line"><span>private static final int STOP       =  1 &lt;&lt; COUNT_BITS;</span></span>
<span class="line"><span>private static final int TIDYING    =  2 &lt;&lt; COUNT_BITS;</span></span>
<span class="line"><span>private static final int TERMINATED =  3 &lt;&lt; COUNT_BITS;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æ‹¿åˆ°çº¿ç¨‹æ± çŠ¶æ€</span></span>
<span class="line"><span>// 011... </span></span>
<span class="line"><span>// 111...</span></span>
<span class="line"><span>private static int runStateOf(int c)     { return c &amp; ~CAPACITY; }</span></span>
<span class="line"><span>// æ‹¿åˆ°å·¥ä½œçº¿ç¨‹ä¸ªæ•°</span></span>
<span class="line"><span>// ...0000000111111</span></span>
<span class="line"><span>// ...1111111111111</span></span>
<span class="line"><span>private static int workerCountOf(int c)  { return c &amp; CAPACITY; }</span></span></code></pre></div><p>çº¿ç¨‹æ± çŠ¶æ€</p><h3 id="ä¸‰ã€executeæ–¹æ³•" tabindex="-1">ä¸‰ã€executeæ–¹æ³• <a class="header-anchor" href="#ä¸‰ã€executeæ–¹æ³•" aria-label="Permalink to &quot;ä¸‰ã€executeæ–¹æ³•&quot;">â€‹</a></h3><p>é€šè¿‡executeæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°çº¿ç¨‹æ± å¤„ç†ä»»åŠ¡çš„æ•´ä½“æ‰§è¡Œæµç¨‹</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public void execute(Runnable command) {</span></span>
<span class="line"><span>    // éç©ºï¼ï¼</span></span>
<span class="line"><span>    if (command == null)</span></span>
<span class="line"><span>        throw new NullPointerException();</span></span>
<span class="line"><span>    // æ‹¿åˆ°ctl</span></span>
<span class="line"><span>    int c = ctl.get();</span></span>
<span class="line"><span>    // é€šè¿‡ctlè·å–å½“å‰å·¥ä½œçº¿ç¨‹ä¸ªæ•°</span></span>
<span class="line"><span>    if (workerCountOf(c) &lt; corePoolSize) {</span></span>
<span class="line"><span>        // trueï¼šä»£è¡¨æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œfalseï¼šä»£è¡¨æ˜¯éæ ¸å¿ƒçº¿ç¨‹</span></span>
<span class="line"><span>        if (addWorker(command, true))</span></span>
<span class="line"><span>            // å¦‚æœæ·»åŠ æ ¸å¿ƒçº¿ç¨‹æˆåŠŸï¼Œreturnç»“æŸæ‰</span></span>
<span class="line"><span>            return;</span></span>
<span class="line"><span>        // å¦‚æœæ·»åŠ å¤±è´¥ï¼Œé‡æ–°è·å–ctl</span></span>
<span class="line"><span>        c = ctl.get();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // æ ¸å¿ƒçº¿ç¨‹æ•°å·²ç»åˆ°äº†æœ€å¤§å€¼ã€æ·»åŠ æ—¶ï¼Œçº¿ç¨‹æ± çŠ¶æ€å˜ä¸ºSHUTDOWN/STOP</span></span>
<span class="line"><span>    // åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦æ˜¯è¿è¡ŒçŠ¶æ€ &amp;&amp; æ·»åŠ ä»»åŠ¡åˆ°å·¥ä½œé˜Ÿåˆ—</span></span>
<span class="line"><span>    if (isRunning(c) &amp;&amp; workQueue.offer(command)) {</span></span>
<span class="line"><span>        // å†æ¬¡è·å–ctlçš„å€¼</span></span>
<span class="line"><span>        int recheck = ctl.get();</span></span>
<span class="line"><span>        // å†æ¬¡åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€ã€‚  DCL</span></span>
<span class="line"><span>        // å¦‚æœçŠ¶æ€ä¸æ˜¯RUNNINGï¼ŒæŠŠä»»åŠ¡ä»å·¥ä½œé˜Ÿåˆ—ç§»é™¤ã€‚</span></span>
<span class="line"><span>        if (! isRunning(recheck) &amp;&amp; remove(command))</span></span>
<span class="line"><span>            // èµ°ä¸€æ³¢æ‹’ç»ç­–ç•¥ã€‚</span></span>
<span class="line"><span>            reject(command);</span></span>
<span class="line"><span>        // çº¿ç¨‹æ± çŠ¶æ€æ˜¯RUNNINGã€‚</span></span>
<span class="line"><span>        // åˆ¤æ–­å·¥ä½œçº¿ç¨‹æ•°æ˜¯å¦æ˜¯0ä¸ªã€‚</span></span>
<span class="line"><span>        // å¯ä»¥å°†æ ¸å¿ƒçº¿ç¨‹è®¾ç½®ä¸º0ï¼Œæ‰€æœ‰å·¥ä½œçº¿ç¨‹éƒ½æ˜¯éæ ¸å¿ƒçº¿ç¨‹ã€‚</span></span>
<span class="line"><span>        // æ ¸å¿ƒçº¿ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡keepAlivedè¶…æ—¶è¢«é”€æ¯ï¼Œæ‰€ä»¥å¦‚æœæ°å·§æ ¸å¿ƒçº¿ç¨‹è¢«é”€æ¯ï¼Œä¹Ÿä¼šå‡ºç°å½“å‰æ•ˆæœ</span></span>
<span class="line"><span>        else if (workerCountOf(recheck) == 0)</span></span>
<span class="line"><span>            // æ·»åŠ ç©ºä»»åŠ¡çš„éæ ¸å¿ƒçº¿ç¨‹å»å¤„ç†å·¥ä½œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span></span>
<span class="line"><span>            addWorker(null, false);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // å¯èƒ½å·¥ä½œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å­˜æ»¡äº†ï¼Œæ²¡æ·»åŠ è¿›å»ï¼Œåˆ°è¿™å°±è¦æ·»åŠ éæ ¸å¿ƒçº¿ç¨‹å»å¤„ç†ä»»åŠ¡</span></span>
<span class="line"><span>    else if (!addWorker(command, false))</span></span>
<span class="line"><span>        // æ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼</span></span>
<span class="line"><span>        reject(command);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å››ã€addworkeræ·»åŠ å·¥ä½œçº¿ç¨‹" tabindex="-1">å››ã€addWorkeræ·»åŠ å·¥ä½œçº¿ç¨‹ <a class="header-anchor" href="#å››ã€addworkeræ·»åŠ å·¥ä½œçº¿ç¨‹" aria-label="Permalink to &quot;å››ã€addWorkeræ·»åŠ å·¥ä½œçº¿ç¨‹&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>private boolean addWorker(Runnable firstTask, boolean core) {</span></span>
<span class="line"><span>    xxx:</span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        // é˜¿å·´é˜¿å·´â€¦â€¦â€¦â€¦</span></span>
<span class="line"><span>        int c = ctl.get();</span></span>
<span class="line"><span>        int rs = runStateOf(c);</span></span>
<span class="line"><span>        // åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€</span></span>
<span class="line"><span>        if (rs &gt;= SHUTDOWN &amp;&amp;</span></span>
<span class="line"><span>              // åˆ¤æ–­å¦‚æœçº¿ç¨‹æ± çš„çŠ¶æ€ä¸ºSHUTDOWNï¼Œè¿˜è¦å¤„ç†å·¥ä½œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span></span>
<span class="line"><span>              // å¦‚æœä½ æ·»åŠ å·¥ä½œçº¿ç¨‹çš„æ–¹å¼ï¼Œæ˜¯ä»»åŠ¡çš„éæ ¸å¿ƒçº¿ç¨‹ï¼Œå¹¶ä¸”å·¥ä½œé˜Ÿåˆ—è¿˜æœ‰ä»»åŠ¡</span></span>
<span class="line"><span>            ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; ! workQueue.isEmpty()))</span></span>
<span class="line"><span>            return false;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // åˆ¤æ–­å·¥ä½œçº¿ç¨‹ä¸ªæ•°</span></span>
<span class="line"><span>        for (;;) {</span></span>
<span class="line"><span>            // é˜¿å·´é˜¿å·´â€¦â€¦</span></span>
<span class="line"><span>            int wc = workerCountOf(c);</span></span>
<span class="line"><span>            // åˆ¤æ–­1ï¼šå·¥ä½œçº¿ç¨‹æ˜¯å¦å·²ç» == å·¥ä½œçº¿ç¨‹æœ€å¤§ä¸ªæ•°</span></span>
<span class="line"><span>            // åˆ¤æ–­2-trueåˆ¤æ–­ï¼šåˆ¤æ–­æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¹ˆï¼Ÿå¦‚æœæ˜¯åˆ¤æ–­æ˜¯å¦è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹ä¸ªæ•°</span></span>
<span class="line"><span>            // åˆ¤æ–­2-falseåˆ¤æ–­ï¼šå¦‚æœæ˜¯éæ ¸å¿ƒçº¿ç¨‹ï¼ŒæŸ¥çœ‹æ˜¯å¦è¶…è¿‡è®¾ç½®çš„æœ€å¤§çº¿ç¨‹æ•°</span></span>
<span class="line"><span>            if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize))</span></span>
<span class="line"><span>                return false;</span></span>
<span class="line"><span>            // å¯¹å·¥ä½œçº¿ç¨‹è¿›è¡Œ + 1æ“ä½œ</span></span>
<span class="line"><span>            if (compareAndIncrementWorkerCount(c))</span></span>
<span class="line"><span>                // +1æˆåŠŸï¼Œè·³å‡ºå¤–å±‚å¾ªç¯ï¼Œæ‰§è¡Œæ·»åŠ å·¥ä½œçº¿ç¨‹çš„ä¸šåŠ¡</span></span>
<span class="line"><span>                // ä»¥CASæ–¹å¼ï¼Œå¯¹ctl+1ï¼Œå¤šçº¿ç¨‹å¹¶å‘æ“ä½œï¼Œåªæœ‰ä¼šæœ‰ä¸€ä¸ªæˆåŠŸ</span></span>
<span class="line"><span>                break xxx;</span></span>
<span class="line"><span>            // é‡æ–°æ‹¿ctlï¼Œ</span></span>
<span class="line"><span>            c = ctl.get();</span></span>
<span class="line"><span>            // åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦æœ‰å˜åŒ–</span></span>
<span class="line"><span>            if (runStateOf(c) != rs)</span></span>
<span class="line"><span>                continue xxx;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // æ·»åŠ å·¥ä½œçº¿ç¨‹çš„ä¸šåŠ¡  </span></span>
<span class="line"><span>    // å·¥ä½œçº¿ç¨‹å¯åŠ¨äº†å—ï¼Ÿ</span></span>
<span class="line"><span>    boolean workerStarted = false;</span></span>
<span class="line"><span>	// å·¥ä½œçº¿ç¨‹æ·»åŠ äº†å—ï¼Ÿ</span></span>
<span class="line"><span>    boolean workerAdded = false;</span></span>
<span class="line"><span>    // Workerå°±æ˜¯å·¥ä½œçº¿ç¨‹</span></span>
<span class="line"><span>    Worker w = null;</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // åˆ›å»ºå·¥ä½œçº¿ç¨‹ï¼Œå°†ä»»åŠ¡ä¼ åˆ°Workerä¸­</span></span>
<span class="line"><span>        w = new Worker(firstTask);</span></span>
<span class="line"><span>        final Thread t = w.thread;</span></span>
<span class="line"><span>        // åªæœ‰ä½ å†™çš„çº¿ç¨‹å·¥å‚è¿”å›çš„æ˜¯nullï¼Œè¿™é‡Œæ‰ä¼šä¸ºnull</span></span>
<span class="line"><span>        if (t != null) {</span></span>
<span class="line"><span>            // è·å–é”èµ„æº</span></span>
<span class="line"><span>            final ReentrantLock mainLock = this.mainLock;</span></span>
<span class="line"><span>            // åŠ é”ã€‚  å› ä¸ºæˆ‘è¦åœ¨å¯åŠ¨è¿™ä¸ªå·¥ä½œçº¿ç¨‹æ—¶ï¼Œé¿å…çº¿ç¨‹æ± çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒåŠ é”ã€‚</span></span>
<span class="line"><span>            mainLock.lock();</span></span>
<span class="line"><span>            try {</span></span>
<span class="line"><span>                // é‡æ–°è·å–ctlï¼Œæ‹¿åˆ°çº¿ç¨‹æ± çŠ¶æ€</span></span>
<span class="line"><span>                int rs = runStateOf(ctl.get());</span></span>
<span class="line"><span>                // DCL i think you know~~~</span></span>
<span class="line"><span>                if (rs &lt; SHUTDOWN ||</span></span>
<span class="line"><span>                    (rs == SHUTDOWN &amp;&amp; firstTask == null)) {</span></span>
<span class="line"><span>                   	// åˆ¤æ–­Workerä¸­çš„threadæ˜¯å¦å·²ç»å¯åŠ¨äº†ï¼Œä¸€èˆ¬ä¸ä¼šå¯åŠ¨ï¼Œé™¤éä½ åœ¨çº¿ç¨‹å·¥å‚æŠŠä»–å¯åŠ¨äº†</span></span>
<span class="line"><span>                    if (t.isAlive()) </span></span>
<span class="line"><span>                        throw new IllegalThreadStateException();</span></span>
<span class="line"><span>                    // å°†å·¥ä½œçº¿ç¨‹å­˜å‚¨åˆ°hashSetä¸­</span></span>
<span class="line"><span>                    workers.add(w);</span></span>
<span class="line"><span>                    // è·å–å·¥ä½œçº¿ç¨‹ä¸ªæ•°ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¿®æ”¹æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°è®°å½•ã€‚</span></span>
<span class="line"><span>                    int s = workers.size();</span></span>
<span class="line"><span>                    if (s &gt; largestPoolSize)</span></span>
<span class="line"><span>                        largestPoolSize = s;</span></span>
<span class="line"><span>                    // å·¥ä½œçº¿ç¨‹æ·»åŠ æˆåŠŸ     0</span></span>
<span class="line"><span>                    workerAdded = true;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            } finally {</span></span>
<span class="line"><span>                mainLock.unlock();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // å¦‚æœæ·»åŠ æˆåŠŸ</span></span>
<span class="line"><span>            if (workerAdded) {</span></span>
<span class="line"><span>                // å¯åŠ¨å·¥ä½œçº¿ç¨‹</span></span>
<span class="line"><span>                t.start();</span></span>
<span class="line"><span>                // è®¾ç½®æ ‡è¯†ä¸ºtrue</span></span>
<span class="line"><span>                workerStarted = true;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        // å¦‚æœå·¥ä½œçº¿ç¨‹å¯åŠ¨å¤±è´¥</span></span>
<span class="line"><span>        if (! workerStarted)</span></span>
<span class="line"><span>            addWorkerFailed(w);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return workerStarted;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å¦‚æœæ·»åŠ å·¥ä½œçº¿ç¨‹å¤±è´¥ï¼Œæ‰§è¡Œ</span></span>
<span class="line"><span>private void addWorkerFailed(Worker w) {</span></span>
<span class="line"><span>    final ReentrantLock mainLock = this.mainLock;</span></span>
<span class="line"><span>    mainLock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // è¯´æ˜workerå¯èƒ½å­˜æ”¾åˆ°äº†workersçš„hashSetä¸­ã€‚</span></span>
<span class="line"><span>        if (w != null)</span></span>
<span class="line"><span>            // ç§»é™¤ï¼</span></span>
<span class="line"><span>            workers.remove(w);</span></span>
<span class="line"><span>        // å‡æ‰workerCountçš„æ•°å€¼ -1</span></span>
<span class="line"><span>        decrementWorkerCount();</span></span>
<span class="line"><span>        // å°è¯•å¹²æ‰è‡ªå·±</span></span>
<span class="line"><span>        tryTerminate();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        mainLock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äº”ã€runworkeræ‰§è¡Œä»»åŠ¡" tabindex="-1">äº”ã€runWorkeræ‰§è¡Œä»»åŠ¡ <a class="header-anchor" href="#äº”ã€runworkeræ‰§è¡Œä»»åŠ¡" aria-label="Permalink to &quot;äº”ã€runWorkeræ‰§è¡Œä»»åŠ¡&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>final void runWorker(Worker w) {</span></span>
<span class="line"><span>    // æ‹¿åˆ°å½“å‰çº¿ç¨‹å¯¹è±¡</span></span>
<span class="line"><span>    Thread wt = Thread.currentThread();</span></span>
<span class="line"><span>    // æ‹¿åˆ°workerä¸­å­˜æ”¾çš„Runnable</span></span>
<span class="line"><span>    Runnable task = w.firstTask;</span></span>
<span class="line"><span>    // å°†workerä¸­çš„ä»»åŠ¡æ¸…ç©º</span></span>
<span class="line"><span>    w.firstTask = null;</span></span>
<span class="line"><span>    // ææ˜¯ä¸€ä¸ªæ ‡è¯†</span></span>
<span class="line"><span>    boolean completedAbruptly = true;</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // å¦‚æœWorkerè‡ªèº«æºå¸¦ä»»åŠ¡ï¼Œç›´æ¥æ‰§è¡Œ</span></span>
<span class="line"><span>        // å¦‚æœWorkeræºå¸¦çš„æ˜¯nullï¼Œé€šè¿‡getTaskå»å·¥ä½œé˜Ÿåˆ—è·å–ä»»åŠ¡</span></span>
<span class="line"><span>        while (task != null || (task = getTask()) != null) {</span></span>
<span class="line"><span>            w.lock();</span></span>
<span class="line"><span>            // åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦å¤§äºç­‰äºSTOPï¼Œå¦‚æœæ˜¯è¦ä¸­æ–­å½“å‰çº¿ç¨‹</span></span>
<span class="line"><span>            if ((runStateAtLeast(ctl.get(), STOP) ||</span></span>
<span class="line"><span>                 // ä¸­æ–­å½“å‰çº¿ç¨‹ï¼ˆDCLï¼‰</span></span>
<span class="line"><span>                 (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted())</span></span>
<span class="line"><span>                wt.interrupt();</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>            try {</span></span>
<span class="line"><span>                // å‰ç½®é’©å­</span></span>
<span class="line"><span>                beforeExecute(wt, task);</span></span>
<span class="line"><span>                Throwable thrown = null;</span></span>
<span class="line"><span>                try {</span></span>
<span class="line"><span>                    // æ‰§è¡Œä»»åŠ¡</span></span>
<span class="line"><span>                    task.run();</span></span>
<span class="line"><span>                } catch (RuntimeException x) {</span></span>
<span class="line"><span>                    thrown = x; throw x;</span></span>
<span class="line"><span>                } catch (Error x) {</span></span>
<span class="line"><span>                    thrown = x; throw x;</span></span>
<span class="line"><span>                } catch (Throwable x) {</span></span>
<span class="line"><span>                    thrown = x; throw new Error(x);</span></span>
<span class="line"><span>                } finally {</span></span>
<span class="line"><span>                    // åç½®é’©å­</span></span>
<span class="line"><span>                    afterExecute(task, thrown);</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            } finally {</span></span>
<span class="line"><span>                task = null;</span></span>
<span class="line"><span>                // å½“å‰å·¥ä½œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå°±++</span></span>
<span class="line"><span>                w.completedTasks++;</span></span>
<span class="line"><span>                w.unlock();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        completedAbruptly = false;</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        processWorkerExit(w, completedAbruptly);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å…­ã€gettaskå·¥ä½œçº¿ç¨‹æ’é˜Ÿæ‹¿ä»»åŠ¡" tabindex="-1">å…­ã€getTaskå·¥ä½œçº¿ç¨‹æ’é˜Ÿæ‹¿ä»»åŠ¡ <a class="header-anchor" href="#å…­ã€gettaskå·¥ä½œçº¿ç¨‹æ’é˜Ÿæ‹¿ä»»åŠ¡" aria-label="Permalink to &quot;å…­ã€getTaskå·¥ä½œçº¿ç¨‹æ’é˜Ÿæ‹¿ä»»åŠ¡&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>private Runnable getTask() {</span></span>
<span class="line"><span>    // è¶…æ—¶-false</span></span>
<span class="line"><span>    boolean timedOut = false; // Did the last poll() time out?</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        // é˜¿å·´</span></span>
<span class="line"><span>        int c = ctl.get();</span></span>
<span class="line"><span>        int rs = runStateOf(c);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // çº¿ç¨‹æ± çŠ¶æ€åˆ¤æ–­</span></span>
<span class="line"><span>        // å¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWN &amp;&amp; å·¥ä½œé˜Ÿåˆ—ä¸ºç©º</span></span>
<span class="line"><span>        // å¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸ºSTOP</span></span>
<span class="line"><span>        if (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) {</span></span>
<span class="line"><span>            // å¯¹å·¥ä½œçº¿ç¨‹ä¸ªæ•°--</span></span>
<span class="line"><span>            decrementWorkerCount();</span></span>
<span class="line"><span>            return null;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // å¯¹æ•°é‡çš„åˆ¤æ–­ã€‚</span></span>
<span class="line"><span>        int wc = workerCountOf(c);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // åˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦å…è®¸è¶…æ—¶ï¼Ÿ</span></span>
<span class="line"><span>        // å·¥ä½œçº¿ç¨‹ä¸ªæ•°æ˜¯å¦å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°</span></span>
<span class="line"><span>        boolean timed = allowCoreThreadTimeOut || wc &gt; corePoolSize;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // åˆ¤æ–­å·¥ä½œçº¿ç¨‹æ˜¯å¦è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•° &amp;&amp; å·¥ä½œé˜Ÿåˆ—ä¸ºnull</span></span>
<span class="line"><span>        if ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut)) &amp;&amp; (wc &gt; 1 || workQueue.isEmpty())) {</span></span>
<span class="line"><span>            // å·¥ä½œçº¿ç¨‹æ•°æœ‰é—®é¢˜ï¼Œå¿…é¡»-1ï¼Œå¹²æ‰å½“å‰å·¥ä½œçº¿ç¨‹</span></span>
<span class="line"><span>            // å·¥ä½œçº¿ç¨‹æ˜¯å¦è¶…è¿‡äº†æ ¸å¿ƒçº¿ç¨‹ï¼Œå¦‚æœè¶…æ—¶ï¼Œå°±å¹²æ‰å½“å‰çº¿ç¨‹</span></span>
<span class="line"><span>            // å¯¹å·¥ä½œçº¿ç¨‹ä¸ªæ•°--</span></span>
<span class="line"><span>            if (compareAndDecrementWorkerCount(c))</span></span>
<span class="line"><span>                return null;</span></span>
<span class="line"><span>            continue;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            // å¦‚æœæ˜¯éæ ¸å¿ƒï¼Œèµ°pollï¼Œæ‹‰å–å·¥ä½œé˜Ÿåˆ—ä»»åŠ¡ï¼Œ</span></span>
<span class="line"><span>            // å¦‚æœæ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œèµ°takeä¸€ç›´é˜»å¡ï¼Œæ‹‰å–å·¥ä½œé˜Ÿåˆ—ä»»åŠ¡</span></span>
<span class="line"><span>            Runnable r = timed ?</span></span>
<span class="line"><span>                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :</span></span>
<span class="line"><span>            	// å½“å·¥ä½œé˜Ÿåˆ—æ²¡æœ‰ä»»åŠ¡æ—¶ï¼Œè¿™æ—¶å°±ä¼šè¢«Conditioné€šè¿‡awaité˜»å¡çº¿ç¨‹</span></span>
<span class="line"><span>            	// å½“æœ‰ä»»åŠ¡æ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹åï¼Œè¿™æ˜¯æ·»åŠ å®Œä»»åŠ¡åï¼Œå°±ä¼šç”¨è¿‡Condition.signalå”¤é†’é˜»å¡çš„çº¿ç¨‹</span></span>
<span class="line"><span>                workQueue.take();</span></span>
<span class="line"><span>            if (r != null)</span></span>
<span class="line"><span>                return r;</span></span>
<span class="line"><span>            // æ‰§è¡Œçš„pollæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨æŒ‡å®šæ—¶é—´æ²¡æ‹¿åˆ°ä»»åŠ¡ï¼Œ</span></span>
<span class="line"><span>            timedOut = true;</span></span>
<span class="line"><span>        } catch (InterruptedException retry) {</span></span>
<span class="line"><span>            timedOut = false;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="ä¸ƒã€processworkerexitå·¥ä½œçº¿ç¨‹å‘Šè¾" tabindex="-1">ä¸ƒã€processWorkerExitå·¥ä½œçº¿ç¨‹å‘Šè¾~ <a class="header-anchor" href="#ä¸ƒã€processworkerexitå·¥ä½œçº¿ç¨‹å‘Šè¾" aria-label="Permalink to &quot;ä¸ƒã€processWorkerExitå·¥ä½œçº¿ç¨‹å‘Šè¾~&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>private void processWorkerExit(Worker w, boolean completedAbruptly) {</span></span>
<span class="line"><span>    // å¦‚æœæ˜¯ä¸æ­£å¸¸æ“ä½œï¼Œéœ€è¦å…ˆå¯¹å·¥ä½œçº¿ç¨‹æ•°-- ï¼ˆå¦‚æœæ­£å¸¸æƒ…å†µï¼ŒgetTaskå°±--äº†ï¼‰</span></span>
<span class="line"><span>    if (completedAbruptly) </span></span>
<span class="line"><span>        decrementWorkerCount();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    final ReentrantLock mainLock = this.mainLock;</span></span>
<span class="line"><span>    mainLock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // å°†å½“å‰å·¥ä½œçº¿ç¨‹å®Œæ•´çš„ä»»åŠ¡ä¸ªæ•°èµ‹å€¼ç»™æ•´ä¸ªçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ•°</span></span>
<span class="line"><span>        completedTaskCount += w.completedTasks;</span></span>
<span class="line"><span>        // å¹²æ‰å½“å‰å·¥ä½œçº¿ç¨‹</span></span>
<span class="line"><span>        workers.remove(w);</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        mainLock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // çº¿ç¨‹æ± æ˜¯å¦å¯ä»¥ä¸­æ­¢ï¼Œçº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚</span></span>
<span class="line"><span>    tryTerminate();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    int c = ctl.get();</span></span>
<span class="line"><span>    //å¦‚æœå½“å‰çº¿ç¨‹æ± çŠ¶æ€å°äºSTOP</span></span>
<span class="line"><span>    if (runStateLessThan(c, STOP)) {</span></span>
<span class="line"><span>        // åˆ¤æ–­çº¿ç¨‹æ± ä¸­çš„å·¥ä½œé˜Ÿåˆ—æ˜¯å¦è¿˜æœ‰ä»»åŠ¡ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹æ˜¯å¦è¿˜åœ¨ã€‚</span></span>
<span class="line"><span>        if (!completedAbruptly) {</span></span>
<span class="line"><span>            int min = allowCoreThreadTimeOut ? 0 : corePoolSize;</span></span>
<span class="line"><span>            if (min == 0 &amp;&amp; ! workQueue.isEmpty())</span></span>
<span class="line"><span>                min = 1;</span></span>
<span class="line"><span>            if (workerCountOf(c) &gt;= min)</span></span>
<span class="line"><span>                return; // replacement not needed</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        // æ·»åŠ éæ ¸å¿ƒç©ºä»»åŠ¡çš„çº¿ç¨‹å¤„ç†å·¥ä½œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span></span>
<span class="line"><span>        addWorker(null, false);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æ‹’ç»ç­–ç•¥ï¼šçº¿ç¨‹æ± æä¾›çš„æ‹’ç»ç­–ç•¥ï¼Œä¸€èˆ¬ä¸é€‚åˆä½ çš„ä¸šåŠ¡åœºæ™¯æ—¶ï¼Œä½ å°±è‡ªå·±å®šä¹‰å³å¯ã€‚</p><ul><li><p>AbortPolicyï¼šæŠ›å‡ºå¼‚å¸¸ï¼</p></li><li><p>CallerRunsPolicyï¼šè®©æäº¤ä»»åŠ¡çš„çº¿ç¨‹å¤„ç†è¿™ä¸ªä»»åŠ¡ï¼</p></li><li><p>DiscardPolicyï¼šå•¥ä¹Ÿä¸åšï¼Œä»»åŠ¡æ²¡äº†ï¼</p></li><li><p>DiscardOldestPolicyï¼šæ‰”æ‰é˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œå°è¯•æŠŠå½“å‰ä»»åŠ¡æ·»åŠ è¿›å»ï¼</p></li></ul><p>ä»»åŠ¡å¤„ç†æµç¨‹ï¼š</p><p>ä¸»çº¿ç¨‹æ‰§è¡Œexecuteæ·»åŠ ä»»åŠ¡ï¼Œçº¿ç¨‹æ± åˆ›å»ºå·¥ä½œçº¿ç¨‹ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œå†æ¬¡æ‹‰å–å·¥ä½œé˜Ÿåˆ—ä»»åŠ¡ï¼Œç›´åˆ°å·¥ä½œé˜Ÿåˆ—æ²¡æœ‰ä»»åŠ¡ï¼Œé˜»å¡å·¥ä½œçº¿ç¨‹</p><p>å·¥ä½œçº¿ç¨‹é˜»å¡åœ¨å·¥ä½œé˜Ÿåˆ—ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œexecuteæ·»åŠ ä»»åŠ¡åˆ°å·¥ä½œé˜Ÿåˆ—ï¼Œå·¥ä½œçº¿ç¨‹è¢«å”¤é†’ï¼Œæ‹¿åˆ°å·¥ä½œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ¯•ï¼Œå†æ¬¡æ‹‰å–å·¥ä½œé˜Ÿåˆ—ä»»åŠ¡ï¼Œç›´åˆ°å·¥ä½œé˜Ÿåˆ—æ²¡æœ‰ä»»åŠ¡ï¼Œé˜»å¡å·¥ä½œçº¿ç¨‹</p><h1 id="äº”ã€concurrenthashmapæºç åˆ†æ-ä¸€" tabindex="-1">äº”ã€<strong>ConcurrentHashMapæºç åˆ†æï¼ˆä¸€ï¼‰</strong> <a class="header-anchor" href="#äº”ã€concurrenthashmapæºç åˆ†æ-ä¸€" aria-label="Permalink to &quot;äº”ã€**ConcurrentHashMapæºç åˆ†æï¼ˆä¸€ï¼‰**&quot;">â€‹</a></h1><h3 id="ä¸€ã€ç»“æ„ä»‹ç»" tabindex="-1">ä¸€ã€ç»“æ„ä»‹ç» <a class="header-anchor" href="#ä¸€ã€ç»“æ„ä»‹ç»" aria-label="Permalink to &quot;ä¸€ã€ç»“æ„ä»‹ç»&quot;">â€‹</a></h3><p>HashMapå’ŒConcurrentHashMapçš„å­˜å‚¨ç»“æ„æ˜¯ä¸€è‡´çš„ã€‚</p><p>ConcurrentHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>å­˜å‚¨ç»“æ„</p><p>å…³äºputå’ŒputIfAbsentçš„åŒºåˆ«</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// putå’ŒputIfAbsentéƒ½æ˜¯æƒ³ConcurrentHashMapä¸­å­˜å‚¨å€¼ã€‚</span></span>
<span class="line"><span>// å¦‚æœå‡ºç°keyä¸€è‡´çš„ï¼Œå°†æ–°æ•°æ®è¦†ç›–è€æ•°æ®ï¼Œå¹¶ä¸”è¿”å›è€æ•°æ®</span></span>
<span class="line"><span>public V put(K key, V value) {</span></span>
<span class="line"><span>    return putVal(key, value, false);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å¦‚æœå‡ºç°keyä¸€è‡´çš„ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å›è€æ•°æ®ã€‚ æœ€åªæœ‰keyä¸å­˜åœ¨æ—¶ï¼Œæ‰ä¼šæ­£å¸¸çš„æ·»åŠ æ•°æ®</span></span>
<span class="line"><span>public V putIfAbsent(K key, V value) {</span></span>
<span class="line"><span>    return putVal(key, value, true);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äºŒã€æ•£åˆ—ç®—æ³•" tabindex="-1">äºŒã€æ•£åˆ—ç®—æ³• <a class="header-anchor" href="#äºŒã€æ•£åˆ—ç®—æ³•" aria-label="Permalink to &quot;äºŒã€æ•£åˆ—ç®—æ³•&quot;">â€‹</a></h3><p>æ•£åˆ—ç®—æ³•æ˜¯ä¸ºäº†è®©hashCodeçš„é«˜16ä½å‚ä¸åˆ°ç´¢å¼•ä½ç½®çš„è®¡ç®—ä¸­ï¼Œä»è€Œå°½å¯èƒ½çš„æ‰“æ•£æ•°æ®å­˜æ”¾åˆ°æ•°ç»„ä¸Šã€‚ä»è€Œå‡å°‘Hashå†²çª<br> ConcurrentHashMapä¸­ï¼Œè¿˜ä¼šå°†hashå€¼å¯¹HASH_BITSè¿›è¡Œ&amp;è¿ç®—ï¼Œè®©hashå€¼ä¸€å®šæ˜¯ä¸€ä¸ªæ­£æ•°ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// ConcurrentHashMapå­˜å‚¨æ•°æ®çš„æ ¸å¿ƒæ–¹æ³•</span></span>
<span class="line"><span>final V putVal(K key, V value, boolean onlyIfAbsent) {</span></span>
<span class="line"><span>    // keyå’Œvalueä¸èƒ½ä¸ºnullã€‚              HashMapä¸­æ˜¯å…è®¸ä¸ºnullçš„ã€‚</span></span>
<span class="line"><span>    if (key == null || value == null) throw new NullPointerException();</span></span>
<span class="line"><span>    // æ•£åˆ—ç®—æ³•å°±æ˜¯åŸºäºkeyè¿›è¡Œhashè¿ç®—ï¼Œå¹¶ä¸”æ ¹æ®æ•£åˆ—ç®—æ³•çš„ç»“æœï¼Œç¡®å®šå½“å‰key-valueå­˜å‚¨åˆ°æ•°ç»„çš„å“ªä¸ªç´¢å¼•ä½ç½®ã€‚</span></span>
<span class="line"><span>    int hash = spread(key.hashCode());</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æ•£åˆ—ç®—æ³•</span></span>
<span class="line"><span>// æ•£åˆ—ç®—æ³•æ˜¯ä¸ºäº†è®©hashCodeçš„é«˜16ä½å‚ä¸åˆ°ç´¢å¼•ä½ç½®çš„è®¡ç®—ä¸­ï¼Œä»è€Œå°½å¯èƒ½çš„æ‰“æ•£æ•°æ®å­˜æ”¾åˆ°æ•°ç»„ä¸Šã€‚ä»è€Œå‡å°‘Hashå†²çª</span></span>
<span class="line"><span>// ConcurrentHashMapä¸­ï¼Œè¿˜ä¼šå°†hashå€¼å¯¹HASH_BITSè¿›è¡Œ&amp;è¿ç®—ï¼Œè®©hashå€¼ä¸€å®šæ˜¯ä¸€ä¸ªæ­£æ•°ã€‚</span></span>
<span class="line"><span>// å› ä¸ºConcurrentHashMapä¸­æ•°ç»„ä¸Šçš„æ•°æ®çš„hashå€¼ï¼Œå¦‚æœä¸ºè´Ÿæ•°ï¼Œæœ‰ç‰¹æ®Šå«ä¹‰</span></span>
<span class="line"><span>// static final int MOVED     = -1; // ä»£è¡¨å½“å‰ä½ç½®æ•°æ®åœ¨æ‰©å®¹ï¼Œå¹¶ä¸”æ•°æ®å·²ç»è¿ç§»åˆ°äº†æ–°æ•°ç»„</span></span>
<span class="line"><span>// static final int TREEBIN   = -2; // ä»£è¡¨å½“å‰ç´¢å¼•ä½ç½®ä¸‹ï¼Œæ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ã€‚   è½¬çº¢é»‘æ ‘ï¼ŒTreeBinæœ‰å‚æ„é€ </span></span>
<span class="line"><span>// static final int RESERVED  = -3; // ä»£è¡¨å½“å‰ç´¢å¼•ä½ç½®å·²ç»è¢«å äº†ï¼Œä½†æ˜¯å€¼è¿˜æ²¡æ”¾è¿›å»å‘¢ã€‚  computeæ–¹æ³•</span></span>
<span class="line"><span>static final int spread(int h) {</span></span>
<span class="line"><span>    return (h ^ (h &gt;&gt;&gt; 16))  &amp; HASH_BITS;;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>   </span></span>
<span class="line"><span>00011000 00000110 00111000 00001100  h</span></span>
<span class="line"><span>^</span></span>
<span class="line"><span>00000000 00000000 00011000 00000110  h &gt;&gt;&gt; 16</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>00011000 00000110 00111000 00001100 </span></span>
<span class="line"><span>&amp;</span></span>
<span class="line"><span>00000000 00000000 00000111 11111111  2048 - 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>ConcurrentHashMapæ˜¯å¦‚ä½•æ ¹æ®hashå€¼ï¼Œè®¡ç®—å­˜å‚¨çš„ä½ç½®ï¼Ÿ</span></span>
<span class="line"><span>(æ•°ç»„é•¿åº¦ - 1) &amp;  (h ^ (h &gt;&gt;&gt; 16))</span></span>
<span class="line"><span></span></span>
<span class="line"><span>00011000 00000110 00110000 00001100  key1-hash</span></span>
<span class="line"><span>00011000 00000110 00111000 00001100  key2-hash</span></span>
<span class="line"><span>&amp;</span></span>
<span class="line"><span>00000000 00000000 00000111 11111111  2048 - 1</span></span></code></pre></div><h3 id="ä¸‰ã€åˆå§‹åŒ–æ•°ç»„" tabindex="-1">ä¸‰ã€åˆå§‹åŒ–æ•°ç»„ <a class="header-anchor" href="#ä¸‰ã€åˆå§‹åŒ–æ•°ç»„" aria-label="Permalink to &quot;ä¸‰ã€åˆå§‹åŒ–æ•°ç»„&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>final V putVal(K key, V value, boolean onlyIfAbsent) {  </span></span>
<span class="line"><span>    // æ­»å¾ªç¯~~~~</span></span>
<span class="line"><span>    // tabæ˜¯ConcurrentHashMapçš„æ•°ç»„</span></span>
<span class="line"><span>    for (Node&lt;K,V&gt;[] tab = table;;) {</span></span>
<span class="line"><span>        // ä¸€å †å˜é‡</span></span>
<span class="line"><span>        Node&lt;K,V&gt; f; int n, i, fh;</span></span>
<span class="line"><span>        // ä»£è¡¨å½“å‰æ•°ç»„æ²¡æœ‰åˆå§‹åŒ–ã€‚</span></span>
<span class="line"><span>        if (tab == null || (n = tab.length) == 0)</span></span>
<span class="line"><span>            // åˆå§‹åŒ–æ•°ç»„  ï¼ˆConcurrentHashMapåœ¨newæ—¶ï¼Œä¸ä¼šåˆ›å»ºæ•°ç»„ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œæ‰ä¼šåˆ›å»ºï¼‰</span></span>
<span class="line"><span>            tab = initTable();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return null;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>/*</span></span>
<span class="line"><span>sizeCtlæ˜¯æ ‡è¯†æ•°ç»„åˆå§‹åŒ–å’Œæ‰©å®¹çš„æ ‡è¯†ä¿¡æ¯ã€‚</span></span>
<span class="line"><span>= -1ï¼šä»£è¡¨æ­£åœ¨åˆå§‹åŒ–ï¼</span></span>
<span class="line"><span>&lt; -1ï¼šä»£è¡¨æ­£åœ¨æ‰©å®¹ï¼</span></span>
<span class="line"><span>= 0ï¼šä»£è¡¨æ²¡æœ‰åˆå§‹åŒ–ï¼</span></span>
<span class="line"><span>&gt; 0ï¼šâ‘ å½“å‰æ•°ç»„æ²¡æœ‰åˆå§‹åŒ–ï¼Œè¿™ä¸ªå€¼ï¼Œå°±ä»£è¡¨åˆå§‹åŒ–çš„é•¿åº¦ï¼  â‘¡å¦‚æœå·²ç»åˆå§‹åŒ–äº†ï¼Œå°±ä»£è¡¨ä¸‹æ¬¡æ‰©å®¹çš„é˜ˆå€¼ï¼</span></span>
<span class="line"><span>*/</span></span>
<span class="line"><span>private transient volatile int sizeCtl;</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>// åˆå§‹åŒ–æ•°ç»„æ“ä½œ</span></span>
<span class="line"><span>private final Node&lt;K,V&gt;[] initTable() {</span></span>
<span class="line"><span>    // å£°æ˜tabï¼šä¸´æ—¶å­˜æ•°ç»„ã€‚ scï¼šä¸´æ—¶å­˜sizeCtl</span></span>
<span class="line"><span>    Node&lt;K,V&gt;[] tab; int sc;</span></span>
<span class="line"><span>    // åˆ¤æ–­æ•°ç»„è¿˜æ²¡åˆå§‹åŒ–å‘¢å§ï¼Ÿ</span></span>
<span class="line"><span>    while ((tab = table) == null || tab.length == 0) {</span></span>
<span class="line"><span>        // scèµ‹å€¼ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦å°äº0</span></span>
<span class="line"><span>        if ((sc = sizeCtl) &lt; 0)</span></span>
<span class="line"><span>            // çº¿ç¨‹å…ˆè®©å‡ºCPUçš„æ‰§è¡Œæƒã€‚</span></span>
<span class="line"><span>            Thread.yield(); </span></span>
<span class="line"><span>        // å¦‚æœscå¤§äºç­‰äº0ï¼Œæ²¡äººåœ¨æ‰§è¡Œåˆå§‹åŒ–æ“ä½œã€‚</span></span>
<span class="line"><span>        // ä»¥CASçš„æ–¹å¼ï¼Œå°†sizeCtlï¼Œæ”¹ä¸º-1ï¼Œä»£è¡¨å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘</span></span>
<span class="line"><span>        else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) {</span></span>
<span class="line"><span>            try {</span></span>
<span class="line"><span>                // åˆ¤æ–­æ•°ç»„è¿˜æ²¡åˆå§‹åŒ–å‘¢å§ï¼Ÿ  DCL</span></span>
<span class="line"><span>                if ((tab = table) == null || tab.length == 0) {</span></span>
<span class="line"><span>                    // æ‹¿åˆ°æ•°ç»„çš„åˆå§‹åŒ–é•¿åº¦</span></span>
<span class="line"><span>                    int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY;</span></span>
<span class="line"><span>                    // åˆ›å»ºæ•°ç»„</span></span>
<span class="line"><span>                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n];</span></span>
<span class="line"><span>                    // ä¾æ¬¡ç»™å±€éƒ¨å˜é‡å’Œæˆå‘˜å˜é‡èµ‹å€¼ã€‚</span></span>
<span class="line"><span>                    table = tab = nt;</span></span>
<span class="line"><span>                    // è®¡ç®—ä¸‹æ¬¡æ‰©å®¹çš„é˜ˆå€¼</span></span>
<span class="line"><span>                    sc = n - (n &gt;&gt;&gt; 2);</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            } finally {</span></span>
<span class="line"><span>                // å°†æ‰©å®¹é˜ˆå€¼èµ‹å€¼ç»™sizeCtl</span></span>
<span class="line"><span>                sizeCtl = sc;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            break;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return tab;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å››ã€æ·»åŠ æ•°æ®-æ•°ç»„" tabindex="-1">å››ã€æ·»åŠ æ•°æ®-æ•°ç»„ <a class="header-anchor" href="#å››ã€æ·»åŠ æ•°æ®-æ•°ç»„" aria-label="Permalink to &quot;å››ã€æ·»åŠ æ•°æ®-æ•°ç»„&quot;">â€‹</a></h3><p>æ•°æ®æ·»åŠ åˆ°æ•°ç»„ä¸Šï¼ˆæ²¡æœ‰hashå†²çªï¼‰</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>final V putVal(K key, V value, boolean onlyIfAbsent) {</span></span>
<span class="line"><span>    int binCount = 0;</span></span>
<span class="line"><span>    for (Node&lt;K,V&gt;[] tab = table;;) {</span></span>
<span class="line"><span>        // nï¼š æ•°ç»„é•¿åº¦ã€‚ iï¼šç´¢å¼•ä½ç½®ã€‚  fï¼šiä½ç½®çš„æ•°æ®ã€‚ fhï¼šæ˜¯fçš„hashå€¼</span></span>
<span class="line"><span>        Node&lt;K,V&gt; f; int n, i, fh;</span></span>
<span class="line"><span>        // tabAt(æ•°ç»„ï¼Œç´¢å¼•ä½ç½®) = æ‹¿åˆ°æ•°ç»„æŒ‡å®šç´¢å¼•ä½ç½®çš„æ•°æ®</span></span>
<span class="line"><span>        else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) {</span></span>
<span class="line"><span>            // å½“å‰ç´¢å¼•ä½ç½®æ•°æ®ä¸ºnullã€‚</span></span>
<span class="line"><span>            // ä»¥CASçš„æ–¹å¼ï¼Œå°†æ•°æ®æ”¾åˆ°tabçš„iä½ç½®ä¸Šï¼Œå°†hashï¼Œkeyï¼Œvalueå°è£…æˆäº†ä¸€ä¸ªNodeå¯¹è±¡</span></span>
<span class="line"><span>            if (casTabAt(tab, i, null,new Node&lt;K,V&gt;(hash, key, value, null)))</span></span>
<span class="line"><span>                break;  </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        // è¯´æ˜å½“å‰ä½ç½®æ•°æ®å·²ç»è¢«è¿ç§»åˆ°äº†æ–°æ•°ç»„ã€‚</span></span>
<span class="line"><span>        else if ((fh = f.hash) == MOVED)</span></span>
<span class="line"><span>            // å¸®ä½ æ‰©å®¹ï¼Œå¿«ç‚¹æ‰©å®¹å®Œï¼Œæˆ‘å¥½æŠŠæ•°æ®æ”¾åˆ°æ–°æ•°ç»„~~~</span></span>
<span class="line"><span>            tab = helpTransfer(tab, f);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return null;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äº”ã€æ·»åŠ æ•°æ®-é“¾è¡¨" tabindex="-1">äº”ã€æ·»åŠ æ•°æ®-é“¾è¡¨ <a class="header-anchor" href="#äº”ã€æ·»åŠ æ•°æ®-é“¾è¡¨" aria-label="Permalink to &quot;äº”ã€æ·»åŠ æ•°æ®-é“¾è¡¨&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>final V putVal(K key, V value, boolean onlyIfAbsent) {</span></span>
<span class="line"><span>    // æ‹¿åˆ°binCount</span></span>
<span class="line"><span>    int binCount = 0;</span></span>
<span class="line"><span>    for (Node&lt;K,V&gt;[] tab = table;;) {</span></span>
<span class="line"><span>        // nï¼š æ•°ç»„é•¿åº¦ã€‚ iï¼šç´¢å¼•ä½ç½®ã€‚  fï¼šiä½ç½®çš„æ•°æ®ã€‚ fhï¼šæ˜¯fçš„hashå€¼</span></span>
<span class="line"><span>        Node&lt;K,V&gt; f; int n, i, fh;</span></span>
<span class="line"><span>        // åˆ°è¿™ï¼Œè¯´æ˜å‡ºç°äº†hashå†²çªï¼Œiä½ç½®æœ‰æ•°æ®ï¼Œå°è¯•å¾€iä½ç½®ä¸‹æŒ‚æ•°æ®</span></span>
<span class="line"><span>        else {</span></span>
<span class="line"><span>            // å£°æ˜oldValï¼Œè¿”å›ç»“æœ</span></span>
<span class="line"><span>            V oldVal = null;</span></span>
<span class="line"><span>            // ä»¥æ¡¶ä½ç½®æ•°æ®ä½œä¸ºé”ï¼Œé”ä½å½“å‰æ¡¶ï¼Œé”ç²’åº¦æ›´ç»†ã€‚</span></span>
<span class="line"><span>            synchronized (f) {</span></span>
<span class="line"><span>                // å†åˆ¤æ–­ä¸€æ¬¡ï¼Œæ•°æ®æ²¡æœ‰å˜åŒ–ï¼Œæ­£å¸¸æŒ‚é“¾è¡¨ã€‚</span></span>
<span class="line"><span>                if (tabAt(tab, i) == f) {</span></span>
<span class="line"><span>                    // é“¾è¡¨æ·»åŠ æ“ä½œ</span></span>
<span class="line"><span>                    if (fh &gt;= 0) {</span></span>
<span class="line"><span>                        // binCountèµ‹å€¼1ï¼Œè®°å½•é“¾è¡¨ä¸­Nodeçš„é•¿åº¦</span></span>
<span class="line"><span>                        binCount = 1;</span></span>
<span class="line"><span>                        // eï¼šæš‚æ—¶æŒ‡å‘æ•°ç»„ä½ç½®æ•°æ®</span></span>
<span class="line"><span>                        for (Node&lt;K,V&gt; e = f;; ++binCount) {</span></span>
<span class="line"><span>                            K ek;</span></span>
<span class="line"><span>                            // æ‹¿åˆ°å½“å‰æ•°æ®çš„hashå€¼ï¼Œå’Œæ•°ç»„ä½ç½®æ•°æ®çš„hashå€¼æ¯”è¾ƒï¼Œ</span></span>
<span class="line"><span>                            if (e.hash == hash &amp;&amp;</span></span>
<span class="line"><span>                                // å¦‚æœç›¸ç­‰ , åˆ¤æ–­ == æˆ–è€… equals è¿”å›true</span></span>
<span class="line"><span>                                ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) {</span></span>
<span class="line"><span>                                // å°è¯•è¦†ç›–åŸæ•°æ®ï¼Œå…ˆè·å–è€æ•°æ®</span></span>
<span class="line"><span>                                oldVal = e.val;</span></span>
<span class="line"><span>                                // å¦‚æœæ˜¯putæ–¹æ³•ï¼Œè¿›å»è¦†ç›–å€¼</span></span>
<span class="line"><span>                                // å¦‚æœæ˜¯putIfAbsentï¼Œè¿›å»ä¸ifé€»è¾‘</span></span>
<span class="line"><span>                                if (!onlyIfAbsent)</span></span>
<span class="line"><span>                                    // è¦†ç›–å€¼</span></span>
<span class="line"><span>                                    e.val = value;</span></span>
<span class="line"><span>                                break;</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span>                            // predæš‚å­˜e</span></span>
<span class="line"><span>                            Node&lt;K,V&gt; pred = e;</span></span>
<span class="line"><span>                            // eæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å¦‚æœe == nullï¼Œè¯´æ˜ä¸‹é¢æ²¡èŠ‚ç‚¹äº†</span></span>
<span class="line"><span>                            if ((e = e.next) == null) {</span></span>
<span class="line"><span>                                // å°†å½“å‰çš„å€¼å°è£…ä¸ºNodeå¯¹è±¡ï¼Œå¹¶æŒ‚åœ¨æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„åé¢</span></span>
<span class="line"><span>                                pred.next = new Node&lt;K,V&gt;(hash, key, value, null);</span></span>
<span class="line"><span>                                break;</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span>                        }</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                    // çº¢é»‘æ ‘æ·»åŠ å¥—è·¯</span></span>
<span class="line"><span>                    else if (f instanceof TreeBin) {</span></span>
<span class="line"><span>                        // çœç•¥éƒ¨åˆ†ä»£ç </span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // å¦‚æœbinCount != 0</span></span>
<span class="line"><span>            if (binCount != 0) {</span></span>
<span class="line"><span>                // å¦‚æœbinCount &gt;= 8</span></span>
<span class="line"><span>                if (binCount &gt;= TREEIFY_THRESHOLD)</span></span>
<span class="line"><span>                    // åˆ¤æ–­æ˜¯æ‰©å®¹è¿˜æ˜¯è½¬çº¢é»‘æ ‘</span></span>
<span class="line"><span>                    treeifyBin(tab, i);</span></span>
<span class="line"><span>                // åˆ¤æ–­æ˜¯å¦éœ€è¦è¿”å›</span></span>
<span class="line"><span>                if (oldVal != null)</span></span>
<span class="line"><span>                    return oldVal;</span></span>
<span class="line"><span>                break;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return null;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å…­ã€è§¦å‘æ‰©å®¹" tabindex="-1">å…­ã€è§¦å‘æ‰©å®¹ <a class="header-anchor" href="#å…­ã€è§¦å‘æ‰©å®¹" aria-label="Permalink to &quot;å…­ã€è§¦å‘æ‰©å®¹&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬çº¢é»‘æ ‘æˆ–è€…æ˜¯æ‰©å®¹  tabï¼šæ•°ç»„ï¼  indexï¼šç´¢å¼•ä½ç½®ï¼</span></span>
<span class="line"><span>private final void treeifyBin(Node&lt;K,V&gt;[] tab, int index) {</span></span>
<span class="line"><span>    // nï¼šæ•°ç»„é•¿åº¦ï¼Œ scï¼šsizeCtl</span></span>
<span class="line"><span>    Node&lt;K,V&gt; b; int n, sc;</span></span>
<span class="line"><span>    // åˆ¤æ–­tabä¸ä¸ºnull</span></span>
<span class="line"><span>    if (tab != null) {</span></span>
<span class="line"><span>        // å¦‚æœæ•°ç»„é•¿åº¦ å°äº 64ï¼Œä¸è½¬çº¢é»‘æ ‘ï¼Œå…ˆæ‰©å®¹ï¼ˆæ›´å¸Œæœ›æ•°æ®å­˜æ”¾åœ¨æ•°ç»„ä¸Šï¼ŒO1ï¼‰</span></span>
<span class="line"><span>        // åªæœ‰æ•°ç»„é•¿åº¦å¤§äºç­‰äº64å¹¶ä¸”é“¾è¡¨é•¿åº¦è¾¾åˆ°8ï¼Œæ‰è½¬ä¸ºçº¢é»‘æ ‘</span></span>
<span class="line"><span>        if ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span></span>
<span class="line"><span>            // æ‰©å®¹å‰çš„ä¸€äº›å‡†å¤‡å’Œä¸šåŠ¡åˆ¤æ–­</span></span>
<span class="line"><span>            tryPresize(n &lt;&lt; 1);</span></span>
<span class="line"><span>        // è½¬çº¢é»‘æ ‘æ“ä½œ</span></span>
<span class="line"><span>        // å°†å•å‘é“¾è¡¨è½¬æ¢ä¸ºTreeNodeå¯¹è±¡ï¼ˆåŒå‘é“¾è¡¨ï¼‰ï¼Œå†é€šè¿‡TreeBinæ–¹æ³•è½¬ä¸ºçº¢é»‘æ ‘ã€‚</span></span>
<span class="line"><span>        // TreeBinä¸­ä¿ç•™ç€åŒå‘é“¾è¡¨ä»¥åŠçº¢é»‘æ ‘ï¼</span></span>
<span class="line"><span>        else if ((b = tabAt(tab, index)) != null &amp;&amp; b.hash &gt;= 0) {</span></span>
<span class="line"><span>            // çœç•¥éƒ¨åˆ†ä»£ç ~~</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="ä¸ƒã€hashmapçš„æ‰©å®¹" tabindex="-1">ä¸ƒã€HashMapçš„æ‰©å®¹ <a class="header-anchor" href="#ä¸ƒã€hashmapçš„æ‰©å®¹" aria-label="Permalink to &quot;ä¸ƒã€HashMapçš„æ‰©å®¹&quot;">â€‹</a></h3><h1 id="å…­ã€concurrenthashmapæ‰©å®¹" tabindex="-1">å…­ã€<em><strong>ConcurrentHashMapæ‰©å®¹</strong></em> <a class="header-anchor" href="#å…­ã€concurrenthashmapæ‰©å®¹" aria-label="Permalink to &quot;å…­ã€_**ConcurrentHashMapæ‰©å®¹**_&quot;">â€‹</a></h1><p>ä¸‰ç§è§¦å‘æ–¹å¼</p><p>è¾¾åˆ°äº†æ‰©å®¹çš„é˜ˆå€¼</p><h3 id="ä¸€ã€trypresizeæ–¹æ³•-åˆå§‹åŒ–æ•°ç»„" tabindex="-1">ä¸€ã€tryPreSizeæ–¹æ³•-åˆå§‹åŒ–æ•°ç»„ <a class="header-anchor" href="#ä¸€ã€trypresizeæ–¹æ³•-åˆå§‹åŒ–æ•°ç»„" aria-label="Permalink to &quot;ä¸€ã€tryPreSizeæ–¹æ³•-åˆå§‹åŒ–æ•°ç»„&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// æ‰©å®¹å‰æ“ä½œï¼ŒputAllï¼Œé“¾è¡¨è½¬çº¢é»‘æ ‘  æ’å…¥mapçš„é•¿åº¦ï¼ˆputAllï¼‰</span></span>
<span class="line"><span>private final void tryPresize(int size) {</span></span>
<span class="line"><span>    // è¿™ä¸ªåˆ¤æ–­æ˜¯ç»™putAllç•™çš„ï¼Œè¦è®¡ç®—å½“å‰æ•°ç»„çš„é•¿åº¦ï¼ˆåˆå§‹åŒ–ï¼‰</span></span>
<span class="line"><span>    // å¦‚æœsizeå¤§äºæœ€å¤§é•¿åº¦ / 2ï¼Œç›´æ¥å°†æ•°ç»„é•¿åº¦è®¾ç½®ä¸ºæœ€å¤§å€¼ã€‚</span></span>
<span class="line"><span>    // tableSizeForï¼Œå°†é•¿åº¦è®¾ç½®çš„2çš„næ¬¡å¹‚</span></span>
<span class="line"><span>    // cæ˜¯åˆå§‹åŒ–æ•°ç»„é•¿åº¦</span></span>
<span class="line"><span>    int c = (size &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(size + (size &gt;&gt;&gt; 1) + 1);</span></span>
<span class="line"><span>    // scæ˜¯ç»™sizeCtlèµ‹å€¼</span></span>
<span class="line"><span>    // -1:æ­£åœ¨åˆå§‹åŒ–æ•°ç»„ï¼Œå°äº-1ï¼šæ­£åœ¨æ‰©å®¹ï¼Œ0ï¼šä»£è¡¨è¿˜æ²¡åˆå§‹åŒ–æ•°ç»„ï¼Œå¤§äº0ï¼šå¯èƒ½åˆå§‹åŒ–äº†(ä»£è¡¨é˜ˆå€¼)ï¼Œä¹Ÿå¯èƒ½æ²¡åˆå§‹åŒ–ï¼ˆåˆå§‹åŒ–çš„é•¿åº¦ï¼‰</span></span>
<span class="line"><span>    int sc;</span></span>
<span class="line"><span>    while ((sc = sizeCtl) &gt;= 0) {</span></span>
<span class="line"><span>        // ä»£è¡¨æ²¡æœ‰æ­£åœ¨æ‰§è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿæ²¡æœ‰æ­£åœ¨æ‰§è¡Œæ‰©å®¹ã€‚ã€</span></span>
<span class="line"><span>        // tabï¼šæ•°ç»„ï¼Œnï¼šæ•°ç»„é•¿åº¦</span></span>
<span class="line"><span>        Node&lt;K,V&gt;[] tab = table; int n;</span></span>
<span class="line"><span>        // åˆ¤æ–­æ•°ç»„æ˜¯ä¸æ˜¯è¿˜æ²¡åˆå§‹åŒ–å‘¢</span></span>
<span class="line"><span>        if (tab == null || (n = tab.length) == 0) {</span></span>
<span class="line"><span>            // åˆå§‹åŒ–æ•°ç»„ï¼Œå’ŒinitTableä¸€æ ·çš„ä¸œè¥¿</span></span>
<span class="line"><span>            // åœ¨scå’Œcä¹‹é—´é€‰æ‹©æœ€å¤§å€¼ï¼Œä½œä¸ºæ•°ç»„çš„åˆå§‹åŒ–é•¿åº¦</span></span>
<span class="line"><span>            n = (sc &gt; c) ? sc : c;</span></span>
<span class="line"><span>            // è¦åˆå§‹åŒ–ï¼Œå°±ç›´æ¥æŠŠsizeCtlè®¾ç½®ä¸º-1ï¼Œä»£è¡¨æˆ‘è¦åˆå§‹åŒ–æ•°ç»„</span></span>
<span class="line"><span>            if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) {</span></span>
<span class="line"><span>                try {</span></span>
<span class="line"><span>                    // DCLï¼</span></span>
<span class="line"><span>                    if (table == tab) {</span></span>
<span class="line"><span>                        // åˆ›å»ºæ•°ç»„</span></span>
<span class="line"><span>                        Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n];</span></span>
<span class="line"><span>                        // åˆå§‹åŒ–æ•°ç»„èµ‹å€¼ç»™æˆå‘˜å˜é‡</span></span>
<span class="line"><span>                        table = nt;</span></span>
<span class="line"><span>                        // scå…ˆè®¾ç½®æˆé˜ˆå€¼</span></span>
<span class="line"><span>                        sc = n - (n &gt;&gt;&gt; 2);</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                } finally {</span></span>
<span class="line"><span>                    // å°†scèµ‹å€¼ç»™sizeCtl</span></span>
<span class="line"><span>                    sizeCtl = sc;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        // è¦ä¹ˆæ˜¯cæ²¡æœ‰è¶…è¿‡é˜ˆå€¼ï¼Œè¦ä¹ˆæ˜¯è¶…è¿‡æœ€å¤§å€¼ï¼Œå•¥äº‹ä¸åš~~~</span></span>
<span class="line"><span>        else if (c &lt;= sc || n &gt;= MAXIMUM_CAPACITY)</span></span>
<span class="line"><span>            break;</span></span>
<span class="line"><span>        // çœç•¥éƒ¨åˆ†ä»£ç ã€‚</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äºŒã€trypresizeæ–¹æ³•-æ‰©å®¹æ ‡è¯†æˆ³" tabindex="-1">äºŒã€tryPreSizeæ–¹æ³•-æ‰©å®¹æ ‡è¯†æˆ³ <a class="header-anchor" href="#äºŒã€trypresizeæ–¹æ³•-æ‰©å®¹æ ‡è¯†æˆ³" aria-label="Permalink to &quot;äºŒã€tryPreSizeæ–¹æ³•-æ‰©å®¹æ ‡è¯†æˆ³&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// æ‰©å®¹å‰æ“ä½œ</span></span>
<span class="line"><span>private final void tryPresize(int size) {</span></span>
<span class="line"><span>    while ((sc = sizeCtl) &gt;= 0) {</span></span>
<span class="line"><span>        // çœç•¥éƒ¨åˆ†åˆå§‹åŒ–ä»£ç </span></span>
<span class="line"><span>        Node&lt;K,V&gt;[] tab = table; int n;</span></span>
<span class="line"><span>        if (tab == null || (n = tab.length) == 0) {</span></span>
<span class="line"><span>        // æ‰©å®¹å‰æ“ä½œï¼</span></span>
<span class="line"><span>        else if (tab == table) {</span></span>
<span class="line"><span>            // è®¡ç®—æ‰©å®¹æ ‡è¯†æˆ³ï¼ˆåŸºäºè€æ•°ç»„é•¿åº¦è®¡ç®—æ‰©å®¹æ ‡è¯†æˆ³ï¼Œå› ä¸ºConcurrentHashMapå…è®¸å¤šçº¿ç¨‹è¿ç§»æ•°æ®ã€‚ï¼‰</span></span>
<span class="line"><span>            int rs = resizeStamp(n);</span></span>
<span class="line"><span>            // è¿™é‡Œæ˜¯ä¸€ä¸ªBUGï¼Œå½“å‰scåœ¨whileå¾ªç¯ä¸­ï¼Œé™¤äº†åˆå§‹åŒ–æ²¡æœ‰é¢å¤–èµ‹å€¼çš„å‰æä¸‹ï¼Œè¿™ä¸ªsc &lt; 0 æ°¸è¿œè¿›ä¸æ¥ã€‚</span></span>
<span class="line"><span>            // è™½ç„¶æ˜¯BUGï¼Œä½†æ˜¯æ¸…æ¥šsc &lt; 0 ä»£è¡¨æ­£åœ¨æ‰©å®¹</span></span>
<span class="line"><span>            if (sc &lt; 0) {</span></span>
<span class="line"><span>                Node&lt;K,V&gt;[] nt;    31 ~ 16   15 ~ 0</span></span>
<span class="line"><span>                // è¿™é‡Œæ˜¯ç¬¬äºŒä¸ªBUG</span></span>
<span class="line"><span>                if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs ||   // åˆ¤æ–­ååŠ©æ‰©å®¹çº¿ç¨‹çš„æ ‡è¯†æˆ³æ˜¯å¦ä¸€è‡´</span></span>
<span class="line"><span>                    sc == rs &lt;&lt; RESIZE_STAMP_SHIFT + 1 ||    // BUGä¹‹ä¸€,åœ¨åˆ¤æ–­æ‰©å®¹æ“ä½œæ˜¯å¦å·²ç»åˆ°äº†æœ€åçš„æ£€æŸ¥é˜¶æ®µ</span></span>
<span class="line"><span>                    sc == rs &lt;&lt; RESIZE_STAMP_SHIFT + MAX_RESIZERS ||   // BUGä¹‹ä¸€ï¼Œåˆ¤æ–­æ‰©å®¹çº¿ç¨‹æ˜¯å¦å·²ç»è¾¾åˆ°æœ€å¤§å€¼</span></span>
<span class="line"><span>                    (nt = nextTable) == null ||  // æ–°æ•°ç»„ä¸ºnullï¼Œè¯´æ˜ä¹Ÿå·²ç»æ‰©å®¹å®Œæ¯•ï¼Œæ‰©å®¹å®Œæ¯•åï¼Œæ‰ä¼šæŠŠnextTableç½®ä½null</span></span>
<span class="line"><span>                    transferIndex &lt;= 0) // transferIndexä¸ºçº¿ç¨‹é¢†å–ä»»åŠ¡çš„æœ€å¤§èŠ‚ç‚¹ï¼Œå¦‚æœä¸º0ï¼Œä»£è¡¨æ‰€æœ‰è€æ•°æ®è¿ç§»ä»»åŠ¡éƒ½æ²¡é¢†å¹²å‡€äº†</span></span>
<span class="line"><span>                    break;</span></span>
<span class="line"><span>                if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1))</span></span>
<span class="line"><span>                    transfer(tab, nt);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // è¿˜æ²¡æœ‰æ‰§è¡Œæ‰©å®¹ï¼Œå½“å‰çº¿ç¨‹å¯èƒ½æ˜¯ç¬¬ä¸€ä¸ªè¿›æ¥æ‰§è¡Œæ‰©å®¹çš„çº¿ç¨‹</span></span>
<span class="line"><span>            // åŸºäºCASçš„æ–¹å¼ï¼Œå°†sizeCtlä»åŸå€¼æ”¹ä¸º æ‰©å®¹æ ‡è¯†æˆ³å·¦ç§»16ä½</span></span>
<span class="line"><span>            // 10000000 00011010 00000000 00000010  ä¸€å®šæ˜¯&lt; -1çš„è´Ÿæ•°ï¼Œå¯ä»¥ä»£è¡¨å½“å‰ConcurrentHashMapæ­£åœ¨æ‰©å®¹</span></span>
<span class="line"><span>            // ä¸ºä»€ä¹ˆæ˜¯ä½ä½+2ï¼Œä»£è¡¨1ä¸ªçº¿ç¨‹æ‰©å®¹ã€‚ ä½ä½ä¸º5ï¼Œå°±ä»£è¡¨4ä¸ªçº¿ç¨‹æ­£åœ¨å¹¶å‘æ‰©å®¹</span></span>
<span class="line"><span>            // æ‰©å®¹åˆ†ä¸º2éƒ¨ï¼šåˆ›å»ºæ–°æ•°ç»„ï¼Œè¿ç§»æ•°æ®ã€‚</span></span>
<span class="line"><span>            // å½“æœ€åä¸€ä¸ªçº¿ç¨‹è¿ç§»å®Œæ¯•æ•°æ®åï¼Œå¯¹ä½ä½-1.æœ€ç»ˆç»“æœä½ä½è¿˜æ˜¯1ï¼Œéœ€è¦å¯¹æ•´ä¸ªè€æ•°ç»„å†æ¬¡æ£€æŸ¥ï¼Œæ•°æ®æ˜¯å¦è¿ç§»å¹²å‡€</span></span>
<span class="line"><span>            else if (U.compareAndSwapInt(this, SIZECTL, sc,</span></span>
<span class="line"><span>                                         (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2))</span></span>
<span class="line"><span>                // å¼€å§‹æ‰©å®¹æ“ä½œï¼Œä¼ å…¥è€æ•°ç»„~~</span></span>
<span class="line"><span>                transfer(tab, null);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>static final int resizeStamp(int n) {</span></span>
<span class="line"><span>    // 32~64</span></span>
<span class="line"><span>    // 00000000 00000000 00000000 00011010</span></span>
<span class="line"><span>    // è®¡ç®—nåœ¨äºŒè¿›åˆ¶è¡¨ç¤ºæ—¶ï¼Œå‰é¢æœ‰å¤šå°‘ä¸ª0</span></span>
<span class="line"><span>    // 00000000 00000000 10000000 00000000</span></span>
<span class="line"><span>    // 00000000 00000000 10000000 00011010</span></span>
<span class="line"><span>    // å‰é¢çš„æ“ä½œæ˜¯åŸºäºæ•°ç»„é•¿åº¦ç­‰åˆ°ä¸€ä¸ªæ ‡è¯†ï¼Œæ–¹ä¾¿å…¶ä»–çº¿ç¨‹å‚ä¸æ‰©å®¹</span></span>
<span class="line"><span>    // åé¢çš„å€¼æ˜¯ä¸ºäº†ä¿è¯å½“å‰æ‰©å®¹æˆ³å·¦ç§»16ä½ä¹‹åï¼Œä¸€å®šæ˜¯ä¸€ä¸ªè´Ÿæ•°</span></span>
<span class="line"><span>    return Integer.numberOfLeadingZeros(n) | (1 &lt;&lt; (RESIZE_STAMP_BITS - 1));</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="ä¸‰ã€transferæ–¹æ³•-æ„å»ºæ–°æ•°ç»„" tabindex="-1">ä¸‰ã€transferæ–¹æ³•-æ„å»ºæ–°æ•°ç»„ <a class="header-anchor" href="#ä¸‰ã€transferæ–¹æ³•-æ„å»ºæ–°æ•°ç»„" aria-label="Permalink to &quot;ä¸‰ã€transferæ–¹æ³•-æ„å»ºæ–°æ•°ç»„&quot;">â€‹</a></h3><p>transferæ–¹æ³•ï¼š</p><ul><li><p>è®¡ç®—æ­¥é•¿</p></li><li><p>åˆå§‹åŒ–æ–°æ•°ç»„</p></li><li><p>çº¿ç¨‹é¢†å–è¿ç§»æ•°æ®ä»»åŠ¡</p></li><li><p>åˆ¤æ–­è¿ç§»æ˜¯å¦å®Œæˆï¼Œå¹¶åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå®Œæˆçš„</p></li><li><p>æŸ¥çœ‹å½“å‰ä½ç½®æ•°æ®æ˜¯å¦ä¸ºnull</p></li><li><p>æŸ¥çœ‹å½“å‰ä½ç½®æ•°æ®æ˜¯å¦ä¸ºfwd</p></li><li><p>é“¾è¡¨è¿ç§»æ•°æ®-lastRunæœºåˆ¶</p></li><li><p>çº¢é»‘æ ‘è¿ç§»-è¿ç§»å®Œæ•°æ®é•¿åº¦å°äºç­‰äº6ï¼Œè½¬å›é“¾è¡¨</p></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// æ‰©å®¹æ“ä½œï¼Œä»¥ç¬¬ä¸€ä¸ªè¿›æ¥æ‰§è¡Œæ‰©å®¹çš„çº¿ç¨‹ä¸ºä¾‹ã€‚</span></span>
<span class="line"><span>private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) {</span></span>
<span class="line"><span>    // åˆ›å»ºæ–°æ•°ç»„æµç¨‹ï¼</span></span>
<span class="line"><span>    // nï¼šè€æ•°ç»„é•¿åº¦32ï¼Œ   strideï¼šæ‰©å®¹çš„æ­¥é•¿16</span></span>
<span class="line"><span>    int n = tab.length, stride;</span></span>
<span class="line"><span>    // NCPU:4</span></span>
<span class="line"><span>    // 00000000 00000000 00000000 00000000</span></span>
<span class="line"><span>    // 00000000 00000000 00000100 00000000  - 1024 512 256 128 / 4 = 32</span></span>
<span class="line"><span>    // å¦‚æœæ¯ä¸ªçº¿ç¨‹è¿ç§»çš„é•¿åº¦åŸºäºCPUè®¡ç®—ï¼Œå¤§äº16ï¼Œå°±é‡‡ç”¨è®¡ç®—çš„å€¼ï¼Œå¦‚æœå°äº16ï¼Œå°±ç”¨16</span></span>
<span class="line"><span>    // æ¯ä¸ªçº¿ç¨‹æ¯æ¬¡æœ€å°è¿ç§»16é•¿åº¦æ•°æ®</span></span>
<span class="line"><span>    // stride = 1 &lt; 16</span></span>
<span class="line"><span>    // è¿™ä¸ªæ“ä½œå°±æ˜¯ä¸ºäº†å……åˆ†å‘æŒ¥CPUæ€§èƒ½ï¼Œå› ä¸ºè¿ç§»æ•°æ®æ˜¯CPUå¯†é›†å‹æ“ä½œï¼Œå°½é‡è®©å¹¶å‘æ‰©å®¹çº¿ç¨‹æ•°é‡ä¸è¦å¤ªå¤§ï¼Œä»è€Œé€ æˆCPUçš„æ€§èƒ½éƒ½æ¶ˆè€—åœ¨äº†åˆ‡æ¢ä¸Šï¼Œé€ æˆæ‰©å®¹æ•ˆç‡é™ä½</span></span>
<span class="line"><span>    // å¦‚æœè¦åšä¼˜åŒ–çš„ï¼Œæ¨èå°†æ‰©å®¹çº¿ç¨‹æ•°è®¾ç½®ä¸ºå’ŒCPUå†…æ ¸æ•°+1ä¸€è‡´ã€‚</span></span>
<span class="line"><span>    if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE) </span></span>
<span class="line"><span>        stride = MIN_TRANSFER_STRIDE; </span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // å¦‚æœæ–°æ•°ç»„æ²¡æœ‰åˆå§‹åŒ–</span></span>
<span class="line"><span>    if (nextTab == null) {   </span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            // åˆå§‹åŒ–æ•°ç»„</span></span>
<span class="line"><span>            Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1];</span></span>
<span class="line"><span>            // æ–°æ•°ç»„èµ‹å€¼ç»™nextTab</span></span>
<span class="line"><span>            nextTab = nt;</span></span>
<span class="line"><span>        } catch (Throwable ex) {   </span></span>
<span class="line"><span>            // è¦ä¹ˆOOMï¼Œè¦ä¹ˆæ•°ç»„é•¿åº¦è¾¾åˆ°æœ€å¤§å€¼ã€‚</span></span>
<span class="line"><span>            sizeCtl = Integer.MAX_VALUE;</span></span>
<span class="line"><span>            return;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        // å°†nextTableæˆå‘˜å˜é‡èµ‹å€¼</span></span>
<span class="line"><span>        nextTable = nextTab;</span></span>
<span class="line"><span>        // transferIndexè®¾ç½®ä¸ºè€æ•°ç»„é•¿åº¦</span></span>
<span class="line"><span>        transferIndex = n;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// nï¼šè€æ•°ç»„é•¿åº¦</span></span>
<span class="line"><span>// strideï¼šæ­¥é•¿</span></span>
<span class="line"><span>// nextTale,nextTabï¼šæ–°æ•°ç»„</span></span>
<span class="line"><span>// transferIndexï¼šçº¿ç¨‹é¢†å–ä»»åŠ¡æ—¶çš„æ ¸å¿ƒå±æ€§</span></span></code></pre></div><h3 id="å››ã€transferæ–¹æ³•-è¿ç§»æ•°æ®" tabindex="-1">å››ã€transferæ–¹æ³•-è¿ç§»æ•°æ® <a class="header-anchor" href="#å››ã€transferæ–¹æ³•-è¿ç§»æ•°æ®" aria-label="Permalink to &quot;å››ã€transferæ–¹æ³•-è¿ç§»æ•°æ®&quot;">â€‹</a></h3><p>ç¬¬ä¸€æ­¥ï¼Œçº¿ç¨‹é¢†å–è¿ç§»æ•°æ®çš„ä»»åŠ¡</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) {</span></span>
<span class="line"><span>    // çœç•¥éƒ¨åˆ†ä»£ç </span></span>
<span class="line"><span>    // nï¼šè€æ•°ç»„é•¿åº¦   32</span></span>
<span class="line"><span>    // strideï¼šæ­¥é•¿   16</span></span>
<span class="line"><span>    // nextTale,nextTabï¼šæ–°æ•°ç»„</span></span>
<span class="line"><span>    // nextnï¼šæ–°æ•°ç»„é•¿åº¦  64 </span></span>
<span class="line"><span>    // transferIndexï¼šçº¿ç¨‹é¢†å–ä»»åŠ¡æ—¶çš„æ ¸å¿ƒå±æ€§ 32</span></span>
<span class="line"><span>    // å…ˆçœ‹é¢†å–ä»»åŠ¡çš„è¿‡ç¨‹ï¼ï¼ï¼</span></span>
<span class="line"><span>    // å£°æ˜fwdèŠ‚ç‚¹ï¼Œåœ¨è€æ•°ç»„è¿ç§»æ•°æ®å®Œæˆåï¼Œå°†fwdèµ‹å€¼ä¸Šå»</span></span>
<span class="line"><span>    ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab);</span></span>
<span class="line"><span>    // é¢†ä»»åŠ¡çš„æ ¸å¿ƒæ ‡è¯†</span></span>
<span class="line"><span>    boolean advance = true;</span></span>
<span class="line"><span>    // æ‰©å®¹ç»“æŸäº†å’©ï¼Ÿ</span></span>
<span class="line"><span>    boolean finishing = false;</span></span>
<span class="line"><span>    // æ‰©å®¹çš„forå¾ªç¯</span></span>
<span class="line"><span>    for (int i = 0, bound = 0;;) {</span></span>
<span class="line"><span>        Node&lt;K,V&gt; f; int fh;</span></span>
<span class="line"><span>        // é¢†å–ä»»åŠ¡çš„whileå¾ªç¯</span></span>
<span class="line"><span>        while (advance) {</span></span>
<span class="line"><span>            int nextIndex, nextBound;</span></span>
<span class="line"><span>            // ç¬¬ä¸€ä¸ªåˆ¤æ–­æ˜¯ä¸ºäº†è¿ç§»ä¸‹ä¸€ä¸ªç´¢å¼•æ•°æ®ï¼ˆæš‚æ—¶ä¸ç®¡ï¼‰</span></span>
<span class="line"><span>            if (--i &gt;= bound || finishing)</span></span>
<span class="line"><span>                advance = false;</span></span>
<span class="line"><span>            // è¯´æ˜æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–äº†ï¼ˆæš‚æ—¶ä¸ç®¡ï¼‰</span></span>
<span class="line"><span>            else if ((nextIndex = transferIndex) &lt;= 0) {</span></span>
<span class="line"><span>                i = -1;</span></span>
<span class="line"><span>                advance = false;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // transferIndexï¼š16</span></span>
<span class="line"><span>            // strideï¼š16ï¼ŒnextIndexï¼š32ï¼ŒnextBoundï¼š16</span></span>
<span class="line"><span>            // boundï¼š16ï¼Œiï¼š31</span></span>
<span class="line"><span>            // å¼€å§‹é¢†å–ä»»åŠ¡ï¼Œå¦‚æœCASæˆåŠŸï¼Œä»£è¡¨å½“å‰çº¿ç¨‹é¢†å–äº†32~16è¿™ä¸ªèŒƒå›´æ•°æ®çš„è¿ç§»</span></span>
<span class="line"><span>            else if (U.compareAndSwapInt</span></span>
<span class="line"><span>                     (this, TRANSFERINDEX, nextIndex,</span></span>
<span class="line"><span>                      nextBound = (nextIndex &gt; stride ?</span></span>
<span class="line"><span>                                   nextIndex - stride : 0))) {</span></span>
<span class="line"><span>                bound = nextBound;</span></span>
<span class="line"><span>                i = nextIndex - 1;</span></span>
<span class="line"><span>                advance = false;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span></code></pre></div><p>ç¬¬äºŒæ­¥ï¼šåˆ¤æ–­æ˜¯å¦ç»“æŸï¼Œä»¥åŠçº¿ç¨‹é€€å‡ºæ‰©å®¹ï¼Œå¹¶ä¸”ä¸ºç©ºæ—¶ï¼Œè®¾ç½®fwdï¼Œå¹¶ä¸”hashä¸ºmovedç›´æ¥ç§»åŠ¨åˆ°ä¸‹ä¸ªä½ç½®</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) {</span></span>
<span class="line"><span>    // çœç•¥éƒ¨åˆ†ä»£ç </span></span>
<span class="line"><span>    // nï¼šè€æ•°ç»„é•¿åº¦   32</span></span>
<span class="line"><span>    // strideï¼šæ­¥é•¿   16</span></span>
<span class="line"><span>    // nextTale,nextTabï¼šæ–°æ•°ç»„</span></span>
<span class="line"><span>    // nextnï¼šæ–°æ•°ç»„é•¿åº¦  64 </span></span>
<span class="line"><span>    // transferIndexï¼šçº¿ç¨‹é¢†å–ä»»åŠ¡æ—¶çš„æ ¸å¿ƒå±æ€§ 32</span></span>
<span class="line"><span>    // å…ˆçœ‹é¢†å–ä»»åŠ¡çš„è¿‡ç¨‹ï¼ï¼ï¼</span></span>
<span class="line"><span>    // å£°æ˜fwdèŠ‚ç‚¹ï¼Œåœ¨è€æ•°ç»„è¿ç§»æ•°æ®å®Œæˆåï¼Œå°†fwdèµ‹å€¼ä¸Šå»</span></span>
<span class="line"><span>    ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab);</span></span>
<span class="line"><span>    // é¢†ä»»åŠ¡çš„æ ¸å¿ƒæ ‡è¯†</span></span>
<span class="line"><span>    boolean advance = true;</span></span>
<span class="line"><span>    // æ‰©å®¹ç»“æŸäº†å’©ï¼Ÿ</span></span>
<span class="line"><span>    boolean finishing = false;</span></span>
<span class="line"><span>    // æ‰©å®¹çš„forå¾ªç¯</span></span>
<span class="line"><span>    for (int i = 0, bound = 0;;) {</span></span>
<span class="line"><span>        Node&lt;K,V&gt; f; int fh;</span></span>
<span class="line"><span>        // é¢†å–ä»»åŠ¡çš„whileå¾ªç¯</span></span>
<span class="line"><span>        while (advance) {</span></span>
<span class="line"><span>            int nextIndex, nextBound;</span></span>
<span class="line"><span>            // ç¬¬ä¸€ä¸ªåˆ¤æ–­æ˜¯ä¸ºäº†è¿ç§»ä¸‹ä¸€ä¸ªç´¢å¼•æ•°æ®ï¼ˆæš‚æ—¶ä¸ç®¡ï¼‰</span></span>
<span class="line"><span>            if (--i &gt;= bound || finishing)</span></span>
<span class="line"><span>                advance = false;</span></span>
<span class="line"><span>            // è¯´æ˜æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–äº†ï¼ˆæš‚æ—¶ä¸ç®¡ï¼‰</span></span>
<span class="line"><span>            else if ((nextIndex = transferIndex) &lt;= 0) {</span></span>
<span class="line"><span>                i = -1;</span></span>
<span class="line"><span>                advance = false;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // transferIndexï¼š16</span></span>
<span class="line"><span>            // strideï¼š16ï¼ŒnextIndexï¼š32ï¼ŒnextBoundï¼š16</span></span>
<span class="line"><span>            // boundï¼š16ï¼Œiï¼š31</span></span>
<span class="line"><span>            // å¼€å§‹é¢†å–ä»»åŠ¡ï¼Œå¦‚æœCASæˆåŠŸï¼Œä»£è¡¨å½“å‰çº¿ç¨‹é¢†å–äº†32~16è¿™ä¸ªèŒƒå›´æ•°æ®çš„è¿ç§»</span></span>
<span class="line"><span>            else if (U.compareAndSwapInt</span></span>
<span class="line"><span>                     (this, TRANSFERINDEX, nextIndex,</span></span>
<span class="line"><span>                      nextBound = (nextIndex &gt; stride ?</span></span>
<span class="line"><span>                                   nextIndex - stride : 0))) {</span></span>
<span class="line"><span>                bound = nextBound;</span></span>
<span class="line"><span>                i = nextIndex - 1;</span></span>
<span class="line"><span>                advance = false;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        // è¿ç§»æœ€åä¸€æ®µçš„çº¿ç¨‹å¹²å®Œæ´»äº†ï¼Œæˆ–è€…å…¶ä»–çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–äº†ã€‚</span></span>
<span class="line"><span>        if (i &lt; 0) {</span></span>
<span class="line"><span>            int sc;</span></span>
<span class="line"><span>            // åˆ¤æ–­ç»“æŸäº†æ²¡ï¼Œç¬¬ä¸€æ¬¡è‚¯å®šè¿›ä¸æ¥</span></span>
<span class="line"><span>            if (finishing) {</span></span>
<span class="line"><span>                // ç»“æŸæ‰©å®¹ï¼Œå°†nextTablè®¾ç½®ä¸ºnull</span></span>
<span class="line"><span>                nextTable = null;</span></span>
<span class="line"><span>                // å°†è¿ç§»å®Œæ•°æ®çš„æ–°æ•°ç»„ï¼ŒæŒ‡å‘æŒ‡å‘çš„è€æ•°ç»„</span></span>
<span class="line"><span>                table = nextTab;</span></span>
<span class="line"><span>                // å°†sizeCtlå¤åˆ¶ä¸ºä¸‹æ¬¡æ‰©å®¹çš„é˜ˆå€¼</span></span>
<span class="line"><span>                sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1);</span></span>
<span class="line"><span>                // ç»“æŸ</span></span>
<span class="line"><span>                return;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // åˆ°è¿™ï¼Œè¯´æ˜å½“å‰çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–äº†</span></span>
<span class="line"><span>            // åŸºäºCASçš„æ–¹å¼ï¼Œå°†ä½ä½-1ï¼Œä»£è¡¨å½“å‰çº¿ç¨‹é€€å‡ºæ‰©å®¹æ“ä½œï¼ˆå¦‚æœæ˜¯æœ€åä¸€ä¸ªï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„æ´»ï¼‰</span></span>
<span class="line"><span>            if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) {</span></span>
<span class="line"><span>                // åˆ¤æ–­æˆ‘æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå®Œæˆè¿ç§»æ•°æ®çš„çº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥returnç»“æŸ</span></span>
<span class="line"><span>                if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)</span></span>
<span class="line"><span>                    return;</span></span>
<span class="line"><span>                // å¦‚æœåˆ°è¿™ï¼Œè¯´æ˜æˆ‘æ˜¯æœ€åä¸€ä¸ªç»“æŸè¿ç§»æ•°æ®çš„çº¿ç¨‹ã€‚</span></span>
<span class="line"><span>                // finishingç»“æŸè¡¨ç¤ºå’Œadvanceé¢†å–ä»»åŠ¡çš„æ ‡è¯†å…¨éƒ¨è®¾ç½®ä¸ºtrue</span></span>
<span class="line"><span>                finishing = advance = true;</span></span>
<span class="line"><span>                // iè®¾ç½®ä¸ºè€æ•°ç»„é•¿åº¦ï¼Œä»å¤´åˆ°ä½å†æ£€æŸ¥ä¸€æ¬¡æ•´ä¸ªè€æ•°ç»„ã€‚</span></span>
<span class="line"><span>                i = n; </span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            é¢å¤–åˆ†æï¼šå½“å‰çº¿ç¨‹å®Œæˆé¢†å–çš„è¿ç§»ä»»åŠ¡åï¼Œå†æ¬¡è¿›å…¥whileå¾ªç¯ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ä»»åŠ¡å¯ä»¥é¢†å–å¦‚æœtransferIndexå˜ä¸º0äº†ï¼Œä»£è¡¨æˆ‘æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–ï¼Œå°†iè®¾ç½®ä¸º-1æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–ï¼Œé€€å‡ºå½“å‰æ‰©å®¹æ“ä½œï¼š1ã€åŸºäºCASå°†sizeCtl - 1ä»£è¡¨æˆ‘é€€å‡ºæ‰©å®¹æ“ä½œ2ã€-1æˆåŠŸåï¼Œè¿˜è¦åˆ¤æ–­ï¼Œæˆ‘æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªé€€å‡ºæ‰©å®¹çš„çº¿ç¨‹ï¼ˆsc - 2å€¼æ˜¯å¦æ˜¯ æ‰©å®¹æ ‡è¯†æˆ³ &lt;&lt; 16ï¼‰Â  Â  å¦‚æœä¸æ˜¯ï¼Œç›´æ¥returnç»“æŸ3ã€å¦‚æœæ˜¯æœ€åä¸€ä¸ªç»“æŸè¿ç§»çš„çº¿ç¨‹ï¼Œå°†iå¤åˆ¶ä¸ºè€æ•°ç»„é•¿åº¦ï¼Œé‡æ–°ä»æœ«ä½åˆ°å¤´éƒ¨å†æ¬¡æ£€æŸ¥ä¸€åœˆ</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        else if ((f = tabAt(tab, i)) == null)</span></span>
<span class="line"><span>            // å¦‚æœå‘ç°è¿ç§»ä¸ºä¸»çš„æ•°æ®ä¸ºnullï¼Œè®¾ç½®æ”¾ç½®ä¸€ä¸ªfwdï¼Œä»£è¡¨å½“å‰ä½ç½®è¿ç§»å®Œæˆ</span></span>
<span class="line"><span>            advance = casTabAt(tab, i, null, fwd);</span></span>
<span class="line"><span>        else if ((fh = f.hash) == MOVED)</span></span>
<span class="line"><span>            // æ˜¯åœ¨æ£€æŸ¥æ—¶çš„é€»è¾‘</span></span>
<span class="line"><span>            advance = true;</span></span></code></pre></div><h3 id="äº”ã€transferæ–¹æ³•-lastrunæœºåˆ¶" tabindex="-1">äº”ã€transferæ–¹æ³•-lastRunæœºåˆ¶ <a class="header-anchor" href="#äº”ã€transferæ–¹æ³•-lastrunæœºåˆ¶" aria-label="Permalink to &quot;äº”ã€transferæ–¹æ³•-lastRunæœºåˆ¶&quot;">â€‹</a></h3><p>å°±æ˜¯è¿ç§»é“¾è¡¨åˆ°æ–°æ•°ç»„æ—¶çš„æ“ä½œ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) {</span></span>
<span class="line"><span>    // çœç•¥éƒ¨åˆ†ä»£ç </span></span>
<span class="line"><span>    // nï¼šè€æ•°ç»„é•¿åº¦   32</span></span>
<span class="line"><span>    // strideï¼šæ­¥é•¿   16</span></span>
<span class="line"><span>    // nextTale,nextTabï¼šæ–°æ•°ç»„</span></span>
<span class="line"><span>    // nextnï¼šæ–°æ•°ç»„é•¿åº¦  64 </span></span>
<span class="line"><span>    // transferIndexï¼šçº¿ç¨‹é¢†å–ä»»åŠ¡æ—¶çš„æ ¸å¿ƒå±æ€§ 32</span></span>
<span class="line"><span>    // å…ˆçœ‹é¢†å–ä»»åŠ¡çš„è¿‡ç¨‹ï¼ï¼ï¼</span></span>
<span class="line"><span>    // å£°æ˜fwdèŠ‚ç‚¹ï¼Œåœ¨è€æ•°ç»„è¿ç§»æ•°æ®å®Œæˆåï¼Œå°†fwdèµ‹å€¼ä¸Šå»</span></span>
<span class="line"><span>    ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab);</span></span>
<span class="line"><span>    // é¢†ä»»åŠ¡çš„æ ¸å¿ƒæ ‡è¯†</span></span>
<span class="line"><span>    boolean advance = true;</span></span>
<span class="line"><span>    // æ‰©å®¹ç»“æŸäº†å’©ï¼Ÿ</span></span>
<span class="line"><span>    boolean finishing = false;</span></span>
<span class="line"><span>    // æ‰©å®¹çš„forå¾ªç¯</span></span>
<span class="line"><span>    for (int i = 0, bound = 0;;) {</span></span>
<span class="line"><span>        Node&lt;K,V&gt; f; int fh;</span></span>
<span class="line"><span>        // é¢†å–ä»»åŠ¡çš„whileå¾ªç¯</span></span>
<span class="line"><span>        while (advance) {</span></span>
<span class="line"><span>            int nextIndex, nextBound;</span></span>
<span class="line"><span>            // ç¬¬ä¸€ä¸ªåˆ¤æ–­æ˜¯ä¸ºäº†è¿ç§»ä¸‹ä¸€ä¸ªç´¢å¼•æ•°æ®ï¼ˆæš‚æ—¶ä¸ç®¡ï¼‰</span></span>
<span class="line"><span>            if (--i &gt;= bound || finishing)</span></span>
<span class="line"><span>                advance = false;</span></span>
<span class="line"><span>            // è¯´æ˜æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–äº†ï¼ˆæš‚æ—¶ä¸ç®¡ï¼‰</span></span>
<span class="line"><span>            else if ((nextIndex = transferIndex) &lt;= 0) {</span></span>
<span class="line"><span>                i = -1;</span></span>
<span class="line"><span>                advance = false;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // transferIndexï¼š16</span></span>
<span class="line"><span>            // strideï¼š16ï¼ŒnextIndexï¼š32ï¼ŒnextBoundï¼š16</span></span>
<span class="line"><span>            // boundï¼š16ï¼Œiï¼š31</span></span>
<span class="line"><span>            // å¼€å§‹é¢†å–ä»»åŠ¡ï¼Œå¦‚æœCASæˆåŠŸï¼Œä»£è¡¨å½“å‰çº¿ç¨‹é¢†å–äº†32~16è¿™ä¸ªèŒƒå›´æ•°æ®çš„è¿ç§»</span></span>
<span class="line"><span>            else if (U.compareAndSwapInt</span></span>
<span class="line"><span>                     (this, TRANSFERINDEX, nextIndex,</span></span>
<span class="line"><span>                      nextBound = (nextIndex &gt; stride ?</span></span>
<span class="line"><span>                                   nextIndex - stride : 0))) {</span></span>
<span class="line"><span>                bound = nextBound;</span></span>
<span class="line"><span>                i = nextIndex - 1;</span></span>
<span class="line"><span>                advance = false;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        // è¿ç§»æœ€åä¸€æ®µçš„çº¿ç¨‹å¹²å®Œæ´»äº†ï¼Œæˆ–è€…å…¶ä»–çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–äº†ã€‚</span></span>
<span class="line"><span>        if (i &lt; 0) {</span></span>
<span class="line"><span>            int sc;</span></span>
<span class="line"><span>            // åˆ¤æ–­ç»“æŸäº†æ²¡ï¼Œç¬¬ä¸€æ¬¡è‚¯å®šè¿›ä¸æ¥</span></span>
<span class="line"><span>            if (finishing) {</span></span>
<span class="line"><span>                // ç»“æŸæ‰©å®¹ï¼Œå°†nextTablè®¾ç½®ä¸ºnull</span></span>
<span class="line"><span>                nextTable = null;</span></span>
<span class="line"><span>                // å°†è¿ç§»å®Œæ•°æ®çš„æ–°æ•°ç»„ï¼ŒæŒ‡å‘æŒ‡å‘çš„è€æ•°ç»„</span></span>
<span class="line"><span>                table = nextTab;</span></span>
<span class="line"><span>                // å°†sizeCtlå¤åˆ¶ä¸ºä¸‹æ¬¡æ‰©å®¹çš„é˜ˆå€¼</span></span>
<span class="line"><span>                sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1);</span></span>
<span class="line"><span>                // ç»“æŸ</span></span>
<span class="line"><span>                return;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // åˆ°è¿™ï¼Œè¯´æ˜å½“å‰çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–äº†</span></span>
<span class="line"><span>            // åŸºäºCASçš„æ–¹å¼ï¼Œå°†ä½ä½-1ï¼Œä»£è¡¨å½“å‰çº¿ç¨‹é€€å‡ºæ‰©å®¹æ“ä½œï¼ˆå¦‚æœæ˜¯æœ€åä¸€ä¸ªï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„æ´»ï¼‰</span></span>
<span class="line"><span>            if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) {</span></span>
<span class="line"><span>                // åˆ¤æ–­æˆ‘æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªå®Œæˆè¿ç§»æ•°æ®çš„çº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥returnç»“æŸ</span></span>
<span class="line"><span>                if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)</span></span>
<span class="line"><span>                    return;</span></span>
<span class="line"><span>                // å¦‚æœåˆ°è¿™ï¼Œè¯´æ˜æˆ‘æ˜¯æœ€åä¸€ä¸ªç»“æŸè¿ç§»æ•°æ®çš„çº¿ç¨‹ã€‚</span></span>
<span class="line"><span>                // finishingç»“æŸè¡¨ç¤ºå’Œadvanceé¢†å–ä»»åŠ¡çš„æ ‡è¯†å…¨éƒ¨è®¾ç½®ä¸ºtrue</span></span>
<span class="line"><span>                finishing = advance = true;</span></span>
<span class="line"><span>                // iè®¾ç½®ä¸ºè€æ•°ç»„é•¿åº¦ï¼Œä»å¤´åˆ°ä½å†æ£€æŸ¥ä¸€æ¬¡æ•´ä¸ªè€æ•°ç»„ã€‚</span></span>
<span class="line"><span>                i = n; </span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            é¢å¤–åˆ†æï¼šå½“å‰çº¿ç¨‹å®Œæˆé¢†å–çš„è¿ç§»ä»»åŠ¡åï¼Œå†æ¬¡è¿›å…¥whileå¾ªç¯ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ä»»åŠ¡å¯ä»¥é¢†å–å¦‚æœtransferIndexå˜ä¸º0äº†ï¼Œä»£è¡¨æˆ‘æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–ï¼Œå°†iè®¾ç½®ä¸º-1æ²¡æœ‰ä»»åŠ¡å¯ä»¥é¢†å–ï¼Œé€€å‡ºå½“å‰æ‰©å®¹æ“ä½œï¼š1ã€åŸºäºCASå°†sizeCtl - 1ä»£è¡¨æˆ‘é€€å‡ºæ‰©å®¹æ“ä½œ2ã€-1æˆåŠŸåï¼Œè¿˜è¦åˆ¤æ–­ï¼Œæˆ‘æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªé€€å‡ºæ‰©å®¹çš„çº¿ç¨‹ï¼ˆsc - 2å€¼æ˜¯å¦æ˜¯ æ‰©å®¹æ ‡è¯†æˆ³ &lt;&lt; 16ï¼‰Â  Â  å¦‚æœä¸æ˜¯ï¼Œç›´æ¥returnç»“æŸ3ã€å¦‚æœæ˜¯æœ€åä¸€ä¸ªç»“æŸè¿ç§»çš„çº¿ç¨‹ï¼Œå°†iå¤åˆ¶ä¸ºè€æ•°ç»„é•¿åº¦ï¼Œé‡æ–°ä»æœ«ä½åˆ°å¤´éƒ¨å†æ¬¡æ£€æŸ¥ä¸€åœˆ</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        else if ((f = tabAt(tab, i)) == null)</span></span>
<span class="line"><span>            // å¦‚æœå‘ç°è¿ç§»ä¸ºä¸»çš„æ•°æ®ä¸ºnullï¼Œè®¾ç½®æ”¾ç½®ä¸€ä¸ªfwdï¼Œä»£è¡¨å½“å‰ä½ç½®è¿ç§»å®Œæˆ</span></span>
<span class="line"><span>            advance = casTabAt(tab, i, null, fwd);</span></span>
<span class="line"><span>        else if ((fh = f.hash) == MOVED)</span></span>
<span class="line"><span>            // æ˜¯åœ¨æ£€æŸ¥æ—¶çš„é€»è¾‘</span></span>
<span class="line"><span>            advance = true; </span></span>
<span class="line"><span>        else {</span></span>
<span class="line"><span>            // è¿ç§»æ•°æ®ï¼ŒåŠ é”ï¼</span></span>
<span class="line"><span>            synchronized (f) {</span></span>
<span class="line"><span>                // æ‹¿åˆ°å½“å‰ä½ç½®æ•°æ®</span></span>
<span class="line"><span>                if (tabAt(tab, i) == f) {</span></span>
<span class="line"><span>                    Node&lt;K,V&gt; ln, hn;</span></span>
<span class="line"><span>                    // è¯´æ˜å½“å‰èŠ‚ç‚¹çŠ¶æ€æ­£å¸¸ï¼Œä¸æ˜¯è¿ç§»ï¼Œä¸æ˜¯çº¢é»‘æ ‘ï¼Œä¸æ˜¯é¢„ç•™</span></span>
<span class="line"><span>                    if (fh &gt;= 0) {</span></span>
<span class="line"><span>                        // fhä¸è€æ•°ç»„è¿›è¡Œ&amp;è¿ç®—ï¼Œå¾—åˆ°runBit</span></span>
<span class="line"><span>                        // 00001111</span></span>
<span class="line"><span>                        // 00010000</span></span>
<span class="line"><span>                        // è¿™ä¸ªè®¡ç®—çš„ç»“æœï¼Œä¼šå†³å®šå½“å‰æ•°æ®åœ¨è¿ç§»æ—¶ï¼Œæ˜¯æ”¾åˆ°æ–°æ•°ç»„çš„iä½ç½®è¿˜æœ‰æ–°æ•°ç»„çš„ i + nä½ç½®</span></span>
<span class="line"><span>                        int runBit = fh &amp; n;</span></span>
<span class="line"><span>                        Node&lt;K,V&gt; lastRun = f;</span></span>
<span class="line"><span>                        // lastRunæœºåˆ¶</span></span>
<span class="line"><span>                        // æå‰å¾ªç¯ä¸€æ¬¡é“¾è¡¨ï¼Œå°†èŠ‚ç‚¹èµ‹å€¼åˆ°å¯¹åº”çš„é«˜ä½ä½Node./</span></span>
<span class="line"><span>                        // å¦‚æœé“¾è¡¨æœ€åé¢çš„å€¼æ²¡æœ‰å˜åŒ–ï¼Œé‚£å°±ä¸åŠ¨æŒ‡é’ˆï¼Œç›´æ¥å¤åˆ¶ã€‚</span></span>
<span class="line"><span>                        for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) {</span></span>
<span class="line"><span>                            int b = p.hash &amp; n;</span></span>
<span class="line"><span>                            if (b != runBit) {</span></span>
<span class="line"><span>                                runBit = b;</span></span>
<span class="line"><span>                                lastRun = p;</span></span>
<span class="line"><span>                            }</span></span>
<span class="line"><span>                        }</span></span>
<span class="line"><span>                        if (runBit == 0) {</span></span>
<span class="line"><span>                            ln = lastRun;</span></span>
<span class="line"><span>                            hn = null;</span></span>
<span class="line"><span>                        }</span></span>
<span class="line"><span>                        else {</span></span>
<span class="line"><span>                            hn = lastRun;</span></span>
<span class="line"><span>                            ln = null;</span></span>
<span class="line"><span>                        }</span></span>
<span class="line"><span>                        // å†æ¬¡å¾ªç¯æ—¶ï¼Œå°±å¾ªç¯åˆ°lastRunä½ç½®ï¼Œä¸å†ç»§ç»­å¾€ä¸‹å¾ªç¯</span></span>
<span class="line"><span>                        // è¿™æ ·å¯ä»¥ä¸ç”¨æ¯ä¸ªèŠ‚ç‚¹éƒ½newï¼Œé¿å…GCå’ŒOOMé—®é¢˜ã€‚</span></span>
<span class="line"><span>                        for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) {</span></span>
<span class="line"><span>                            int ph = p.hash; K pk = p.key; V pv = p.val;</span></span>
<span class="line"><span>                            if ((ph &amp; n) == 0)</span></span>
<span class="line"><span>                                ln = new Node&lt;K,V&gt;(ph, pk, pv, ln);</span></span>
<span class="line"><span>                            else</span></span>
<span class="line"><span>                                hn = new Node&lt;K,V&gt;(ph, pk, pv, hn);</span></span>
<span class="line"><span>                        }</span></span>
<span class="line"><span>                        // æ”¾ä½ä½</span></span>
<span class="line"><span>                        setTabAt(nextTab, i, ln);</span></span>
<span class="line"><span>                        // æ”¾é«˜ä½</span></span>
<span class="line"><span>                        setTabAt(nextTab, i + n, hn);</span></span>
<span class="line"><span>                        // å°†å½“å‰è¿ç§»å®Œçš„æ¡¶ä½ç½®ï¼Œè®¾ç½®ä¸Šfwdï¼Œä»£è¡¨æ•°æ®è¿ç§»å®Œæ¯•</span></span>
<span class="line"><span>                        setTabAt(tab, i, fwd);</span></span>
<span class="line"><span>                        // advanceï¼Œä»£è¡¨æ‰§è¡Œä¸‹æ¬¡å¾ªç¯ï¼Œi--ã€‚</span></span>
<span class="line"><span>                        advance = true;</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                    // çœç•¥çº¢é»‘æ ‘è¿ç§»ï¼</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å…­ã€helptransferæ–¹æ³•-ååŠ©æ‰©å®¹" tabindex="-1">å…­ã€helpTransferæ–¹æ³•-ååŠ©æ‰©å®¹ <a class="header-anchor" href="#å…­ã€helptransferæ–¹æ³•-ååŠ©æ‰©å®¹" aria-label="Permalink to &quot;å…­ã€helpTransferæ–¹æ³•-ååŠ©æ‰©å®¹&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// ååŠ©æ‰©å®¹</span></span>
<span class="line"><span>final Node&lt;K,V&gt;[] helpTransfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt; f) {</span></span>
<span class="line"><span>    Node&lt;K,V&gt;[] nextTab; int sc;</span></span>
<span class="line"><span>    // è€æ•°ç»„ä¸ä¸ºnullï¼Œå½“å‰èŠ‚ç‚¹æ˜¯fwdï¼Œæ–°æ•°ç»„ä¸ä¸ºnull</span></span>
<span class="line"><span>    if (tab != null &amp;&amp; (f instanceof ForwardingNode) &amp;&amp;</span></span>
<span class="line"><span>        (nextTab = ((ForwardingNode&lt;K,V&gt;)f).nextTable) != null) {</span></span>
<span class="line"><span>        // åˆ›å»ºè‡ªå·±çš„æ‰©å®¹æ ‡è¯†æˆ³</span></span>
<span class="line"><span>        int rs = resizeStamp(tab.length);</span></span>
<span class="line"><span>        // åˆ¤æ–­ä¹‹å‰èµ‹å€¼çš„å†…å®¹æ˜¯å¦æœ‰å˜åŒ–ï¼Œå¹¶ä¸”sizeCtlæ˜¯å¦å°äº0</span></span>
<span class="line"><span>        while (nextTab == nextTable &amp;&amp; table == tab &amp;&amp;</span></span>
<span class="line"><span>               (sc = sizeCtl) &lt; 0) {</span></span>
<span class="line"><span>            if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || </span></span>
<span class="line"><span>                sc == rs + 1 ||</span></span>
<span class="line"><span>                sc == rs + MAX_RESIZERS || </span></span>
<span class="line"><span>                transferIndex &lt;= 0)</span></span>
<span class="line"><span>                // æœ‰ä¸€ä¸ªæ»¡è¶³ï¼Œå°±è¯´æ˜ä¸éœ€è¦ååŠ©æ‰©å®¹äº†</span></span>
<span class="line"><span>                break;</span></span>
<span class="line"><span>            // CASï¼Œå°†sizeCtl + 1ï¼Œä»£è¡¨æ¥ååŠ©æ‰©å®¹äº†</span></span>
<span class="line"><span>            if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) {</span></span>
<span class="line"><span>                transfer(tab, nextTab);</span></span>
<span class="line"><span>                break;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        return nextTab;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return table;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h1 id="ä¸ƒã€jucå¹¶å‘å·¥å…·" tabindex="-1">ä¸ƒã€<strong>JUCå¹¶å‘å·¥å…·</strong> <a class="header-anchor" href="#ä¸ƒã€jucå¹¶å‘å·¥å…·" aria-label="Permalink to &quot;ä¸ƒã€**JUCå¹¶å‘å·¥å…·**&quot;">â€‹</a></h1><p>è·Ÿç€æˆ‘æŒæ¡è¿™äº›å†…å®¹ï¼Œé¦–å…ˆä½ è¦å¯¹AQSæœ‰ä¸€å®šäº†è§£ã€‚ï¼ˆReentrantLockï¼ŒReentrantReadWriteLockï¼‰</p><h3 id="ä¸€ã€countdownlatchåº”ç”¨" tabindex="-1">ä¸€ã€CountDownLatchåº”ç”¨ <a class="header-anchor" href="#ä¸€ã€countdownlatchåº”ç”¨" aria-label="Permalink to &quot;ä¸€ã€CountDownLatchåº”ç”¨&quot;">â€‹</a></h3><p>CountDownLatchæœ¬èº«å°±å¥½åƒä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¯ä»¥è®©ä¸€ä¸ªçº¿ç¨‹æˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆåå†æ‰§è¡Œã€‚</p><p>åº”ç”¨æ–¹å¼å·¨ç®€å•</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws InterruptedException, BrokenBarrierException {</span></span>
<span class="line"><span>    // å£°æ˜CountDownLatchï¼Œæœ‰å‚æ„é€ ä¼ å…¥çš„å€¼ï¼Œä¼šèµ‹å€¼ç»™stateï¼ŒCountDownLatchåŸºäºAQSå®ç°</span></span>
<span class="line"><span>    // 3 - 1 = 2 - 1 = 1 - 1</span></span>
<span class="line"><span>    CountDownLatch countDownLatch = new CountDownLatch(3);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    new Thread(() -&gt; {</span></span>
<span class="line"><span>        System.out.println(&quot;111&quot;);</span></span>
<span class="line"><span>        countDownLatch.countDown();</span></span>
<span class="line"><span>    }).start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    new Thread(() -&gt; {</span></span>
<span class="line"><span>        System.out.println(&quot;222&quot;);</span></span>
<span class="line"><span>        countDownLatch.countDown();</span></span>
<span class="line"><span>    }).start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    new Thread(() -&gt; {</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            Thread.sleep(1000);</span></span>
<span class="line"><span>        } catch (InterruptedException e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        System.out.println(&quot;333&quot;);</span></span>
<span class="line"><span>        countDownLatch.countDown();</span></span>
<span class="line"><span>    }).start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // ä¸»çº¿ä¼šé˜»å¡åœ¨è¿™ä¸ªä½ç½®ï¼Œç›´åˆ°CountDownLatchçš„stateå˜ä¸º0</span></span>
<span class="line"><span>    countDownLatch.await();</span></span>
<span class="line"><span>    System.out.println(&quot;main&quot;);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äºŒã€countdownlatchæ ¸å¿ƒæºç åˆ†æ" tabindex="-1">äºŒã€CountDownLatchæ ¸å¿ƒæºç åˆ†æ <a class="header-anchor" href="#äºŒã€countdownlatchæ ¸å¿ƒæºç åˆ†æ" aria-label="Permalink to &quot;äºŒã€CountDownLatchæ ¸å¿ƒæºç åˆ†æ&quot;">â€‹</a></h3><h4 id="_2-1-ä»æ„é€ æ–¹æ³•æŸ¥çœ‹" tabindex="-1">2.1 ä»æ„é€ æ–¹æ³•æŸ¥çœ‹ <a class="header-anchor" href="#_2-1-ä»æ„é€ æ–¹æ³•æŸ¥çœ‹" aria-label="Permalink to &quot;2.1 ä»æ„é€ æ–¹æ³•æŸ¥çœ‹&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// CountDownLatch çš„æœ‰å‚æ„é€ </span></span>
<span class="line"><span>public CountDownLatch(int count) {</span></span>
<span class="line"><span>    // å¥å£®æ€§æ ¡éªŒ</span></span>
<span class="line"><span>    if (count &lt; 0) throw new IllegalArgumentException(&quot;count &lt; 0&quot;);</span></span>
<span class="line"><span>    // æ„å»ºSyncç»™AQSçš„stateèµ‹å€¼</span></span>
<span class="line"><span>    this.sync = new Sync(count);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_2-2-countdownæ–¹æ³•" tabindex="-1">2.2 countDownæ–¹æ³• <a class="header-anchor" href="#_2-2-countdownæ–¹æ³•" aria-label="Permalink to &quot;2.2 countDownæ–¹æ³•&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// countDownæ–¹æ³•,æœ¬è´¨å°±æ˜¯è°ƒç”¨äº†AQSçš„é‡Šæ”¾å…±äº«é”æ“ä½œ</span></span>
<span class="line"><span>// è¿™é‡Œçš„åŠŸèƒ½éƒ½æ˜¯AQSæä¾›çš„ï¼Œåªæœ‰tryReleaseSharedéœ€è¦å®ç°çš„ç±»è‡ªå·±å»ç¼–å†™ä¸šåŠ¡</span></span>
<span class="line"><span>public final boolean releaseShared(int arg) {</span></span>
<span class="line"><span>    if (tryReleaseShared(arg)) {</span></span>
<span class="line"><span>        // å”¤é†’åœ¨AQSé˜Ÿåˆ—ä¸­æ’é˜Ÿçš„çº¿ç¨‹ã€‚</span></span>
<span class="line"><span>        doReleaseShared();</span></span>
<span class="line"><span>        return true;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return false;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// countDownLatchå®ç°çš„ä¸šåŠ¡</span></span>
<span class="line"><span>protected boolean tryReleaseShared(int releases) {</span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        int c = getState();</span></span>
<span class="line"><span>        if (c == 0)</span></span>
<span class="line"><span>            return false;</span></span>
<span class="line"><span>        // state - 1</span></span>
<span class="line"><span>        int nextc = c-1;</span></span>
<span class="line"><span>        // ç”¨CASèµ‹å€¼</span></span>
<span class="line"><span>        if (compareAndSetState(c, nextc))</span></span>
<span class="line"><span>            return nextc == 0;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>// å¦‚æœCountDownLatchä¸­çš„stateå·²ç»ä¸º0äº†ï¼Œé‚£ä¹ˆå†æ¬¡æ‰§è¡ŒcountDownè·Ÿæ²¡æ‰§è¡Œä¸€æ ·ã€‚</span></span>
<span class="line"><span>// è€Œä¸”åªè¦stateå˜ä¸º0ï¼Œawaitå°±ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚</span></span></code></pre></div><h4 id="_2-3-awaitæ–¹æ³•" tabindex="-1">2.3 awaitæ–¹æ³• <a class="header-anchor" href="#_2-3-awaitæ–¹æ³•" aria-label="Permalink to &quot;2.3 awaitæ–¹æ³•&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// awaitæ–¹æ³•</span></span>
<span class="line"><span>public void await() throws InterruptedException {</span></span>
<span class="line"><span>    // è°ƒç”¨äº†AQSæä¾›çš„è·å–å…±äº«é”å¹¶ä¸”å…è®¸ä¸­æ–­çš„æ–¹æ³•</span></span>
<span class="line"><span>    sync.acquireSharedInterruptibly(1);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// AQSææ¬§çš„è·å–å…±äº«é”å¹¶ä¸”å…è®¸ä¸­æ–­çš„æ–¹æ³•</span></span>
<span class="line"><span>public final void acquireSharedInterruptibly(int arg)</span></span>
<span class="line"><span>        throws InterruptedException {</span></span>
<span class="line"><span>    if (Thread.interrupted())</span></span>
<span class="line"><span>        throw new InterruptedException();</span></span>
<span class="line"><span>    // countDownLatchæ“ä½œ</span></span>
<span class="line"><span>    if (tryAcquireShared(arg) &lt; 0)</span></span>
<span class="line"><span>        // å¦‚æœè¿”å›çš„æ˜¯-1ï¼Œä»£è¡¨stateè‚¯å®šå¤§äº0</span></span>
<span class="line"><span>        doAcquireSharedInterruptibly(arg);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// CountDownLatchå®ç°çš„tryAcquireShared</span></span>
<span class="line"><span>protected int tryAcquireShared(int acquires) {</span></span>
<span class="line"><span>    // stateä¸º0ï¼Œè¿”å›1,ã€‚å¦åˆ™è¿”å›-1</span></span>
<span class="line"><span>    return (getState() == 0) ? 1 : -1;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è®©å½“å‰çº¿ç¨‹è¿›åˆ°AQSé˜Ÿåˆ—ï¼Œæ’é˜Ÿå»</span></span>
<span class="line"><span>private void doAcquireSharedInterruptibly(int arg) throws InterruptedException {</span></span>
<span class="line"><span>    // å°†å½“å‰çº¿ç¨‹å°è£…ä¸ºNodeï¼Œå¹¶ä¸”æ·»åŠ åˆ°AQSçš„é˜Ÿåˆ—ä¸­</span></span>
<span class="line"><span>    final Node node = addWaiter(Node.SHARED);</span></span>
<span class="line"><span>    boolean failed = true;</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        for (;;) {</span></span>
<span class="line"><span>            final Node p = node.predecessor();</span></span>
<span class="line"><span>            if (p == head) {</span></span>
<span class="line"><span>                // å†æ¬¡èµ°ä¸Šé¢çš„tryAcquireSharedï¼Œå¦‚æœè¿”å›çš„æ˜¯çš„1ï¼Œä»£è¡¨stateä¸º0</span></span>
<span class="line"><span>                int r = tryAcquireShared(arg);</span></span>
<span class="line"><span>                if (r &gt;= 0) {</span></span>
<span class="line"><span>                    // ä¼šå°†å½“å‰çº¿ç¨‹å’Œåé¢æ‰€æœ‰æ’é˜Ÿçš„çº¿ç¨‹éƒ½å”¤é†’ã€‚</span></span>
<span class="line"><span>                    setHeadAndPropagate(node, r);</span></span>
<span class="line"><span>                    p.next = null; // help GC</span></span>
<span class="line"><span>                    failed = false;</span></span>
<span class="line"><span>                    return;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span></span>
<span class="line"><span>                parkAndCheckInterrupt())</span></span>
<span class="line"><span>                throw new InterruptedException();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        if (failed)</span></span>
<span class="line"><span>            cancelAcquire(node);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="ä¸‰ã€semaphoreåº”ç”¨" tabindex="-1">ä¸‰ã€Semaphoreåº”ç”¨ <a class="header-anchor" href="#ä¸‰ã€semaphoreåº”ç”¨" aria-label="Permalink to &quot;ä¸‰ã€Semaphoreåº”ç”¨&quot;">â€‹</a></h3><p>ä¹Ÿæ˜¯å¸¸ç”¨çš„JUCå¹¶å‘å·¥å…·ï¼Œä¸€èˆ¬ç”¨äºæµæ§ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªå…¬å…±èµ„æºï¼Œå¤šçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®æ—¶ï¼Œå¯ä»¥ç”¨ä¿¡å·é‡åšé™åˆ¶ã€‚</p><p>è¿æ¥æ± ï¼Œå†…éƒ¨çš„é“¾æ¥å¯¹è±¡æœ‰é™ï¼Œæ¯å½“æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–è¿æ¥å¯¹è±¡æ—¶ï¼Œå¯¹ä¿¡å·é‡-1ï¼Œå½“è¿™ä¸ªçº¿ç¨‹å½’è¿˜èµ„æºæ—¶å¯¹ä¿¡å·é‡+1ã€‚</p><p>å¦‚æœçº¿ç¨‹æ‹¿èµ„æºæ—¶ï¼Œå‘ç°Semaphoreå†…éƒ¨çš„èµ„æºä¸ªæ•°ä¸º0ï¼Œå°±ä¼šè¢«é˜»å¡ã€‚</p><p>Hystrixçš„éš”ç¦»ç­–ç•¥ - çº¿ç¨‹æ± ï¼Œä¿¡å·é‡</p><p>ä½¿ç”¨æ–¹å¼å·¨ç®€å•ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws InterruptedException, BrokenBarrierException {</span></span>
<span class="line"><span>    // å£°æ˜ä¿¡å·é‡</span></span>
<span class="line"><span>    Semaphore semaphore = new Semaphore(1);</span></span>
<span class="line"><span>    // èƒ½å¦å»æ‹¿èµ„æº</span></span>
<span class="line"><span>    semaphore.acquire();</span></span>
<span class="line"><span>    // æ‹¿èµ„æºå¤„ç†ä¸šåŠ¡</span></span>
<span class="line"><span>    System.out.println(&quot;main&quot;);</span></span>
<span class="line"><span>    // å½’è¿˜èµ„æº</span></span>
<span class="line"><span>    semaphore.release();</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å››ã€semaphoreæ ¸å¿ƒæºç åˆ†æ" tabindex="-1">å››ã€Semaphoreæ ¸å¿ƒæºç åˆ†æ <a class="header-anchor" href="#å››ã€semaphoreæ ¸å¿ƒæºç åˆ†æ" aria-label="Permalink to &quot;å››ã€Semaphoreæ ¸å¿ƒæºç åˆ†æ&quot;">â€‹</a></h3><h4 id="_4-1-æœ‰å‚æ„é€ " tabindex="-1">4.1 æœ‰å‚æ„é€  <a class="header-anchor" href="#_4-1-æœ‰å‚æ„é€ " aria-label="Permalink to &quot;4.1 æœ‰å‚æ„é€ &quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// Semaphoreæœ‰å…¬å¹³å’Œéå…¬å¹³ä¸¤ç§ç«äº‰èµ„æºçš„æ–¹å¼ã€‚</span></span>
<span class="line"><span>public Semaphore(int permits, boolean fair) {</span></span>
<span class="line"><span>    sync = fair ? new FairSync(permits) : new NonfairSync(permits);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è®¾ç½®èµ„æºä¸ªæ•°ï¼ŒStateå…¶å®å°±æ˜¯ä¿¡å·é‡çš„èµ„æºä¸ªæ•°</span></span>
<span class="line"><span>Sync(int permits) {</span></span>
<span class="line"><span>    setState(permits);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_4-2-acquire" tabindex="-1">4.2 acquire <a class="header-anchor" href="#_4-2-acquire" aria-label="Permalink to &quot;4.2 acquire&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// é˜¿å·´é˜¿å·´~</span></span>
<span class="line"><span>public final void acquireSharedInterruptibly(int arg)</span></span>
<span class="line"><span>        throws InterruptedException {</span></span>
<span class="line"><span>    if (Thread.interrupted())</span></span>
<span class="line"><span>        throw new InterruptedException();</span></span>
<span class="line"><span>    if (tryAcquireShared(arg) &lt; 0)</span></span>
<span class="line"><span>        doAcquireSharedInterruptibly(arg);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å…¬å¹³</span></span>
<span class="line"><span>protected int tryAcquireShared(int acquires) {</span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        // å…¬å¹³æ–¹å¼ï¼Œå…ˆå¥½çœ‹é˜Ÿåˆ—ä¸­æœ‰æœ¨æœ‰æ’é˜Ÿçš„ï¼Œæœ‰æ’é˜Ÿçš„è¿”å›-1ï¼Œæ‰§è¡ŒdoAcquireSharedInterruptiblyå»æ’é˜Ÿ</span></span>
<span class="line"><span>        if (hasQueuedPredecessors())</span></span>
<span class="line"><span>            return -1;</span></span>
<span class="line"><span>        // é‚£state</span></span>
<span class="line"><span>        int available = getState();</span></span>
<span class="line"><span>        // remaining = èµ„æºæ•° - 1</span></span>
<span class="line"><span>        int remaining = available - acquires;</span></span>
<span class="line"><span>        // å¦‚æœèµ„æºä¸å¤Ÿï¼Œç›´æ¥è¿”å›-1</span></span>
<span class="line"><span>        if (remaining &lt; 0 ||</span></span>
<span class="line"><span>            // å¦‚æœèµ„æºå¤Ÿï¼Œæ‰§è¡ŒCASï¼Œä¿®æ”¹state</span></span>
<span class="line"><span>            compareAndSetState(available, remaining))</span></span>
<span class="line"><span>            return remaining;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// éå…¬å¹³</span></span>
<span class="line"><span>final int nonfairTryAcquireShared(int acquires) {</span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        int available = getState();</span></span>
<span class="line"><span>        int remaining = available - acquires;</span></span>
<span class="line"><span>        if (remaining &lt; 0 ||</span></span>
<span class="line"><span>            compareAndSetState(available, remaining))</span></span>
<span class="line"><span>            return remaining;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_4-3-release" tabindex="-1">4.3 release <a class="header-anchor" href="#_4-3-release" aria-label="Permalink to &quot;4.3 release&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// ä¸¤ä¸ªä¸€èµ· é˜¿å·´é˜¿å·´</span></span>
<span class="line"><span>public void release() {</span></span>
<span class="line"><span>    sync.releaseShared(1);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public final boolean releaseShared(int arg) {</span></span>
<span class="line"><span>    if (tryReleaseShared(arg)) {</span></span>
<span class="line"><span>        // å”¤é†’åœ¨AQSä¸­æ’é˜Ÿçš„Nodeï¼Œå»ç«äº‰èµ„æº</span></span>
<span class="line"><span>        doReleaseShared();</span></span>
<span class="line"><span>        return true;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return false;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// ä¿¡å·é‡å®ç°çš„å½’è¿˜èµ„æº</span></span>
<span class="line"><span>protected final boolean tryReleaseShared(int releases) {</span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        // æ‹¿state</span></span>
<span class="line"><span>        int current = getState();</span></span>
<span class="line"><span>        // state + 1</span></span>
<span class="line"><span>        int next = current + releases;</span></span>
<span class="line"><span>        // èµ„æºæœ€å¤§å€¼ï¼Œå†+1ï¼Œå˜ä¸ºè´Ÿæ•°</span></span>
<span class="line"><span>        if (next &lt; current)</span></span>
<span class="line"><span>            throw new Error(&quot;Maximum permit count exceeded&quot;);</span></span>
<span class="line"><span>        // CAS æ”¹ä¸€æ‰‹</span></span>
<span class="line"><span>        if (compareAndSetState(current, next))</span></span>
<span class="line"><span>            return true;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_4-4-åˆ†æaqsä¸­propagateç±»å‹èŠ‚ç‚¹-å”¯ä¸€çš„éš¾ç‚¹" tabindex="-1">4.4 åˆ†æAQSä¸­PROPAGATEç±»å‹èŠ‚ç‚¹ï¼ˆå”¯ä¸€çš„éš¾ç‚¹ï¼‰ <a class="header-anchor" href="#_4-4-åˆ†æaqsä¸­propagateç±»å‹èŠ‚ç‚¹-å”¯ä¸€çš„éš¾ç‚¹" aria-label="Permalink to &quot;4.4 åˆ†æAQSä¸­PROPAGATEç±»å‹èŠ‚ç‚¹ï¼ˆå”¯ä¸€çš„éš¾ç‚¹ï¼‰&quot;">â€‹</a></h4><p>JDK1.5ä¸­ï¼Œä½¿ç”¨ä¿¡å·é‡æ—¶ï¼Œå¯èƒ½ä¼šé€ æˆåœ¨æœ‰èµ„æºçš„æƒ…å†µä¸‹ï¼Œåç»§èŠ‚ç‚¹æ— æ³•è¢«å”¤é†’ã€‚</p><p>åœ¨JDK1.8ä¸­ï¼Œé—®é¢˜è¢«ä¿®å¤ï¼Œä¿®å¤æ–¹å¼å°±æ˜¯è¿½åŠ äº†PROPAGATEèŠ‚ç‚¹çŠ¶æ€æ¥è§£å†³ã€‚</p><p>å…±äº«é”åœ¨é‡Šæ”¾èµ„æºåï¼Œå¦‚æœå¤´èŠ‚ç‚¹ä¸º0ï¼Œæ— æ³•ç¡®è®¤çœŸçš„æ²¡æœ‰åç»§èŠ‚ç‚¹ã€‚å¦‚æœå¤´èŠ‚ç‚¹ä¸º0ï¼Œéœ€è¦å°†å¤´èŠ‚ç‚¹çš„çŠ¶æ€ä¿®æ”¹ä¸º-3ï¼Œå½“æœ€æ–°æ‹¿åˆ°é”èµ„æºçš„çº¿ç¨‹ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰åç»§èŠ‚ç‚¹å¹¶ä¸”ä¸ºå…±äº«é”ï¼Œå°±å”¤é†’æ’é˜Ÿçš„çº¿ç¨‹</p><h3 id="äº”ã€cyclicbarrieråº”ç”¨" tabindex="-1">äº”ã€CyclicBarrieråº”ç”¨ <a class="header-anchor" href="#äº”ã€cyclicbarrieråº”ç”¨" aria-label="Permalink to &quot;äº”ã€CyclicBarrieråº”ç”¨&quot;">â€‹</a></h3><p>ä¸€èˆ¬ç§°ä¸ºæ …æ ï¼Œå’ŒCountDownLatchå¾ˆåƒã€‚</p><p>CountDownLatchåœ¨æ“ä½œæ—¶ï¼Œåªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯stateå˜ä¸º0ä¹‹åï¼Œå°±æ— æ³•ç»§ç»­ç©äº†ã€‚</p><p>CyclicBarrieræ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œä»–çš„è®¡æ•°å™¨å¯ä»¥å½’ä½ï¼Œç„¶åå†å¤„ç†ã€‚è€Œä¸”å¯ä»¥åœ¨è®¡æ•°è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜åï¼Œé‡ç½®å½“å‰CyclicBarrierï¼Œå†æ¬¡é‡æ–°æ“ä½œï¼</p><p>åº”ç”¨ä¸€æ³¢</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws InterruptedException, BrokenBarrierException {</span></span>
<span class="line"><span>    // å£°æ˜æ …æ </span></span>
<span class="line"><span>    CyclicBarrier barrier = new CyclicBarrier(3,() -&gt; {</span></span>
<span class="line"><span>        System.out.println(&quot;æ‰“æ‰‹æªï¼&quot;);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    new Thread(() -&gt; {</span></span>
<span class="line"><span>        System.out.println(&quot;ç¬¬ä¸€ä½é€‰æ‰‹åˆ°ä½&quot;);</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            barrier.await();</span></span>
<span class="line"><span>            System.out.println(&quot;ç¬¬ä¸€ä½å¾€æ­»é‡Œè·‘ï¼&quot;);</span></span>
<span class="line"><span>        } catch (Exception e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }).start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    new Thread(() -&gt; {</span></span>
<span class="line"><span>        System.out.println(&quot;ç¬¬äºŒä½é€‰æ‰‹åˆ°ä½&quot;);</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            barrier.await();</span></span>
<span class="line"><span>            System.out.println(&quot;ç¬¬äºŒä½ä¹Ÿå¾€æ­»é‡Œè·‘ï¼&quot;);</span></span>
<span class="line"><span>        } catch (Exception e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }).start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    System.out.println(&quot;è£åˆ¤å·²ç»åˆ°ä½&quot;);</span></span>
<span class="line"><span>    barrier.await();</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å…­ã€cyclicbarrieræ ¸å¿ƒæºç åˆ†æ" tabindex="-1">å…­ã€CyclicBarrieræ ¸å¿ƒæºç åˆ†æ <a class="header-anchor" href="#å…­ã€cyclicbarrieræ ¸å¿ƒæºç åˆ†æ" aria-label="Permalink to &quot;å…­ã€CyclicBarrieræ ¸å¿ƒæºç åˆ†æ&quot;">â€‹</a></h3><h4 id="_6-1-æœ‰å‚æ„é€ " tabindex="-1">6.1 æœ‰å‚æ„é€  <a class="header-anchor" href="#_6-1-æœ‰å‚æ„é€ " aria-label="Permalink to &quot;6.1 æœ‰å‚æ„é€ &quot;">â€‹</a></h4><p>CyclicBarrieræ²¡æœ‰ç›´æ¥ä½¿ç”¨AQSï¼Œè€Œæ˜¯ä½¿ç”¨ReentrantLockï¼Œç®€ä»‹çš„ä½¿ç”¨çš„AQS</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// CyclicBarrierçš„æœ‰å‚</span></span>
<span class="line"><span>public CyclicBarrier(int parties, Runnable barrierAction) {ã€</span></span>
<span class="line"><span>    // å¥å£®æ€§åˆ¤æ–­ï¼</span></span>
<span class="line"><span>    if (parties &lt;= 0) throw new IllegalArgumentException();</span></span>
<span class="line"><span>    // partiesæ˜¯finalä¿®é¥°çš„ï¼Œéœ€è¦åœ¨é‡ç½®æ—¶ï¼Œä½¿ç”¨ï¼</span></span>
<span class="line"><span>    this.parties = parties;</span></span>
<span class="line"><span>    // countæ˜¯åœ¨æ‰§è¡Œawaitç”¨æ¥è®¡æ•°çš„ã€‚</span></span>
<span class="line"><span>    this.count = parties;</span></span>
<span class="line"><span>    // å½“è®¡æ•°countä¸º0æ—¶ ï¼Œå…ˆæ‰§è¡Œè¿™ä¸ªRunnnableï¼åœ¨å”¤é†’è¢«é˜»å¡çš„çº¿ç¨‹</span></span>
<span class="line"><span>    this.barrierCommand = barrierAction;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_6-2-await" tabindex="-1">6.2 await <a class="header-anchor" href="#_6-2-await" aria-label="Permalink to &quot;6.2 await&quot;">â€‹</a></h4><p>çº¿ç¨‹æ‰§è¡Œawaitæ–¹æ³•ï¼Œä¼šå¯¹count-1ï¼Œå†åˆ¤æ–­countæ˜¯å¦ä¸º0</p><p>å¦‚æœä¸ä¸º0ï¼Œéœ€è¦æ·»åŠ åˆ°AQSä¸­çš„ConditionObjectçš„Waiteré˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œå¹¶parkå½“å‰çº¿ç¨‹</p><p>å¦‚æœä¸º0ï¼Œè¯æ˜çº¿ç¨‹åˆ°é½ï¼Œéœ€è¦æ‰§è¡ŒnextGenerationï¼Œä¼šå…ˆå°†Waiteré˜Ÿåˆ—ä¸­çš„Nodeå…¨éƒ¨è½¬ç§»åˆ°AQSçš„é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”æœ‰åç»§èŠ‚ç‚¹çš„ï¼Œwsè®¾ç½®ä¸º-1ã€‚æ²¡æœ‰åç»§èŠ‚ç‚¹è®¾ç½®ä¸º0ã€‚ç„¶åé‡ç½®countå’Œbrokeræ ‡è®°ã€‚ç­‰åˆ°unlockæ‰§è¡Œåï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// é€‰æ‰‹åˆ°ä½ï¼ï¼ï¼</span></span>
<span class="line"><span>private int dowait(boolean timed, long nanos) throws InterruptedException, BrokenBarrierException, TimeoutException {</span></span>
<span class="line"><span>    // åŠ é”ï¼Ÿï¼Ÿ  å› ä¸ºCyclicBarrieræ˜¯åŸºäºReentrantLock-Conditionçš„awaitå’ŒsingalAllæ–¹æ³•å®ç°çš„ã€‚</span></span>
<span class="line"><span>    // ç›¸å½“äºsynchronizedä¸­ä½¿ç”¨waitå’Œnotify</span></span>
<span class="line"><span>    // åˆ«å¿˜äº†ï¼Œåªè¦æŒ‚èµ·ï¼Œä¼šé‡Šæ”¾é”èµ„æºã€‚</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // é‡Œé¢å°±æ˜¯booleanï¼Œé»˜è®¤false</span></span>
<span class="line"><span>        final Generation g = generation;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // åˆ¤æ–­ä¹‹å‰æ …æ åŠ å…¥çº¿ç¨‹æ—¶ï¼Œæ˜¯å¦æœ‰è¶…æ—¶ã€ä¸­æ–­ç­‰é—®é¢˜ï¼Œå¦‚æœæœ‰ï¼Œè®¾ç½®booleanä¸ºtrueï¼Œå…¶ä»–çº¿ç¨‹å†è¿›æ¥ï¼Œç›´æ¥å‡‰å‡‰</span></span>
<span class="line"><span>        if (g.broken)</span></span>
<span class="line"><span>            throw new BrokenBarrierException();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if (Thread.interrupted()) {</span></span>
<span class="line"><span>            breakBarrier();</span></span>
<span class="line"><span>            throw new InterruptedException();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // å¯¹è®¡æ•°å™¨count--</span></span>
<span class="line"><span>        int index = --count;</span></span>
<span class="line"><span>        // å¦‚æœ--å®Œï¼Œæ˜¯0ï¼Œä»£è¡¨çªç ´æ …æ ï¼Œå¹²æ´»ï¼</span></span>
<span class="line"><span>        if (index == 0) {  </span></span>
<span class="line"><span>            // é»˜è®¤false</span></span>
<span class="line"><span>            boolean ranAction = false;</span></span>
<span class="line"><span>            try {</span></span>
<span class="line"><span>                // å¦‚æœä½ ç”¨çš„æ˜¯2ä¸ªå‚æ•°çš„æœ‰å‚æ„é€ ï¼Œè¯´æ˜ä½ ä¼ å…¥äº†ä»»åŠ¡ï¼Œindex == 0ï¼Œå…ˆæ‰§è¡ŒCyclicBarrieræœ‰å‚çš„ä»»åŠ¡</span></span>
<span class="line"><span>                final Runnable command = barrierCommand;</span></span>
<span class="line"><span>                if (command != null)</span></span>
<span class="line"><span>                    command.run();</span></span>
<span class="line"><span>                // è®¾ç½®ä¸ºtrue</span></span>
<span class="line"><span>                ranAction = true;</span></span>
<span class="line"><span>                nextGeneration();</span></span>
<span class="line"><span>                return 0;</span></span>
<span class="line"><span>            } finally {</span></span>
<span class="line"><span>                if (!ranAction)</span></span>
<span class="line"><span>                    breakBarrier();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // --å®Œä¹‹åï¼Œindexä¸æ˜¯0ï¼Œä»£è¡¨è¿˜éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹</span></span>
<span class="line"><span>        for (;;) {</span></span>
<span class="line"><span>            try {</span></span>
<span class="line"><span>                // å¦‚æœæ²¡è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚  await()</span></span>
<span class="line"><span>                if (!timed)</span></span>
<span class="line"><span>                    trip.await();</span></span>
<span class="line"><span>                // è®¾ç½®äº†è¶…æ—¶æ—¶é—´ã€‚  await(1,SECOND)</span></span>
<span class="line"><span>                else if (nanos &gt; 0L)</span></span>
<span class="line"><span>                    nanos = trip.awaitNanos(nanos);</span></span>
<span class="line"><span>            } catch (InterruptedException ie) {</span></span>
<span class="line"><span>                if (g == generation &amp;&amp; ! g.broken) {</span></span>
<span class="line"><span>                    breakBarrier();</span></span>
<span class="line"><span>                    throw ie;</span></span>
<span class="line"><span>                } else {</span></span>
<span class="line"><span>                    Thread.currentThread().interrupt();</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            if (g.broken)</span></span>
<span class="line"><span>                throw new BrokenBarrierException();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            if (g != generation)</span></span>
<span class="line"><span>                return index;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            if (timed &amp;&amp; nanos &lt;= 0L) {</span></span>
<span class="line"><span>                breakBarrier();</span></span>
<span class="line"><span>                throw new TimeoutException();</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æŒ‚èµ·çº¿ç¨‹</span></span>
<span class="line"><span>public final void await() throws InterruptedException {</span></span>
<span class="line"><span>    // å…è®¸ä¸­æ–­</span></span>
<span class="line"><span>    if (Thread.interrupted())</span></span>
<span class="line"><span>        throw new InterruptedException();</span></span>
<span class="line"><span>    // æ·»åŠ åˆ°é˜Ÿåˆ—ï¼ˆä¸æ˜¯AQSé˜Ÿåˆ—ï¼Œæ˜¯AQSé‡Œçš„ConditionObjectä¸­çš„é˜Ÿåˆ—ï¼‰</span></span>
<span class="line"><span>    Node node = addConditionWaiter();</span></span>
<span class="line"><span>    int savedState = fullyRelease(node);</span></span>
<span class="line"><span>    int interruptMode = 0;</span></span>
<span class="line"><span>    while (!isOnSyncQueue(node)) {</span></span>
<span class="line"><span>        // æŒ‚èµ·å½“å‰çº¿ç¨‹</span></span>
<span class="line"><span>        LockSupport.park(this);</span></span>
<span class="line"><span>        if ((interruptMode = checkInterruptWhileWaiting(node)) != 0)</span></span>
<span class="line"><span>            break;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>// countåˆ°0ï¼Œå”¤é†’æ‰€æœ‰é˜Ÿåˆ—é‡Œçš„çº¿ç¨‹çº¿ç¨‹</span></span>
<span class="line"><span>private void nextGeneration() {</span></span>
<span class="line"><span>    // è¿™ä¸ªæ–¹æ³•å°±æ˜¯å°†Waiteré˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹éå†éƒ½æ‰”åˆ°AQSçš„é˜Ÿåˆ—ä¸­ï¼ŒçœŸæ­£å”¤é†’çš„æ—¶æœºï¼Œæ˜¯unlockæ–¹æ³•</span></span>
<span class="line"><span>    trip.signalAll();</span></span>
<span class="line"><span>    // é‡ç½®è®¡æ•°å™¨</span></span>
<span class="line"><span>    count = parties;</span></span>
<span class="line"><span>    // é‡ç½®å¼‚å¸¸åˆ¤æ–­</span></span>
<span class="line"><span>    generation = new Generation();</span></span>
<span class="line"><span>}</span></span></code></pre></div><h1 id="å…«ã€jucé˜»å¡é˜Ÿåˆ—" tabindex="-1">å…«ã€<strong>JUCé˜»å¡é˜Ÿåˆ—</strong> <a class="header-anchor" href="#å…«ã€jucé˜»å¡é˜Ÿåˆ—" aria-label="Permalink to &quot;å…«ã€**JUCé˜»å¡é˜Ÿåˆ—**&quot;">â€‹</a></h1><p>é˜»å¡é˜Ÿåˆ—ï¼š</p><ul><li><p>é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡ºçš„ä¸€ä¸ªæ•°æ®ç»“æ„</p></li><li><p>é˜»å¡ï¼ŒåŸºäºReentrantLockå®ç°çš„ï¼Œå¹¶ä¸”çº¿ç¨‹çš„æŒ‚èµ·ä¹Ÿæ˜¯é€šè¿‡Condition</p></li></ul><p>ä»æœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€ç®€å•çš„ArrayBlockingQueueï¼ŒLinkedBlockingQueue</p><h3 id="ä¸€ã€arrayblockingqueue" tabindex="-1">ä¸€ã€ArrayBlockingQueue <a class="header-anchor" href="#ä¸€ã€arrayblockingqueue" aria-label="Permalink to &quot;ä¸€ã€ArrayBlockingQueue&quot;">â€‹</a></h3><p>ArrayBlockingQueueåº•å±‚æ˜¯é‡‡ç”¨æ•°ç»„å®ç°çš„ä¸€ä¸ªé˜Ÿåˆ—ã€‚å› ä¸ºåº•å±‚æ˜¯æ•°æ®ï¼Œä¸€èˆ¬è¢«æˆä¸ºæœ‰ç•Œé˜Ÿåˆ—</p><p>å…¶æ¬¡é˜»å¡æ–¹å¼ï¼Œæ˜¯åŸºäºReentrantLockå®ç°çš„ã€‚</p><p>å¸¸ç”¨çš„å­˜å–æ–¹æ³•</p><h4 id="_1-1-arrayblockingqueueåº”ç”¨" tabindex="-1">1.1 ArrayBlockingQueueåº”ç”¨ <a class="header-anchor" href="#_1-1-arrayblockingqueueåº”ç”¨" aria-label="Permalink to &quot;1.1 ArrayBlockingQueueåº”ç”¨&quot;">â€‹</a></h4><p>// å­˜æ•°æ®æ“ä½œ Â add(E),offer(E),put(E)ï¼Œoffer(E,time,unit)<br> // add(E)ï¼šæ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—ï¼Œå¦‚æœæ»¡äº†ï¼Œæ‰”å¼‚å¸¸ã€‚<br> // offer(E)ï¼šæ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—ï¼Œå¦‚æœæ»¡äº†ï¼Œè¿”å›false<br> // put(E)ï¼šæ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—ï¼Œå¦‚æœæ»¡äº†ï¼Œçº¿ç¨‹æŒ‚èµ·<br> // offer(E,time,unit)ï¼šæ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—ï¼Œå¦‚æœæ»¡äº†ï¼Œçº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´</p><p>// å–æ•°æ®æ“ä½œ Â remove(),poll(),take(),poll(time,unit)<br> // remove()ï¼šä»é˜Ÿåˆ—æ‹¿æ•°æ®ï¼Œæ‹¿åˆ°è¿”å›ï¼Œæ‹¿åˆ°nullï¼Œç”©å¼‚å¸¸<br> // poll()ï¼šä»é˜Ÿåˆ—æ‹¿æ•°æ®ï¼Œæ‹¿åˆ°è¿”å›ï¼Œæ‹¿åˆ°nullï¼Œä¹Ÿè¿”å›<br> // take()ï¼šä»é˜Ÿåˆ—æ‹¿æ•°æ®ï¼Œæ‹¿åˆ°è¿”å›ï¼Œæ²¡æ•°æ®ï¼Œä¸€ç›´é˜»å¡<br> // poll(time,unit)ï¼šä»é˜Ÿåˆ—æ‹¿æ•°æ®ï¼Œæ‹¿åˆ°è¿”å›ï¼Œæ²¡æ•°æ®ï¼Œé˜»å¡timeæ—¶é—´</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws InterruptedException, BrokenBarrierException, IOException {</span></span>
<span class="line"><span>    // ArrayBlockingQueue,å› ä¸ºåº•å±‚ä½¿ç”¨æ•°ç»„ï¼Œå¿…é¡»è¦æŒ‡å®šæ•°ç»„çš„é•¿åº¦ï¼Œä½œä¸ºé˜Ÿåˆ—çš„é•¿åº¦</span></span>
<span class="line"><span>    ArrayBlockingQueue queue = new ArrayBlockingQueue(1);</span></span>
<span class="line"><span>    // å­˜æ•°æ®æ“ä½œ  add(E),offer(E),put(E)ï¼Œoffer(E,time,unit)</span></span>
<span class="line"><span>    // add(E)ï¼šæ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—ï¼Œå¦‚æœæ»¡äº†ï¼Œæ‰”å¼‚å¸¸ã€‚</span></span>
<span class="line"><span>    // offer(E)ï¼šæ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—ï¼Œå¦‚æœæ»¡äº†ï¼Œè¿”å›false</span></span>
<span class="line"><span>    // put(E)ï¼šæ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—ï¼Œå¦‚æœæ»¡äº†ï¼Œçº¿ç¨‹æŒ‚èµ·</span></span>
<span class="line"><span>    // offer(E,time,unit)ï¼šæ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—ï¼Œå¦‚æœæ»¡äº†ï¼Œçº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // å–æ•°æ®æ“ä½œ  remove(),poll(),take(),poll(time,unit)</span></span>
<span class="line"><span>    // remove()ï¼šä»é˜Ÿåˆ—æ‹¿æ•°æ®ï¼Œæ‹¿åˆ°è¿”å›ï¼Œæ‹¿åˆ°nullï¼Œç”©å¼‚å¸¸</span></span>
<span class="line"><span>    // poll()ï¼šä»é˜Ÿåˆ—æ‹¿æ•°æ®ï¼Œæ‹¿åˆ°è¿”å›ï¼Œæ‹¿åˆ°nullï¼Œä¹Ÿè¿”å›</span></span>
<span class="line"><span>    // take()ï¼šä»é˜Ÿåˆ—æ‹¿æ•°æ®ï¼Œæ‹¿åˆ°è¿”å›ï¼Œæ²¡æ•°æ®ï¼Œä¸€ç›´é˜»å¡</span></span>
<span class="line"><span>    // poll(time,unit)ï¼šä»é˜Ÿåˆ—æ‹¿æ•°æ®ï¼Œæ‹¿åˆ°è¿”å›ï¼Œæ²¡æ•°æ®ï¼Œé˜»å¡timeæ—¶é—´</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_1-2-å­˜æ•°æ®æºç " tabindex="-1">1.2 å­˜æ•°æ®æºç  <a class="header-anchor" href="#_1-2-å­˜æ•°æ®æºç " aria-label="Permalink to &quot;1.2 å­˜æ•°æ®æºç &quot;">â€‹</a></h4><p>offerï¼Œæ·»åŠ æ—¶ï¼Œå…ˆåˆ¤æ–­é˜Ÿåˆ—æ»¡äº†æ²¡ï¼Œæ»¡äº†å°±è¿”å›false<br> offer(time,unit)ï¼Œæ·»åŠ æ—¶ï¼Œå…ˆåˆ¤æ–­é˜Ÿåˆ—æ»¡äº†æ²¡ï¼Œæ»¡äº†å…ˆé˜»å¡timeæ—¶é—´ï¼Œè‡ªåŠ¨å”¤é†’ï¼Œè¿˜æ˜¯æ»¡çš„ï¼Œä¹Ÿè¿”å›false<br> put,æ·»åŠ æ—¶ï¼Œå…ˆåˆ¤æ–­é˜Ÿåˆ—æ»¡äº†æ²¡ï¼Œæ»¡äº†å°±é˜»å¡ï¼Œé˜»å¡åˆ°è¢«å”¤é†’ï¼Œæˆ–è€…è¢«ä¸­æ–­</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å­˜æ•°æ®</span></span>
<span class="line"><span>public boolean offer(E e) {</span></span>
<span class="line"><span>    // éç©ºæ ¡éªŒ</span></span>
<span class="line"><span>    checkNotNull(e);</span></span>
<span class="line"><span>    // äº’æ–¥é”</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // å¦‚æœæ•°ç»„ä¸­çš„æ•°æ®å·²ç»è¾¾åˆ°äº†æ•°ç»„çš„é•¿åº¦ï¼Œæ²¡åœ°å„¿äº†~ï¼Œé˜Ÿåˆ—æ»¡äº†</span></span>
<span class="line"><span>        if (count == items.length)</span></span>
<span class="line"><span>            return false;</span></span>
<span class="line"><span>        else {</span></span>
<span class="line"><span>            // è¿˜æœ‰ä½ç½®</span></span>
<span class="line"><span>            enqueue(e);</span></span>
<span class="line"><span>            return true;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>// å­˜æ”¾æ•°æ®åˆ°æ•°ç»„ä¸­</span></span>
<span class="line"><span>private void enqueue(E x) {</span></span>
<span class="line"><span>    // æ‹¿åˆ°æ•°ç»„</span></span>
<span class="line"><span>    final Object[] items = this.items;</span></span>
<span class="line"><span>    // æ•°ç»„æ”¾è¿›å»</span></span>
<span class="line"><span>    items[putIndex] = x;</span></span>
<span class="line"><span>    // æŠŠputæŒ‡é’ˆ++ï¼Œ æŒ‡é’ˆæ˜¯å¦å·²ç»åˆ°äº†æœ€åä¸€ä¸ªä½ç½®ï¼Œå½’ä½åˆ°0ä½ç½®ã€‚</span></span>
<span class="line"><span>    if (++putIndex == items.length)</span></span>
<span class="line"><span>        // å½’ä½åˆ°0ä½ç½®ã€‚</span></span>
<span class="line"><span>        putIndex = 0;</span></span>
<span class="line"><span>    // æ•°æ®æ¡æ•° + 1</span></span>
<span class="line"><span>    count++;</span></span>
<span class="line"><span>    // å”¤é†’åœ¨é˜»å¡çš„å–æ•°æ®çº¿ç¨‹</span></span>
<span class="line"><span>    notEmpty.signal();</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// putæ–¹æ³•</span></span>
<span class="line"><span>public void put(E e) throws InterruptedException {</span></span>
<span class="line"><span>    checkNotNull(e);</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lockInterruptibly();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        while (count == items.length)</span></span>
<span class="line"><span>            notFull.await();</span></span>
<span class="line"><span>        enqueue(e);</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>// offeræ–¹æ³•ï¼Œå¯ä»¥é˜»å¡ä¸€æ®µæ—¶é—´</span></span>
<span class="line"><span>public boolean offer(E e, long timeout, TimeUnit unit) throws InterruptedException {</span></span>
<span class="line"><span>    checkNotNull(e);</span></span>
<span class="line"><span>    long nanos = unit.toNanos(timeout);</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lockInterruptibly();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        while (count == items.length) {</span></span>
<span class="line"><span>            if (nanos &lt;= 0)</span></span>
<span class="line"><span>                return false;</span></span>
<span class="line"><span>            nanos = notFull.awaitNanos(nanos);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        enqueue(e);</span></span>
<span class="line"><span>        return true;</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>offerï¼Œæ·»åŠ æ—¶ï¼Œå…ˆåˆ¤æ–­é˜Ÿåˆ—æ»¡äº†æ²¡ï¼Œæ»¡äº†å°±è¿”å›false</span></span>
<span class="line"><span>offer(time,unit)ï¼Œæ·»åŠ æ—¶ï¼Œå…ˆåˆ¤æ–­é˜Ÿåˆ—æ»¡äº†æ²¡ï¼Œæ»¡äº†å…ˆé˜»å¡timeæ—¶é—´ï¼Œè‡ªåŠ¨å”¤é†’ï¼Œè¿˜æ˜¯æ»¡çš„ï¼Œä¹Ÿè¿”å›false</span></span>
<span class="line"><span>put,æ·»åŠ æ—¶ï¼Œå…ˆåˆ¤æ–­é˜Ÿåˆ—æ»¡äº†æ²¡ï¼Œæ»¡äº†å°±é˜»å¡ï¼Œé˜»å¡åˆ°è¢«å”¤é†’ï¼Œæˆ–è€…è¢«ä¸­æ–­</span></span></code></pre></div><h4 id="_1-3-å–æ•°æ®" tabindex="-1">1.3 å–æ•°æ® <a class="header-anchor" href="#_1-3-å–æ•°æ®" aria-label="Permalink to &quot;1.3 å–æ•°æ®&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// é˜¿å·´é˜¿å·´~~å–æ•°æ®</span></span>
<span class="line"><span>public E poll() {</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // count == 0ä»£è¡¨æ²¡æ•°æ®ï¼Œ å°±è¿”å›nullï¼Œæœ‰æ•°æ®èµ°dequeue</span></span>
<span class="line"><span>        return (count == 0) ? null : dequeue();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// ä»æ•°ç»„ä¸­é‚£æ•°æ®</span></span>
<span class="line"><span>private E dequeue() {</span></span>
<span class="line"><span>    final Object[] items = this.items;</span></span>
<span class="line"><span>    // å–æ•°æ®</span></span>
<span class="line"><span>    E x = (E) items[takeIndex];</span></span>
<span class="line"><span>    // å°†å–å®Œçš„ä½ç½®ç½®ä½null</span></span>
<span class="line"><span>    items[takeIndex] = null;</span></span>
<span class="line"><span>    // takeæŒ‡é’ˆ++ï¼Œå¦‚æœåˆ°å¤´ï¼Œå½’ä½0~~</span></span>
<span class="line"><span>    if (++takeIndex == items.length)</span></span>
<span class="line"><span>        takeIndex = 0;</span></span>
<span class="line"><span>    // æ•°æ®æ¡æ•° - 1</span></span>
<span class="line"><span>    count--;</span></span>
<span class="line"><span>    // å”¤é†’é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œé˜»å¡ä½çš„å†™çº¿ç¨‹</span></span>
<span class="line"><span>    notFull.signal();</span></span>
<span class="line"><span>    return x;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>public E take() throws InterruptedException {</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lockInterruptibly();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        while (count == 0)</span></span>
<span class="line"><span>            notEmpty.await();  // æŒ‚èµ·çº¿ç¨‹ï¼Œéœ€è¦è¢«å”¤é†’</span></span>
<span class="line"><span>        return dequeue();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public E poll(long timeout, TimeUnit unit) throws InterruptedException {</span></span>
<span class="line"><span>    long nanos = unit.toNanos(timeout);</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lockInterruptibly();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        while (count == 0) {</span></span>
<span class="line"><span>            if (nanos &lt;= 0)</span></span>
<span class="line"><span>                return null;  </span></span>
<span class="line"><span>            nanos = notEmpty.awaitNanos(nanos);   //  æŒ‚èµ·çº¿ç¨‹ï¼Œåˆ°æ—¶é—´è‡ªåŠ¨å”¤é†’ã€æˆ–è€…è¢«æ‰‹åŠ¨å”¤é†’</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        return dequeue();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äºŒã€linkedblockingqueue" tabindex="-1">äºŒã€LinkedBlockingQueue <a class="header-anchor" href="#äºŒã€linkedblockingqueue" aria-label="Permalink to &quot;äºŒã€LinkedBlockingQueue&quot;">â€‹</a></h3><p>åº•å±‚åŸºäºé“¾è¡¨å®ç°çš„ï¼Œä¼šå°†æ¯ä¸ªå…ƒç´ å°è£…ä¸ºNodeï¼ŒNodeæœ‰å½“å‰å€¼ï¼Œè¿˜æœ‰ä¸€ä¸ªnextæŒ‡é’ˆï¼Œä¸€èˆ¬æˆä¸ºæ— ç•Œé˜Ÿåˆ—</p><p>LinkedBlockingQueueæœ¬è´¨å°±æ˜¯ä¸€ä¸ªç”¨Nodeå°è£…çš„å•å‘é“¾è¡¨ã€‚</p><p>LinkedBlockingQueueå†…éƒ¨æä¾›äº†è¯»é”å’Œå†™é”ï¼Œè¯»å†™ä¸äº’æ–¥ï¼Œè€Œä¸”è®°å½•æ•°æ®æ¡æ•°çš„å±æ€§æ˜¯AtomicåŸå­ç±»</p><p>æ ¸å¿ƒå±æ€§</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/**</span></span>
<span class="line"><span> * é˜»å¡é˜Ÿåˆ—å…ƒç´ ä¼šè¢«å°è£…ä¸ºNode</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>static class Node&lt;E&gt; {</span></span>
<span class="line"><span>    E item;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Node&lt;E&gt; next;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Node(E x) { item = x; }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/** æŒ‡å®šé˜Ÿåˆ—çš„é•¿åº¦ï¼Œå¦‚æœä¸ä¼ å€¼ï¼Œé»˜è®¤ä¸ºInteger.MAX */</span></span>
<span class="line"><span>private final int capacity;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/** è®°å½•æ•°æ®æ¡æ•° */</span></span>
<span class="line"><span>private final AtomicInteger count = new AtomicInteger();</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>transient Node&lt;E&gt; head;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private transient Node&lt;E&gt; last;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/** è¯»é” */</span></span>
<span class="line"><span>private final ReentrantLock takeLock = new ReentrantLock();</span></span>
<span class="line"><span>private final Condition notEmpty = takeLock.newCondition();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/** å†™é” */</span></span>
<span class="line"><span>private final ReentrantLock putLock = new ReentrantLock();</span></span>
<span class="line"><span>private final Condition notFull = putLock.newCondition();</span></span></code></pre></div><h4 id="_2-1-å†™æ“ä½œ" tabindex="-1">2.1 å†™æ“ä½œ <a class="header-anchor" href="#_2-1-å†™æ“ä½œ" aria-label="Permalink to &quot;2.1 å†™æ“ä½œ&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å†™æ“ä½œ~</span></span>
<span class="line"><span>public boolean offer(E e) {</span></span>
<span class="line"><span>    // éç©º</span></span>
<span class="line"><span>    if (e == null) throw new NullPointerException();</span></span>
<span class="line"><span>    // æ‹¿åˆ°countï¼ˆè®°å½•å½“å‰æ•°æ®æ¡æ•°ï¼‰</span></span>
<span class="line"><span>    final AtomicInteger count = this.count;</span></span>
<span class="line"><span>    // å¦‚æœcountè¾¾åˆ°äº†æœ€å¤§å€¼</span></span>
<span class="line"><span>    if (count.get() == capacity)</span></span>
<span class="line"><span>        // æ•°æ®æ»¡äº†ã€‚</span></span>
<span class="line"><span>        return false;</span></span>
<span class="line"><span>    // å£°æ˜c </span></span>
<span class="line"><span>    int c = -1;</span></span>
<span class="line"><span>    // å°†å½“å‰æ•°æ®å°è£…ä¸ºNode</span></span>
<span class="line"><span>    Node&lt;E&gt; node = new Node&lt;E&gt;(e);</span></span>
<span class="line"><span>    // æ·»åŠ å†™é”~</span></span>
<span class="line"><span>    final ReentrantLock putLock = this.putLock;</span></span>
<span class="line"><span>    putLock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // ï¼ï¼DCLï¼ï¼</span></span>
<span class="line"><span>        // å†æ¬¡æ‹¿åˆ°æ¡æ•°åˆ¤æ–­ï¼Œå¦‚æœè¿˜æœ‰ç©ºé—´ï¼Œenqueueå­˜æ•°æ®</span></span>
<span class="line"><span>        if (count.get() &lt; capacity) {</span></span>
<span class="line"><span>            // æ•°æ®æ”¾è¿›æ¥</span></span>
<span class="line"><span>            enqueue(node);</span></span>
<span class="line"><span>            // æ‹¿åˆ°countï¼Œå†è‡ªå¢</span></span>
<span class="line"><span>            c = count.getAndIncrement();</span></span>
<span class="line"><span>            // æ·»åŠ å®Œæ•°æ®ä¹‹åï¼Œé•¿åº¦ä¾ç„¶å°äºæœ€å¤§é•¿åº¦ï¼Œå”¤é†’å¯èƒ½é˜»å¡çš„å†™çº¿ç¨‹  </span></span>
<span class="line"><span>            // è¯»å†™ä¸äº’æ–¥ï¼Œå¯èƒ½å‰é¢åœ¨æ‰§è¡Œæ—¶ï¼Œé˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œä½†æ˜¯è¯»æ“ä½œä¾ç„¶åœ¨è¿›è¡Œ</span></span>
<span class="line"><span>            if (c + 1 &lt; capacity)</span></span>
<span class="line"><span>                notFull.signal();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        putLock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // c == 0ï¼Œè¯´æ˜æ·»åŠ æ•°æ®ä¹‹å‰ï¼Œé˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œå”¤é†’å¯èƒ½é˜»å¡çš„è¯»çº¿ç¨‹</span></span>
<span class="line"><span>    if (c == 0)</span></span>
<span class="line"><span>        signalNotEmpty();</span></span>
<span class="line"><span>    // è¿”å›count &gt;= 0</span></span>
<span class="line"><span>    return c &gt;= 0;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æ’å…¥æ•°æ®åˆ°é“¾è¡¨~~~</span></span>
<span class="line"><span>private void enqueue(Node&lt;E&gt; node) {</span></span>
<span class="line"><span>    last = last.next = node;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>public void put(E e) throws InterruptedException {</span></span>
<span class="line"><span>    if (e == null) throw new NullPointerException();</span></span>
<span class="line"><span>    int c = -1;</span></span>
<span class="line"><span>    Node&lt;E&gt; node = new Node&lt;E&gt;(e);</span></span>
<span class="line"><span>    final ReentrantLock putLock = this.putLock;</span></span>
<span class="line"><span>    final AtomicInteger count = this.count;</span></span>
<span class="line"><span>    putLock.lockInterruptibly();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        while (count.get() == capacity) {</span></span>
<span class="line"><span>            notFull.await();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        enqueue(node);</span></span>
<span class="line"><span>        c = count.getAndIncrement();</span></span>
<span class="line"><span>        if (c + 1 &lt; capacity)</span></span>
<span class="line"><span>            notFull.signal();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        putLock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if (c == 0)</span></span>
<span class="line"><span>        signalNotEmpty();</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public boolean offer(E e, long timeout, TimeUnit unit)</span></span>
<span class="line"><span>    throws InterruptedException {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if (e == null) throw new NullPointerException();</span></span>
<span class="line"><span>    long nanos = unit.toNanos(timeout);</span></span>
<span class="line"><span>    int c = -1;</span></span>
<span class="line"><span>    final ReentrantLock putLock = this.putLock;</span></span>
<span class="line"><span>    final AtomicInteger count = this.count;</span></span>
<span class="line"><span>    putLock.lockInterruptibly();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        while (count.get() == capacity) {</span></span>
<span class="line"><span>            if (nanos &lt;= 0)</span></span>
<span class="line"><span>                return false;</span></span>
<span class="line"><span>            nanos = notFull.awaitNanos(nanos);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        enqueue(new Node&lt;E&gt;(e));</span></span>
<span class="line"><span>        c = count.getAndIncrement();</span></span>
<span class="line"><span>        if (c + 1 &lt; capacity)</span></span>
<span class="line"><span>            notFull.signal();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        putLock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if (c == 0)</span></span>
<span class="line"><span>        signalNotEmpty();</span></span>
<span class="line"><span>    return true;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_2-2-è¯»æ“ä½œ" tabindex="-1">2.2 è¯»æ“ä½œ <a class="header-anchor" href="#_2-2-è¯»æ“ä½œ" aria-label="Permalink to &quot;2.2 è¯»æ“ä½œ&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public E poll() {</span></span>
<span class="line"><span>    final AtomicInteger count = this.count;</span></span>
<span class="line"><span>    // ä¸º0ï¼Œæ²¡æ•°æ®ï¼Œæ‹œæ‹œ~~</span></span>
<span class="line"><span>    if (count.get() == 0)</span></span>
<span class="line"><span>        return null;</span></span>
<span class="line"><span>    E x = null;</span></span>
<span class="line"><span>    int c = -1;</span></span>
<span class="line"><span>    // è¯»é”</span></span>
<span class="line"><span>    final ReentrantLock takeLock = this.takeLock;</span></span>
<span class="line"><span>    takeLock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // å¦‚æœé˜Ÿåˆ—æœ‰æ•°æ®  DCL</span></span>
<span class="line"><span>        if (count.get() &gt; 0) {</span></span>
<span class="line"><span>            x = dequeue();</span></span>
<span class="line"><span>            // count --</span></span>
<span class="line"><span>            c = count.getAndDecrement();</span></span>
<span class="line"><span>            if (c &gt; 1)</span></span>
<span class="line"><span>                // c &gt; 1,è¯´æ˜è¿˜æœ‰æ•°æ®ï¼Œå”¤é†’è¯»çº¿ç¨‹</span></span>
<span class="line"><span>                notEmpty.signal();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        takeLock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if (c == capacity)</span></span>
<span class="line"><span>        // åˆ°è¿™è¯´æ˜è¿˜æœ‰ä½ç½®å‘¢ï¼Œå”¤é†’å†™çº¿ç¨‹</span></span>
<span class="line"><span>        signalNotFull();</span></span>
<span class="line"><span>    return x;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private E dequeue() {</span></span>
<span class="line"><span>    Node&lt;E&gt; h = head;</span></span>
<span class="line"><span>    Node&lt;E&gt; first = h.next;</span></span>
<span class="line"><span>    h.next = h; // help GC</span></span>
<span class="line"><span>    head = first;</span></span>
<span class="line"><span>    E x = first.item;</span></span>
<span class="line"><span>    first.item = null;</span></span>
<span class="line"><span>    return x;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="ä¸‰ã€priorityqueue" tabindex="-1">ä¸‰ã€PriorityQueue <a class="header-anchor" href="#ä¸‰ã€priorityqueue" aria-label="Permalink to &quot;ä¸‰ã€PriorityQueue&quot;">â€‹</a></h3><p>è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„é˜Ÿåˆ—ï¼Œä¸æ˜¯é˜»å¡çš„ã€‚</p><p>å› ä¸ºDelayQueueå’ŒPriorityBlockingQueueéƒ½å’ŒPriorityQueueæœ‰å…³ç³»ï¼Œå¾ˆç±»ä¼¼ã€‚</p><p>å…ˆæŠŠPriorityQueueæå®šï¼Œåç»­å†çœ‹å…¶ä»–çš„ä¼˜å…ˆçº§é˜»å¡é˜Ÿåˆ—ï¼Œæ•ˆæœæ›´ä½³ï¼</p><p>PriorityQueueæ‰æ˜¯çœŸæ­£è€Œå®šæ— ç•Œé˜Ÿåˆ—ã€‚åº•å±‚æ˜¯æ•°ç»„å®ç°ï¼Œä¼šæ‰©å®¹ï¼</p><p>PriorityQueueå®ç°ä¼˜å…ˆçº§çš„æ–¹å¼ï¼Œæ˜¯åŸºäºäºŒå‰å †å®ç°çš„</p><p>äºŒå‰å †ï¼š</p><ul><li><p>äºŒå‰å †æ˜¯ä¸€é¢—å®Œæ•´çš„äºŒå‰æ ‘</p></li><li><p>ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹ Â  æˆ–è€… Â  å°äºçˆ¶èŠ‚ç‚¹</p></li></ul><p>å› ä¸ºè¿™ä¸ªäºŒå‰å †æ˜¯å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—çš„åŸç†ï¼Œé‚£ä¹ˆé˜Ÿåˆ—æˆ–æœ‰æ·»åŠ å’Œè·å–çš„æ“ä½œï¼Œè¿™ç§æ“ä½œä¼šå½±å“äºŒå‰å †çš„ç»“æ„ï¼ŒæŸ¥çœ‹PriorityQueueé˜Ÿåˆ—çš„æ·»åŠ å’Œè·å–æ“ä½œå¦‚ä½•ä¿è¯ç»“æ„</p><h4 id="_3-1-æ·»åŠ æ“ä½œä¸Šç§»ä¿è¯ç»“æ„" tabindex="-1">3.1 æ·»åŠ æ“ä½œä¸Šç§»ä¿è¯ç»“æ„ <a class="header-anchor" href="#_3-1-æ·»åŠ æ“ä½œä¸Šç§»ä¿è¯ç»“æ„" aria-label="Permalink to &quot;3.1 æ·»åŠ æ“ä½œä¸Šç§»ä¿è¯ç»“æ„&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// ä¼˜å…ˆçº§é˜Ÿåˆ—æ·»åŠ æ“ä½œï¼Œç¡®å®šå¦‚ä½•ä¿è¯å°é¡¶å †ç»“æ„</span></span>
<span class="line"><span>public boolean offer(E e) {</span></span>
<span class="line"><span>    if (e == null)</span></span>
<span class="line"><span>        throw new NullPointerException();</span></span>
<span class="line"><span>    modCount++;</span></span>
<span class="line"><span>    // sizeæ˜¯æ•°ç»„æ•°æ®æ¡æ•°ï¼Œå¤§äºç­‰äºæ•°ç»„é•¿åº¦åï¼Œéœ€è¦æ‰©å®¹</span></span>
<span class="line"><span>    int i = size;</span></span>
<span class="line"><span>    if (i &gt;= queue.length)</span></span>
<span class="line"><span>        // Double size if small; else grow by 50%</span></span>
<span class="line"><span>        grow(i + 1);</span></span>
<span class="line"><span>    // size + iï¼Œæ•°æ®å¤šä¸€æ¡</span></span>
<span class="line"><span>    size = i + 1;</span></span>
<span class="line"><span>    // å¦‚æœi == 0ï¼Œè¯´æ˜æ·»åŠ çš„æ˜¯ç¬¬ä¸€ä¸ªæ•°æ®</span></span>
<span class="line"><span>    if (i == 0)</span></span>
<span class="line"><span>        queue[0] = e;</span></span>
<span class="line"><span>    else</span></span>
<span class="line"><span>        // ä¸æ˜¯ç¬¬ä¸€ä¸ªæ•°æ®ï¼ŒUpä¸Šç§»ä¿è¯ç»“æ„</span></span>
<span class="line"><span>        siftUp(i, e);</span></span>
<span class="line"><span>    return true;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è®©å½“å‰èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹æ¯”è¾ƒï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹æ¯”è¾ƒå°ï¼Œå°±ä¸Šç§»~~~</span></span>
<span class="line"><span>private void siftUpUsingComparator(int k, E x) {</span></span>
<span class="line"><span>    while (k &gt; 0) {</span></span>
<span class="line"><span>        int parent = (k - 1) &gt;&gt;&gt; 1;</span></span>
<span class="line"><span>        Object e = queue[parent];</span></span>
<span class="line"><span>        if (comparator.compare(x, (E) e) &gt;= 0)</span></span>
<span class="line"><span>            break;</span></span>
<span class="line"><span>        queue[k] = e;</span></span>
<span class="line"><span>        k = parent;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    queue[k] = x;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_3-2-å–æ•°æ®å¦‚ä½•ä¿è¯äºŒå‰å †ç»“æ„" tabindex="-1">3.2 å–æ•°æ®å¦‚ä½•ä¿è¯äºŒå‰å †ç»“æ„ <a class="header-anchor" href="#_3-2-å–æ•°æ®å¦‚ä½•ä¿è¯äºŒå‰å †ç»“æ„" aria-label="Permalink to &quot;3.2 å–æ•°æ®å¦‚ä½•ä¿è¯äºŒå‰å †ç»“æ„&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å–å †é¡¶æ•°æ®</span></span>
<span class="line"><span>public E poll() {</span></span>
<span class="line"><span>    // æ²¡æœ‰æ•°æ®è¿”å›null</span></span>
<span class="line"><span>    if (size == 0)</span></span>
<span class="line"><span>        return null;</span></span>
<span class="line"><span>    // æœ€åä¸€ä¸ªæ•°æ®çš„ç´¢å¼•</span></span>
<span class="line"><span>    int s = --size;</span></span>
<span class="line"><span>    // éœ€è¦å…¨éƒ½çš„æ•°æ®</span></span>
<span class="line"><span>    E result = (E) queue[0];</span></span>
<span class="line"><span>    // å–å‡ºæœ€åä¸€ä¸ªæ•°æ®</span></span>
<span class="line"><span>    E x = (E) queue[s];</span></span>
<span class="line"><span>    // å°†æœ€åä¸€ä¸ªæ•°æ®ç½®ä½null</span></span>
<span class="line"><span>    queue[s] = null;</span></span>
<span class="line"><span>    if (s != 0)</span></span>
<span class="line"><span>        // ä¸‹ç§»ä¿è¯å®‰å…¨</span></span>
<span class="line"><span>        siftDown(0, x);</span></span>
<span class="line"><span>    return result;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å †é¡¶æ•°æ®ä¸‹ç§»ï¼ŒçŸ¥é“lastæ•°æ®å¯ä»¥å­˜æ”¾çš„ä½ç½®ï¼Œç„¶åæ›¿æ¢å³å¯</span></span>
<span class="line"><span>private void siftDownUsingComparator(int k, E x) {</span></span>
<span class="line"><span>    while (k &lt; half) {</span></span>
<span class="line"><span>        int child = (k &lt;&lt; 1) + 1;</span></span>
<span class="line"><span>        // æ‰¾åˆ°å·¦å­</span></span>
<span class="line"><span>        Object c = queue[child];</span></span>
<span class="line"><span>        int right = child + 1;</span></span>
<span class="line"><span>        if (right &lt; size &amp;&amp;</span></span>
<span class="line"><span>            comparator.compare((E) c, (E) queue[right]) &gt; 0)</span></span>
<span class="line"><span>            c = queue[child = right];</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if (comparator.compare(x, (E) c) &lt;= 0)</span></span>
<span class="line"><span>            break;</span></span>
<span class="line"><span>        queue[k] = c;</span></span>
<span class="line"><span>        k = child;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    queue[k] = x;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="å››ã€priorityblockingqueue" tabindex="-1">å››ã€PriorityBlockingQueue <a class="header-anchor" href="#å››ã€priorityblockingqueue" aria-label="Permalink to &quot;å››ã€PriorityBlockingQueue&quot;">â€‹</a></h3><p>è¿™ä¸ªé˜»å¡çš„ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å®ç°è·ŸPriorityQueueåŸºæœ¬ä¸€æ¨¡ä¸€æ ·ï¼Œåªæ˜¯PriorityBlockingQueueåŸºäºLocké”å®ç°çš„å¤šçº¿ç¨‹æ“ä½œå®‰å…¨å¹¶ä¸”çº¿ç¨‹å¯ä»¥æŒ‚èµ·é˜»å¡çš„æ“ä½œ</p><p>PriorityBlockingQueueåº•å±‚åŸºäºæ•°ç»„ï¼Œå¹¶ä¸”å¯ä»¥æ‰©å®¹ï¼Œä¸ä¼šåŸºäºconditionæŒ‚èµ·çº¿ç¨‹ï¼Œè¯»ä¼šé˜»å¡ã€‚</p><h4 id="_4-1-å†™æ“ä½œ" tabindex="-1">4.1 å†™æ“ä½œ <a class="header-anchor" href="#_4-1-å†™æ“ä½œ" aria-label="Permalink to &quot;4.1 å†™æ“ä½œ&quot;">â€‹</a></h4><p>å› ä¸ºåº•å±‚åŸºäºæ•°ç»„ï¼Œå¹¶ä¸”å¯ä»¥æ‰©å®¹ï¼Œæ‰€ä»¥å†™æ“ä½œçš„putå’Œpoll(time,unit)çš„æ–¹å¼ä¸ä¼šåŸºäºconditionæŒ‚èµ·çº¿ç¨‹ã€‚</p><p>å¹¶ä¸”æ˜¯å¤šçº¿ç¨‹åŸºäºCASçš„æ–¹å¼äº‰æŠ¢æ‰©å®¹çš„æ ‡è¯†</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// æ‰€æœ‰æ·»åŠ éƒ½èµ°ç€ï¼Œæ²¡æœ‰awaitæŒ‚èµ·çš„æ–¹å¼ï¼Œ</span></span>
<span class="line"><span>public boolean offer(E e) {</span></span>
<span class="line"><span>    if (e == null)</span></span>
<span class="line"><span>        throw new NullPointerException();</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lock();</span></span>
<span class="line"><span>    int n, cap;</span></span>
<span class="line"><span>    Object[] array;</span></span>
<span class="line"><span>    // æ‰©å®¹ï¼Œå…è®¸å¤šçº¿ç¨‹å¹¶å‘æ‰©å®¹ã€‚ä¸€ä¼šçœ‹~~~</span></span>
<span class="line"><span>    while ((n = size) &gt;= (cap = (array = queue).length))</span></span>
<span class="line"><span>        tryGrow(array, cap);</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        Comparator&lt;? super E&gt; cmp = comparator;</span></span>
<span class="line"><span>        if (cmp == null)</span></span>
<span class="line"><span>            //æ·»åŠ æ•°æ®åˆ°äºŒå‰å †</span></span>
<span class="line"><span>            siftUpComparable(n, e, array);</span></span>
<span class="line"><span>        else</span></span>
<span class="line"><span>            siftUpUsingComparator(n, e, array, cmp);</span></span>
<span class="line"><span>        size = n + 1;</span></span>
<span class="line"><span>        // å”¤é†’è¯»çº¿ç¨‹</span></span>
<span class="line"><span>        notEmpty.signal();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return true;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è·ŸPriorityQueueä¸€æ ·çš„ä¸Šç§»æ“ä½œ</span></span>
<span class="line"><span>private static &lt;T&gt; void siftUpComparable(int k, T x, Object[] array) {</span></span>
<span class="line"><span>    Comparable&lt;? super T&gt; key = (Comparable&lt;? super T&gt;) x;</span></span>
<span class="line"><span>    while (k &gt; 0) {</span></span>
<span class="line"><span>        int parent = (k - 1) &gt;&gt;&gt; 1;</span></span>
<span class="line"><span>        Object e = array[parent];</span></span>
<span class="line"><span>        if (key.compareTo((T) e) &gt;= 0)</span></span>
<span class="line"><span>            break;</span></span>
<span class="line"><span>        array[k] = e;</span></span>
<span class="line"><span>        k = parent;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    array[k] = key;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å°è¯•æ‰©å®¹</span></span>
<span class="line"><span>private void tryGrow(Object[] array, int oldCap) {</span></span>
<span class="line"><span>    // å…è®¸å¤šçº¿ç¨‹å¹¶å‘æ‰©å®¹çš„ã€‚ï¼ˆä¸æ˜¯ååŠ©æ‰©å®¹ï¼‰ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šæˆåŠŸï¼ŒåŸºäºCASçš„æ–¹å¼ï¼Œé¿å…å¹¶å‘é—®é¢˜</span></span>
<span class="line"><span>    lock.unlock();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Object[] newArray = null;</span></span>
<span class="line"><span>    // çº¿ç¨‹å°†allocationSpinLockä»0æ”¹ä¸º1ï¼Œå¾—åˆ°äº†æ‰©å®¹çš„æƒåˆ©ï¼Œå¯ä»¥åˆ›å»ºæ–°æ•°ç»„</span></span>
<span class="line"><span>    if (allocationSpinLock == 0 &amp;&amp; UNSAFE.compareAndSwapInt(this, allocationSpinLockOffset,0, 1)) {</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            // è®¡ç®—æ–°æ•°ç»„é•¿åº¦</span></span>
<span class="line"><span>            int newCap = oldCap + ((oldCap &lt; 64) ? (oldCap + 2) :  (oldCap &gt;&gt; 1));</span></span>
<span class="line"><span>            // åˆ¤æ–­é•¿åº¦æ˜¯å¦è¶…è¿‡ç•Œé™</span></span>
<span class="line"><span>            if (newCap - MAX_ARRAY_SIZE &gt; 0) {  </span></span>
<span class="line"><span>                int minCap = oldCap + 1;</span></span>
<span class="line"><span>                if (minCap &lt; 0 || minCap &gt; MAX_ARRAY_SIZE)</span></span>
<span class="line"><span>                    throw new OutOfMemoryError();</span></span>
<span class="line"><span>                newCap = MAX_ARRAY_SIZE;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            if (newCap &gt; oldCap &amp;&amp; queue == array)</span></span>
<span class="line"><span>                // åˆ›å»ºæ–°æ•°ç»„</span></span>
<span class="line"><span>                newArray = new Object[newCap];</span></span>
<span class="line"><span>        } finally {</span></span>
<span class="line"><span>            allocationSpinLock = 0;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if (newArray == null) </span></span>
<span class="line"><span>        // å¦‚æœnewArrayæ˜¯nullï¼Œè¯´æ˜å½“å‰çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œæ‰©å®¹æ“ä½œ</span></span>
<span class="line"><span>        // è®©å‡ºCPUæ—¶é—´ç‰‡ï¼Œå°½é‡è®©æ‰©å®¹çš„çº¿ç¨‹å…ˆèµ°å®Œæ‰©å®¹æ“ä½œ</span></span>
<span class="line"><span>        Thread.yield();</span></span>
<span class="line"><span>    lock.lock();</span></span>
<span class="line"><span>    if (newArray != null &amp;&amp; queue == array) {</span></span>
<span class="line"><span>        queue = newArray;</span></span>
<span class="line"><span>        // æ‰©å®¹ç»“æŸ</span></span>
<span class="line"><span>        System.arraycopy(array, 0, newArray, 0, oldCap);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_4-2-è¯»æ“ä½œ" tabindex="-1">4.2 è¯»æ“ä½œ <a class="header-anchor" href="#_4-2-è¯»æ“ä½œ" aria-label="Permalink to &quot;4.2 è¯»æ“ä½œ&quot;">â€‹</a></h4><p>PriorityBlockingQueueçš„è¯»æ“ä½œï¼Œæ˜¯å…è®¸ä½¿ç”¨conditionæŒ‚èµ·çš„ï¼Œå› ä¸ºäºŒå‰å †å¯èƒ½æ²¡æœ‰æ•°æ®ã€‚æ²¡æœ‰æ•°æ®ï¼Œå°±æŒ‚èµ·å‘—~~</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public E poll() {</span></span>
<span class="line"><span>    // åŸºäºlocké”ä¿è¯å®‰å…¨ï¼Œ</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        return dequeue();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>private E dequeue() {</span></span>
<span class="line"><span>    int n = size - 1;</span></span>
<span class="line"><span>    if (n &lt; 0)</span></span>
<span class="line"><span>        return null;</span></span>
<span class="line"><span>    else {</span></span>
<span class="line"><span>        Object[] array = queue;</span></span>
<span class="line"><span>        // æ‹¿åˆ°å †é¡¶æ•°æ®</span></span>
<span class="line"><span>        E result = (E) array[0];</span></span>
<span class="line"><span>        E x = (E) array[n];</span></span>
<span class="line"><span>        array[n] = null;</span></span>
<span class="line"><span>        Comparator&lt;? super E&gt; cmp = comparator;</span></span>
<span class="line"><span>        if (cmp == null)</span></span>
<span class="line"><span>            // ä¿è¯ç»“æ„ï¼Œä¸‹ç§»~~</span></span>
<span class="line"><span>            siftDownComparable(0, x, array, n);</span></span>
<span class="line"><span>        else</span></span>
<span class="line"><span>            siftDownUsingComparator(0, x, array, n, cmp);</span></span>
<span class="line"><span>        size = n;</span></span>
<span class="line"><span>        return result;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>public E take() throws InterruptedException {</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lockInterruptibly();</span></span>
<span class="line"><span>    E result;</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        while ( (result = dequeue()) == null)</span></span>
<span class="line"><span>            notEmpty.await();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return result;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>public E poll(long timeout, TimeUnit unit) throws InterruptedException {</span></span>
<span class="line"><span>    long nanos = unit.toNanos(timeout);</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lockInterruptibly();</span></span>
<span class="line"><span>    E result;</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        while ( (result = dequeue()) == null &amp;&amp; nanos &gt; 0)</span></span>
<span class="line"><span>            nanos = notEmpty.awaitNanos(nanos);</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return result;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h1 id="ä¹ã€jucé˜»å¡é˜Ÿåˆ—ç¬¬äºŒå¼¹" tabindex="-1">ä¹ã€<strong>JUCé˜»å¡é˜Ÿåˆ—ç¬¬äºŒå¼¹</strong> <a class="header-anchor" href="#ä¹ã€jucé˜»å¡é˜Ÿåˆ—ç¬¬äºŒå¼¹" aria-label="Permalink to &quot;ä¹ã€**JUCé˜»å¡é˜Ÿåˆ—ç¬¬äºŒå¼¹**&quot;">â€‹</a></h1><h3 id="ä¸€ã€delayqueue" tabindex="-1">ä¸€ã€DelayQueue <a class="header-anchor" href="#ä¸€ã€delayqueue" aria-label="Permalink to &quot;ä¸€ã€DelayQueue&quot;">â€‹</a></h3><p>åœ¨å­¦ä¹ Delayçš„åŸç†ä¹‹å‰ï¼Œå…ˆæŒæ¡åº”ç”¨ã€‚</p><p>å¦‚æœéœ€è¦æŒæ¡æºç çš„è¯ï¼Œéœ€è¦å¯¹PriorityQueueæœ‰ä¸€å®šæŒæ¡ï¼Œä¹Ÿå°±æ˜¯äºŒå‰å †ã€‚</p><h4 id="_1-1-æŒæ¡delayqueueåº”ç”¨" tabindex="-1">1.1 æŒæ¡DelayQueueåº”ç”¨ <a class="header-anchor" href="#_1-1-æŒæ¡delayqueueåº”ç”¨" aria-label="Permalink to &quot;1.1 æŒæ¡DelayQueueåº”ç”¨&quot;">â€‹</a></h4><p>DelayQueueæ˜¯æ— ç•Œé˜Ÿåˆ—</p><p>å»¶è¿Ÿçš„æ“ä½œï¼Œå¯ä»¥å‘å»¶è¿Ÿé˜Ÿåˆ—ä¸­è¿½åŠ ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡éœ€è¦æŒ‡å®šå»¶è¿Ÿæ—¶é—´ã€‚</p><p>åªæœ‰å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰å¯ä»¥å°†ä»»åŠ¡ä»é˜Ÿåˆ—ä¸­è·å–å‡ºæ¥ã€‚</p><p>ä»»åŠ¡å¯ä»¥æŒ‡å®šå»¶è¿Ÿæ—¶é—´ï¼Œæ‰€ä»¥éœ€è¦ä»»åŠ¡æ»¡è¶³ä¸€å®šçš„éœ€æ±‚</p><p>å‘ç°DelayQueueä¸­çš„ä»»åŠ¡éœ€è¦å®ç°Delayedæ¥å£ï¼Œé‡å†™getDelayå’ŒcompareToæ–¹æ³•</p><p>getDelayï¼šä»»åŠ¡ä»€ä¹ˆæ—¶å€™å¯ä»¥å‡ºé˜Ÿåˆ—</p><p>compareToï¼šå­˜æ”¾ä»»åŠ¡åˆ°é˜Ÿåˆ—æ—¶ï¼Œæ”¾åœ¨äºŒå‰å †çš„å“ªä¸ªä½ç½®</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>class Task implements Delayed{</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    private String name;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**  æ‰§è¡Œæ—¶é—´ ï¼ˆå•ä½æ¯«ç§’ï¼‰ */</span></span>
<span class="line"><span>    private Long time;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /**</span></span>
<span class="line"><span>     *</span></span>
<span class="line"><span>     * @param name  ä»»åŠ¡åç§°</span></span>
<span class="line"><span>     * @param delayTime  ä¼ å…¥å»¶è¿Ÿæ—¶é—´</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    public Task(String name, Long delayTime) {</span></span>
<span class="line"><span>        this.name = name;</span></span>
<span class="line"><span>        this.time = System.currentTimeMillis() + delayTime;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /** ä»»åŠ¡å¯ä»¥å‡ºé˜Ÿåˆ—çš„æ ¸å¿ƒæ–¹æ³• */</span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>    public long getDelay(TimeUnit unit) {</span></span>
<span class="line"><span>        return unit.convert(time - System.currentTimeMillis(),TimeUnit.MILLISECONDS);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /** é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæ¥æ¯”è¾ƒï¼Œå°†ä»»åŠ¡å­˜æ”¾åˆ°äºŒå‰å †çš„æŒ‡å®šä½ç½® */</span></span>
<span class="line"><span>    @Override</span></span>
<span class="line"><span>    public int compareTo(Delayed o) {</span></span>
<span class="line"><span>        // åŸºäºæ‰§è¡Œæ—¶é—´æ¯”è¾ƒ</span></span>
<span class="line"><span>        return (int) (this.time - ((Task)o).getTime());</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æµ‹è¯•æ•ˆæœ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws InterruptedException {</span></span>
<span class="line"><span>    DelayQueue queue = new DelayQueue();</span></span>
<span class="line"><span>    queue.offer(new Task(&quot;A&quot;,4000L));</span></span>
<span class="line"><span>    queue.offer(new Task(&quot;B&quot;,2000L));</span></span>
<span class="line"><span>    queue.offer(new Task(&quot;C&quot;,3000L));</span></span>
<span class="line"><span>    queue.offer(new Task(&quot;D&quot;,1000L));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    System.out.println(queue.take());</span></span>
<span class="line"><span>    System.out.println(queue.take());</span></span>
<span class="line"><span>    System.out.println(queue.take());</span></span>
<span class="line"><span>    System.out.println(queue.take());</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_1-2-åˆ†ææºç " tabindex="-1">1.2 åˆ†ææºç  <a class="header-anchor" href="#_1-2-åˆ†ææºç " aria-label="Permalink to &quot;1.2 åˆ†ææºç &quot;">â€‹</a></h4><p>é¦–å…ˆï¼Œæƒ³æŒæ¡å»¶è¿Ÿé˜Ÿåˆ—çš„æºç ä¿¡æ¯ï¼Œä½ éœ€è¦å…ˆæŒæ¡ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p><p>PriorityQueueï¼Œè¿™ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯åŸºäºäºŒå‰å †ã€‚</p><p>äºŒå‰å †è·ŸäºŒå‰æ ‘ç»“æ„å¾ˆåƒï¼ŒäºŒå‰å †å°±æ˜¯æ»¡äºŒå‰æ ‘ã€‚</p><p>ä¼˜å…ˆçº§é˜Ÿåˆ—æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œ åœ¨é˜Ÿåˆ—å†…éƒ¨ä¼šå¯¹æ¯ä¸ªèŠ‚ç‚¹åšæ’åº</p><p>äºŒå‰å †å­˜æ”¾æ•°æ®çš„é¡ºåºæ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”æ²¡æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œä¼šåŸºäºä¸Šç§»æ“ä½œä¿è¯å°é¡¶å †çš„ç»“æ„</p><p>å¦‚æœå–å‡ºæ•°æ®ï¼Œè¦æ¶‰åŠåˆ°ä¸‹ç§»æ¥ä¿è¯å°é¡¶å †ç»“æ„</p><p>å»¶è¿Ÿé˜Ÿåˆ—å°±æ˜¯åŸºäºä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„</p><p>çœ‹å»¶è¿Ÿé˜Ÿåˆ—çš„æ·»åŠ ä»»åŠ¡æ–¹æ³•</p><p>å› ä¸ºDelayQueueæ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œç©ºé—´ä¸å¤Ÿä¼šæ‰©å®¹ï¼Œç”Ÿäº§è€…ä¸éœ€è¦æŒ‚èµ·çº¿ç¨‹ï¼Œç©ºé—´è‚¯å®šå¯ä»¥å­˜æ”¾ä¸‹å½“å‰çš„ä»»åŠ¡èŠ‚ç‚¹</p><p>åªéœ€è¦æŸ¥çœ‹offerå³å¯ï¼Œå…¶ä»–çš„æ–¹æ³•ä¹Ÿéƒ½æ˜¯è°ƒç”¨çš„offer</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå°±è¿™ä¹ˆä¸€ä¸ªæ·»åŠ ä»»åŠ¡çš„æ–¹æ³•</span></span>
<span class="line"><span>public boolean offer(E e) {</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // è°ƒç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ·»åŠ ä»»åŠ¡</span></span>
<span class="line"><span>        q.offer(e);</span></span>
<span class="line"><span>        // æ‹¿åˆ°ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œçœ‹çœ‹æˆ‘æ˜¯ä¸æ˜¯ç¬¬ä¸€ä¸ªï¼Œå¦‚æœæ˜¯ç¬¬ä¸€ä¸ªï¼Œå¯èƒ½æœ‰æ¶ˆè´¹è€…æŒ‚èµ·äº†ï¼Œå”¤é†’ä¸€æ³¢</span></span>
<span class="line"><span>        if (q.peek() == e) {</span></span>
<span class="line"><span>            // ä¸€ä¼šè¯´ï¼ï¼ï¼ï¼</span></span>
<span class="line"><span>            leader = null;</span></span>
<span class="line"><span>            // conditionå•Šï¼ŒawaitæŒ‚èµ·çº¿ç¨‹ï¼Œsignalå”¤é†’çº¿ç¨‹</span></span>
<span class="line"><span>            available.signal();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        // ok~è¿”å›true</span></span>
<span class="line"><span>        return true;</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è¿™ä¸ªæ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—çš„æ·»åŠ ï¼Œå»¶è¿Ÿé˜Ÿåˆ—æ˜¯åŸºäºä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„åŠŸèƒ½</span></span>
<span class="line"><span>public boolean offer(E e) {</span></span>
<span class="line"><span>    if (e == null)</span></span>
<span class="line"><span>        throw new NullPointerException();</span></span>
<span class="line"><span>    modCount++;</span></span>
<span class="line"><span>    int i = size;</span></span>
<span class="line"><span>    // ç©ºé—´ä¸å¤Ÿï¼Œæ‰©å®¹æ•°ç»„</span></span>
<span class="line"><span>    if (i &gt;= queue.length)</span></span>
<span class="line"><span>        grow(i + 1);</span></span>
<span class="line"><span>    size = i + 1;</span></span>
<span class="line"><span>    if (i == 0)</span></span>
<span class="line"><span>        // æ”¾ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œä¸éœ€è¦ä¸Šç§»</span></span>
<span class="line"><span>        queue[0] = e;</span></span>
<span class="line"><span>    else</span></span>
<span class="line"><span>        // ä¸æ˜¯ä¸€ä¸ªæ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¸Šç§»</span></span>
<span class="line"><span>        siftUp(i, e);</span></span>
<span class="line"><span>    return true;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æ•°æ®æ€ä¹ˆä»å»¶è¿Ÿé˜Ÿåˆ—æ‹¿å‡ºæ¥çš„</p><p>æµ…å°çš„poll()</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// æ¶ˆè´¹è€…æµ…å°ä¸€ä¸‹æ‹¿æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œå¹¶ä¸”å»¶è¿Ÿæ—¶é—´å·²ç»åˆ°äº†ï¼Œè¿”å›ï¼Œå¦åˆ™å•¥ä¹Ÿä¸å¹²</span></span>
<span class="line"><span>public E poll() {</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    lock.lock();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // æ‹¿åˆ°å †é¡¶æ•°æ®</span></span>
<span class="line"><span>        E first = q.peek();</span></span>
<span class="line"><span>        // å¦‚æœæ²¡æ•°æ®ï¼Œæˆ–è€…æ•°æ®çš„å»¶è¿Ÿæ—¶é—´æ²¡åˆ°ï¼Œè¿”å›null</span></span>
<span class="line"><span>        if (first == null || first.getDelay(NANOSECONDS) &gt; 0)</span></span>
<span class="line"><span>            return null;</span></span>
<span class="line"><span>        else</span></span>
<span class="line"><span>            // å¦‚æœæœ‰æ•°æ®ï¼Œå¹¶ä¸”æ—¶é—´åˆ°äº†ï¼ŒåŸºäºä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ŒæŠŠä»»åŠ¡å–å‡ºæ¥ã€‚  </span></span>
<span class="line"><span>            return q.poll();</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æµ…å°ä¸€ä¼šçš„poll(time,unit)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å°ä¸€å°ä¼š~~~å°  timeoutæ—¶é—´</span></span>
<span class="line"><span>public E poll(long timeout, TimeUnit unit) throws InterruptedException {</span></span>
<span class="line"><span>    // çº³ç§’åˆ¤æ–­</span></span>
<span class="line"><span>    long nanos = unit.toNanos(timeout);</span></span>
<span class="line"><span>    final ReentrantLock lock = this.lock;</span></span>
<span class="line"><span>    // è¿™é‡ŒåŠ é”ï¼Œå…è®¸ä¸­æ–­ã€‚</span></span>
<span class="line"><span>    lock.lockInterruptibly();</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        for (;;) {</span></span>
<span class="line"><span>            // æ‹¿å †é¡¶</span></span>
<span class="line"><span>            E first = q.peek();</span></span>
<span class="line"><span>            // æ²¡æ•°æ®ï¼Œåˆ¤æ–­ç­‰å¤šä¹…</span></span>
<span class="line"><span>            if (first == null) {</span></span>
<span class="line"><span>                if (nanos &lt;= 0)</span></span>
<span class="line"><span>                    // æ—¶é—´æ²¡äº†ï¼Œå‘Šè¾ï¼ï¼ï¼ï¼</span></span>
<span class="line"><span>                    return null;</span></span>
<span class="line"><span>                else</span></span>
<span class="line"><span>                    // æ—¶é—´è¿˜æœ‰ï¼Œç­‰ä¸€å°ä¼š~~</span></span>
<span class="line"><span>                    nanos = available.awaitNanos(nanos);</span></span>
<span class="line"><span>            } else {</span></span>
<span class="line"><span>                // å¿…ç„¶æœ‰æ•°æ®ï¼ï¼ï¼ï¼</span></span>
<span class="line"><span>                // å–å‡ºå †é¡¶æ•°æ®çš„å‰©ä½™æ—¶é—´</span></span>
<span class="line"><span>                long delay = first.getDelay(NANOSECONDS);</span></span>
<span class="line"><span>                // å¦‚æœæ—¶é—´å·²ç»åˆ°ä½äº†ï¼Œç›´æ¥è°ƒç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ŒæŠŠæ•°æ®å–å‡ºæ¥</span></span>
<span class="line"><span>                if (delay &lt;= 0)</span></span>
<span class="line"><span>                    return q.poll();</span></span>
<span class="line"><span>                // å†æ¬¡åˆ¤æ–­ç­‰å¾…æ—¶é—´</span></span>
<span class="line"><span>                if (nanos &lt;= 0)</span></span>
<span class="line"><span>                    // ä¸ç­‰ï¼Œå‘Šè¾ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</span></span>
<span class="line"><span>                    return null;</span></span>
<span class="line"><span>                // å°†ä¸´æ—¶å˜é‡ç½®ä½null</span></span>
<span class="line"><span>                first = null; </span></span>
<span class="line"><span>                // å¦‚æœå‰©ä½™çš„ç­‰å¾…æ—¶é—´ï¼Œå°äºä»»åŠ¡çš„å»¶è¿Ÿæ—¶é—´ï¼Œè‚¯å®šæ‹¿ä¸åˆ°æ•°æ®çš„ï¼Œç­‰ç€ç©ï¼Œåæ­£æ‹¿ä¸åˆ°</span></span>
<span class="line"><span>                if (nanos &lt; delay || leader != null)</span></span>
<span class="line"><span>                    nanos = available.awaitNanos(nanos);</span></span>
<span class="line"><span>                else {</span></span>
<span class="line"><span>                    // æˆ‘ç­‰å¾…çš„æ—¶é—´å†…ï¼Œå¿…ç„¶å¯ä»¥æ‹¿åˆ°æ•°æ®ï¼Œå¹¶ä¸”æ²¡æœ‰leader</span></span>
<span class="line"><span>                    Thread thisThread = Thread.currentThread();</span></span>
<span class="line"><span>                    // å°†å½“å‰çº¿ç¨‹ç½®ä½leaderï¼Œè¯´æ˜æˆ‘æ˜¯ç¬¬ä¸€ä¸ªåœ¨è¿™ç­‰å¾…æ•°æ®çš„çº¿ç¨‹ï¼ï¼ï¼ï¼</span></span>
<span class="line"><span>                    leader = thisThread;</span></span>
<span class="line"><span>                    try {</span></span>
<span class="line"><span>                        // å½“å‰çº¿ç¨‹å…ˆæŒ‚èµ·ï¼ŒæŒ‚èµ·ä»»åŠ¡å‰©ä½™çš„å»¶è¿Ÿæ—¶é—´ï¼Œä¼šé‡Šæ”¾é”ï¼</span></span>
<span class="line"><span>                        long timeLeft = available.awaitNanos(delay);</span></span>
<span class="line"><span>                        // é‡æ–°è®¡ç®—å‰©ä½™çš„ç­‰å¾…æ—¶é—´</span></span>
<span class="line"><span>                        nanos -= delay - timeLeft;</span></span>
<span class="line"><span>                    } finally {</span></span>
<span class="line"><span>                        // å°†leaderç½®ä½null</span></span>
<span class="line"><span>                        if (leader == thisThread)</span></span>
<span class="line"><span>                            leader = null;</span></span>
<span class="line"><span>                    }</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        // å¦‚æœleaderä¸ºnullï¼Œå¹¶ä¸”å †é¡¶æœ‰æ•°æ®ï¼Œæ‰§è¡Œå”¤é†’æ“ä½œ</span></span>
<span class="line"><span>        if (leader == null &amp;&amp; q.peek() != null)</span></span>
<span class="line"><span>            available.signal();</span></span>
<span class="line"><span>        lock.unlock();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>è€Œtakeæ–¹æ³•ï¼Œä¼šè°ƒç”¨await()ï¼Œä¸€è‡´é˜»å¡ï¼Œç›´åˆ°æ‹¿åˆ°æ•°æ®ã€‚</p><p>ä¸poll(time,unit)çš„åŒºåˆ«æ˜¯ï¼Œpoll(time,unit)ä¼šè®¡ç®—å‰©ä½™é¢çš„é˜»å¡æ—¶é—´ï¼Œtakeä¸ä¼šã€‚</p><hr><p>é¦–å…ˆçŸ¥é“äº†DelayQueueå¦‚ä½•ç”¨ä»£ç å®ç°ï¼Œé¦–å…ˆèŠ‚ç‚¹å°±æ˜¯ä»»åŠ¡å¿…é¡»å®ç°Delayedæ¥å£ï¼Œé‡å†™ä»»åŠ¡å‡ºé˜Ÿçš„æ—¶é—´(getDelay)ä»¥åŠä»»åŠ¡çš„æ’åºæ–¹å¼(compareTo)</p><p>å…¥é˜Ÿï¼šå…¥é˜Ÿåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯offerï¼Œå› ä¸ºDelayQueueæ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œæ‰€ä»¥ç”Ÿäº§è€…æ˜¯ä¸éœ€è¦é˜»å¡çš„</p><p>å‡ºé˜Ÿï¼š</p><ul><li><p>pollï¼šç›´æ¥æ‹¿å †é¡¶æ•°æ®ï¼Œå †é¡¶çš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œç›´æ¥è¿”å›ä»»åŠ¡ï¼Œå¦‚æœæ²¡åˆ°æ—¶é—´ï¼Œè¿”å›nullã€‚</p></li><li><p>poll(time,unit)ï¼š</p></li><li><p>ç›´æ¥æ‹¿å †é¡¶æ•°æ®ï¼Œ</p></li><li><p>å¦‚æœä¸ºnullï¼Œæˆ–è€…é˜»å¡æ—¶é—´å·²ç»åˆ°äº†ï¼Œç›´æ¥å‘Šè¾ï¼</p></li><li><p>å¦‚æœä¸ä¸ºnull</p></li><li><p>å¹¶ä¸”å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œè¿”å›æ•°æ®</p></li><li><p>å¦‚æœæ•°æ®æ—¶é—´æ²¡åˆ°ï¼ŒæŸ¥çœ‹é˜»å¡å‰©ä½™çš„æ—¶é—´åˆ°äº†ä¹ˆï¼Œåˆ°äº†ç›´æ¥è¿”å›null</p></li><li><p>å¦‚æœæ•°æ®çš„å»¶è¿Ÿæ—¶é—´æ²¡åˆ°</p></li><li><p>å¦‚æœé˜»å¡æ—¶é—´å°äºå»¶è¿Ÿæ—¶é—´ï¼Œæˆ–è€…å·²ç»æœ‰leaderäº†ï¼Œç›´æ¥ç­‰å¾…é˜»å¡æ—¶é—´ï¼Œç­‰å¾…è¢«å”¤é†’å³å¯</p></li><li><p>å½“å‰é˜»å¡æ—¶é—´å¤§äºç­‰äºå»¶è¿Ÿæ—¶é—´ï¼Œå¹¶ä¸”leaderä¸ºnullï¼Œè¿™æ˜¯å°±é˜»å¡å»¶è¿Ÿæ—¶é—´å³å¯</p></li></ul><h3 id="äºŒã€synchronousqueue" tabindex="-1">äºŒã€SynchronousQueue <a class="header-anchor" href="#äºŒã€synchronousqueue" aria-label="Permalink to &quot;äºŒã€SynchronousQueue&quot;">â€‹</a></h3><h4 id="_2-1-ä»‹ç»-åº”ç”¨" tabindex="-1">2.1 ä»‹ç»&amp;åº”ç”¨ <a class="header-anchor" href="#_2-1-ä»‹ç»-åº”ç”¨" aria-label="Permalink to &quot;2.1 ä»‹ç»&amp;åº”ç”¨&quot;">â€‹</a></h4><p>SynchronousQueueå’Œå…¶ä»–é˜»å¡é˜Ÿåˆ—æœ‰ç‚¹åŒºåˆ«ï¼Œä½†æ˜¯ä¹Ÿæ˜¯é˜»å¡çš„ï¼</p><p>SynchronousQueueå¹¶ä¸å­˜å‚¨æ•°æ®ï¼Œé˜Ÿåˆ—çš„é•¿åº¦æ˜¯0ï¼Œä¸€ä¸ªç”Ÿäº§è€…æ‰”æ•°æ®åˆ°SynchronousQueueåï¼Œå¿…é¡»ç­‰å¾…æ¶ˆè´¹è€…æ‹¿èµ°è¿™ä¸ªæ•°æ®æ‰å¯ä»¥ã€‚</p><p>è·ŸExchangerå¾ˆåƒï¼ŒExchangeræ˜¯ä¸¤ä¸ªçº¿ç¨‹äº¤æ¢æ•°æ®ï¼ŒSynchronousQueueæ˜¯ä¼ é€’æ•°æ®ï¼Œä¸æ˜¯äº¤æ¢</p><p>åº”ç”¨çš„æ–¹å‘æ˜¯çº¿ç¨‹é—´çš„é€šè®¯ï¼Œå¯ä»¥ä½¿ç”¨ã€‚</p><p>ä½¿ç”¨çš„æ–¹æ³•ï¼š</p><p>offer()ï¼šæ‹¿ç€æ•°æ®åˆ°äº†SynchronousQueueï¼Œå¦‚æœæ°å·§æœ‰æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ‹¿æ•°æ®ï¼Œé…å¯¹æˆåŠŸï¼</p><p>offer(time,unit)ï¼šç€æ•°æ®åˆ°äº†SynchronousQueueï¼Œå¯ä»¥ç­‰ä¸€ä¼šï¼Œå¦‚æœæœŸé—´æœ‰æ¶ˆè´¹è€…æ¥äº†ï¼Œé…å¯¹æˆåŠŸï¼</p><p>put()ï¼šç€æ•°æ®åˆ°äº†SynchronousQueueï¼Œæ­»ç­‰ï¼Œç›´åˆ°æ¶ˆè´¹è€…æ¥äº†ï¼Œæˆ–è€…è¢«ä¸­æ–­äº†ã€‚</p><p>pollï¼Œpoll(time,unit)ï¼Œtakeï¼Œä½ æ‡‚å¾—ï¼</p><p>æµ…å°ä¸€ä¸‹</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws InterruptedException {</span></span>
<span class="line"><span>    SynchronousQueue queue = new SynchronousQueue();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    new  Thread(() -&gt; {</span></span>
<span class="line"><span>        User user = new User();</span></span>
<span class="line"><span>        user.setName(&quot;jack&amp;rose&quot;);</span></span>
<span class="line"><span>        System.out.println(&quot;publisherï¼š&quot; + user);</span></span>
<span class="line"><span>        queue.offer(user);</span></span>
<span class="line"><span>    }).start();</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    new Thread(() -&gt; {</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            Object user = queue.take();</span></span>
<span class="line"><span>            System.out.println(&quot;consumerï¼š&quot; + user);</span></span>
<span class="line"><span>        } catch (InterruptedException e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }).start();</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_2-1-æ ¸å¿ƒå†…å®¹" tabindex="-1">2.1 æ ¸å¿ƒå†…å®¹ <a class="header-anchor" href="#_2-1-æ ¸å¿ƒå†…å®¹" aria-label="Permalink to &quot;2.1 æ ¸å¿ƒå†…å®¹&quot;">â€‹</a></h4><p>é¦–å…ˆæƒ³è¦æŒæ¡SynchronousQueueï¼Œå¿…é¡»äº†è§£Transfererã€‚</p><p>å› ä¸ºSynchronousQueueæ— è®ºæ˜¯æ¶ˆè´¹è€…è¿˜æ˜¯ç”Ÿäº§è€…ï¼Œéƒ½ç”¨åˆ°äº†Transfererä¸­çš„transferæ–¹æ³•</p><p>ç”Ÿäº§è€…è°ƒç”¨transferæ–¹æ³•ï¼Œéœ€è¦ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ•°æ®</p><p>æ¶ˆè´¹è€…è°ƒç”¨transferæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ä¸ºnullï¼Œä»£è¡¨è·å–æ•°æ®</p><p>Transfereræœ‰ä¸¤ä¸ªå®ç°ï¼Œåˆ†åˆ«å¯¹åº”äº†SynchronousQueueçš„å…¬å¹³æ“ä½œå’Œä¸å…¬å¹³æ“ä½œ</p><ul><li><p>TransferQueueä»£è¡¨å…¬å¹³å¤„ç†æ–¹å¼</p></li><li><p>TransferStackä»£è¡¨ä¸å…¬å¹³å¤„ç†æ–¹å¼</p></li></ul><p>æŸ¥çœ‹TransferQueueå†…éƒ¨çš„å®ç°ï¼ŒæŸ¥çœ‹æ ¸å¿ƒå±æ€§</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>//è¿™ä¸ªæ˜¯ TransferQueue ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹</span></span>
<span class="line"><span>static final class QNode {</span></span>
<span class="line"><span>    volatile QNode next;   </span></span>
<span class="line"><span>    volatile Object item;   </span></span>
<span class="line"><span>    // å¦‚æœæ‰§è¡Œäº†putã€takeæ–¹æ³•æ—¶ï¼Œéœ€è¦æŒ‚èµ·çº¿ç¨‹ï¼Œè€ŒæŒ‚èµ·çš„å°±æ˜¯è¿™ä¸ªçº¿ç¨‹</span></span>
<span class="line"><span>    volatile Thread waiter;   </span></span>
<span class="line"><span>    // trueï¼šç”Ÿäº§è€…</span></span>
<span class="line"><span>    // falseï¼šæ¶ˆè´¹è€…</span></span>
<span class="line"><span>    final boolean isData;</span></span>
<span class="line"><span>}   </span></span>
<span class="line"><span>/** Head of queue */</span></span>
<span class="line"><span>transient volatile QNode head;</span></span>
<span class="line"><span>/** Tail of queue */</span></span>
<span class="line"><span>transient volatile QNode tail;</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æ— å‚æ„é€ </span></span>
<span class="line"><span>TransferQueue() {</span></span>
<span class="line"><span>    // ä¼šå…ˆåˆå§‹åŒ–ä¸€ä¸ªQNodeï¼Œä½œä¸ºheadå’Œtailçš„æŒ‡å‘ï¼Œå¹¶ä¸”è¿™ä¸ªQNodeä¸åŒ…å«çº¿ç¨‹ä¿¡æ¯ï¼Œå°±ä¸€ä¸ªä¼ªçš„å¤´ç»“ç‚¹</span></span>
<span class="line"><span>    QNode h = new QNode(null, false); // initialize to dummy node.</span></span>
<span class="line"><span>    head = h;</span></span>
<span class="line"><span>    tail = h;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_2-3-ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ‰§è¡Œå¥—è·¯" tabindex="-1">2.3 ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ‰§è¡Œå¥—è·¯ <a class="header-anchor" href="#_2-3-ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ‰§è¡Œå¥—è·¯" aria-label="Permalink to &quot;2.3 ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ‰§è¡Œå¥—è·¯&quot;">â€‹</a></h4><p>ç”Ÿäº§è€…ï¼šæ‰§è¡Œtransferæ–¹æ³•æ—¶ï¼Œä¼šä¼ é€’å€¼</p><ul><li><p>offerï¼šä¼ é€’çš„nacosä¸º0</p></li><li><p>offeræµ…ç­‰ï¼šä¼ é€’çš„nacosæ˜¯æŒ‡å®šæ•°å€¼</p></li><li><p>putï¼štimedè®¾ç½®ä¸ºfalse</p></li></ul><p>æ¶ˆè´¹è€…ï¼šæ‰§è¡Œtransferæ–¹æ³•æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè®¾ç½®ä¸ºnull</p><ul><li>pollï¼Œpollæµ…ç­‰ï¼Œtakeæ–¹æ³•ä¸ç”Ÿäº§è€…ä¸€è‡´ã€‚</li></ul><p>åˆ†æTransferQueueçš„transferæ–¹æ³•</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæˆ¿</span></span>
<span class="line"><span>E transfer(E e, boolean timed, long nanos) {</span></span>
<span class="line"><span>    // å£°æ˜QNode</span></span>
<span class="line"><span>    QNode s = null; </span></span>
<span class="line"><span>    // åˆ¤æ–­å½“å‰æ“ä½œçš„æ˜¯æ¶ˆè´¹è€…è¿˜æ˜¯ç”Ÿäº§è€…</span></span>
<span class="line"><span>    // trueï¼šç”Ÿ</span></span>
<span class="line"><span>    // falseï¼šæ¶ˆ</span></span>
<span class="line"><span>    boolean isData = (e != null);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        // æ‹¿åˆ°å¤´å°¾èŠ‚ç‚¹</span></span>
<span class="line"><span>        QNode t = tail;</span></span>
<span class="line"><span>        QNode h = head;</span></span>
<span class="line"><span>        // å¥å£®æ€§åˆ¤æ–­</span></span>
<span class="line"><span>        if (t == null || h == null)   </span></span>
<span class="line"><span>            continue;   </span></span>
<span class="line"><span>        // å¦‚æœå¤´å’Œå°¾ç›¸ç­‰ã€‚</span></span>
<span class="line"><span>        // åœ¨å½“å‰çš„QNodeå•å‘é“¾è¡¨ä¸­ï¼Œè¦ä¹ˆéƒ½å­˜æ”¾ç”Ÿäº§è€…ï¼Œè¦ä¹ˆéƒ½å­˜æ”¾æ¶ˆè´¹è€…ã€‚</span></span>
<span class="line"><span>        // æ‰€ä»¥ç¬¬äºŒä¸ªåˆ¤æ–­æ˜¯ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æœ‰Qnodeï¼ŒæŸ¥çœ‹æˆ‘å½“å‰çš„isDataæ˜¯å¦å’Œé˜Ÿåˆ—ä¸­Qnodeçš„isDataä¸€è‡´ï¼Œä¸€è‡´æŒ‚ä¸Šå»</span></span>
<span class="line"><span>        if (h == t || t.isData == isData) { </span></span>
<span class="line"><span>            // æ‹¿åˆ°t.next</span></span>
<span class="line"><span>            QNode tn = t.next;</span></span>
<span class="line"><span>            // --------------------é¿å…å¹¶å‘-----------------------------</span></span>
<span class="line"><span>            // å‡ºç°äº†å¹¶å‘æ“ä½œï¼Œé‡æ–°æ‰§è¡Œforå¾ªç¯</span></span>
<span class="line"><span>            if (t != tail)  </span></span>
<span class="line"><span>                continue;</span></span>
<span class="line"><span>            // å¦‚æœå°¾èŠ‚ç‚¹çš„nextä¸ä¸ºnullï¼Œæœ‰å¹¶å‘æƒ…å†µ</span></span>
<span class="line"><span>            if (tn != null) {   </span></span>
<span class="line"><span>                // ç›´æ¥CASæ“ä½œï¼Œå°†tailçš„nextèŠ‚ç‚¹è®¾ç½®ä¸ºtailèŠ‚ç‚¹  </span></span>
<span class="line"><span>                advanceTail(t, tn);</span></span>
<span class="line"><span>                // é‡æ–°æ‰§è¡Œforå¾ªç¯</span></span>
<span class="line"><span>                continue;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // timed == trueï¼š offerï¼Œpoll</span></span>
<span class="line"><span>            // è¿›æ¥ä¹‹åæ²¡æœ‰ç«‹å³é…å¯¹ï¼Œé‚£å°±ç›´æ¥å‘Šè¾ï¼</span></span>
<span class="line"><span>            if (timed &amp;&amp; nanos &lt;= 0)  </span></span>
<span class="line"><span>                return null;</span></span>
<span class="line"><span>            // æŠŠå½“å‰çš„QNodeåˆå§‹åŒ–ã€‚</span></span>
<span class="line"><span>            if (s == null)</span></span>
<span class="line"><span>                s = new QNode(e, isData);</span></span>
<span class="line"><span>            // å°†tailçš„nextæŒ‡å‘çš„å½“å‰QNode</span></span>
<span class="line"><span>            if (!t.casNext(null, s))  </span></span>
<span class="line"><span>                continue;</span></span>
<span class="line"><span>            // å°†tailæŒ‡å‘å½“å‰Qnode</span></span>
<span class="line"><span>            advanceTail(t, s);  </span></span>
<span class="line"><span>            // ç­‰ï¼ï¼ï¼ï¼ˆæŒ‚èµ·çº¿ç¨‹ï¼‰ï¼Œç›´åˆ°è¢«å”¤é†’ï¼Œæ‹¿åˆ°æŒ‡å®šçš„itemæ•°æ®</span></span>
<span class="line"><span>            Object x = awaitFulfill(s, e, timed, nanos);</span></span>
<span class="line"><span>            // æ‹¿åˆ°çš„æ•°æ®å’Œå½“å‰QNodeä¸€è‡´ï¼Œå½“å‰èŠ‚ç‚¹å–æ¶ˆäº†</span></span>
<span class="line"><span>            if (x == s) {  </span></span>
<span class="line"><span>                // æ¸…é™¤å½“å‰èŠ‚ç‚¹ï¼Œå‘Šè¾ï¼ï¼ï¼   </span></span>
<span class="line"><span>                clean(t, s);</span></span>
<span class="line"><span>                return null;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // åˆ¤æ–­æ˜¯å¦è¿˜åœ¨é˜Ÿåˆ—ä¸­</span></span>
<span class="line"><span>            if (!s.isOffList()) {  </span></span>
<span class="line"><span>                // å°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºæ–°çš„head</span></span>
<span class="line"><span>                advanceHead(t, s);  </span></span>
<span class="line"><span>                if (x != null)  </span></span>
<span class="line"><span>                    // æˆ‘æ‹¿åˆ°æ•°æ®äº†ï¼Œè®¾ç½®itemä¸ºå½“å‰èŠ‚ç‚¹å¯¹è±¡</span></span>
<span class="line"><span>                    s.item = s;</span></span>
<span class="line"><span>                // çº¿ç¨‹ç½®ä½null</span></span>
<span class="line"><span>                s.waiter = null;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // è¿”å›æ•°æ®</span></span>
<span class="line"><span>            return (x != null) ? (E)x : e;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        } else {   </span></span>
<span class="line"><span>            // å¦‚æœé€»è¾‘åˆ°è¿™ï¼Œéœ€è¦è·Ÿé˜Ÿåˆ—ä¸­çš„Qnodeåšé…å¯¹ã€‚</span></span>
<span class="line"><span>            // æ‹¿åˆ°headçš„nextï¼Œm</span></span>
<span class="line"><span>            QNode m = h.next;   </span></span>
<span class="line"><span>            // å¹¶å‘é—®é¢˜ï¼Œé‡æ–°å¾ªç¯</span></span>
<span class="line"><span>            if (t != tail || m == null || h != head)</span></span>
<span class="line"><span>                continue;  </span></span>
<span class="line"><span>            // æ‹¿åˆ°mä¸­çš„æ•°æ®ã€‚</span></span>
<span class="line"><span>            // x == nullï¼šé˜Ÿåˆ—æ˜¯æ¶ˆè´¹è€…</span></span>
<span class="line"><span>            // x != nullï¼šé˜Ÿåˆ—æ˜¯ç”Ÿäº§è€…</span></span>
<span class="line"><span>            Object x = m.item;</span></span>
<span class="line"><span>            // 1ã€å‡ºç°å¹¶å‘é—®é¢˜ï¼Œè£…è½¦äº†</span></span>
<span class="line"><span>            // 2ã€å–å‡ºçš„æ•°æ®ï¼Œç«Ÿç„¶æ˜¯èŠ‚ç‚¹æœ¬èº«ï¼Œä»£è¡¨èŠ‚ç‚¹è¢«å–æ¶ˆï¼</span></span>
<span class="line"><span>            // 3ã€å¼€å§‹äº¤æ¢æ•°æ®ï¼Œå°†å½“å‰æ–¹æ³•ä¼ å…¥æ•°æ®ï¼Œæ›¿æ¢åˆ°headçš„nextï¼Œå¦‚æœæ“ä½œå¤±è´¥ï¼Œå¹¶å‘é—®é¢˜</span></span>
<span class="line"><span>            if (isData == (x != null) ||  x == m || !m.casItem(x, e)) {  </span></span>
<span class="line"><span>                // é…å¯¹å¤±è´¥ï¼Œé‡æ–°æ›¿æ¢headèŠ‚ç‚¹   </span></span>
<span class="line"><span>                advanceHead(h, m);  </span></span>
<span class="line"><span>                // é‡æ–°forå¾ªç¯  </span></span>
<span class="line"><span>                continue;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // æ“ä½œæˆåŠŸï¼Œä¹Ÿè¦æ›¿æ¢head</span></span>
<span class="line"><span>            advanceHead(h, m);  </span></span>
<span class="line"><span>            // å”¤é†’é˜Ÿåˆ—ä¸­çš„headçš„nextèŠ‚ç‚¹çš„çº¿ç¨‹ã€‚   </span></span>
<span class="line"><span>            LockSupport.unpark(m.waiter);</span></span>
<span class="line"><span>            // æ“ä½œæˆåŠŸï¼Œè¿”å›æ•°æ®ï¼</span></span>
<span class="line"><span>            return (x != null) ? (E)x : e;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h1 id="åã€scheduledthreadpoolexecutor" tabindex="-1">åã€<strong>ScheduledThreadPoolExecutor</strong> <a class="header-anchor" href="#åã€scheduledthreadpoolexecutor" aria-label="Permalink to &quot;åã€**ScheduledThreadPoolExecutor**&quot;">â€‹</a></h1><h3 id="ä¸€ã€scheduledthreadpoolexecutorä»‹ç»-åº”ç”¨" tabindex="-1">ä¸€ã€ScheduledThreadPoolExecutorä»‹ç»&amp;åº”ç”¨ <a class="header-anchor" href="#ä¸€ã€scheduledthreadpoolexecutorä»‹ç»-åº”ç”¨" aria-label="Permalink to &quot;ä¸€ã€ScheduledThreadPoolExecutorä»‹ç»&amp;åº”ç”¨&quot;">â€‹</a></h3><p>ScheduledThreadPoolExecutoræ˜¯ThreadPoolExecutorçš„ä¸€ä¸ªå­ç±»ï¼Œåœ¨çº¿ç¨‹æ± çš„åŸºç¡€ä¸Šå®ç°äº†å»¶è¿Ÿæ‰§è¡Œä»»åŠ¡ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ã€‚</p><p>Javaæœ€æ—©æä¾›çš„æ˜¯Timerç±»æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œä¸²è¡Œçš„ï¼Œä¸é è°±ï¼Œä¼šå½±å“åˆ°å…¶ä»–çš„ä»»åŠ¡æ‰§è¡Œï¼Œåœ¨ä¸é‡‡ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶æ—¶ï¼Œéœ€è¦æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼ŒScheduledThreadPoolExecutoræ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚</p><p>ScheduledThreadPoolExecutorå°±æ˜¯åœ¨çº¿ç¨‹æ± çš„åŸºç¡€ä¸Šå®ç°çš„å®šæ—¶æ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ã€‚</p><p>ScheduledThreadPoolExecutoræä¾›äº†æ¯”è¾ƒå¸¸ç”¨çš„å››ç§æ–¹æ³•æ‰§è¡Œä»»åŠ¡ï¼šï¼ˆä¸è¯´Callableï¼‰</p><ul><li><p>executeï¼šè·Ÿæ™®é€šçº¿ç¨‹æ± æ‰§è¡Œæ²¡åŒºåˆ«ã€‚</p></li><li><p>scheduleï¼šå¯ä»¥æŒ‡å®šå»¶è¿Ÿæ—¶é—´ï¼Œä¸€æ¬¡æ€§æ‰§è¡Œä»»åŠ¡ã€‚</p></li><li><p>scheduleAtFixedRateï¼šå¯ä»¥è®©ä»»åŠ¡åœ¨å›ºå®šçš„å‘¨æœŸä¸‹æ‰§è¡Œã€‚ï¼ˆä»»åŠ¡çš„å¤„ç†æ—¶é—´ï¼Œä¸å½±å“ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œå¦‚æœä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†è®¾ç½®çš„å»¶è¿Ÿæ—¶é—´ï¼ŒæŒ‰ç…§æ—¶é—´æœ€é•¿çš„è®¡ç®—ï¼‰</p></li><li><p>scheduleWithFixedDelayï¼šå¯ä»¥è®©ä»»åŠ¡åœ¨å›ºå®šçš„å‘¨æœŸä¸‹æ‰§è¡Œã€‚ï¼ˆä»»åŠ¡çš„å¤„ç†æ—¶é—´ï¼Œå½±å“ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼‰</p></li></ul><p>åº”ç”¨æ•ˆæœï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws InterruptedException {</span></span>
<span class="line"><span>    ScheduledThreadPoolExecutor executor = new ScheduledThreadPoolExecutor(10);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //1. execute</span></span>
<span class="line"><span>    executor.execute(() -&gt; {</span></span>
<span class="line"><span>        System.out.println(&quot;execute&quot;);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //2. schedule</span></span>
<span class="line"><span>    executor.schedule(() -&gt; {</span></span>
<span class="line"><span>        System.out.println(&quot;schedule&quot;);</span></span>
<span class="line"><span>    },2000,TimeUnit.MILLISECONDS);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //3. AtFixedRate</span></span>
<span class="line"><span>    executor.scheduleAtFixedRate(() -&gt; {</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            Thread.sleep(4000);</span></span>
<span class="line"><span>        } catch (InterruptedException e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        System.out.println(&quot;at:&quot; + System.currentTimeMillis());</span></span>
<span class="line"><span>    },3000,2000,TimeUnit.MILLISECONDS);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    //4. WithFixedDelay</span></span>
<span class="line"><span>    executor.scheduleWithFixedDelay(() -&gt; {</span></span>
<span class="line"><span>        try {</span></span>
<span class="line"><span>            Thread.sleep(5000);</span></span>
<span class="line"><span>        } catch (InterruptedException e) {</span></span>
<span class="line"><span>            e.printStackTrace();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        System.out.println(&quot;with:&quot; + System.currentTimeMillis());</span></span>
<span class="line"><span>    },3000,2000,TimeUnit.MILLISECONDS);</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>å¦‚æœå®é™…å¼€å‘åº”ç”¨éœ€è¦ä½¿ç”¨åˆ°å®šäººä»»åŠ¡ï¼Œæ›´æ¨èä¸€äº›å¼€æºä½ çš„æ¡†æ¶ï¼Œæ¯”å¦‚Quartzï¼ŒXXL-jobï¼ŒElastic-Job</p><p>å› ä¸ºcornè¡¨è¾¾å¼ï¼Œå¯¹æ—¶é—´çš„æ§åˆ¶æ›´åŠ æ–¹ä¾¿ï¼</p><h3 id="äºŒã€schedulethreadpoolexecutoråº•å±‚ç»“æ„" tabindex="-1">äºŒã€ScheduleThreadPoolExecutoråº•å±‚ç»“æ„ <a class="header-anchor" href="#äºŒã€schedulethreadpoolexecutoråº•å±‚ç»“æ„" aria-label="Permalink to &quot;äºŒã€ScheduleThreadPoolExecutoråº•å±‚ç»“æ„&quot;">â€‹</a></h3><p>ä¸¤ä¸ªæ ¸å¿ƒå†…å®¹</p><h4 id="_2-1-scheduledfuturetask" tabindex="-1">2.1 ScheduledFutureTask <a class="header-anchor" href="#_2-1-scheduledfuturetask" aria-label="Permalink to &quot;2.1 ScheduledFutureTask&quot;">â€‹</a></h4><p>é¦–å…ˆçœ‹åˆ°äº†æ ¸å¿ƒå†…å®¹ï¼ŒScheduledFutureTaské—´æ¥çš„å®ç°äº†Delayedæ¥å£ï¼Œè®©ä»»åŠ¡å¯ä»¥æ”¾åˆ°å»¶è¿Ÿé˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”åŸºäºäºŒå‰å †åšæ’åºï¼Œå³å°†æ‰§è¡Œçš„æ—¶é—´è¶ŠçŸ­ï¼Œå°±å¾€å †é¡¶æ‰”ï¼ŒæŸ¥çœ‹æ ¸å¿ƒå†…å®¹</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>private class ScheduledFutureTask&lt;V&gt;</span></span>
<span class="line"><span>        extends FutureTask&lt;V&gt; implements RunnableScheduledFuture&lt;V&gt; {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // å°±æ˜¯è®¡æ•°å™¨ï¼Œæ¯ä¸ªä»»åŠ¡è¿›æ¥æ—¶ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„åºå·ã€‚</span></span>
<span class="line"><span>    // å¦‚æœä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¸€æ¨¡ä¸€æ ·ï¼Œæ¯”å¯¹sequenceNumber</span></span>
<span class="line"><span>    private final long sequenceNumber;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ï¼Œå•ä½æ˜¯çº³ç§’</span></span>
<span class="line"><span>    private long time;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /*</span></span>
<span class="line"><span>     * period == 0ï¼šè¡¨ç¤ºä¸€æ¬¡æ€§æ‰§è¡Œçš„ä»»åŠ¡</span></span>
<span class="line"><span>     * period &gt; 0ï¼šè¡¨ç¤ºä½¿ç”¨çš„æ˜¯Atï¼</span></span>
<span class="line"><span>     * period &lt; 0ï¼šè¡¨ç¤ºä½¿ç”¨çš„æ˜¯Withï¼</span></span>
<span class="line"><span>     */</span></span>
<span class="line"><span>    private final long period;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // å‘¨æœŸæ€§å®è¡Œä»»åŠ¡æ—¶ï¼Œå¼•ç”¨å…·ä½“ä»»åŠ¡ï¼Œæ–¹ä¾¿åé¢é‡æ–°æ‰”åˆ°é˜»å¡é˜Ÿåˆ—</span></span>
<span class="line"><span>    RunnableScheduledFuture&lt;V&gt; outerTask = this;</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // æœ‰å‚æ„é€ ã€‚scheduleæ—¶ä½¿ç”¨å½“å‰æœ‰å‚é‡è½½å°è£…ä»»åŠ¡ï¼</span></span>
<span class="line"><span>    ScheduledFutureTask(Runnable r, V result, long ns) {</span></span>
<span class="line"><span>        super(r, result);</span></span>
<span class="line"><span>        this.time = ns;</span></span>
<span class="line"><span>        this.period = 0;</span></span>
<span class="line"><span>        this.sequenceNumber = sequencer.getAndIncrement();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // At,Withæ—¶ï¼Œä½¿ç”¨å½“å‰æœ‰å‚é‡è½½å°è£…ä»»åŠ¡ï¼</span></span>
<span class="line"><span>    ScheduledFutureTask(Runnable r, V result, long ns, long period) {</span></span>
<span class="line"><span>        super(r, result);</span></span>
<span class="line"><span>        this.time = ns;</span></span>
<span class="line"><span>        this.period = period;</span></span>
<span class="line"><span>        this.sequenceNumber = sequencer.getAndIncrement();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // ä¸è€ƒè™‘è¿™ä¸ªï¼Œæœ‰è¿”å›ç»“æœ</span></span>
<span class="line"><span>    ScheduledFutureTask(Callable&lt;V&gt; callable, long ns) {</span></span>
<span class="line"><span>        super(callable);</span></span>
<span class="line"><span>        this.time = ns;</span></span>
<span class="line"><span>        this.period = 0;</span></span>
<span class="line"><span>        this.sequenceNumber = sequencer.getAndIncrement();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // å®ç°Delayedæ¥å£é‡å†™çš„æ–¹æ³•ï¼Œæ‰§è¡Œçš„æ—¶é—´</span></span>
<span class="line"><span>    public long getDelay(TimeUnit unit) {</span></span>
<span class="line"><span>        return unit.convert(time - now(), NANOSECONDS);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // å®ç°Delayedæ¥å£é‡å†™çš„æ–¹æ³•ï¼Œæ¯”è¾ƒçš„æ–¹å¼ï¼Œæ”¾åœ¨äºŒå‰å †å†…éƒ¨</span></span>
<span class="line"><span>    public int compareTo(Delayed other) {</span></span>
<span class="line"><span>        if (other == this) // compare zero if same object</span></span>
<span class="line"><span>            return 0;</span></span>
<span class="line"><span>        if (other instanceof ScheduledFutureTask) {</span></span>
<span class="line"><span>            ScheduledFutureTask&lt;?&gt; x = (ScheduledFutureTask&lt;?&gt;)other;</span></span>
<span class="line"><span>            long diff = time - x.time;</span></span>
<span class="line"><span>            if (diff &lt; 0)</span></span>
<span class="line"><span>                return -1;</span></span>
<span class="line"><span>            else if (diff &gt; 0)</span></span>
<span class="line"><span>                return 1;</span></span>
<span class="line"><span>            else if (sequenceNumber &lt; x.sequenceNumber)</span></span>
<span class="line"><span>                return -1;</span></span>
<span class="line"><span>            else</span></span>
<span class="line"><span>                return 1;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        long diff = getDelay(NANOSECONDS) - other.getDelay(NANOSECONDS);</span></span>
<span class="line"><span>        return (diff &lt; 0) ? -1 : (diff &gt; 0) ? 1 : 0;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // åˆ¤æ–­æ˜¯å¦æ˜¯å‘¨æœŸæ‰§è¡Œ</span></span>
<span class="line"><span>    public boolean isPeriodic() {</span></span>
<span class="line"><span>        return period != 0;</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // çœç•¥éƒ¨åˆ†ä»£ç </span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_2-2-delayedworkqueue" tabindex="-1">2.2 DelayedWorkQueue <a class="header-anchor" href="#_2-2-delayedworkqueue" aria-label="Permalink to &quot;2.2 DelayedWorkQueue&quot;">â€‹</a></h4><p>é˜¿å·´é˜¿å·´ï¼ï¼ï¼ï¼</p><h3 id="ä¸‰ã€executeæ–¹æ³•åˆ†æ" tabindex="-1">ä¸‰ã€executeæ–¹æ³•åˆ†æ <a class="header-anchor" href="#ä¸‰ã€executeæ–¹æ³•åˆ†æ" aria-label="Permalink to &quot;ä¸‰ã€executeæ–¹æ³•åˆ†æ&quot;">â€‹</a></h3><p>è¿™ä¸ªæ–¹æ³•æ˜¯ç™½ç»™çš„ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public void execute(Runnable command) {</span></span>
<span class="line"><span>    schedule(command, 0, NANOSECONDS);</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æŸ¥çœ‹scheduleå³å¯</p><h3 id="å››ã€scheduleæ–¹æ³•åˆ†æ" tabindex="-1">å››ã€scheduleæ–¹æ³•åˆ†æ <a class="header-anchor" href="#å››ã€scheduleæ–¹æ³•åˆ†æ" aria-label="Permalink to &quot;å››ã€scheduleæ–¹æ³•åˆ†æ&quot;">â€‹</a></h3><p><strong>å°è£…ä»»åŠ¡-æ”¾å»¶è¿Ÿé˜Ÿåˆ—-åˆ›å»ºçº¿ç¨‹å‡†å¤‡æ‰§è¡Œ</strong></p><p>å°†ä¼ å…¥çš„commandä»»åŠ¡å’Œå»¶è¿Ÿæ‰§è¡Œçš„æ—¶é—´å°è£…</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// åˆ†æå®šæ—¶ä»»åŠ¡çº¿ç¨‹çš„scheduleï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´ï¼Œæ‰§è¡Œä¸€æ¬¡commandä»»åŠ¡</span></span>
<span class="line"><span>public ScheduledFuture&lt;?&gt; schedule(Runnable command, long delay,TimeUnit unit) {</span></span>
<span class="line"><span>    // éç©ºåˆ¤æ–­ï¼</span></span>
<span class="line"><span>    if (command == null || unit == null)</span></span>
<span class="line"><span>        throw new NullPointerException();</span></span>
<span class="line"><span>    // å°è£…ä»»åŠ¡ï¼Œå°†æ™®é€šçš„commandå°ä½ä¸ºScheduledFutureTaskã€</span></span>
<span class="line"><span>    // decorateTaskæ–¹æ³•é»˜è®¤æƒ…å†µä¸‹ï¼Œä»€ä¹ˆéƒ½æ²¡åšï¼Œå°±æ˜¯è¿”å›äº†ScheduledFutureTask</span></span>
<span class="line"><span>    // decorateTaskæ–¹æ³•æ˜¯çº¿ç¨‹æ± ç»™ä½ æä¾›çš„æ‰©å±•æ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™ä¸ªä½ç½®ä¿®æ”¹ä»»åŠ¡éœ€è¦æ‰§è¡Œçš„å…·ä½“ç»†èŠ‚</span></span>
<span class="line"><span>    RunnableScheduledFuture&lt;?&gt; t = decorateTask(command,new ScheduledFutureTask&lt;Void&gt;(command, null,triggerTime(delay, unit)));</span></span>
<span class="line"><span>    // å»¶è¿Ÿæ‰§è¡Œ</span></span>
<span class="line"><span>    delayedExecute(t);</span></span>
<span class="line"><span>    return t;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æŸ¥çœ‹triggerTime</span></span>
<span class="line"><span>private long triggerTime(long delay, TimeUnit unit) {</span></span>
<span class="line"><span>    return triggerTime(unit.toNanos((delay &lt; 0) ? 0 : delay));</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>// æŸ¥çœ‹triggerTimeæ–¹æ³•é‡è½½ï¼Œè¿”å›å½“å‰ä»»åŠ¡è¦æ‰§è¡Œçš„ç³»ç»Ÿæ—¶é—´ã€‚</span></span>
<span class="line"><span>long triggerTime(long delay) {</span></span>
<span class="line"><span>    // åˆ¤æ–­delayæ—¶é—´æ˜¯å¦å°äºLong.MAX_VALUE &gt;&gt; 1ï¼Œ</span></span>
<span class="line"><span>    // å¦‚æœå°äº,æ­£å¸¸è®¡ç®—æ‰§è¡Œçš„æ—¶é—´</span></span>
<span class="line"><span>    // å¦‚æœå¤§äºï¼Œå¯èƒ½å‡ºç°è¶…è¿‡longçš„å–å€¼èŒƒå›´é—®é¢˜ï¼Œåšé¢å¤–å¤„ç†</span></span>
<span class="line"><span>    return now() + ((delay &lt; (Long.MAX_VALUE &gt;&gt; 1)) ? delay : overflowFree(delay));</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å°†commandä»»åŠ¡å°è£…ä¸ºScheduledFutureTask</span></span>
<span class="line"><span>ScheduledFutureTask(Runnable r, V result, long ns) {</span></span>
<span class="line"><span>    super(r, result);</span></span>
<span class="line"><span>    // ä»»åŠ¡è¦æ‰§è¡Œçš„ç³»ç»Ÿæ—¶é—´</span></span>
<span class="line"><span>    this.time = ns;</span></span>
<span class="line"><span>    // ä»»åŠ¡æ˜¯å¦æ˜¯å‘¨æœŸæ€§æ‰§è¡Œ</span></span>
<span class="line"><span>    this.period = 0;</span></span>
<span class="line"><span>    // åŸºäºAtomicLongè®¡ç®—åºåˆ—åŒ–ã€‚</span></span>
<span class="line"><span>    this.sequenceNumber = sequencer.getAndIncrement();</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// ScheduleThreadPoolExecutoræä¾›çš„ä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™ä¸ªä½ç½®ç»†ç²’åº¦çš„ä¿®æ”¹ä»»åŠ¡æ‰§è¡Œçš„ç»†èŠ‚ã€‚</span></span>
<span class="line"><span>protected &lt;V&gt; RunnableScheduledFuture&lt;V&gt; decorateTask(Runnable runnable, RunnableScheduledFuture&lt;V&gt; task) {</span></span>
<span class="line"><span>    return task;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// åˆ†æå®šæ—¶ä»»åŠ¡çº¿ç¨‹çš„scheduleï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´ï¼Œæ‰§è¡Œä¸€æ¬¡commandä»»åŠ¡</span></span>
<span class="line"><span>public ScheduledFuture&lt;?&gt; schedule(Runnable command, long delay,TimeUnit unit) {</span></span>
<span class="line"><span>    // éç©ºåˆ¤æ–­ï¼</span></span>
<span class="line"><span>    if (command == null || unit == null)</span></span>
<span class="line"><span>        throw new NullPointerException();</span></span>
<span class="line"><span>    // å°è£…ä»»åŠ¡ï¼Œå°†æ™®é€šçš„commandå°ä½ä¸ºScheduledFutureTaskã€</span></span>
<span class="line"><span>    // decorateTaskæ–¹æ³•é»˜è®¤æƒ…å†µä¸‹ï¼Œä»€ä¹ˆéƒ½æ²¡åšï¼Œå°±æ˜¯è¿”å›äº†ScheduledFutureTask</span></span>
<span class="line"><span>    // decorateTaskæ–¹æ³•æ˜¯çº¿ç¨‹æ± ç»™ä½ æä¾›çš„æ‰©å±•æ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™ä¸ªä½ç½®ä¿®æ”¹ä»»åŠ¡éœ€è¦æ‰§è¡Œçš„å…·ä½“ç»†èŠ‚</span></span>
<span class="line"><span>    RunnableScheduledFuture&lt;?&gt; t = decorateTask(command,new ScheduledFutureTask&lt;Void&gt;(command, null,triggerTime(delay, unit)));</span></span>
<span class="line"><span>    // å»¶è¿Ÿæ‰§è¡Œ</span></span>
<span class="line"><span>    delayedExecute(t);</span></span>
<span class="line"><span>    return t;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>// å»¶è¿Ÿæ‰§è¡Œï¼</span></span>
<span class="line"><span>private void delayedExecute(RunnableScheduledFuture&lt;?&gt; task) {</span></span>
<span class="line"><span>    // æŸ¥çœ‹çº¿ç¨‹æ± æ˜¯ä¸æ˜¯å·²ç»ä¸æ˜¯RUNNINGçŠ¶æ€</span></span>
<span class="line"><span>    if (isShutdown())</span></span>
<span class="line"><span>        // å¦‚æœæ˜¯ï¼Œæ‹’ç»ç­–ç•¥ã€‚</span></span>
<span class="line"><span>        reject(task);</span></span>
<span class="line"><span>    else {</span></span>
<span class="line"><span>        // åˆ°è¿™è¯´æ˜çº¿ç¨‹æ± çŠ¶æ€æ˜¯RUNNING</span></span>
<span class="line"><span>        // è°ƒç”¨é˜»å¡é˜Ÿåˆ—ï¼Œå°†ä»»åŠ¡æ·»åŠ è¿›å»ï¼Œå°†ä»»åŠ¡æ‰”åˆ°äº†å»¶è¿Ÿé˜Ÿåˆ—ä¸­ï¼ˆäºŒå‰å †ï¼‰</span></span>
<span class="line"><span>        // åœ¨æ·»åŠ ä»»åŠ¡åˆ°å»¶è¿Ÿé˜Ÿåˆ—çš„æ•°ç»„æ—¶ï¼Œä¼šè®°å½•å½“å‰ä»»åŠ¡æ‰€åœ¨çš„ç´¢å¼•ä½ç½®ï¼Œæ–¹ä¾¿å–æ¶ˆä»»åŠ¡æ—¶ï¼Œä»æ•°ç»„ä¸­ç§»é™¤</span></span>
<span class="line"><span>        // heapIndexæ–¹ä¾¿å–æ¶ˆä»»åŠ¡</span></span>
<span class="line"><span>        super.getQueue().add(task);</span></span>
<span class="line"><span>        // åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦ä¸æ˜¯RUNNINGçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯RUNNINGï¼Œå°±æ ¹æ®ç­–ç•¥å†³å®šä»»åŠ¡æ˜¯å¦æ‰§è¡Œ</span></span>
<span class="line"><span>        // å¦‚æœä»»åŠ¡ä¸éœ€è¦æ‰§è¡Œäº†ï¼Œè°ƒç”¨removeæ–¹æ³•ï¼Œå°†ä»»åŠ¡ä»å»¶è¿Ÿé˜Ÿåˆ—ç§»é™¤ï¼Œå¹¶ä¸”åœ¨ifå†…éƒ¨è¿˜ä¼šå–æ¶ˆä»»åŠ¡</span></span>
<span class="line"><span>        if (isShutdown() &amp;&amp; !canRunInCurrentRunState(task.isPeriodic()) &amp;&amp; remove(task))</span></span>
<span class="line"><span>            task.cancel(false);</span></span>
<span class="line"><span>        else</span></span>
<span class="line"><span>            // çº¿ç¨‹æ± çŠ¶æ€æ²¡æ¯›ç—…ï¼Œä»»åŠ¡æ˜¯éœ€è¦æ‰§è¡Œçš„ï¼</span></span>
<span class="line"><span>            ensurePrestart();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>// å¦‚æœä»»åŠ¡æ·»åŠ åˆ°äº†é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå¿½ç„¶çº¿ç¨‹æ± ä¸æ˜¯RUNNINGçŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªä»»åŠ¡æ˜¯å¦æ‰§è¡Œï¼Ÿ</span></span>
<span class="line"><span>// periodic - trueï¼šä»£è¡¨æ˜¯å‘¨æœŸæ€§æ‰§è¡Œçš„ä»»åŠ¡</span></span>
<span class="line"><span>// periodic - falseï¼šä»£è¡¨æ˜¯ä¸€æ¬¡æ€§çš„å»¶è¿Ÿä»»åŠ¡</span></span>
<span class="line"><span>boolean canRunInCurrentRunState(boolean periodic) {</span></span>
<span class="line"><span>    return isRunningOrShutdown(periodic ?</span></span>
<span class="line"><span>                               continueExistingPeriodicTasksAfterShutdown :</span></span>
<span class="line"><span>                               executeExistingDelayedTasksAfterShutdown);</span></span>
<span class="line"><span>    // é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä»»åŠ¡æ‰”åˆ°äº†å»¶è¿Ÿé˜Ÿåˆ—ä¸­ï¼Œæœ‰ä¸¤ä¸ªç­–ç•¥</span></span>
<span class="line"><span>    // å¦‚æœä»»åŠ¡æ˜¯å‘¨æœŸæ€§æ‰§è¡Œçš„ï¼Œé»˜è®¤ä¸ºfalseï¼Œ</span></span>
<span class="line"><span>    // å¦‚æœä»»åŠ¡æ˜¯ä¸€æ¬¡æ€§çš„å»¶è¿Ÿä»»åŠ¡ï¼Œé»˜è®¤ä¸ºtrue</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// åˆ¤æ–­å½“å‰ä»»åŠ¡åˆ°åº•æ‰§è¡Œä¸æ‰§è¡Œ</span></span>
<span class="line"><span>final boolean isRunningOrShutdown(boolean shutdownOK) {</span></span>
<span class="line"><span>    // é‡æ–°æ‹¿åˆ°çº¿ç¨‹æ± çš„ctl</span></span>
<span class="line"><span>    int rs = runStateOf(ctl.get());</span></span>
<span class="line"><span>    // å¦‚æœçº¿ç¨‹æ± æ˜¯RUNNINGï¼Œè¿”å›true</span></span>
<span class="line"><span>    // å¦‚æœçº¿ç¨‹æ± çŠ¶æ€æ˜¯SHUTDOWNï¼Œé‚£ä¹ˆå°±é…åˆç­–ç•¥è¿”å›trueã€false</span></span>
<span class="line"><span>    return rs == RUNNING || (rs == SHUTDOWN &amp;&amp; shutdownOK);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å‡†å¤‡æ‰§è¡Œä»»åŠ¡</span></span>
<span class="line"><span>void ensurePrestart() {</span></span>
<span class="line"><span>    // è·å–çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ä¸ªæ•°ã€‚</span></span>
<span class="line"><span>    int wc = workerCountOf(ctl.get());</span></span>
<span class="line"><span>    // å¦‚æœå·¥ä½œçº¿ç¨‹ä¸ªæ•°ï¼Œå°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œ</span></span>
<span class="line"><span>    if (wc &lt; corePoolSize)</span></span>
<span class="line"><span>        // åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œä¸€è‡´åœ¨é˜»å¡é˜Ÿåˆ—çš„ä½ç½®takeï¼Œç­‰å¾…æ‹¿ä»»åŠ¡æ‰§è¡Œ</span></span>
<span class="line"><span>        addWorker(null, true);</span></span>
<span class="line"><span>    // å¦‚æœå·¥ä½œçº¿ç¨‹æ•°ä¸å°äºæ ¸å¿ƒçº¿ç¨‹ï¼Œä½†æ˜¯å€¼ä¸º0ï¼Œåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span></span>
<span class="line"><span>    else if (wc == 0)</span></span>
<span class="line"><span>        // åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤„ç†é˜»å¡é˜Ÿåˆ—ä»»åŠ¡ï¼Œè€Œä¸”åªè¦é˜»å¡é˜Ÿåˆ—æ²¡æœ‰ä»»åŠ¡äº†ï¼Œå½“å‰çº¿ç¨‹ç«‹å³é”€æ¯</span></span>
<span class="line"><span>        addWorker(null, false);</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æŸ¥çœ‹ä»»åŠ¡æ”¾åˆ°å»¶è¿Ÿé˜Ÿåˆ—åï¼Œæ˜¯å¦‚ä½•è¢«å·¥ä½œçº¿ç¨‹å–å‡ºæ¥æ‰§è¡Œçš„</p><p>æ‰§è¡ŒaddWorkeræ–¹æ³•ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå·¥ä½œçº¿ç¨‹åœ¨åˆ›å»ºæˆåŠŸåï¼Œä¼šæ‰§è¡Œstartæ–¹æ³•ã€‚åœ¨startæ–¹æ³•æ‰§è¡Œåï¼Œä¼šè°ƒç”¨Workerçš„runæ–¹æ³•ï¼Œæœ€ç»ˆæ‰§è¡Œäº†runWorkeræ–¹æ³•ï¼Œåœ¨runWorkeræ–¹æ³•ä¸­ä¼šåœ¨é˜»å¡é˜Ÿåˆ—çš„ä½ç½®æ‰§è¡Œtakeæ–¹æ³•ä¸€ç›´é˜»å¡æ‹¿Runnableä»»åŠ¡ï¼Œæ‹¿åˆ°ä»»åŠ¡åå°±è¿”å›ï¼Œç„¶åæ‰§è¡Œã€‚</p><p>æ‰€ä»¥éœ€è¦æŸ¥çœ‹çš„å°±æ˜¯å»¶è¿Ÿé˜Ÿåˆ—çš„takeæ–¹æ³•ï¼Œå¥—è·¯å’Œä¹‹å‰è®²çš„DelayQueueæ²¡æœ‰åŒºåˆ«</p><p>åœ¨æ‹¿åˆ°ä»»åŠ¡åï¼Œä¼šæ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œä»»åŠ¡çš„runæ–¹æ³•ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// æ‰§è¡Œä»»åŠ¡</span></span>
<span class="line"><span>public void run() {</span></span>
<span class="line"><span>    // è·å–ä»»åŠ¡æ˜¯å¦æ˜¯å‘¨æœŸæ‰§è¡Œ</span></span>
<span class="line"><span>    // trueï¼šå‘¨æœŸæ‰§è¡Œ</span></span>
<span class="line"><span>    // falseï¼šä¸€æ¬¡çš„å»¶è¿Ÿæ‰§è¡Œ</span></span>
<span class="line"><span>    boolean periodic = isPeriodic();</span></span>
<span class="line"><span>    // å†æ¬¡åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦ä¸æ˜¯RUNNINGï¼Œå¦‚æœä¸æ˜¯RUNNINGï¼Œå¹¶ä¸”SHUTDOWNæƒ…å†µä¹Ÿä¸å…è®¸æ‰§è¡Œï¼Œæˆ–è€…æ˜¯STOPçŠ¶æ€</span></span>
<span class="line"><span>    if (!canRunInCurrentRunState(periodic))</span></span>
<span class="line"><span>        // å–æ¶ˆä»»åŠ¡</span></span>
<span class="line"><span>        cancel(false);</span></span>
<span class="line"><span>    else if (!periodic)</span></span>
<span class="line"><span>        // å½“å‰ä»»åŠ¡æ˜¯ä¸€æ¬¡æ€§çš„å»¶è¿Ÿæ‰§è¡Œã€‚æ‰§è¡Œä»»åŠ¡å…·ä½“çš„runæ–¹æ³•ï¼Œæ‰§è¡Œå®Œï¼Œæ²¡äº†â€¦â€¦â€¦â€¦â€¦â€¦</span></span>
<span class="line"><span>        ScheduledFutureTask.super.run();</span></span>
<span class="line"><span>    // åé¢æ˜¯å‘¨æœŸæ‰§è¡Œã€çœç•¥éƒ¨åˆ†ä»£ç â€¦â€¦â€¦â€¦</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="äº”ã€scheduleatfixedrateå’Œschedulewithfixeddelayåˆ†æ" tabindex="-1">äº”ã€scheduleAtFixedRateå’ŒscheduleWithFixedDelayåˆ†æ <a class="header-anchor" href="#äº”ã€scheduleatfixedrateå’Œschedulewithfixeddelayåˆ†æ" aria-label="Permalink to &quot;äº”ã€scheduleAtFixedRateå’ŒscheduleWithFixedDelayåˆ†æ&quot;">â€‹</a></h3><p>åœ¨æ‰§è¡Œæ–¹æ³•çš„åˆæœŸï¼Œå°è£…ä»»åŠ¡æ—¶ï¼š</p><ul><li><p>Atä¼šå°†periodè®¾ç½®ä¸ºæ­£æ•°ï¼Œä»£è¡¨å›ºå®šå‘¨æœŸæ‰§è¡Œè¡¨</p></li><li><p>Withä¼šå°†periodè®¾ç½®ä¸ºè´Ÿæ•°ï¼Œä»£è¡¨åœ¨æ‰§è¡Œä»»åŠ¡å®Œæ¯•åï¼Œå†è®¡ç®—ä¸‹æ¬¡æ‰§è¡Œçš„æ—¶é—´</p></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å›ºå®šå‘¨æœŸæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼Œè¶…è¿‡å‘¨æœŸï¼Œä»»åŠ¡æ‰§è¡Œå®Œï¼Œç«‹å³æ‰§è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡ã€‚</span></span>
<span class="line"><span>public ScheduledFuture&lt;?&gt; scheduleAtFixedRate(</span></span>
<span class="line"><span>                        Runnable command,    // å…·ä½“ä»»åŠ¡</span></span>
<span class="line"><span>                        long initialDelay,   // ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´</span></span>
<span class="line"><span>                        long period,         // å‘¨æœŸæ‰§è¡Œæ—¶é—´</span></span>
<span class="line"><span>                        TimeUnit unit) {     // æ—¶é—´å•ä½</span></span>
<span class="line"><span>    // é˜¿å·´é˜¿å·´~~~</span></span>
<span class="line"><span>    if (command == null || unit == null)</span></span>
<span class="line"><span>        throw new NullPointerException();</span></span>
<span class="line"><span>    // å¦‚æœä¼ é€’çš„å‘¨æœŸå°äºç­‰äº0ï¼Œç›´æ¥æŠ›å¼‚å¸¸</span></span>
<span class="line"><span>    if (period &lt;= 0)</span></span>
<span class="line"><span>        throw new IllegalArgumentException();</span></span>
<span class="line"><span>    ScheduledFutureTask&lt;Void&gt; sft =</span></span>
<span class="line"><span>        new ScheduledFutureTask&lt;Void&gt;(command, null, triggerTime(initialDelay, unit),</span></span>
<span class="line"><span>                                      unit.toNanos(period));</span></span>
<span class="line"><span>    // æ‰©å±•</span></span>
<span class="line"><span>    RunnableScheduledFuture&lt;Void&gt; t = decorateTask(command, sft);</span></span>
<span class="line"><span>    // å°†ä»»åŠ¡è®¾ç½®ç»™outerTaskå±æ€§ï¼Œæ–¹ä¾¿åæœŸé‡æ–°æ‰”åˆ°å»¶è¿Ÿé˜Ÿåˆ—</span></span>
<span class="line"><span>    sft.outerTask = t;</span></span>
<span class="line"><span>    // å—¯å“¼~</span></span>
<span class="line"><span>    delayedExecute(t);</span></span>
<span class="line"><span>    return t;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>// å›ºå®šå‘¨æœŸæ‰§è¡Œä»»åŠ¡ï¼Œä¼šåœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†è®¡ç®—ä¸‹æ¬¡æ‰§è¡Œçš„æ—¶é—´ã€‚</span></span>
<span class="line"><span>public ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command,</span></span>
<span class="line"><span>                                                 long initialDelay,</span></span>
<span class="line"><span>                                                 long delay,</span></span>
<span class="line"><span>                                                 TimeUnit unit) {</span></span>
<span class="line"><span>    if (command == null || unit == null)</span></span>
<span class="line"><span>        throw new NullPointerException();</span></span>
<span class="line"><span>    if (delay &lt;= 0)</span></span>
<span class="line"><span>        throw new IllegalArgumentException();</span></span>
<span class="line"><span>    ScheduledFutureTask&lt;Void&gt; sft =</span></span>
<span class="line"><span>        new ScheduledFutureTask&lt;Void&gt;(command, null, triggerTime(initialDelay, unit),</span></span>
<span class="line"><span>                                      unit.toNanos(-delay));</span></span>
<span class="line"><span>    RunnableScheduledFuture&lt;Void&gt; t = decorateTask(command, sft);</span></span>
<span class="line"><span>    sft.outerTask = t;</span></span>
<span class="line"><span>    delayedExecute(t);</span></span>
<span class="line"><span>    return t;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æœ€ç»ˆä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè°ƒç”¨delayedExecuteæ–¹æ³•åŒºå°†ä»»åŠ¡æ‰”åˆ°é˜»å¡é˜Ÿåˆ—ï¼Œå¹¶å°è¯•æ˜¯å¦éœ€è¦æ„å»ºå·¥ä½œçº¿ç¨‹ï¼Œä»è€Œæ‰§è¡Œä»»åŠ¡</p><p>å·¥ä½œçº¿ç¨‹ä¼šç›‘å¬å»¶è¿Ÿé˜Ÿåˆ—ï¼Œæ‹¿åˆ°ä»»åŠ¡åä¼šè°ƒç”¨ä»»åŠ¡çš„runæ–¹æ³•</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public void run() {</span></span>
<span class="line"><span>    // æŸ¥çœ‹Atå’ŒWithå¯ç¡®å®šä»»åŠ¡æ˜¯å‘¨æœŸæ‰§è¡Œ</span></span>
<span class="line"><span>    boolean periodic = isPeriodic();</span></span>
<span class="line"><span>    // çº¿ç¨‹æ± çŠ¶æ€å¯¹ä¸ï¼ï¼</span></span>
<span class="line"><span>    if (!canRunInCurrentRunState(periodic))</span></span>
<span class="line"><span>        cancel(false);</span></span>
<span class="line"><span>    else if (!periodic)</span></span>
<span class="line"><span>        // ä¸€æ¬¡æ€§çš„å»¶è¿Ÿæ‰§è¡Œ</span></span>
<span class="line"><span>        ScheduledFutureTask.super.run();</span></span>
<span class="line"><span>    // åˆ°è¿™ï¼Œå…ˆæ‰§è¡Œä»»åŠ¡</span></span>
<span class="line"><span>    else if (ScheduledFutureTask.super.runAndReset()) {</span></span>
<span class="line"><span>        // è®¾ç½®ä¸‹ä¸€æ¬¡ä»»åŠ¡çš„è¿è¡Œæ—¶é—´</span></span>
<span class="line"><span>        setNextRunTime();</span></span>
<span class="line"><span>        reExecutePeriodic(outerTask);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è®¡ç®—ä»»åŠ¡ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œtimeæ˜¯ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ï¼Œè€Œè¿™é‡Œæ˜¯timeçš„ä¸Šæ¬¡çš„æ‰§è¡Œæ—¶é—´</span></span>
<span class="line"><span>private void setNextRunTime() {</span></span>
<span class="line"><span>    // æ‹¿åˆ°å½“å‰ä»»åŠ¡çš„period</span></span>
<span class="line"><span>    long p = period;</span></span>
<span class="line"><span>    // period &gt; 0ï¼šAt</span></span>
<span class="line"><span>    if (p &gt; 0)</span></span>
<span class="line"><span>        // ç›´æ¥æ‹¿ä¸Šæ¬¡æ‰§è¡Œçš„æ—¶é—´ï¼Œæ·»åŠ ä¸Šå‘¨æœŸæ—¶é—´ï¼Œæ¥è®¡ç®—ä¸‹æ¬¡æ‰§è¡Œçš„æ—¶é—´ã€‚</span></span>
<span class="line"><span>        time = time + p;</span></span>
<span class="line"><span>    else</span></span>
<span class="line"><span>        // period &lt; 0ï¼šWith</span></span>
<span class="line"><span>        // ä»»åŠ¡æ‰§è¡Œå®Œï¼Œæ‹¿å½“å‰ç³»ç»Ÿæ—¶é—´è®¡ç®—ä¸‹æ¬¡æ‰§è¡Œçš„æ—¶é—´ç‚¹</span></span>
<span class="line"><span>        time = now() + p;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// é‡æ–°å°†ä»»åŠ¡æ‰”åˆ°å»¶è¿Ÿé˜Ÿåˆ—ä¸­</span></span>
<span class="line"><span>void reExecutePeriodic(RunnableScheduledFuture&lt;?&gt; task) {</span></span>
<span class="line"><span>    // çº¿ç¨‹æ± çŠ¶æ€çš„åˆ¤æ–­</span></span>
<span class="line"><span>    if (canRunInCurrentRunState(true)) {</span></span>
<span class="line"><span>        // å°†ä»»åŠ¡æ‰”åˆ°äº†å»¶è¿Ÿé˜Ÿåˆ—ä¸­</span></span>
<span class="line"><span>        super.getQueue().add(task);</span></span>
<span class="line"><span>        // æ‰”åˆ°å»¶è¿Ÿé˜Ÿåˆ—åï¼Œå†æ¬¡åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€ï¼Œæ˜¯å¦éœ€è¦å–æ¶ˆä»»åŠ¡ï¼</span></span>
<span class="line"><span>        if (!canRunInCurrentRunState(true) &amp;&amp; remove(task))</span></span>
<span class="line"><span>            task.cancel(false);</span></span>
<span class="line"><span>        else</span></span>
<span class="line"><span>            // éœ€è¦åˆ›å»ºçº¿ç¨‹ä¸~</span></span>
<span class="line"><span>            ensurePrestart();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>åŒæ­¥ã€å¼‚æ­¥ã€é˜»å¡ã€éé˜»å¡ã€‚</p><p>åŒæ­¥ï¼šåšäº†åŒæ­¥æ“ä½œåï¼Œè¢«è°ƒç”¨è€…ä¸ä¼šä¸»åŠ¨é€šçŸ¥æˆ‘ç»“æœï¼Œæˆ‘éœ€è¦ä¸»åŠ¨æŸ¥çœ‹ç»“æœã€‚</p><p>å¼‚æ­¥ï¼šåšäº†å¼‚æ­¥æ“ä½œåï¼Œè¢«è°ƒç”¨è€…ä¼šä¸»åŠ¨é€šçŸ¥æˆ‘ç»“æœæ˜¯ä»€ä¹ˆã€‚</p><p>é˜»å¡ï¼šè°ƒç”¨åŠŸèƒ½åï¼Œä¸èƒ½åšå…¶ä»–äº‹æƒ…ã€‚</p><p>éé˜»å¡ï¼šè°ƒç”¨åŠŸèƒ½åï¼Œå¯ä»¥åšå…¶ä»–äº‹æƒ…ã€‚</p><p>åŒæ­¥é˜»å¡ï¼šæ‰§è¡Œçƒ§æ°´åŠŸèƒ½æ—¶ï¼Œæˆ‘ä¸èƒ½åšå…¶ä»–äº‹æƒ…ï¼Œå¹¶ä¸”çƒ§æ°´åŠŸèƒ½æ‰§è¡Œå®Œåï¼Œä¸ä¼šä¸»åŠ¨é€šçŸ¥æˆ‘ã€‚</p><p>åŒæ­¥éé˜»å¡ï¼šæ‰§è¡Œçƒ§æ°´åŠŸèƒ½æ—¶ï¼Œæˆ‘å¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼Œä½†æ˜¯çƒ§æ°´åŠŸèƒ½æ‰§è¡Œå®Œåï¼Œä¸ä¼šä¸»åŠ¨é€šçŸ¥æˆ‘ã€‚</p><p>å¼‚æ­¥é˜»å¡ï¼šæ‰§è¡Œçƒ§æ°´åŠŸèƒ½æ—¶ï¼Œæˆ‘ä¸èƒ½åšå…¶ä»–äº‹æƒ…ï¼Œå¹¶ä¸”çƒ§æ°´åŠŸèƒ½æ‰§è¡Œå®Œåï¼Œä¼šä¸»åŠ¨é€šçŸ¥æˆ‘ã€‚ï¼ˆè¿™ä¸ªæ“ä½œæ²¡æœ‰ï¼‰</p><p>å¼‚æ­¥éé˜»å¡ï¼šæ‰§è¡Œçƒ§æ°´åŠŸèƒ½æ—¶ï¼Œæˆ‘å¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼Œå¹¶ä¸”çƒ§æ°´åŠŸèƒ½æ‰§è¡Œå®Œåï¼Œä¼šä¸»åŠ¨é€šçŸ¥æˆ‘ã€‚</p><h1 id="åä¸€ã€futuretaskæºç " tabindex="-1">åä¸€ã€<strong>FutureTaskæºç </strong> <a class="header-anchor" href="#åä¸€ã€futuretaskæºç " aria-label="Permalink to &quot;åä¸€ã€**FutureTaskæºç **&quot;">â€‹</a></h1><h2 id="ä¸€ã€futureä»‹ç»" tabindex="-1">ä¸€ã€<strong>Futureä»‹ç»</strong> <a class="header-anchor" href="#ä¸€ã€futureä»‹ç»" aria-label="Permalink to &quot;ä¸€ã€**Futureä»‹ç»**&quot;">â€‹</a></h2><p>Futureæ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿ<br> Javaåˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼Œä¸€èˆ¬å¸¸ç”¨çš„æ˜¯Threadï¼ŒRunnableã€‚å¦‚æœéœ€è¦å½“å‰å¤„ç†çš„ä»»åŠ¡æœ‰è¿”å›ç»“æœçš„è¯ï¼Œ<br> éœ€è¦ä½¿ç”¨Callableã€‚Callableè¿è¡Œéœ€è¦é…åˆFutureã€‚<br> Futureæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨FutureTaskå®ç°ç±»å»æ¥æ”¶Callableä»»åŠ¡çš„è¿”å›ç»“æœã€‚<br> FutureTaskå­˜åœ¨ä¸€äº›é—®é¢˜çš„ï¼ŒåŒæ­¥éé˜»å¡æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä»–ä¸ä¼šä¸»åŠ¨é€šçŸ¥ä½ è¿”å›ç»“æœæ˜¯ä»€ä¹ˆã€‚</p><h2 id="äºŒã€futuretaskä½¿ç”¨" tabindex="-1">äºŒã€<strong>FutureTaskä½¿ç”¨</strong> <a class="header-anchor" href="#äºŒã€futuretaskä½¿ç”¨" aria-label="Permalink to &quot;äºŒã€**FutureTaskä½¿ç”¨**&quot;">â€‹</a></h2><p>Callableæ˜¯ä½ è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p><p>FutureTaskæ˜¯å­˜æ”¾ä»»åŠ¡è¿”å›ç»“æœçš„ä½ç½®ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws ExecutionException, InterruptedException {</span></span>
<span class="line"><span>    FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;&gt;(() -&gt; {</span></span>
<span class="line"><span>        System.out.println(&quot;ä»»åŠ¡æ‰§è¡Œ&quot;);</span></span>
<span class="line"><span>        Thread.sleep(2000);</span></span>
<span class="line"><span>        return 123+764;</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Thread t = new Thread(futureTask);</span></span>
<span class="line"><span>    t.start();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    System.out.println(&quot;mainçº¿ç¨‹å¯åŠ¨äº†tçº¿ç¨‹å¤„ç†ä»»åŠ¡&quot;);</span></span>
<span class="line"><span>    Integer result = futureTask.get();</span></span>
<span class="line"><span>    System.out.println(result);</span></span>
<span class="line"><span>}</span></span></code></pre></div><h2 id="ä¸‰ã€futuretaskæºç åˆ†æ" tabindex="-1">ä¸‰ã€<strong>FutureTaskæºç åˆ†æ</strong> <a class="header-anchor" href="#ä¸‰ã€futuretaskæºç åˆ†æ" aria-label="Permalink to &quot;ä¸‰ã€**FutureTaskæºç åˆ†æ**&quot;">â€‹</a></h2><p>è¦åˆ†æFutureTaskï¼Œé¦–å…ˆéœ€è¦æŸ¥çœ‹ä¸€ä¸‹ä»–çš„æ ¸å¿ƒå±æ€§</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/**</span></span>
<span class="line"><span> * NEW -&gt; COMPLETING -&gt; NORMAL          ä»»åŠ¡æ­£å¸¸æ‰§è¡Œï¼Œè¿”å›ç»“æœæ˜¯æ­£å¸¸çš„ç»“æœ</span></span>
<span class="line"><span> * NEW -&gt; COMPLETING -&gt; EXCEPTIONAL     ä»»åŠ¡æ­£å¸¸æ‰§è¡Œï¼Œä½†æ˜¯è¿”å›ç»“æœæ˜¯å¼‚å¸¸</span></span>
<span class="line"><span> * NEW -&gt; CANCELLED              ä»»åŠ¡ç›´æ¥è¢«å–æ¶ˆçš„æµç¨‹</span></span>
<span class="line"><span> * NEW -&gt; INTERRUPTING -&gt; INTERRUPTED</span></span>
<span class="line"><span> */</span></span>
<span class="line"><span>// ä»£è¡¨å½“å‰ä»»åŠ¡çš„çŠ¶æ€</span></span>
<span class="line"><span>private volatile int state;</span></span>
<span class="line"><span>private static final int NEW          = 0;  // ä»»åŠ¡çš„åˆå§‹åŒ–çŠ¶æ€</span></span>
<span class="line"><span>private static final int COMPLETING   = 1;  // Callableçš„ç»“æœï¼ˆæ­£å¸¸ç»“æœï¼Œå¼‚å¸¸ç»“æœï¼‰æ­£åœ¨å°è£…ç»™å½“å‰çš„FutureTask</span></span>
<span class="line"><span>private static final int NORMAL       = 2;  // NORMALä»»åŠ¡æ­£å¸¸ç»“æŸ</span></span>
<span class="line"><span>private static final int EXCEPTIONAL  = 3;  // æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå‘ç”Ÿäº†å¼‚å¸¸</span></span>
<span class="line"><span>private static final int CANCELLED    = 4;  // ä»»åŠ¡è¢«å–æ¶ˆäº†ã€‚</span></span>
<span class="line"><span>private static final int INTERRUPTING = 5;  // çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œè¢«è®¾ç½®ä¸ºäº†trueï¼ˆç°åœ¨è¿˜åœ¨è¿è¡Œï¼‰</span></span>
<span class="line"><span>private static final int INTERRUPTED  = 6;  // çº¿ç¨‹è¢«ä¸­æ–­äº†ã€‚</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å½“å‰è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span>
<span class="line"><span>private Callable&lt;V&gt; callable;</span></span>
<span class="line"><span>// å­˜æ”¾ä»»åŠ¡è¿”å›ç»“æœçš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯futureTask.getéœ€è¦è·å–çš„ç»“æœ</span></span>
<span class="line"><span>private Object outcome; </span></span>
<span class="line"><span>// æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ã€‚</span></span>
<span class="line"><span>private volatile Thread runner;</span></span>
<span class="line"><span>// å•å‘é“¾è¡¨ï¼Œå­˜æ”¾é€šè¿‡getæ–¹æ³•æŒ‚èµ·ç­‰å¾…çš„çº¿ç¨‹</span></span>
<span class="line"><span>private volatile WaitNode waiters;</span></span></code></pre></div><p>t.startåï¼Œå¦‚ä½•æ‰§è¡ŒCallableçš„callæ–¹æ³•ï¼Œå…¶å®æ˜¯é€šè¿‡runæ–¹æ³•æ‰§è¡Œçš„callæ–¹æ³•</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// runæ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼Œæœ€ç»ˆä¼šæ‰§è¡ŒCallableçš„callæ–¹æ³•</span></span>
<span class="line"><span>public void run() {</span></span>
<span class="line"><span>    // ä¿è¯ä»»åŠ¡çš„çŠ¶æ€æ˜¯NEWæ‰å¯ä»¥è¿è¡Œ</span></span>
<span class="line"><span>    // åŸºäºCASçš„æ–¹å¼ï¼Œå°†å½“å‰çº¿ç¨‹è®¾ç½®ä¸ºrunnerã€‚</span></span>
<span class="line"><span>    if (state != NEW ||</span></span>
<span class="line"><span>        !UNSAFE.compareAndSwapObject(this, runnerOffset,null, Thread.currentThread()))</span></span>
<span class="line"><span>        return;</span></span>
<span class="line"><span>    // å‡†å¤‡æ‰§è¡Œä»»åŠ¡</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        // è¦æ‰§è¡Œä»»åŠ¡ c</span></span>
<span class="line"><span>        Callable&lt;V&gt; c = callable;</span></span>
<span class="line"><span>        // ä»»åŠ¡ä¸ä¸ºnullï¼Œå¹¶ä¸”ä»»åŠ¡çš„çŠ¶æ€è¿˜å¤„äºNEW</span></span>
<span class="line"><span>        if (c != null &amp;&amp; state == NEW) {</span></span>
<span class="line"><span>            // æ”¾è¿”å›ç»“æœ</span></span>
<span class="line"><span>            V result;</span></span>
<span class="line"><span>            // ä»»åŠ¡æ‰§è¡Œæ˜¯å¦ä¸ºæ­£å¸¸ç»“æŸ</span></span>
<span class="line"><span>            boolean ran;</span></span>
<span class="line"><span>            try {</span></span>
<span class="line"><span>                // è¿è¡Œcallæ–¹æ³•ï¼Œæ‹¿åˆ°è¿”å›ç»“æœå°è£…åˆ°resultä¸­</span></span>
<span class="line"><span>                result = c.call();</span></span>
<span class="line"><span>                // æ­£å¸¸è¿”å›ï¼Œranè®¾ç½®ä¸ºtrue</span></span>
<span class="line"><span>                ran = true;</span></span>
<span class="line"><span>            } catch (Throwable ex) {</span></span>
<span class="line"><span>                // ç»“æœä¸ºnull</span></span>
<span class="line"><span>                result = null;</span></span>
<span class="line"><span>                // å¼‚å¸¸è¿”å›ï¼Œranè®¾ç½®ä¸ºfalse</span></span>
<span class="line"><span>                ran = false;</span></span>
<span class="line"><span>                // è®¾ç½®å¼‚å¸¸ä¿¡æ¯</span></span>
<span class="line"><span>                setException(ex);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            if (ran)</span></span>
<span class="line"><span>                // æ­£å¸¸æ‰§è¡Œç»“æŸï¼Œè®¾ç½®è¿”å›ç»“æœ</span></span>
<span class="line"><span>                set(result);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } finally {</span></span>
<span class="line"><span>        // å°†æ‰§è¡Œä»»åŠ¡çš„runnerè®¾ç½®ç©º</span></span>
<span class="line"><span>        runner = null;</span></span>
<span class="line"><span>        // æ‹¿åˆ°çŠ¶æ€</span></span>
<span class="line"><span>        int s = state;</span></span>
<span class="line"><span>        // ä¸­æ–­è¦åšä¸€äº›åç»­å¤„ç†</span></span>
<span class="line"><span>        if (s &gt;= INTERRUPTING)</span></span>
<span class="line"><span>            handlePossibleCancellationInterrupt(s);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è®¾ç½®è¿”å›ç»“æœ</span></span>
<span class="line"><span>protected void set(V v) {</span></span>
<span class="line"><span>    // é¦–å…ˆè¦å°†ä»»åŠ¡çŠ¶æ€ä»NEWè®¾ç½®ä¸ºCOMPLETING</span></span>
<span class="line"><span>    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {</span></span>
<span class="line"><span>        // å°†è¿”å›ç»“æœè®¾ç½®ç»™outcomeã€‚</span></span>
<span class="line"><span>        outcome = v;</span></span>
<span class="line"><span>        // å°†çŠ¶æ€ä¿®æ”¹ä¸ºNORMALï¼Œä»£è¡¨æ­£å¸¸æŠ€æœ¯</span></span>
<span class="line"><span>        UNSAFE.putOrderedInt(this, stateOffset, NORMAL);</span></span>
<span class="line"><span>        // ä¸€ä¼šå†è¯´ï¼Œä½ çŒœçŒœ~~~</span></span>
<span class="line"><span>        finishCompletion();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>getæ–¹æ³•è·å–è¿”å›ç»“æœï¼Œåˆ°æŒ‚èµ·çš„ä½ç½®</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public V get() throws InterruptedException, ExecutionException {</span></span>
<span class="line"><span>    // æ‹¿çŠ¶æ€</span></span>
<span class="line"><span>    int s = state;</span></span>
<span class="line"><span>    // æ»¡è¶³æ‰¾ä¸ªçŠ¶æ€å°±ä»£è¡¨ç°åœ¨å¯èƒ½è¿˜æ²¡æœ‰è¿”å›ç»“æœ</span></span>
<span class="line"><span>    if (s &lt;= COMPLETING)</span></span>
<span class="line"><span>        // å°è¯•æŒ‚èµ·çº¿ç¨‹ï¼Œç­‰å¾…æ‹¿ç»“æœ</span></span>
<span class="line"><span>        s = awaitDone(false, 0L);</span></span>
<span class="line"><span>    return report(s);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// çº¿ç¨‹è¦ç­‰å¾…ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œç­‰å¾…ä»»åŠ¡æ‰§è¡Œçš„çŠ¶æ€å˜ä¸ºå¤§äºCOMPLETINGçŠ¶æ€</span></span>
<span class="line"><span>private int awaitDone(boolean timed, long nanos) throws InterruptedException {</span></span>
<span class="line"><span>    // è®¡ç®—deadlineï¼Œå¦‚æœæ˜¯get()ï¼Œå°±æ˜¯0ï¼Œ  å¦‚æœæ˜¯get(time,unit)é‚£å°±è¿½åŠ å½“å‰ç³»ç»Ÿæ—¶é—´</span></span>
<span class="line"><span>    final long deadline = timed ? System.nanoTime() + nanos : 0L;</span></span>
<span class="line"><span>    // æ„å»ºWaitNode</span></span>
<span class="line"><span>    WaitNode q = null;</span></span>
<span class="line"><span>    // queued = false</span></span>
<span class="line"><span>    boolean queued = false;</span></span>
<span class="line"><span>    // æ­»å¾ªç¯</span></span>
<span class="line"><span>    for (;;) {</span></span>
<span class="line"><span>        // æ‰¾ä¸ªgetçš„çº¿ç¨‹æ˜¯å¦ä¸­æ–­äº†ã€‚</span></span>
<span class="line"><span>        if (Thread.interrupted()) {</span></span>
<span class="line"><span>            // å°†å½“å‰èŠ‚ç‚¹ä»waitersä¸­ç§»é™¤ã€‚</span></span>
<span class="line"><span>            removeWaiter(q);</span></span>
<span class="line"><span>            // å¹¶ä¸”æŠ›å‡ºä¸­æ–­å¼‚å¸¸</span></span>
<span class="line"><span>            throw new InterruptedException();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // æ‹¿åˆ°ç°åœ¨ä»»åŠ¡çš„çŠ¶æ€</span></span>
<span class="line"><span>        int s = state;</span></span>
<span class="line"><span>        // åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œç»“æŸäº†</span></span>
<span class="line"><span>        if (s &gt; COMPLETING) {</span></span>
<span class="line"><span>            // å¦‚æœè®¾ç½®è¿‡WaitNodeï¼Œç›´æ¥ç§»é™¤WaitNodeçš„çº¿ç¨‹</span></span>
<span class="line"><span>            if (q != null)</span></span>
<span class="line"><span>                q.thread = null;</span></span>
<span class="line"><span>            // è¿”å›å½“å‰ä»»åŠ¡çš„çŠ¶æ€</span></span>
<span class="line"><span>            return s;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        // å¦‚æœä»»åŠ¡çš„çŠ¶æ€å¤„äº COMPLETING ï¼Œ</span></span>
<span class="line"><span>        else if (s == COMPLETING)</span></span>
<span class="line"><span>            // COMPLETINGçš„æŒç»­æ—¶é—´éå¸¸çŸ­ï¼Œåªéœ€è¦åšä¸€æ‰‹ç°æˆçš„è®©æ­¥å³å¯ã€‚</span></span>
<span class="line"><span>            Thread.yield();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        // ç°åœ¨çº¿ç¨‹çš„çŠ¶æ€æ˜¯NEWï¼Œï¼ˆcallæ–¹æ³•å¯èƒ½è¿˜æ²¡æ‰§è¡Œå®Œå‘¢ï¼Œå‡†å¤‡æŒ‚èµ·çº¿ç¨‹ï¼‰</span></span>
<span class="line"><span>        else if (q == null)</span></span>
<span class="line"><span>            // å°è£…WaitNodeå­˜æ”¾å½“å‰çº¿ç¨‹</span></span>
<span class="line"><span>            q = new WaitNode();</span></span>
<span class="line"><span>        else if (!queued)</span></span>
<span class="line"><span>            // å¦‚æœWaitNodeè¿˜æ²¡æœ‰æ’åœ¨waitersä¸­ï¼Œç°åœ¨å°±æ’è¿›æ¥ï¼ˆå¤´æ’æ³•çš„æ•ˆæœï¼‰</span></span>
<span class="line"><span>            queued = UNSAFE.compareAndSwapObject(this, waitersOffset, q.next = waiters, q);</span></span>
<span class="line"><span>        else if (timed) {</span></span>
<span class="line"><span>            // get(time,unit)æŒ‚èµ·çº¿ç¨‹çš„æ–¹å¼</span></span>
<span class="line"><span>            // è®¡ç®—æŒ‚èµ·æ—¶é—´</span></span>
<span class="line"><span>            nanos = deadline - System.nanoTime();</span></span>
<span class="line"><span>            // æŒ‚èµ·çš„æ—¶é—´ï¼Œæ˜¯å¦å°äºç­‰äº0</span></span>
<span class="line"><span>            if (nanos &lt;= 0L) {</span></span>
<span class="line"><span>                // ç§»é™¤waitersä¸­çš„å½“å‰Node</span></span>
<span class="line"><span>                removeWaiter(q);</span></span>
<span class="line"><span>                // è¿”å›ä»»åŠ¡çŠ¶æ€</span></span>
<span class="line"><span>                return state;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // æ­£å¸¸æŒ‡å®šæŒ‚èµ·æ—¶é—´å³å¯ã€‚ï¼ˆçº¿ç¨‹æŒ‚èµ·ï¼‰</span></span>
<span class="line"><span>            LockSupport.parkNanos(this, nanos);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        else {</span></span>
<span class="line"><span>            // get()æŒ‚èµ·çº¿ç¨‹çš„æ–¹å¼</span></span>
<span class="line"><span>            LockSupport.park(this);</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>çº¿ç¨‹æŒ‚èµ·åï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç”±finishCompletionå”¤é†’çº¿ç¨‹</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// ä»»åŠ¡çŠ¶æ€å·²ç»å˜ä¸ºäº†NORMALï¼Œåšä¸€äº›åç»­å¤„ç†</span></span>
<span class="line"><span>private void finishCompletion() {</span></span>
<span class="line"><span>    for (WaitNode q; (q = waiters) != null;) {</span></span>
<span class="line"><span>        // æ‹¿åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åï¼Œç›´æ¥ç”¨CASçš„æ–¹å¼ï¼Œå°†å…¶è®¾ç½®ä¸ºnull</span></span>
<span class="line"><span>        if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) {</span></span>
<span class="line"><span>            for (;;) {</span></span>
<span class="line"><span>                // åŸºäºqæ‹¿åˆ°çº¿ç¨‹ä¿¡æ¯</span></span>
<span class="line"><span>                Thread t = q.thread;</span></span>
<span class="line"><span>                // çº¿ç¨‹ä¸ä¸ºnull</span></span>
<span class="line"><span>                if (t != null) {</span></span>
<span class="line"><span>                    // å°†WaitNodeçš„threadè®¾ç½®ä¸ºnull</span></span>
<span class="line"><span>                    q.thread = null;</span></span>
<span class="line"><span>                    // å”¤é†’è¿™ä¸ªçº¿ç¨‹</span></span>
<span class="line"><span>                    LockSupport.unpark(t);</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>                // å¾€åéå†ï¼Œæ¥ç€å”¤é†’</span></span>
<span class="line"><span>                WaitNode next = q.next;</span></span>
<span class="line"><span>                if (next == null)</span></span>
<span class="line"><span>                    break;</span></span>
<span class="line"><span>                q.next = null;</span></span>
<span class="line"><span>                // æŒ‡å‘nextçš„WaitNode</span></span>
<span class="line"><span>                q = next;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            break;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // æ‰©å±•æ–¹æ³•ï¼Œæ²¡ä»»ä½•å®ç°ï¼Œä½ å¯ä»¥è‡ªå·±å®ç°</span></span>
<span class="line"><span>    done();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // ä»»åŠ¡å¤„ç†å®Œäº†ï¼Œå¯ä»¥æ‹œæ‹œäº†ï¼</span></span>
<span class="line"><span>    callable = null;   </span></span>
<span class="line"><span>}</span></span></code></pre></div><p>æ‹¿åˆ°è¿”å›ç»“æœçš„å¤„ç†</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// ä»»åŠ¡ç»“æŸã€‚</span></span>
<span class="line"><span>private V report(int s) throws ExecutionException {</span></span>
<span class="line"><span>    // æ‹¿åˆ°ç»“æœ</span></span>
<span class="line"><span>    Object x = outcome;</span></span>
<span class="line"><span>    // åˆ¤æ–­æ˜¯æ­£å¸¸è¿”å›ç»“æŸ</span></span>
<span class="line"><span>    if (s == NORMAL)</span></span>
<span class="line"><span>        // è¿”å›ç»“æœ</span></span>
<span class="line"><span>        return (V)x;</span></span>
<span class="line"><span>    // ä»»åŠ¡çŠ¶æ€æ˜¯å¤§äºå–æ¶ˆ</span></span>
<span class="line"><span>    if (s &gt;= CANCELLED)</span></span>
<span class="line"><span>        // ç”©å¼‚å¸¸ã€‚</span></span>
<span class="line"><span>        throw new CancellationException();</span></span>
<span class="line"><span>    // æ‰”å¼‚å¸¸ã€‚</span></span>
<span class="line"><span>    throw new ExecutionException((Throwable)x);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æ­£å¸¸è¿”å› report</span></span>
<span class="line"><span>// å¼‚å¸¸è¿”å› report</span></span>
<span class="line"><span>// å–æ¶ˆä»»åŠ¡ report</span></span>
<span class="line"><span>// ä¸­æ–­ä»»åŠ¡ awaitDone</span></span></code></pre></div><h2 id="å››ã€ç‰›æ‰¹çš„completablefuture" tabindex="-1">å››ã€<strong>ç‰›æ‰¹çš„CompletableFuture</strong> <a class="header-anchor" href="#å››ã€ç‰›æ‰¹çš„completablefuture" aria-label="Permalink to &quot;å››ã€**ç‰›æ‰¹çš„CompletableFuture**&quot;">â€‹</a></h2><p>FutureTaskå­˜åœ¨çš„é—®é¢˜ï¼š<br> é—®é¢˜1ï¼šFutureTaskè·å–çº¿ç¨‹æ‰§è¡Œçš„ç»“æœå‰ï¼Œä¸»çº¿ç¨‹éœ€è¦é€šè¿‡getæ–¹æ³•ä¸€ç›´é˜»å¡ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œcallæ–¹æ³•ï¼Œæ‰å¯ä»¥æ‹¿åˆ°è¿”å›ç»“æœã€‚<br> é—®é¢˜2ï¼šå¦‚æœä¸é€šè¿‡getå»æŒ‚èµ·çº¿ç¨‹ï¼Œé€šè¿‡whileå¾ªç¯ï¼Œä¸åœçš„åˆ¤æ–­ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€æ˜¯å¦ç»“æŸï¼Œç»“æŸåï¼Œå†æ‹¿ç»“æœã€‚å¦‚æœä»»åŠ¡é•¿æ—¶é—´æ²¡æ‰§è¡Œå®Œæ¯•ï¼ŒCPUä¼šä¸€ç›´è°ƒåº¦æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€çš„æ–¹æ³•ï¼Œä¼šæµªè´¹CPUèµ„æºã€‚<br> FutureTaskæ˜¯ä¸€ä¸ªåŒæ­¥éé˜»å¡å¤„ç†ä»»åŠ¡çš„æ–¹å¼ã€‚<br> éœ€è¦ä¸€ä¸ªå¼‚æ­¥éé˜»å¡å¤„ç†ä»»åŠ¡çš„æ–¹å¼ã€‚CompletableFutureåœ¨ä¸€å®šç¨‹åº¦ä¸Šå°±æä¾›äº†å„ç§å¼‚æ­¥éé˜»å¡çš„å¤„ç†æ–¹æ¡ˆï¼Œå¹¶ä¸”æä¾›å“åº”å¼ç¼–ç¨‹ï¼Œä»£ç ç¼–å†™ä¸Šï¼Œæ•ˆæœæ›´ä½³ï¼ˆæ›´æ¼‚äº®ï¼‰</p><p>CompletableFutureæ˜¯JDK1.8ï¼Œå†æ¬¡åˆDoug Leaç ”å‘ï¼ŒCOmpletableFutureä¹Ÿæ˜¯å®ç°äº†Futureæ¥å£å®ç°çš„åŠŸèƒ½ï¼Œå¯ä»¥ä¸ä½¿ç”¨FutureTaskï¼Œç›´æ¥ä½¿ç”¨CompletableFutureå³å¯ã€‚<br> æä¾›éå¸¸ä¸°å¯Œçš„å‡½æ•°å»æ‰§è¡Œå„ç§å¼‚æ­¥æ“ä½œã€‚</p><h1 id="åäºŒã€completablefutureåº”ç”¨" tabindex="-1">åäºŒã€<strong>CompletableFutureåº”ç”¨</strong> <a class="header-anchor" href="#åäºŒã€completablefutureåº”ç”¨" aria-label="Permalink to &quot;åäºŒã€**CompletableFutureåº”ç”¨**&quot;">â€‹</a></h1><h2 id="å›é¡¾" tabindex="-1">å›é¡¾ï¼š <a class="header-anchor" href="#å›é¡¾" aria-label="Permalink to &quot;å›é¡¾ï¼š&quot;">â€‹</a></h2><p>ä¸Šæ¬¡è¯¾ï¼Œç©çš„FutureTaskï¼Œåº”ç”¨èµ·æ¥ç‰¹åˆ«ç®€å•ã€‚</p><p>FutureTaskä»–æ˜¯åŒæ­¥éé˜»å¡ã€‚</p><p>FutureTaskä¼šé…åˆCallableæ‰§è¡Œæœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</p><p>å¦‚æœéœ€è¦æ‹¿åˆ°è¿”å›ç»“æœï¼Œéœ€è¦æ‰§è¡Œgetæ–¹æ³•ï¼Œè·å–æœ€ç»ˆç»“æœ</p><p>å› ä¸ºæ— æ³•å®ç°å¼‚æ­¥éé˜»å¡ï¼ŒJDK1.8ä¸­æœ‰ä¸ªCompletableFutureå¯ä»¥å®ç°<strong>å¼‚æ­¥éé˜»å¡</strong>çš„æ•ˆæœ</p><p>å†å¸¦æœ‰è¿”å›ç»“æœçš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œæä¾›ä¸€ä¸ªå›è°ƒã€‚</p><h2 id="ä¸€ã€completablefutureçš„åº”ç”¨" tabindex="-1">ä¸€ã€CompletableFutureçš„åº”ç”¨ <a class="header-anchor" href="#ä¸€ã€completablefutureçš„åº”ç”¨" aria-label="Permalink to &quot;ä¸€ã€CompletableFutureçš„åº”ç”¨&quot;">â€‹</a></h2><p><strong>CompletableFutureæœ€é‡è¦çš„å°±æ˜¯è§£å†³äº†å¼‚æ­¥å›è°ƒçš„é—®é¢˜</strong></p><p>CompletableFutureå°±æ˜¯æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¼‚æ­¥ä»»åŠ¡å¯ä»¥æœ‰è¿”å›ç»“æœï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰è¿”å›ç»“æœ</p><p>CompletableFutureæä¾›äº†ä¸¤ä¸ªæœ€åŸºæœ¬è¿è¡Œçš„åŸºæœ¬æ–¹æ³•</p><p>å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œä¸‰ä¸ªæœ€æ ¸å¿ƒçš„æ¥å£</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>Supplier - ç”Ÿäº§è€…ï¼Œæ²¡æœ‰å…¥å‚ï¼Œä½†æ˜¯æœ‰è¿”å›ç»“æœ</span></span>
<span class="line"><span>Consumer - æ¶ˆè´¹è€…ï¼Œæœ‰å…¥å‚ï¼Œä½†æ˜¯æ²¡æœ‰è¿”å›ç»“æœ</span></span>
<span class="line"><span>Function - å‡½æ•°ï¼Œæœ‰å…¥å‚ï¼Œå¹¶ä¸”æœ‰è¿”å›ç»“æœ</span></span></code></pre></div><p><code>supplyAsync(Supplier&amp;#x3c;U&gt; supplier)</code></p><p>å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼Œæœ‰è¿”å›ç»“æœ</p><p><code>runAsync(Runnable runnable)</code></p><p>å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼Œæ²¡æœ‰è¿”å›ç»“æœ</p><p>åœ¨ä¸æŒ‡å®šçº¿ç¨‹æ± çš„å‰æä¸‹ï¼Œè¿™ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡éƒ½æ˜¯äº¤ç»™ForkJoinPoolå»æ‰§è¡Œçš„ã€‚</p><p>è€ŒForkJoinPoolå†…éƒ¨æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œå®ˆæŠ¤çº¿ç¨‹åœ¨ä¸»çº¿ç¨‹ç»“æŸåï¼Œå°±ä¸å¹²æ´»äº†ã€‚</p><p>ä½†æ˜¯åªæ˜¯ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæ— æ³•å®ç°å¼‚æ­¥å›è°ƒçš„ã€‚</p><p>å¦‚æœéœ€è¦åœ¨å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œæ‹¿ç€è¿”å›ç»“æœæˆ–è€…ä¸æ‹¿è¿”å›ç»“æœï¼Œç»§ç»­å»æ‰§è¡Œåç»­ä»»åŠ¡æ“ä½œçš„è¯ï¼Œéœ€è¦åŸºäºå…¶ä»–æ–¹æ³•å»å®ç°</p><p><strong>è¿™é‡Œçš„æ–¹æ³•æœ‰ä¸ªç‰¹ç‚¹ï¼Œéƒ½æ˜¯åœ¨å‰ç½®ä»»åŠ¡ç»“æœåï¼Œå†æ‰§è¡Œå½“å‰ä»»åŠ¡</strong></p><p>æ‰€ä»¥åç»­çœ‹çš„ä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå¤§éƒ¨åˆ†æ–¹æ³•ä¸€å…±æœ‰ä¸‰ç§æ–¹æ³•é‡è½½ã€</p><p>ä¸å¸¦Asyncï¼Œå¸¦Asyncï¼Œå¸¦Asyncè¿˜å¯ä»¥ä¼ å…¥çº¿ç¨‹æ± çš„å¥—è·¯</p><p><code>thenApply(Function&amp;#x3c;prevResult,currResult&gt;);</code></p><p>ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡å¤„ç†ç»“æŸåï¼Œæ‹¿ç€å‰ç½®ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œå†åšå¤„ç†ï¼Œå¹¶ä¸”è¿”å›å½“å‰ç»“æœ</p><p><code>thenApplyAsync(Function&amp;#x3c;prevResult,currResult&gt;[,çº¿ç¨‹æ± ])</code></p><p>è·Ÿä¸Šé¢çš„å¥—è·¯ä¸€è‡´ï¼Œä½†æ˜¯å†æ‰§è¡Œåç»­ä»»åŠ¡æ—¶ï¼Œé‡‡ç”¨å…¨æ–°çš„çº¿ç¨‹æ‰§è¡Œ</p><p><code>thenAccept(Consumer&amp;#x3c;preResult&gt;);</code></p><p>ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡å¤„ç†ç»“æŸåï¼Œæ‹¿ç€å‰ç½®ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œå†åšå¤„ç†ï¼Œå½“ç„¶å¤„ç†æ²¡æœ‰è¿”å›ç»“æœ</p><p><code>thenAcceptAsync(Consumer&amp;#x3c;preResult&gt;[,çº¿ç¨‹æ± ]);</code></p><p>è·Ÿä¸Šé¢çš„å¥—è·¯ä¸€è‡´ï¼Œä½†æ˜¯å†æ‰§è¡Œåç»­ä»»åŠ¡æ—¶ï¼Œé‡‡ç”¨å…¨æ–°çš„çº¿ç¨‹æ‰§è¡Œ</p><p><code>thenRun(Runnable)</code></p><p>ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡å¤„ç†ç»“æŸåï¼Œå†åšå¤„ç†ã€‚ä¸æ¥æ”¶å‰ç½®ä»»åŠ¡ç»“æœï¼Œä¹Ÿä¸è¿”å›ç»“æœ</p><p><code>thenRunAsync(Runnable[,çº¿ç¨‹æ± ])</code></p><p>è·Ÿä¸Šé¢çš„å¥—è·¯ä¸€è‡´ï¼Œä½†æ˜¯å†æ‰§è¡Œåç»­ä»»åŠ¡æ—¶ï¼Œé‡‡ç”¨å…¨æ–°çš„çº¿ç¨‹æ‰§è¡Œ</p><p>å…¶æ¬¡è¿˜æœ‰å¯ä»¥æ‰§è¡Œç›¸å¯¹å¤æ‚çš„å¤„ç†ï¼Œåœ¨å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œçš„åŒæ—¶ï¼Œæ‰§è¡Œåç»­ä»»åŠ¡ã€‚ç­‰å¾…å‰ç½®ä»»åŠ¡å’Œåç½®ä»»åŠ¡éƒ½æå®šä¹‹åï¼Œå†æ‰§è¡Œæœ€ç»ˆä»»åŠ¡</p><p><code>thenCombine(CompletionStage,Function&amp;#x3c;prevResult,nextResult,afterResult&gt;)</code></p><p>å¯ä»¥è®©ä»»åŠ¡1å’Œä»»åŠ¡2ä¸€èµ·æ‰§è¡Œï¼Œç­‰å¾…ä»»åŠ¡1å’Œä»»åŠ¡2å…¨éƒ¨æå®šï¼Œè·å–å‰ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœæ‰§è¡Œæœ€ç»ˆå¤„ç†ï¼Œæœ€ç»ˆå¤„ç†ä¹Ÿå¯ä»¥è¿”å›ç»“æœ<br><code>thenCombineAsync(CompletionStage,Function&amp;#x3c;prevResult,nextResult,afterResult&gt;[,çº¿ç¨‹æ± ])</code></p><p>è·Ÿä¸Šé¢çš„å¥—è·¯ä¸€è‡´ï¼Œä½†æ˜¯å†æ‰§è¡Œåç»­ä»»åŠ¡æ—¶ï¼Œé‡‡ç”¨å…¨æ–°çš„çº¿ç¨‹æ‰§è¡Œ</p><p><code>thenAcceptBoth(CompletionStage,Consumer&amp;#x3c;prevResult,nextResult&gt;)</code></p><p>è®©å‰ç½®ä»»åŠ¡å’Œåç»­ä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œéƒ½æ‰§è¡Œå®Œæ¯•åï¼Œæ‹¿åˆ°ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœï¼Œå†åšåç»­å¤„ç†ï¼Œä½†æ˜¯æ²¡æœ‰è¿”å›ç»“æœ</p><p><code>thenAcceptBothAsync(CompletionStage,Consumer&amp;#x3c;prevResult,nextResult&gt;[,çº¿ç¨‹æ± ])</code></p><p>è·Ÿä¸Šé¢çš„å¥—è·¯ä¸€è‡´ï¼Œä½†æ˜¯å†æ‰§è¡Œåç»­ä»»åŠ¡æ—¶ï¼Œé‡‡ç”¨å…¨æ–°çš„çº¿ç¨‹æ‰§è¡Œ</p><p><code>runAfterBoth(CompletionStage,Runnble)</code></p><p>è®©å‰ç½®ä»»åŠ¡å’Œåç»­ä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œéƒ½æ‰§è¡Œå®Œæ¯•åï¼Œå†åšåç»­å¤„ç†</p><p><code>runAfterBothAsync(CompletionStage,Runnble[,çº¿ç¨‹æ± ])</code></p><p>è·Ÿä¸Šé¢çš„å¥—è·¯ä¸€è‡´ï¼Œä½†æ˜¯å†æ‰§è¡Œåç»­ä»»åŠ¡æ—¶ï¼Œé‡‡ç”¨å…¨æ–°çš„çº¿ç¨‹æ‰§è¡Œ</p><p>åé¢è¿˜æä¾›äº†å¯ä»¥è®©ä¸¤ä¸ªä»»åŠ¡ä¸€èµ·æ‰§è¡Œï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªä»»åŠ¡ç»“æŸï¼Œæœ‰è¿”å›ç»“æœåï¼Œå°±åšæœ€ç»ˆå¤„ç†</p><p><code>applyToEither(CompletionStage,Function&amp;#x3c;firstResult,afterResult&gt;)</code></p><p>å‰é¢ä¸¤ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œæœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œï¼Œè·å–è¿”å›ç»“æœï¼Œåšæœ€ç»ˆå¤„ç†ï¼Œå†è¿”å›ç»“æœ</p><p><code>acceptEither(CompletionStage,Consumer&amp;#x3c;firstResult&gt;)</code></p><p>å‰é¢ä¸¤ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œæœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œï¼Œè·å–è¿”å›ç»“æœï¼Œåšæœ€ç»ˆå¤„ç†</p><p><code>runAfterEither(CompletionStage,Runnable)</code></p><p>å‰é¢ä¸¤ä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œï¼Œæœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œï¼Œåšæœ€ç»ˆå¤„ç†</p><p>Asyncçš„ä¸è¯´äº†ã€‚</p><p>åé¢è¿˜æä¾›äº†ç­‰åˆ°å‰ç½®ä»»åŠ¡å¤„ç†å®Œï¼Œå†åšåç»­å¤„ç†ï¼Œåç»­å¤„ç†è¿”å›çš„ç»“æœä¸ºCompletionStage</p><p><code>thenCompose(Function&amp;#x3c;prevResult,CompletionStage&gt;)</code></p><p>è¿æ¥ä¸¤ä¸ªä»»åŠ¡ï¼Œå‰ç½®å¤„ç†å®Œï¼Œæ‰§è¡Œåç»­ï¼Œåç»­å¯ä»¥æ‹¿åˆ°å‰ç½®ä»»åŠ¡çš„ç»“æœï¼Œå¹¶ä¸”åšå¤„ç†ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯CompletionStage</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>thenCompose (Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn);</span></span>
<span class="line"><span>thenApply   (Function&lt;? super T, ? extends U&gt; fn);</span></span>
<span class="line"><span>// ç”¨thenApplyå…¶å®å°±è¶³å¤Ÿäº†</span></span></code></pre></div><p>æœ€åè¿˜æœ‰å¤„ç†å¼‚å¸¸çš„å„ç§å§¿åŠ¿</p><p><code>exceptionally(Function&amp;#x3c;Throwable,currResult&gt;)</code></p><p>åªæœ‰å½“å‰è¿™ä¸ªå¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œå¯ä»¥è·å–åˆ°å‰é¢ä»»åŠ¡çš„å¼‚å¸¸ä¿¡æ¯ï¼Œæœ‰å¼‚å¸¸æ‰æ‰§è¡Œå½“å‰ä»»åŠ¡ã€‚</p><p>exceptionallyä¸å­˜åœ¨Asyncçš„æ“ä½œã€‚</p><p><code>whenComplete(Consumer&amp;#x3c;prevResult,Throwable&gt;)</code></p><p>å¯ä»¥æ‹¿åˆ°ä¸Šä¸€ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœå’Œå¼‚å¸¸ï¼Œä½†æ˜¯å½“å‰å¤„ç†æ²¡æœ‰è¿”å›ç»“æœï¼Œæ— æ³•å½±å“æœ€ç»ˆè®©ä»»åŠ¡çš„ç»“æœå†…å®¹</p><p>è¿™ä¸ªå¸¦æœ‰Asyncæ“ä½œ</p><p><code>hanle(Function&amp;#x3c;prevResult,Throwable,currResult&gt;)</code></p><p>å¯ä»¥æ‹¿åˆ°ä¸Šä¸€ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœå’Œå¼‚å¸¸ï¼ŒåŒæ—¶å½“å‰å¤„ç†å¯ä»¥è¿”å›å†…å®¹</p><h2 id="äºŒã€åŸºäºä¸Šé¢é˜è¿°åšåº”ç”¨" tabindex="-1">äºŒã€åŸºäºä¸Šé¢é˜è¿°åšåº”ç”¨ <a class="header-anchor" href="#äºŒã€åŸºäºä¸Šé¢é˜è¿°åšåº”ç”¨" aria-label="Permalink to &quot;äºŒã€åŸºäºä¸Šé¢é˜è¿°åšåº”ç”¨&quot;">â€‹</a></h2><h4 id="_2-1-å°ä¸€è¦å›å®¶å¹²æ³•-å°äºŒå»åšé¥­-å°ä¸€çœ‹ç”µè§†-ç­‰åˆ°å°äºŒæ˜¨æ™š-å°ä¸€å¹²é¥­ã€‚" tabindex="-1">2.1 å°ä¸€è¦å›å®¶å¹²æ³•ï¼Œå°äºŒå»åšé¥­ï¼Œå°ä¸€çœ‹ç”µè§†ï¼Œç­‰åˆ°å°äºŒæ˜¨æ™šï¼Œå°ä¸€å¹²é¥­ã€‚ <a class="header-anchor" href="#_2-1-å°ä¸€è¦å›å®¶å¹²æ³•-å°äºŒå»åšé¥­-å°ä¸€çœ‹ç”µè§†-ç­‰åˆ°å°äºŒæ˜¨æ™š-å°ä¸€å¹²é¥­ã€‚" aria-label="Permalink to &quot;2.1 å°ä¸€è¦å›å®¶å¹²æ³•ï¼Œå°äºŒå»åšé¥­ï¼Œå°ä¸€çœ‹ç”µè§†ï¼Œç­‰åˆ°å°äºŒæ˜¨æ™šï¼Œå°ä¸€å¹²é¥­ã€‚&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws InterruptedException {</span></span>
<span class="line"><span>    sout(&quot;å°è¿å›å®¶å¹²é¥­&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    CompletableFuture&lt;String&gt; task = CompletableFuture.supplyAsync(() -&gt; {</span></span>
<span class="line"><span>        sout(&quot;å°ä¸¥åšé¥­ï¼&quot;);</span></span>
<span class="line"><span>        sleep();</span></span>
<span class="line"><span>        return &quot;é”…åŒ…è‚‰ï¼&quot;;</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>    sout(&quot;å°è¿çœ‹ç”µè§†ï¼&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    sout(&quot;å°è¿å¹²é¥­ï¼š&quot; + task.join());</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_2-2-å°ä¸€è¦å›å®¶å¹²æ³•-å°äºŒå»ç‚’èœ-å°ä¸‰å»ç„–é¥­-å°ä¸€çœ‹ç”µè§†-ç­‰åˆ°å°äºŒå’Œå°ä¸‰éƒ½åšå¥½äº†-å°å››ç«¯èœå’Œé¥­ç»™å°ä¸€-å°ä¸€å¹²é¥­" tabindex="-1">2.2 å°ä¸€è¦å›å®¶å¹²æ³•ï¼Œå°äºŒå»ç‚’èœï¼Œå°ä¸‰å»ç„–é¥­ï¼Œå°ä¸€çœ‹ç”µè§†ï¼Œç­‰åˆ°å°äºŒå’Œå°ä¸‰éƒ½åšå¥½äº†ï¼Œå°å››ç«¯èœå’Œé¥­ç»™å°ä¸€ï¼Œå°ä¸€å¹²é¥­ <a class="header-anchor" href="#_2-2-å°ä¸€è¦å›å®¶å¹²æ³•-å°äºŒå»ç‚’èœ-å°ä¸‰å»ç„–é¥­-å°ä¸€çœ‹ç”µè§†-ç­‰åˆ°å°äºŒå’Œå°ä¸‰éƒ½åšå¥½äº†-å°å››ç«¯èœå’Œé¥­ç»™å°ä¸€-å°ä¸€å¹²é¥­" aria-label="Permalink to &quot;2.2 å°ä¸€è¦å›å®¶å¹²æ³•ï¼Œå°äºŒå»ç‚’èœï¼Œå°ä¸‰å»ç„–é¥­ï¼Œå°ä¸€çœ‹ç”µè§†ï¼Œç­‰åˆ°å°äºŒå’Œå°ä¸‰éƒ½åšå¥½äº†ï¼Œå°å››ç«¯èœå’Œé¥­ç»™å°ä¸€ï¼Œå°ä¸€å¹²é¥­&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public static void main(String[] args) throws InterruptedException {</span></span>
<span class="line"><span>    sout(&quot;å°è¿å›å®¶å¹²é¥­&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    CompletableFuture&lt;String&gt; task = CompletableFuture.supplyAsync(() -&gt; {</span></span>
<span class="line"><span>        sout(&quot;å°ä¸¥å»ç‚’èœï¼&quot;);</span></span>
<span class="line"><span>        sleep();</span></span>
<span class="line"><span>        return &quot;é”…åŒ…è‚‰ï¼&quot;;</span></span>
<span class="line"><span>    },executor).thenCombineAsync(CompletableFuture.supplyAsync(() -&gt; {</span></span>
<span class="line"><span>        sout(&quot;å°æå»ç„–é¥­&quot;);</span></span>
<span class="line"><span>        sleep();</span></span>
<span class="line"><span>        return &quot;å¤§ç±³é¥­ï¼&quot;;</span></span>
<span class="line"><span>    },executor),(food,rice) -&gt; {</span></span>
<span class="line"><span>        sout(&quot;å°é™ˆç«¯&quot; + food + &quot;,&quot; + rice);</span></span>
<span class="line"><span>        sleep();</span></span>
<span class="line"><span>        return &quot;é¥­èœå¥½äº†ï¼&quot;;</span></span>
<span class="line"><span>    },executor);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    sout(&quot;å°è¿çœ‹ç”µè§†ï¼&quot;);</span></span>
<span class="line"><span>    sout(&quot;å°è¿å¹²é¥­ï¼š&quot; + task.join());</span></span>
<span class="line"><span>}</span></span></code></pre></div><h1 id="åä¸‰ã€completablefutureæºç åˆ†æ" tabindex="-1">åä¸‰ã€<strong>CompletableFutureæºç åˆ†æ</strong> <a class="header-anchor" href="#åä¸‰ã€completablefutureæºç åˆ†æ" aria-label="Permalink to &quot;åä¸‰ã€**CompletableFutureæºç åˆ†æ**&quot;">â€‹</a></h1><p>å¼‚æ­¥å›è°ƒ</p><h2 id="ä¸€ã€runasyncæ–¹æ³•æºç åˆ†æ" tabindex="-1">ä¸€ã€runAsyncæ–¹æ³•æºç åˆ†æ <a class="header-anchor" href="#ä¸€ã€runasyncæ–¹æ³•æºç åˆ†æ" aria-label="Permalink to &quot;ä¸€ã€runAsyncæ–¹æ³•æºç åˆ†æ&quot;">â€‹</a></h2><p>åŸºäºå½“å‰è¿™ä¸ªæœ€ç®€å•çš„æ–¹æ³•ï¼Œæ¥åˆ†æCompletableFutureæ˜¯å¦‚ä½•æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ã€‚</p><p>ä»¥åŠå¦‚ä½•è§¦å‘åç»­ä»»åŠ¡æ‰§è¡Œ</p><h4 id="_1-1-å½“å‰å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæµç¨‹" tabindex="-1">1.1 å½“å‰å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæµç¨‹ <a class="header-anchor" href="#_1-1-å½“å‰å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæµç¨‹" aria-label="Permalink to &quot;1.1 å½“å‰å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæµç¨‹&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å¼‚æ­¥æ‰§è¡Œä»»åŠ¡</span></span>
<span class="line"><span>static CompletableFuture&lt;Void&gt; asyncRunStage(Executor e, Runnable f) {</span></span>
<span class="line"><span>    // éç©ºåˆ¤æ–­ã€‚ </span></span>
<span class="line"><span>    if (f == null) throw new NullPointerException();</span></span>
<span class="line"><span>    // å£°æ˜å½“å‰ä»»åŠ¡çš„CompletableFutureå¯¹è±¡</span></span>
<span class="line"><span>    // åœ¨çœ‹CompletableFutureæ—¶ï¼Œä»»åŠ¡æ‰§è¡Œå’Œåç»­ä»»åŠ¡çš„è§¦å‘æ˜¯ä¸¤ä¸ªæ“ä½œ</span></span>
<span class="line"><span>    // newçš„è¿™ä¸ªdï¼Œä»–çš„ç›®çš„æ˜¯ä¸ºäº†è§¦å‘åç»­ä»»åŠ¡çš„æ‰§è¡Œã€‚</span></span>
<span class="line"><span>    CompletableFuture&lt;Void&gt; d = new CompletableFuture&lt;Void&gt;();</span></span>
<span class="line"><span>    // å°†ä»»åŠ¡å’ŒCompletableFutureå°è£…åˆ°ä¸€èµ·ï¼Œä½œä¸ºAsyncRunçš„å¯¹è±¡</span></span>
<span class="line"><span>    // å°†AsyncRunäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œ</span></span>
<span class="line"><span>    e.execute(new AsyncRun(d, f));</span></span>
<span class="line"><span>    return d;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å°è£…ä»»åŠ¡å’ŒCOmpletableFutureçš„AsyncRunå¯¹è±¡</span></span>
<span class="line"><span>static final class AsyncRun extends ForkJoinTask&lt;Void&gt; </span></span>
<span class="line"><span>    CompletableFuture&lt;Void&gt; dep; Runnable fn;</span></span>
<span class="line"><span>    // å­˜å‚¨å½“å‰çš„ä»»åŠ¡ä»¥åŠCompletableFuture</span></span>
<span class="line"><span>    AsyncRun(CompletableFuture&lt;Void&gt; dep, Runnable fn) {</span></span>
<span class="line"><span>        this.dep = dep; this.fn = fn;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    public void run() {</span></span>
<span class="line"><span>        // å£°æ˜ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªå­˜å‚¨CompletableFutureï¼Œä¸€ä¸ªå­˜å‚¨å…·ä½“ä»»åŠ¡</span></span>
<span class="line"><span>        CompletableFuture&lt;Void&gt; d; Runnable f;</span></span>
<span class="line"><span>        // éç©ºåˆ¤æ–­çš„åŒæ—¶ï¼Œå°†æˆå‘˜å˜é‡åšä¸´æ—¶å­˜å‚¨</span></span>
<span class="line"><span>        if ((d = dep) != null &amp;&amp; (f = fn) != null) {</span></span>
<span class="line"><span>            // help gc</span></span>
<span class="line"><span>            dep = null; fn = null;</span></span>
<span class="line"><span>            // å½“å‰ä»»åŠ¡æ˜¯å¦å·²ç»æœ‰è¿”å›ç»“æœã€‚</span></span>
<span class="line"><span>            if (d.result == null) {</span></span>
<span class="line"><span>                // ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œ</span></span>
<span class="line"><span>                try {</span></span>
<span class="line"><span>                    // çº¿ç¨‹æ± æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚</span></span>
<span class="line"><span>                    f.run();</span></span>
<span class="line"><span>                    // å½“ç„¶æ˜¯Runnableä»»åŠ¡ï¼Œæ²¡æœ‰è¿”å›ç»“æœçš„ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å°è£…ä¸ºä¸€ä¸ªè¡¨ç¤ºnullçš„æ ‡è¯†</span></span>
<span class="line"><span>                    // ä¸ºnullçš„ç»“æœæ˜¯NIL</span></span>
<span class="line"><span>                    d.completeNull();</span></span>
<span class="line"><span>                } catch (Throwable ex) {</span></span>
<span class="line"><span>                    // å¦‚æœå¼‚å¸¸ç»“æŸï¼Œå°†å‡ºç°çš„å¼‚å¸¸å°è£…åˆ°è¿”å›ç»“æœä¸­</span></span>
<span class="line"><span>                    d.completeThrowable(ex);</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            // æ‰§è¡Œåç»­ä»»åŠ¡</span></span>
<span class="line"><span>            d.postComplete();</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="_1-2-åç»­ä»»åŠ¡çš„è§¦å‘æ–¹å¼" tabindex="-1">1.2 åç»­ä»»åŠ¡çš„è§¦å‘æ–¹å¼ <a class="header-anchor" href="#_1-2-åç»­ä»»åŠ¡çš„è§¦å‘æ–¹å¼" aria-label="Permalink to &quot;1.2 åç»­ä»»åŠ¡çš„è§¦å‘æ–¹å¼&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè§¦å‘åç»­ä»»åŠ¡ã€‚</span></span>
<span class="line"><span>final void postComplete() {</span></span>
<span class="line"><span>    // fï¼šå½“å‰ä»»åŠ¡çš„COmpletableFuture</span></span>
<span class="line"><span>    // hï¼šæ ˆé¡¶ï¼</span></span>
<span class="line"><span>    CompletableFuture&lt;?&gt; f = this; Completion h;</span></span>
<span class="line"><span>    // hæ‹¿åˆ°æ ˆé¡¶æ•°æ®ã€‚</span></span>
<span class="line"><span>    while ((h = f.stack) != null ||</span></span>
<span class="line"><span>           (f != this &amp;&amp; (h = (f = this).stack) != null)) {</span></span>
<span class="line"><span>        // æ ˆç»“æ„ä¸­æœ‰åç»­éœ€è¦å¤„ç†çš„ä»»åŠ¡ï¼Œè¿›åˆ°whileå¾ªç¯ä¸­ï¼Œæ¯æ¬¡å¾ªç¯ä¹‹åï¼Œhçš„æŒ‡é’ˆéƒ½ä¼šåç§»</span></span>
<span class="line"><span>        CompletableFuture&lt;?&gt; d; Completion t;</span></span>
<span class="line"><span>        // æ ˆé¡¶æ¢äººå•¦~~</span></span>
<span class="line"><span>        if (f.casStack(h, t = h.next)) {</span></span>
<span class="line"><span>            if (t != null) {</span></span>
<span class="line"><span>                if (f != this) {</span></span>
<span class="line"><span>                    pushStack(h);</span></span>
<span class="line"><span>                    continue;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>                h.next = null;    // detach}</span></span>
<span class="line"><span>            // æ‰§è¡Œæ ˆé¡¶çš„ä»»åŠ¡</span></span>
<span class="line"><span>            f = (d = h.tryFire(NESTED)) == null ? this : d;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>é—®é¢˜ï¼šå‘ç°CompletableFutureçš„åç»­ä»»åŠ¡æ˜¯åŸºäºæ ˆç»“æ„å­˜å‚¨çš„ï¼Œä½†æ˜¯åœ¨æµ‹è¯•çš„ä»£ç ä¸­ï¼Œæ‰§è¡Œçš„é¡ºåºæ²¡æœ‰æŒ‰ç…§æ ˆç»“æ„çš„æ–¹å¼ï¼Œå»æ‰§è¡Œ</p><p>CompletableFutureä¸ä¿è¯åç»­ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºã€‚</p><p>ä»ä¸Šé¢çš„æºç åˆ†æï¼Œå‘ç°ï¼Œä¸ä¼šå‡ºç°æ ˆç»“æ„å®Œå…¨å€’åºçš„æƒ…å†µã€‚</p><h2 id="äºŒã€thenrunæ–¹æ³•æºç åˆ†æ" tabindex="-1">äºŒã€thenRunæ–¹æ³•æºç åˆ†æ <a class="header-anchor" href="#äºŒã€thenrunæ–¹æ³•æºç åˆ†æ" aria-label="Permalink to &quot;äºŒã€thenRunæ–¹æ³•æºç åˆ†æ&quot;">â€‹</a></h2><p>åç»­ä»»åŠ¡çš„è§¦å‘æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ul><li><p>ä¸€ç§æ˜¯åŸºäºå‰ç»§ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡ŒpostCompleteæ–¹æ³•è§¦å‘</p></li><li><p>å¦ä¸€ç§æ˜¯åç»­ä»»åŠ¡åœ¨å‹æ ˆä¹‹å‰å’Œä¹‹åï¼Œä¼šå°è¯•æ‰§è¡Œåç»­ä»»åŠ¡ï¼Œåªè¦å‰ç»§ä»»åŠ¡æ‰§è¡Œç»“æŸçš„å¿«ï¼Œåç»­ä»»åŠ¡å°±å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œä¸éœ€è¦å‰ç»§ä»»åŠ¡çš„è§¦å‘</p></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>// è¿½åŠ ä»»åŠ¡åˆ°æ ˆç»“æ„çš„é€»è¾‘</span></span>
<span class="line"><span>// eï¼šçº¿ç¨‹æ± ã€æ‰§è¡Œå™¨ã€‚  å¦‚æœæ˜¯Asyncå¼‚æ­¥è°ƒç”¨ï¼Œä¼šä¼ é€’ä½¿ç”¨çš„çº¿ç¨‹æ± ã€‚ å¦‚æœæ˜¯æ™®é€šçš„thenRunï¼Œä¸ä¼šä¼ é€’çº¿ç¨‹æ± ï¼Œä¸ºnull</span></span>
<span class="line"><span>private CompletableFuture&lt;Void&gt; uniRunStage(Executor e, Runnable f) {</span></span>
<span class="line"><span>    // é˜¿å·´é˜¿å·´ã€‚</span></span>
<span class="line"><span>    if (f == null) throw new NullPointerException();</span></span>
<span class="line"><span>    // å½“å‰ä»»åŠ¡çš„CompletableFuture</span></span>
<span class="line"><span>    CompletableFuture&lt;Void&gt; d = new CompletableFuture&lt;Void&gt;();</span></span>
<span class="line"><span>    // å¦‚æœä¼ é€’äº†çº¿ç¨‹æ± ï¼Œä»£è¡¨å¼‚æ­¥æ‰§è¡Œï¼Œç›´æ¥èµ°ifä»£ç å—ä¸­çš„å†…å®¹</span></span>
<span class="line"><span>    // å¦‚æœæ²¡æœ‰ä¼ é€’çº¿ç¨‹æ± ï¼ŒåŒæ­¥æ‰§è¡Œï¼Œéœ€è¦å…ˆæ‰§è¡ŒuniRun</span></span>
<span class="line"><span>    if (e != null || !d.uniRun(this, f, null)) {</span></span>
<span class="line"><span>        // å‰ç»§ä»»åŠ¡è¿˜æ²¡æ‰§è¡Œå®Œå‘¢ï¼Œé‚£å°±å‡†å¤‡å‹æ ˆï¼</span></span>
<span class="line"><span>        // å°†çº¿ç¨‹æ± ï¼Œåç»­ä»»åŠ¡ï¼Œå‰ç»§ä»»åŠ¡ï¼Œåç»­å…·ä½“ä»»åŠ¡</span></span>
<span class="line"><span>        UniRun&lt;T&gt; c = new UniRun&lt;T&gt;(e, d, this, f);</span></span>
<span class="line"><span>        // å°†å°è£…å¥½çš„cï¼Œç›´æ¥åˆ°thisçš„æ ˆç»“æ„ä¸­</span></span>
<span class="line"><span>        // ä¸ç¡®ä¿UniRunå¯¹è±¡ä¸€å®šä¼šè¢«å‹åˆ°æ ˆç»“æ„ä¸­</span></span>
<span class="line"><span>        // åœ¨è¿™ä¸ªä½ç½®ï¼Œå¯èƒ½ä¼šå‡ºç°å‰ç»§ä»»åŠ¡å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œå¯¼è‡´æ— æ³•å‹åˆ°æ ˆé¡¶ã€‚</span></span>
<span class="line"><span>        this.push(c);</span></span>
<span class="line"><span>        // å°è¯•æ‰§è¡Œå½“å‰çš„åç»­ä»»åŠ¡</span></span>
<span class="line"><span>        c.tryFire(SYNC);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return d;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å½“å‰æ–¹æ³•çš„ä½œç”¨ï¼šå°è¯•æ‰§è¡Œä»»åŠ¡ã€‚</span></span>
<span class="line"><span>// aï¼šå‰ç»§ä»»åŠ¡</span></span>
<span class="line"><span>// fï¼šåç»­å…·ä½“ä»»åŠ¡</span></span>
<span class="line"><span>// cï¼šç°åœ¨æ˜¯null</span></span>
<span class="line"><span>final boolean uniRun(CompletableFuture&lt;?&gt; a, Runnable f, UniRun&lt;?&gt; c) {</span></span>
<span class="line"><span>    Object r; Throwable x;</span></span>
<span class="line"><span>    // åªçœ‹ç¬¬äºŒä¸ªåˆ¤æ–­ã€‚  </span></span>
<span class="line"><span>    // å¦‚æœå‰ç»§ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œç›´æ¥return false</span></span>
<span class="line"><span>    if (a == null || (r = a.result) == null || f == null)</span></span>
<span class="line"><span>        return false;</span></span>
<span class="line"><span>    // çœç•¥éƒ¨åˆ†ä»£ç </span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å‹æ ˆæ–¹æ³•</span></span>
<span class="line"><span>final void push(UniCompletion&lt;?,?&gt; c) {</span></span>
<span class="line"><span>    // ä¸ä¸ºnullï¼ï¼ï¼</span></span>
<span class="line"><span>    if (c != null) {</span></span>
<span class="line"><span>        // resultæ˜¯å‰ç»§ä»»åŠ¡çš„ç»“æœ</span></span>
<span class="line"><span>        // åªæœ‰å‰ç»§ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œæ‰èƒ½å°†å½“å‰çš„UniRunå¯¹è±¡å‹åˆ°æ ˆç»“æ„ä¸­</span></span>
<span class="line"><span>        while (result == null &amp;&amp; !tryPushStack(c))</span></span>
<span class="line"><span>            lazySetNext(c, null); </span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>// åç»­ä»»åŠ¡çš„æ‰§è¡Œï¼Œä»¥åŠä¹‹å‰å°†åç»­ä»»åŠ¡å°è£…çš„UniRunå¯¹è±¡</span></span>
<span class="line"><span>static final class UniRun&lt;T&gt; extends UniCompletion&lt;T,Void&gt; {</span></span>
<span class="line"><span>    Runnable fn;</span></span>
<span class="line"><span>    // ä¹‹å‰å°è£…åç»§ä»»åŠ¡è°ƒç”¨çš„æœ‰å‚æ„é€ </span></span>
<span class="line"><span>    UniRun(Executor executor, CompletableFuture&lt;Void&gt; dep,CompletableFuture&lt;T&gt; src, Runnable fn) {</span></span>
<span class="line"><span>        super(executor, dep, src); this.fn = fn;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // å°è¯•æ‰§è¡Œä»»åŠ¡</span></span>
<span class="line"><span>    // depï¼šåç»­ä»»åŠ¡</span></span>
<span class="line"><span>    // srcï¼šå‰ç»§ä»»åŠ¡</span></span>
<span class="line"><span>    // fnï¼šåç»­å…·ä½“ä»»åŠ¡</span></span>
<span class="line"><span>    final CompletableFuture&lt;Void&gt; tryFire(int mode) {</span></span>
<span class="line"><span>        // dï¼šå­˜å‚¨åç»­ä»»åŠ¡ï¼Œ   aï¼šå­˜å‚¨å‰ç»§ä»»åŠ¡</span></span>
<span class="line"><span>        CompletableFuture&lt;Void&gt; d; CompletableFuture&lt;T&gt; a;</span></span>
<span class="line"><span>        if ((d = dep) == null ||</span></span>
<span class="line"><span>            // å°è¯•æ‰§è¡Œåç»­ä»»åŠ¡çš„ä½ç½®</span></span>
<span class="line"><span>            !d.uniRun(a = src, fn, mode &gt; 0 ? null : this))</span></span>
<span class="line"><span>            return null;</span></span>
<span class="line"><span>        dep = null; src = null; fn = null;</span></span>
<span class="line"><span>        return d.postFire(a, mode);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å°è¯•æ‰§è¡Œåç»­ä»»åŠ¡çš„æ–¹æ³•</span></span>
<span class="line"><span>final boolean uniRun(CompletableFuture&lt;?&gt; a, Runnable f, UniRun&lt;?&gt; c) {</span></span>
<span class="line"><span>    Object r; Throwable x;</span></span>
<span class="line"><span>    // åˆ¤æ–­å‰ç»§ä»»åŠ¡æ‰§è¡Œå®Œäº†ä¹ˆï¼Ÿ å¦‚æœæ‰§è¡Œå®Œäº†ï¼Œç›´æ¥èµ°åé¢æ‰§è¡Œåç»­ä»»åŠ¡</span></span>
<span class="line"><span>    // å¦‚æœå‰ç»§ä»»åŠ¡æ²¡æ‰§è¡Œå®Œï¼Œ</span></span>
<span class="line"><span>    if (a == null || (r = a.result) == null || f == null)</span></span>
<span class="line"><span>        // è¿”å›false</span></span>
<span class="line"><span>        return false;</span></span>
<span class="line"><span>    // åˆ°è¿™ï¼Œè¯´æ˜å‰ç»§ä»»åŠ¡å·²ç»æ‰§è¡Œç»“æŸäº†ã€‚</span></span>
<span class="line"><span>    // è¦æ‰§è¡Œåç»­ä»»åŠ¡ï¼Œä½†æ˜¯è¦å…ˆåˆ¤æ–­åç»­ä»»åŠ¡æ‰§è¡Œäº†ä¹ˆï¼Ÿ  </span></span>
<span class="line"><span>    if (result == null) {</span></span>
<span class="line"><span>        // åç»­ä»»åŠ¡è¿˜æœ¨æœ‰æ‰§è¡Œ</span></span>
<span class="line"><span>        // å¦‚æœå‰ç»§ä»»åŠ¡æ˜¯å¼‚å¸¸ç»“æŸï¼Œåç»­ä»»åŠ¡å°±ä¸éœ€è¦æ‰§è¡Œäº†ï¼</span></span>
<span class="line"><span>        if (r instanceof AltResult &amp;&amp; (x = ((AltResult)r).ex) != null)</span></span>
<span class="line"><span>            // æ­£å¸¸å°è£…å¼‚å¸¸ä¿¡æ¯ã€‚</span></span>
<span class="line"><span>            completeThrowable(x, r);</span></span>
<span class="line"><span>        else</span></span>
<span class="line"><span>            // å‰ç»§ä»»åŠ¡æ­£å¸¸ç»“æŸï¼Œå°è¯•ä¹‹ååç»­ä»»åŠ¡ã€‚</span></span>
<span class="line"><span>            try {</span></span>
<span class="line"><span>                // å¦‚æœc == nullï¼Œä»£è¡¨å¼‚æ­¥æ‰§è¡Œ</span></span>
<span class="line"><span>                // å¦‚æœc != nullï¼ŒåµŒå¥—æ‰§è¡Œï¼ŒåŒæ­¥æ‰§è¡Œ</span></span>
<span class="line"><span>                if (c != null &amp;&amp; !c.claim())</span></span>
<span class="line"><span>                    // å¼‚æ­¥æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›false</span></span>
<span class="line"><span>                    return false;</span></span>
<span class="line"><span>                // éœ€è¦åŒæ­¥æ‰§è¡Œ</span></span>
<span class="line"><span>                f.run();</span></span>
<span class="line"><span>                // æ­£å¸¸å°è£…ç»“æœ</span></span>
<span class="line"><span>                completeNull();</span></span>
<span class="line"><span>            } catch (Throwable ex) {</span></span>
<span class="line"><span>                // å¼‚å¸¸å°è£…ç»“æœ</span></span>
<span class="line"><span>                completeThrowable(ex);</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return true;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>// æ‰§è¡Œä»»åŠ¡</span></span>
<span class="line"><span>final boolean claim() {</span></span>
<span class="line"><span>    // æ‹¿åˆ°çº¿ç¨‹æ± </span></span>
<span class="line"><span>    Executor e = executor;</span></span>
<span class="line"><span>    // åˆ¤æ–­å½“å‰ä»»åŠ¡æ ‡è®°ï¼Œæ˜¯å¦æ‰§è¡Œ</span></span>
<span class="line"><span>    if (compareAndSetForkJoinTaskTag((short)0, (short)1)) {</span></span>
<span class="line"><span>        if (e == null)</span></span>
<span class="line"><span>            // çº¿ç¨‹æ± ä¸ºnullï¼Œä»£è¡¨åŒæ­¥æ‰§è¡Œï¼Œç›´æ¥è¿”å›true</span></span>
<span class="line"><span>            return true;</span></span>
<span class="line"><span>        // å¼‚æ­¥æ‰§è¡Œï¼Œä½¿ç”¨çº¿ç¨‹æ± æ‰§è¡Œå³å¯ã€‚</span></span>
<span class="line"><span>        executor = null; </span></span>
<span class="line"><span>        e.execute(this);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    return false;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h2 id="ä¸‰ã€æ•´ä½“æ‰§è¡Œæµç¨‹å›¾" tabindex="-1">ä¸‰ã€æ•´ä½“æ‰§è¡Œæµç¨‹å›¾ <a class="header-anchor" href="#ä¸‰ã€æ•´ä½“æ‰§è¡Œæµç¨‹å›¾" aria-label="Permalink to &quot;ä¸‰ã€æ•´ä½“æ‰§è¡Œæµç¨‹å›¾&quot;">â€‹</a></h2><h1 id="åå››ã€å¹¶å‘ç¼–ç¨‹æ€»ç»“" tabindex="-1">åå››ã€å¹¶å‘ç¼–ç¨‹æ€»ç»“ <a class="header-anchor" href="#åå››ã€å¹¶å‘ç¼–ç¨‹æ€»ç»“" aria-label="Permalink to &quot;åå››ã€å¹¶å‘ç¼–ç¨‹æ€»ç»“&quot;">â€‹</a></h1><h2 id="ä¸€ã€é”" tabindex="-1">ä¸€ã€é” <a class="header-anchor" href="#ä¸€ã€é”" aria-label="Permalink to &quot;ä¸€ã€é”&quot;">â€‹</a></h2><h3 id="_1-1-synchronized-çœ‹åˆ°javaå±‚é¢å°±å¤Ÿäº†" tabindex="-1">1.1 synchronizedï¼ˆçœ‹åˆ°Javaå±‚é¢å°±å¤Ÿäº†ï¼‰ <a class="header-anchor" href="#_1-1-synchronized-çœ‹åˆ°javaå±‚é¢å°±å¤Ÿäº†" aria-label="Permalink to &quot;1.1 synchronizedï¼ˆçœ‹åˆ°Javaå±‚é¢å°±å¤Ÿäº†ï¼‰&quot;">â€‹</a></h3><p><strong>å¯¹è±¡é”å’Œç±»é”</strong></p><p>synchronizedåˆ°åº•æ˜¯ä½¿ç”¨æ™®é€šnewå‡ºæ¥çš„å¯¹è±¡ä½œä¸ºé”ï¼Œè¿˜æ˜¯Classå¯¹è±¡ä½œä¸ºé”</p><p>å¯¹è±¡é” - newå¤šä¸ªå¯¹è±¡å»æ“ä½œï¼Œæ— æ³•å®ç°äº’æ–¥çš„</p><p>ç±»é” - æ— è®ºæ€ä¹ˆä½¿ç”¨ï¼Œèƒ½ä¿è¯ä¸€ä¸ªJVMå†…æ˜¯äº’æ–¥çš„</p><p><strong>åŸç†ã€å¯¹è±¡å¤´</strong></p><p>synchronizedæ˜¯åŸºäºå¯¹è±¡ä½œä¸ºé”çš„ã€‚</p><p>é”ä¿¡æ¯å…¨éƒ¨éƒ½æ”¾åœ¨äº†å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­çš„MarkWordä¸­</p><p>å…¶ä¸­çº¿ç¨‹ç«äº‰é”ä¹‹å‰ï¼Œè‚¯å®šéœ€è¦å…ˆæŸ¥çœ‹å½“å‰é”çš„æ ‡è®°ä½ï¼Œä»¥ä¸åŒçš„æ–¹å¼æ¥ç«äº‰é”èµ„æºã€‚</p><p><strong>é”å‡çº§</strong></p><ul><li><p>åˆå§‹åŒ–çŠ¶æ€çš„å¯¹è±¡çš„é”ä¿¡æ¯æœ‰ä¸¤ç§æƒ…å†µ**ï¼ˆæ— é”ï¼‰**ï¼š</p></li><li><p>æ— é”çŠ¶æ€ï¼šå½“å‰çŠ¶æ€æ²¡æœ‰å¼€å¯åå‘é”ã€‚</p></li><li><p>åŒ¿ååå‘ï¼šå½“å‰çŠ¶æ€å¼€å¯äº†åå‘é”ï¼Œæ²¡æœ‰åå‘ä»»ä½•çº¿ç¨‹ã€‚</p></li><li><p>åå‘é”ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‹¿é”èµ„æºï¼Œæ²¡æœ‰ç«äº‰ã€‚</p></li><li><p>è½»é‡çº§é”ï¼šä»¥CASçš„æ–¹å¼ï¼Œå»ç«äº‰é”èµ„æºï¼Œä¸ä¼šè®©çº¿ç¨‹æŒ‚èµ·ã€‚ï¼ˆè‡ªé€‚åº”è‡ªæ—‹é”ï¼‰ï¼ˆLockRecordï¼‰</p></li><li><p>é‡é‡çº§é”ï¼šç›´æ¥é‡‡ç”¨MarkWordæŒ‡å‘çš„ObjectMonitorä»¥ä¼ ç»Ÿçš„æ–¹å¼å»ç«äº‰é”èµ„æºã€‚</p></li></ul><p><strong>åå‘é”çš„é‡å…¥æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</strong></p><ul><li>å…¶å®åå‘é”æ—¶ï¼Œä¹Ÿç”¨åˆ°äº†LockRecordï¼Œåªä¸è¿‡å†…éƒ¨ä¸ä¼šå­˜å‚¨hashcodeä¿¡æ¯ç­‰ç­‰ï¼Œåœ¨åå‘é”é‡å…¥æ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šå‹æ ˆä¸€ä¸ªLockRecordï¼Œä»è€Œå®ç°åå‘é”é‡å…¥ã€‚</li></ul><p><strong>è½»é‡çº§é”çš„CASæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</strong></p><ul><li>åœ¨é‡é‡çº§é”ä¸­å®ç°çš„ã€‚åŸºäºTryLockæ–¹æ³•é‡‡ç”¨</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>int ObjectMonitor::TryLock (Thread * Self) {</span></span>
<span class="line"><span>   for (;;) {</span></span>
<span class="line"><span>      void * own = _owner ;</span></span>
<span class="line"><span>      if (own != NULL) return 0 ;</span></span>
<span class="line"><span>      if (Atomic::cmpxchg_ptr (Self, &amp;_owner, NULL) == NULL) {</span></span>
<span class="line"><span>         // Either guarantee _recursions == 0 or set _recursions = 0.</span></span>
<span class="line"><span>         assert (_recursions == 0, &quot;invariant&quot;) ;</span></span>
<span class="line"><span>         assert (_owner == Self, &quot;invariant&quot;) ;</span></span>
<span class="line"><span>         // CONSIDER: set or assert that OwnerIsThread == 1</span></span>
<span class="line"><span>         return 1 ;</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>      // The lock had been free momentarily, but we lost the race to the lock.</span></span>
<span class="line"><span>      // Interference -- the CAS failed.</span></span>
<span class="line"><span>      // We can either return -1 or retry.</span></span>
<span class="line"><span>      // Retry doesn&#39;t make as much sense because the lock was just acquired.</span></span>
<span class="line"><span>      if (true) return -1 ;</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><strong>synchronizedå’ŒReentrantLockåæœŸæ›´æ¨èä½¿ç”¨è°ã€‚</strong></p><p>åæœŸè‚¯å®šæ˜¯ä½¿ç”¨synchronizedï¼Œå› ä¸ºsynchronizedåº•å±‚æ›´åˆ©äºåæœŸç‰ˆæœ¬çš„ä¼˜åŒ–ï¼Œè€ŒReentrantLockå†æ€ä¹ˆç©ä¹Ÿæ˜¯åŸºäºJavaå±‚é¢çš„é”ã€‚</p><p><strong>é”æ¶ˆé™¤</strong></p><p>JMMå±‚é¢åœ¨ç¼–è¯‘æ—¶ï¼Œå¦‚æœå‘å±•åŠ é”çš„ä½ç½®ä¸å­˜åœ¨ä»»ä½•çš„å…±äº«èµ„æºæ“ä½œæˆ–è€…æ˜¯å¼•å‘çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ï¼Œé‚£ä¹ˆå»æ‰ç«äº‰å’Œé‡Šæ”¾é”èµ„æºçš„æ“ä½œã€‚</p><p><strong>é”è†¨èƒ€</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>while(xxx){</span></span>
<span class="line"><span>    synchronized(this){</span></span>
<span class="line"><span>        // ã€‚ã€‚ã€‚</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>synchronized(this){</span></span>
<span class="line"><span>    while(xxx){</span></span>
<span class="line"><span>        // ã€‚ã€‚ã€‚</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="_1-2-reentrantlock" tabindex="-1">1.2 ReentrantLock <a class="header-anchor" href="#_1-2-reentrantlock" aria-label="Permalink to &quot;1.2 ReentrantLock&quot;">â€‹</a></h3><p>AQSï¼šé˜Ÿåˆ— + çŠ¶æ€ä½ï¼Œå°±æ˜¯ä¸€ä¸ªJUCä¸‹çš„åŸºç¡€ç±»ï¼Œå¤§é‡JUCä¸‹çš„å¹¶å‘å·¥å…·éƒ½æ˜¯åŸºäºAQSå®ç°çš„ã€‚</p><p>çŠ¶æ€ä½stateï¼švolatileä¿®é¥°ï¼ŒCASä¿®æ”¹çš„intç±»å‹æ•°å€¼ã€‚</p><p>é˜Ÿåˆ—ï¼šåŒå‘é“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªNodeã€‚</p><p><strong>å…¬å¹³é”å’Œéå…¬å¹³é”</strong></p><p>lockï¼šéå…¬å¹³é”ç›´æ¥CASä¿®æ”¹stateï¼Œå¦‚æœå¤±è´¥ï¼Œæ‰§è¡Œacquireã€‚å…¬å¹³é”æ‰§è¡Œæ‰§è¡Œacquireã€‚</p><p>tryAcquireï¼šåœ¨å‘ç°stateä¸º0æ—¶ã€‚</p><ul><li><p>éå…¬å¹³é”ï¼Œç›´æ¥CASä¿®æ”¹stateã€‚</p></li><li><p>å…¬å¹³é”ï¼ŒæŸ¥çœ‹é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ’é˜Ÿçš„Nodeï¼Œå¦‚æœæœ‰ï¼ŒæŸ¥çœ‹headçš„nextæ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œç„¶åå†å†³å®šæ˜¯å¦CASä¿®æ”¹state</p></li></ul><p><strong>ä¸ºä»€ä¹ˆå”¤é†’Nodeæ—¶ï¼Œè¦ä»åå¾€å‰éå†æ‰¾åˆ°ç¦»headæœ€è¿‘çš„Nodeï¼Ÿ</strong></p><p>åœ¨æ‰§è¡ŒaddWaiteræ–¹æ³•æ—¶ï¼Œå…ˆå°†å½“å‰Nodeçš„prevæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå†å°†tailæŒ‡å‘å½“å‰èŠ‚ç‚¹ã€‚æ­¤æ—¶ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„nextè¿˜æœ‰æ²¡æœ‰æŒ‡å‘å½“å‰èŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œä¼šå¯¼è‡´éå†æ—¶ï¼Œä¸¢å¤±èŠ‚ç‚¹ã€‚</p><h3 id="_1-3-reentrantreadwritelock" tabindex="-1">1.3 ReentrantReadWriteLock <a class="header-anchor" href="#_1-3-reentrantreadwritelock" aria-label="Permalink to &quot;1.3 ReentrantReadWriteLock&quot;">â€‹</a></h3><p><strong>è¯»å†™é”å®ç°å®ç°åŸç†</strong></p><p>è¿˜æ˜¯åŸºäºAQSå®ç°çš„ï¼Œå°†stateçš„é«˜16ä½ä½œä¸ºè¯»é”çš„ä¿¡æ¯ï¼Œä½16ä½ä½œä¸ºå†™é”çš„ä¿¡æ¯ã€‚</p><p>è¯»é”æ˜¯å…±äº«é”ã€‚å†™é”æ˜¯äº’æ–¥é”ã€‚</p><p><strong>å¦‚ä½•é¿å…å†™é”é¥¥é¥¿çš„</strong></p><p>è¯»é”è·å–é”èµ„æºæ—¶ï¼Œåˆ¤æ–­å½“å‰åœ¨AQSä¸­æ’é˜Ÿçš„æ˜¯å¦æ˜¯å†™é”èµ„æºï¼Œå¦‚æœæ˜¯å†™é”ï¼Œè¯»é”ä¼šç›´æ¥åœ¨AQSä¸­æ’é˜Ÿ</p><p><strong>è¯»é”é‡å…¥å¦‚ä½•å®ç°</strong></p><p>è¯»é”å¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰ï¼Œå¦‚æœä¸æ¸…æ¥šæ¯ä¸ªçº¿ç¨‹é‡å…¥çš„æ¬¡æ•°ï¼Œæ— æ³•ç¡®å®šè¯»é”èµ„æºæ˜¯å¦é‡Šæ”¾å¹²å‡€ã€‚</p><p>ReentrantReadWriteLockå°±åŸºäºThreadLocalæ¥è®°å½•å½“å‰çº¿ç¨‹è¯»é”é‡å…¥çš„æ¬¡æ•°ã€‚</p><p>å½“ç„¶ï¼ŒåŒæ—¶ä¹Ÿè¦å¯¹stateçš„é«˜16ä½ï¼Œè¿›è¡Œä¿®æ”¹ã€‚</p><p><strong>è¯»é”é‡å…¥çš„ä¼˜åŒ–</strong></p><p>ç¬¬ä¸€ä¸ªæŒæœ‰è¯»é”çš„çº¿ç¨‹ï¼Œæ— éœ€å°†é‡å…¥æ¬¡æ•°è®¾ç½®åˆ°ThreadLocalä¸­ï¼Œç›´æ¥ä½¿ç”¨è¯»å†™é”å†…éƒ¨æä¾›çš„firstReaderæ¥è®°å½•å½“å‰çº¿ç¨‹ï¼Œé‡‡ç”¨firstReaderHoldCountæ¥è®°å½•è¯»é”é‡å…¥çš„æ¬¡æ•°ã€‚</p><p>æœ€åä¸€ä¸ªæ¥ç«äº‰è¯»é”èµ„æºçš„çº¿ç¨‹ï¼ˆä¸åŒ…å«ç¬¬ä¸€ä¸ªï¼‰ï¼Œé‡‡ç”¨cachedHoldCounteræ¥è®°å½•é”é‡å…¥æ¬¡æ•°ï¼Œä¹Ÿä¼šåœ¨ThreadLocalä¸­å­˜å‚¨ä¸€ä»½ï¼Œä½†æ˜¯å¦‚æœå½“å‰çº¿ç¨‹å†æ¬¡é‡å…¥ï¼Œä¸éœ€è¦ä»ThreadLocalä¸­è·å–ï¼Œè€Œæ˜¯ç›´æ¥ä¿®æ”¹cachedHoldCounterå³å¯</p><h2 id="äºŒã€threadpoolexecutor" tabindex="-1">äºŒã€ThreadPoolExecutor <a class="header-anchor" href="#äºŒã€threadpoolexecutor" aria-label="Permalink to &quot;äºŒã€ThreadPoolExecutor&quot;">â€‹</a></h2><p><strong>çº¿ç¨‹æ± çš„7ä¸ªæ ¸å¿ƒå‚æ•°</strong></p><p>ä¸ä¼šçš„ï¼Œå‡ºé—¨å·¦è½¬ã€‚</p><p><strong>çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥</strong></p><p>çº¿ç¨‹æ± è‡ªå¸¦å››ç§ï¼Œå¦‚ä½•å¯ä»¥æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œç›´æ¥ç”¨å³å¯ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œå¯ä»¥è‡ªè¡Œå®ç°RejectedExecutionHandleræ¥å£ï¼Œé‡å†™åŠŸèƒ½ã€‚</p><p><strong>çº¿ç¨‹æ± çš„çŠ¶æ€</strong></p><p>RUNNINGï¼ŒSHOTDOWNï¼ŒSTOPï¼ŒTIDYINGï¼ŒTERMINATED</p><p>TIDYINGæ˜¯è¿‡æ¸¡çŠ¶æ€ï¼Œå¯ä»¥ä»SHUTDOWNå’ŒSTOPçŠ¶æ€è½¬æ¢è¿‡æ¥ï¼Œå…¶å®åˆ°äº†TIDYINGï¼Œå·¥ä½œçº¿ç¨‹å·²ç»æ²¡äº†ï¼Œå·¥ä½œé˜Ÿåˆ—çš„ä»»åŠ¡ä¹Ÿå¤„ç†å®Œäº†ã€‚å°±å·®æ‰§è¡Œä¸€ä¸ªterminatedæ–¹æ³•ï¼Œè½¬æ¢åˆ°TERMINATEDçŠ¶æ€</p><p><strong>çº¿ç¨‹æ± çš„ctlå±æ€§</strong></p><p>é«˜3ä½å­˜å‚¨çº¿ç¨‹æ± çŠ¶æ€ï¼Œä½29ä½å­˜å‚¨å·¥ä½œçº¿ç¨‹ä¸ªæ•°ã€‚</p><p><strong>çº¿ç¨‹æ± çš„æ‰§è¡Œæµç¨‹</strong></p><p>ä¸ä¼šçš„ï¼Œå‡ºé—¨å³è½¬ã€‚</p><p><strong>ä¸ºä»€ä¹ˆçº¿ç¨‹æ± è¦æ·»åŠ éæ ¸å¿ƒå¹¶ä¸”æ²¡æœ‰ä»»åŠ¡çš„å·¥ä½œçº¿ç¨‹addWroker(null,false);</strong></p><p>å½“å‰å·¥ä½œçº¿ç¨‹ä¸ªæ•°ä¸º0ï¼Œä½†æ˜¯å·¥ä½œé˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡</p><p>æ­¤æ—¶å°±éœ€è¦æ·»åŠ ä¸€ä¸ªéæ ¸å¿ƒå¹¶ä¸”ç©ºä»»åŠ¡çš„å·¥ä½œçº¿ç¨‹å»å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</p><p><strong>Workerä¸­çš„é”æ˜¯å¹²å˜›çš„</strong></p><p>Workerä¸­åŸºäºAQSå®ç°äº†ä¸€ä¸ªéå¯é‡å…¥é”ã€‚</p><p>Workerä¸ºäº†é¿å…ä¸­æ–­çº¿ç¨‹æ—¶ï¼ŒWorkerè¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆï¼Œå¯¼è‡´å‡ºç°é—®é¢˜ã€‚</p><p><strong>å¦‚ä½•åœ¨çº¿ç¨‹æ± ä¹‹å‰ä»»åŠ¡å‰ååšé¢å¤–å¤„ç†</strong></p><p>çº¿ç¨‹æ± æä¾›äº†ä¸¤ä¸ªå‹¾å­å‡½æ•°ã€‚</p><h2 id="ä¸‰ã€concurrenthashmap-1-8" tabindex="-1">ä¸‰ã€ConcurrentHashMapï¼ˆ1.8ï¼‰ <a class="header-anchor" href="#ä¸‰ã€concurrenthashmap-1-8" aria-label="Permalink to &quot;ä¸‰ã€ConcurrentHashMapï¼ˆ1.8ï¼‰&quot;">â€‹</a></h2><p><strong>ConcurrentHashMapåœ¨JDK1.8ä¸­å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨</strong></p><p>é˜¿å·´é˜¿å·´â€¦â€¦</p><p><strong>ConcurrentHashMapçš„æ•£åˆ—ç®—æ³•</strong></p><p>é˜¿å·´é˜¿å·´â€¦â€¦</p><p><strong>ConcurrentHashMapçš„æ•°ç»„é•¿åº¦ä¸ºä½•æ˜¯2çš„næ¬¡å¹‚</strong></p><p>é˜¿å·´é˜¿å·´â€¦â€¦</p><p><strong>ConcurrentHashMapå¦‚ä½•å®ç°å¹¶å‘æ‰©å®¹çš„</strong></p><p>resizeStampï¼ŒsizeCtlï¼Œæ‰©å®¹çº¿ç¨‹æ•° + 1</p><p><strong>ConcurrentHashMapä¸­çš„addCountå¦‚ä½•å®ç°</strong></p><p>addCountåœ¨è®°å½•ConcurrentHashMapä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œå› ä¸ºAtomicLongåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæ€§èƒ½è¾ƒä½ï¼Œæ‰€ä»¥ConcurrentHashMapä¸­é‡‡ç”¨äº†LongAdderçš„å®ç°æ–¹å¼ï¼Œå…¶å®å°±æ˜¯å°†LongAdderçš„æºç ï¼Œå¤åˆ¶è¿‡æ¥æ”¹äº†ä¸€æ”¹ã€‚å¹¶ä¸”åœ¨addCountæ–¹æ³•ä¸­ï¼Œè¿˜ä¼šæœ‰æ‰©å®¹çš„åˆ¤æ–­ã€‚</p><p><strong>ConcurrentHashMapçº¢é»‘æ ‘ä»€ä¹ˆæƒ…å†µä¼šè½¬æ¢ä¸ºé“¾è¡¨</strong></p><p>æ‰©å®¹æ—¶ï¼Œæˆ–è€…åˆ é™¤çº¢é»‘æ ‘æ•°æ®é•¿åº¦å°äºç­‰äº6æ—¶ï¼Œéƒ½æœ‰å¯èƒ½å°†çº¢é»‘æ ‘è½¬ä¸ºé“¾è¡¨</p><p><strong>ConcurrentHashMapåœ¨æœ‰çº¿ç¨‹å†™çº¢é»‘æ ‘æ—¶ï¼Œè¯»æ“ä½œæ€ä¹ˆåŠ</strong></p><p>é“¾è¡¨åœ¨æ‰©å®¹ä¸ºçº¢é»‘æ ‘çš„åŒæ—¶ï¼Œä¼šä¿ç•™åŒå‘é“¾è¡¨å’Œçº¢é»‘æ ‘ã€‚</p><p>æ­¤æ—¶ä¼šæŸ¥è¯¢åŒå‘é“¾è¡¨ï¼Œä¸ä¼šæŸ¥è¯¢çº¢é»‘æ ‘ã€‚</p><p><strong>ConcurrentHashMapçš„lastRunæœºåˆ¶æ˜¯ä»€ä¹ˆ</strong></p><p>é˜¿å·´é˜¿å·´â€¦â€¦</p><h2 id="å››ã€å¹¶å‘å·¥å…·" tabindex="-1">å››ã€å¹¶å‘å·¥å…· <a class="header-anchor" href="#å››ã€å¹¶å‘å·¥å…·" aria-label="Permalink to &quot;å››ã€å¹¶å‘å·¥å…·&quot;">â€‹</a></h2><h3 id="_4-1-countdownlatch" tabindex="-1">4.1 CountDownLatch <a class="header-anchor" href="#_4-1-countdownlatch" aria-label="Permalink to &quot;4.1 CountDownLatch&quot;">â€‹</a></h3><p><strong>CountDownLatchå®ç°åŸç†</strong></p><p>CountDownLatchåŸºäºAQSå®ç°çš„ï¼Œåˆå§‹åŒ–æ—¶ç»™å®šä¸€ä¸ªstateçš„å€¼ã€‚</p><p>æ¯æ¬¡çº¿ç¨‹æ‰§è¡ŒcountDownæ–¹æ³•æ—¶ï¼Œå¯¹state - 1ã€‚</p><p>å¦‚æœçº¿ç¨‹åœ¨æ‰§è¡Œawaitæ–¹æ³•æ—¶ï¼š</p><ul><li><p>state &gt; 0ï¼Œæ­¤æ—¶çº¿ç¨‹æŒ‚èµ·</p></li><li><p>state == 0ï¼Œæ­¤æ—¶çº¿ç¨‹è¢«å”¤é†’</p></li></ul><h3 id="_4-2-semaphore" tabindex="-1">4.2 Semaphore <a class="header-anchor" href="#_4-2-semaphore" aria-label="Permalink to &quot;4.2 Semaphore&quot;">â€‹</a></h3><p><strong>Semaphoreå®ç°åŸç†</strong></p><p>è¿˜æ˜¯åŸºäºAQSå®ç°çš„ï¼Œä¸€èˆ¬ç”¨äºå›ºå®šèµ„æºï¼Œæ¯”å¦‚è¿æ¥æ± ï¼Œçº¿ç¨‹æ± ç­‰ç­‰ã€‚</p><p>ç±»ä¼¼è®¡æ•°å™¨ã€‚æ¯æ¬¡ä»çº¿ç¨‹ä¸­åŸºäºacquireæ‹¿åˆ°èµ„æºï¼Œä½¿ç”¨å®Œæ¯•åï¼ŒåŸºäºreleaseå½’è¿˜èµ„æºã€‚</p><p><strong>PROPAGATEç±»å‹Nodeçš„ä½œç”¨</strong></p><p>å› ä¸ºåœ¨JDK1.5ä¸­ï¼ŒSemaphoreå­˜åœ¨èµ„æºæ— æ³•è¢«æ­£å¸¸ä½¿ç”¨çš„æƒ…å†µã€‚</p><p>ä¿¡å·é‡ä¸­æœ‰èµ„æºï¼Œä½†æ˜¯çº¿ç¨‹é€šè¿‡acquireæ— æ³•è·å–</p><p>åŸºäºPROPAGATEç±»å‹çš„Nodeï¼Œå¯ä»¥åœ¨å”¤é†’å½“å‰çº¿ç¨‹åï¼Œç»§ç»­å”¤é†’åç»­çº¿ç¨‹</p><h3 id="_4-3-cyclicbarrier" tabindex="-1">4.3 CyclicBarrier <a class="header-anchor" href="#_4-3-cyclicbarrier" aria-label="Permalink to &quot;4.3 CyclicBarrier&quot;">â€‹</a></h3><p><strong>CyclicBarrierå®ç°åŸç†</strong></p><p>Javaä¸­çš„æ …æ </p><p>ç±»ä¼¼CountDownLatchçš„åŸç†ï¼Œç­‰å¾…æŒ‡å®šæ•°é‡çš„çº¿ç¨‹æ‰§è¡Œawaitæ–¹æ³•åï¼Œä¸€èµ·å¹¶è¡Œå»æ‰§è¡Œè¿™äº›çº¿ç¨‹çš„åç»­ä»»åŠ¡ã€‚</p><p>CyclicBarrieræ˜¯å¯ä»¥é‡ç½®stateçš„ï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡æ‰§è¡Œä¸€æ¬¡åï¼Œå¯ä»¥é‡æ–°åå¤ä½¿ç”¨å½“å‰çš„CyclicBarrier</p><p><strong>ReentrantLockçš„Conditionçš„å®ç°åŸç†</strong></p><p>å½“çº¿ç¨‹è·å–åˆ°é”èµ„æºåï¼ŒåŸºäºConditionæŒ‚èµ·çº¿ç¨‹æ—¶ï¼Œä¼šé‡Šæ”¾é”èµ„æºï¼Œå¹¶ä¸”å°†å½“å‰çº¿ç¨‹å°è£…åˆ°AQSä¸­çš„Conditionä¸­çš„ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œå½“åŸºäºsignalæ–¹æ³•å”¤é†’åï¼Œä¼šæ‰”åˆ°AQSçš„åŒå‘é“¾è¡¨ä¸­</p><h2 id="_5ã€é˜»å¡é˜Ÿåˆ—" tabindex="-1">5ã€é˜»å¡é˜Ÿåˆ— <a class="header-anchor" href="#_5ã€é˜»å¡é˜Ÿåˆ—" aria-label="Permalink to &quot;5ã€é˜»å¡é˜Ÿåˆ—&quot;">â€‹</a></h2><h3 id="_5-1-arrayblockingqueue" tabindex="-1">5.1 ArrayBlockingQueue <a class="header-anchor" href="#_5-1-arrayblockingqueue" aria-label="Permalink to &quot;5.1 ArrayBlockingQueue&quot;">â€‹</a></h3><p>åŸºäºæ•°ç»„å®ç°çš„é˜»å¡é˜Ÿåˆ—</p><p><strong>è™šå‡å”¤é†’</strong></p><p>åœ¨awaitæŒ‚èµ·çº¿ç¨‹åˆ¤æ–­çš„ä½ç½®ï¼Œé‡‡ç”¨whileå¾ªç¯å»è§£å†³è™šå‡å”¤é†’ã€‚</p><p>å¦‚æœä½¿ç”¨ifåˆ¤æ–­ï¼Œä¼šé€ æˆå¤šä¸ªçº¿ç¨‹åœ¨ä¸æ»¡è¶³æƒ…å†µä¸‹ï¼Œå»å‘é˜»å¡é˜Ÿåˆ—è¿½åŠ æ•°æ®ï¼Œå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚ã€</p><h3 id="_5-2-linkedblockingqueue" tabindex="-1">5.2 LinkedBlockingQueue <a class="header-anchor" href="#_5-2-linkedblockingqueue" aria-label="Permalink to &quot;5.2 LinkedBlockingQueue&quot;">â€‹</a></h3><p>åŸºäºé“¾è¡¨å®ç°çš„é˜»å¡é˜Ÿåˆ—</p><h3 id="_5-3-priorityqueue" tabindex="-1">5.3 PriorityQueue <a class="header-anchor" href="#_5-3-priorityqueue" aria-label="Permalink to &quot;5.3 PriorityQueue&quot;">â€‹</a></h3><p>åŸºäºæ•°ç»„å®ç°çš„äºŒå‰å †ï¼ŒåŸºäºäºŒå‰å †å®ç°çš„ä¼˜å…ˆçº§é˜Ÿåˆ—</p><h3 id="_5-4-priorityblockingqueue" tabindex="-1">5.4 PriorityBlockingQueue <a class="header-anchor" href="#_5-4-priorityblockingqueue" aria-label="Permalink to &quot;5.4 PriorityBlockingQueue&quot;">â€‹</a></h3><p>åŸºäºPriorityQueueå®ç°çš„é˜»å¡é˜Ÿåˆ—</p><h3 id="_5-5-delayedqueue" tabindex="-1">5.5 DelayedQueue <a class="header-anchor" href="#_5-5-delayedqueue" aria-label="Permalink to &quot;5.5 DelayedQueue&quot;">â€‹</a></h3><p>åŸºäºPriorityQueueå®ç°çš„å»¶è¿Ÿé˜Ÿåˆ—ï¼Œè¦æ±‚æ’å…¥çš„æ•°æ®è¦å®ç°Delayedæ¥å£ã€‚</p><h3 id="_5-6-synchronousqueue" tabindex="-1">5.6 SynchronousQueue <a class="header-anchor" href="#_5-6-synchronousqueue" aria-label="Permalink to &quot;5.6 SynchronousQueue&quot;">â€‹</a></h3><p>ä¸ä¼šå°†æ•°ç»„å­˜æ”¾åˆ°æŒ‡å®šä½ç½®ï¼Œç”Ÿäº§è€…æ”¾æ•°æ®ï¼Œå°±è¦ä¸€ç›´ç­‰åˆ°æ¶ˆè´¹è€…æ¥æ¶ˆè´¹ã€‚</p><h2 id="_6ã€schedulethreadpoolexecutor" tabindex="-1">6ã€ScheduleThreadPoolExecutor <a class="header-anchor" href="#_6ã€schedulethreadpoolexecutor" aria-label="Permalink to &quot;6ã€ScheduleThreadPoolExecutor&quot;">â€‹</a></h2><p><strong>executeï¼Œscheduleï¼ŒscheduleAtFixedRateï¼ŒscheduleWithFixedDelayçš„åŒºåˆ«</strong></p><ul><li><p>executeï¼šæ­£å¸¸æ‰§è¡Œä»»åŠ¡ï¼Œè·Ÿå®šæ—¶æ‰§è¡Œæ²¡å…³ç³»ã€‚</p></li><li><p>scheduleï¼šå»¶è¿Ÿä¸€æ®µæ—¶é—´æ‰§è¡Œã€‚æ‰§è¡Œä¸€æ¬¡ã€‚</p></li><li><p>scheduleAtFixedRateï¼šå¯ä»¥è®©ä»»åŠ¡åœ¨å›ºå®šçš„å‘¨æœŸä¸‹æ‰§è¡Œã€‚ï¼ˆå¦‚æœä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼Œè¶…è¿‡äº†å»¶è¿Ÿæ—¶é—´ï¼Œé‡‡ç”¨ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä½œä¸ºå‘¨æœŸï¼‰è¿™é‡Œä¼šé‡‡ç”¨ä¸Šæ¬¡ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ç‚¹ï¼ŒåŠ ä¸Šå»¶è¿Ÿæ—¶é—´ï¼Œä½œä¸ºä¸‹æ¬¡ä»»åŠ¡çš„æ—¶é—´</p></li><li><p>scheduleWithFixedDelayï¼šå¯ä»¥è®©ä»»åŠ¡åœ¨å›ºå®šçš„å‘¨æœŸä¸‹æ‰§è¡Œã€‚ï¼ˆä»»åŠ¡çš„å¤„ç†æ—¶é—´ï¼Œå½±å“ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼‰</p></li></ul><h2 id="_7ã€completablefuture" tabindex="-1">7ã€CompletableFuture <a class="header-anchor" href="#_7ã€completablefuture" aria-label="Permalink to &quot;7ã€CompletableFuture&quot;">â€‹</a></h2><p><strong>CompletableFutureæ˜¯ä»€ä¹ˆ</strong></p><p>å®ç°äº†å¼‚æ­¥éé˜»å¡çš„æ•ˆæœã€‚å°±æ˜¯åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œä¼šä¸»åŠ¨é€šçŸ¥ï¼Œä¸éœ€è¦è°ƒç”¨æ–¹ä¸»åŠ¨ä¼šè·å–ã€‚</p><p><strong>CompletableFutureçš„åç»­ä»»åŠ¡æ˜¯åŸºäºä»€ä¹ˆå­˜å‚¨çš„</strong></p><p>æ ˆ</p><p><strong>CompletableFutureä¸ºä½•ä¸èƒ½ä¿è¯åç»­ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº</strong></p><p>å› ä¸ºä»»åŠ¡æ˜¯å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œä¸šåŠ¡çº¿ç¨‹ä¾ç„¶å¯ä»¥ç»™CompletableFutureè®¾ç½®åç»­ä»»åŠ¡ï¼Œå¦‚æœåœ¨è®¾ç½®ä»»åŠ¡åˆ°æ ˆç»“æ„ä¹‹å‰ï¼Œå‰ç½®ä»»åŠ¡å·²ç»æ‰§è¡Œå®Œäº†ï¼Œå°±ä¸éœ€è¦å†å­˜æ”¾åˆ°æ ˆç»“æ„äº†ï¼Œç›´æ¥æ‰§è¡Œå³å¯ã€‚</p><p><strong>å¦‚æœæœ‰æ—¶é—´ï¼Œä¸€å®šè¦ç³»ç»Ÿçš„çœ‹ä¸€ä¸‹æºç ï¼Œè¿™æ ·ä¾èµ–å…«è‚¡æ–‡ä»€ä¹ˆçš„å°±ä¸ç”¨çœ‹äº†ã€‚</strong></p></div></div></main><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-8bc02b95 data-v-9f0389bf><div class="container" data-v-9f0389bf><p class="message" data-v-9f0389bf>waitingresult.com</p><p class="copyright" data-v-9f0389bf>Copyright Â© 2024 Luyuan</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"01-dev_01.01-java_juc_conditionæ¥å£.md\":\"CBauyWml\",\"01-dev_01.01-java_cloud_higress.md\":\"5NuC1AiB\",\"01-dev_01.04-è®¾è®¡æ¨¡å¼_04-ç»“æ„å‹_ä»£ç†.md\":\"ChfEte8G\",\"01-dev_01.03-ç½‘ç»œå®‰å…¨_01-ç½‘ç»œå®‰å…¨ç®€ä»‹.md\":\"Czm6Zh__\",\"01-dev_01.08-æ•°æ®åº“_03-redis_redis-å…¥é—¨åŸºç¡€.md\":\"BRMZnMGp\",\"01-dev_01.08-æ•°æ®åº“_00-ã€Šmysqlæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹_01-ã€Šè£…ä½œè‡ªå·±æ˜¯ä¸ªå°ç™½ã€‹-åˆè¯†mysql.md\":\"COufAnTt\",\"01-dev_01.01-java_juc_çº¿ç¨‹æ± .md\":\"CulXJw8l\",\"01-dev_01.08-æ•°æ®åº“_02-mysql_mysqlç‰¹æ®Šå‘½ä»¤.md\":\"CCvYDuEi\",\"01-dev_01.01-java_javaåŸºç¡€_æ³›å‹.md\":\"DD-sSnE4\",\"01-dev_01.06-linux_ç¯å¢ƒå®‰è£…_åŸºç¡€ç¯å¢ƒé—®é¢˜.md\":\"D0rXXryc\",\"links.md\":\"CWYMcL_F\",\"01-dev_01.69-æŠ€æœ¯è§„èŒƒ_01-æ¢ç´¢æ—¥å¿—è§„çº¦.md\":\"CyfUHpSj\",\"01-dev_01.05-ç®—æ³•_ä¸šåŠ¡ç®—æ³•_dfa.md\":\"DIOGn4MH\",\"02-person_02-åšæ–‡æˆé•¿_ä¸ªäººæå‡_æŒæ¡ä¹ æƒ¯.md\":\"ipX8Raoh\",\"02-person_03-ç‹¬ç«‹å¼€å‘è€…_ç‹¬ç«‹å¼€å‘å¤šäººï¼ˆè¿œç¨‹ï¼‰åä½œç»éªŒåˆ†äº«.md\":\"BNeQLmSs\",\"02-person_01-é¡¹ç›®ç®¡ç†_åˆ˜æ¶¦å¯¹è¯æ¨Šç™»ï¼šåšå›¢é˜Ÿï¼Œæˆ‘ä»¬åªæ‹›æˆå¹´äºº.md\":\"CrD38FXO\",\"01-dev_01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ_åŠ å¯†_excel_wordæ–‡ä»¶åŠ å¯†.md\":\"D0t1T-IB\",\"02-person_06-åšå®¢æ­å»º_åŸºäºgithubactionså®ç°githubä¸giteeçš„åŒæ­¥.md\":\"CmDNpE87\",\"01-dev_01.09-docker_01-dockercompose_å¸¸ç”¨-ç¯å¢ƒæœåŠ¡-dockerfile.md\":\"MXJ8bUyU\",\"01-dev_01.08-æ•°æ®åº“_03-redis_redis.md\":\"B8dpbPiA\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_01-æœç´¢_é˜¿é‡Œå·´å·´-æ™ºèƒ½å¼€æ”¾æœç´¢.md\":\"sLRfAIuE\",\"01-dev_01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ_springboot_eventè§‚å¯Ÿè€….md\":\"D37b30ZX\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _02-è·¨å¢ƒç”µå•†å‰ç½®çŸ¥è¯†.md\":\"CTU9T5Mf\",\"01-dev_01.09-docker_dockerè½¯ä»¶å®‰è£…_00-dockeré•œåƒæ–¹å¼æ­å»ºxxl.md\":\"Cvdzv4qi\",\"01-dev_01.06-linux_è™šæ‹Ÿæœº_virtualbox.md\":\"CwpN4Hsw\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_03-ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€_01-ç½‘çº¢ç³»ç»Ÿ_æ ·å“ä¸šåŠ¡é€»è¾‘æ¢³ç†.md\":\"DyB6YsLT\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _04-è·¨å¢ƒä¸šåŠ¡_ç»„ç½‘ä¼˜å…ˆçº§.md\":\"D5hUSE6r\",\"01-dev_01.99-plugins_obsidianæ’ä»¶å¼€å‘_å¿«é€Ÿå…¥é—¨.md\":\"CmAqnpvi\",\"02-person_06-åšå®¢æ­å»º_rsså¤„ç†.md\":\"D5elg70O\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹_04-ç®—æ³•ç­–ç•¥.md\":\"LUF-nXML\",\"01-dev_01.08-æ•°æ®åº“_00-ã€Šmysqlæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹_03-ã€Šä¹±ç çš„å‰ä¸–ä»Šç”Ÿã€‹-å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™.md\":\"BeymwEdu\",\"01-dev_01.03-ç½‘ç»œå®‰å…¨_02-å¸¸è§å®‰å…¨é—®é¢˜.md\":\"Bf6-g5o2\",\"01-dev_01.09-docker_dockerè½¯ä»¶å®‰è£…_minio.md\":\"Bfvl5oON\",\"ä¿®æ”¹configts.md\":\"B7QF1p6i\",\"01-dev_01.01-java_ç³»ç»Ÿä¼˜åŒ–.md\":\"D4bqEfbY\",\"02-person_index.md\":\"CMdNugDb\",\"01-dev_01.04-è®¾è®¡æ¨¡å¼_01-æ·±å…¥è®¾è®¡æ¨¡å¼_01-é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ç®€ä»‹.md\":\"Ca6HoMSE\",\"support.md\":\"BfU2fh6x\",\"01-dev_01.08-æ•°æ®åº“_02-mysql_é—®é¢˜å¼•å¯¼å­¦ä¹ .md\":\"BHxKVABD\",\"01-dev_01.10-devops_å‰è¨€.md\":\"D-wgSlwL\",\"01-dev_01.01-java_jvm_06-javaå¯¹è±¡çš„å†…å­˜æ¨¡å‹å¸ƒå±€.md\":\"DPO1IR9f\",\"01-dev_01.05-ç®—æ³•_äºŒåˆ†.md\":\"BPgxUBqx\",\"01-dev_01.01-java_jvm_04-jvmçš„åƒåœ¾æ”¶é›†ç®—æ³•.md\":\"CpciZf7X\",\"01-dev_01.01-java_cloud_alibaba_nacos_æºç åˆ†æ.md\":\"CLqfUOty\",\"01-dev_01.04-è®¾è®¡æ¨¡å¼_03-è¡Œä¸ºå‹_è´£ä»»é“¾.md\":\"uuGkKU6l\",\"01-dev_01.09-docker_dockerè½¯ä»¶å®‰è£…_powerjob.md\":\"DwbrZjwn\",\"01-dev_01.02-å‰ç«¯_npm_pnpm.md\":\"BS6ofloC\",\"01-dev_01.04-è®¾è®¡æ¨¡å¼_04-ç»“æ„å‹_é—¨é¢.md\":\"DQE9Xrgh\",\"01-dev_01.01-java_juc_ä¿¡å·é‡.md\":\"DRYc4hKu\",\"01-dev_01.10-devops_äº‘æ•ˆæµæ°´çº¿æ„å»º.md\":\"BW55MVUy\",\"01-dev_01.01-java_jvm_05-åŒäº²å§”æ´¾æ¨¡å‹.md\":\"D8YAO1DA\",\"01-dev_01.01-java_javaåŸºç¡€_serializable.md\":\"S5J5I4LF\",\"01-dev_01.01-java_juc_callable å®é™…åº”ç”¨åœºæ™¯.md\":\"CI7O-Ge8\",\"01-dev_01.05-ç®—æ³•_ç®—æ³•è·¯çº¿.md\":\"BiR2njX-\",\"01-dev_01.60-ä¹¦ç±ç›¸å…³_ç»å…¸ç¼–ç¨‹ä¹¦å•500mb.md\":\"BhC9Ahq_\",\"01-dev_01.06-linux_ç¯å¢ƒå®‰è£…_ubuntuåŸºç¡€ç¯å¢ƒå®‰è£….md\":\"CWdCAcck\",\"01-dev_01.01-java_jvm_03-jvmå†…å­˜æ¨¡å‹.md\":\"BgQ_PNNy\",\"01-dev_01.06-linux_å¸¸ç”¨å‘½ä»¤.md\":\"BoEANcH5\",\"01-dev_01.01-java_juc_é”.md\":\"CedRNhAw\",\"01-dev_01.01-java_juc_future.md\":\"l5AtW3YT\",\"01-dev_01.01-java_jvm_00-å‰è¨€.md\":\"Dnk5lWvs\",\"01-dev_01.04-è®¾è®¡æ¨¡å¼_03-è¡Œä¸ºå‹_æ¨¡æ¿.md\":\"BQrBJPUf\",\"01-dev_01.08-æ•°æ®åº“_00-ã€Šmysqlæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹_04-ã€Šä»ä¸€æ¡è®°å½•è¯´èµ·ã€‹-innodbè®°å½•ç»“æ„.md\":\"bHx1sBA6\",\"01-dev_01.06-linux_ç¯å¢ƒå®‰è£…_linuxå®‰è£…jdk.md\":\"DrjkA2H5\",\"01-dev_01.01-java_juc_volatileå…³é”®å­—.md\":\"k-TnsZ10\",\"01-dev_01.01-java_juc_å¤šçº¿ç¨‹.md\":\"CwRopwrg\",\"01-dev_01.08-æ•°æ®åº“_02-mysql_mysqlæ•´ä½“æ¶æ„è§£æ.md\":\"Bnu0Z2_q\",\"01-dev_01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ_mybatis-doå¯¹è±¡åµŒå¥—çš„ç‰¹æ®Šå¤„ç†-æ’ä»¶åŠŸèƒ½.md\":\"DWf_PGyL\",\"01-dev_01.01-java_index.md\":\"aF_pl_nr\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_10-ä¹°äº†åˆä¹°é¡µé€»è¾‘.md\":\"B8D410uE\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_å­¦ä¹ èµ„æº.md\":\"BZ3ctYIo\",\"01-dev_01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ_springboot_springboot-start.md\":\"BbQqwnGK\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_01-æœç´¢_02.æœå¹¿æ¨æ ¸å¿ƒä¸šåŠ¡é“¾è·¯.md\":\"70M5xwwF\",\"01-dev_01.04-è®¾è®¡æ¨¡å¼_03-è¡Œä¸ºå‹_ç­–ç•¥.md\":\"gFhp150B\",\"01-dev_01.03-ç½‘ç»œå®‰å…¨_00-å¸¸ç”¨ç½‘ç«™.md\":\"BzKuz8bf\",\"01-dev_01.08-æ•°æ®åº“_00-ã€Šmysqlæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹_02-ã€Šmysqlçš„è°ƒæ§æŒ‰é’®ã€‹-å¯åŠ¨é€‰é¡¹ä¸ç¯å¢ƒå˜é‡.md\":\"-n6_F036\",\"01-dev_01.99-plugins_easy-inform_å¯¼å›¾.md\":\"lKHPA4Gt\",\"02-person_05-å¥‡æŠ€æ·«å·§_idea.md\":\"Bb4YZ5CD\",\"01-dev_01.08-æ•°æ®åº“_mysql-mvcc.md\":\"CyOiPOe-\",\"01-dev_01.02-å‰ç«¯_vue_01-åŸºç¡€è¯­æ³•.md\":\"oPIyU1HP\",\"01-dev_01.02-å‰ç«¯_nodeç‰ˆæœ¬åˆ‡æ¢.md\":\"DgTVp61l\",\"01-dev_01.06-linux_linuxè‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡-æœåŠ¡è„šæœ¬ç¼–å†™ï¼ˆå¼€æœºè‡ªå¯ï¼‰.md\":\"DtNbxo9s\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_æœæ¨ä¸šåŠ¡æ¢³ç†.md\":\"BeaqWpKF\",\"01-dev_01.01-java_jvm_01-ç±»åŠ è½½æœºåˆ¶.md\":\"CtVJqBjE\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_å•†åŸä¸»é¡µæœç´¢ä¸šåŠ¡.md\":\"BNUyWzAb\",\"01-dev_01.01-java_juc_01-å¹¶å‘ç¼–ç¨‹_å¹¶å‘ç¼–ç¨‹-01.md\":\"CJllK_HG\",\"01-dev_01.01-java_cloud_alibaba_ç»„ä»¶.md\":\"CcfiT9d-\",\"01-dev_01.02-å‰ç«¯_01-å‰ç«¯å­¦ä¹ è·¯çº¿.md\":\"B0qU8aPv\",\"01-dev_01.02-å‰ç«¯_ç–‘é—®.md\":\"d_wqCCZG\",\"01-dev_01.08-æ•°æ®åº“_01-ã€Šmysql-binlogç¥ç§˜é¢çº±ã€‹_01-mysql-binlog.md\":\"CHNe878r\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_01-äº¬ä¸œæ¨èç³»ç»Ÿ_æ¨èç³»ç»Ÿ-å¹¿å‘Šæ’åº.md\":\"CPw-Bquq\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_03-ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€_00-å¹¿å‘Šå‰ç½®ä¸šåŠ¡çŸ¥è¯†.md\":\"BtBnyxi-\",\"01-dev_01.01-java_jvm_02-è¿è¡Œæ—¶æ•°æ®åŒº.md\":\"N7Fik3OI\",\"01-dev_01.09-docker_dockerè½¯ä»¶å®‰è£…_00-dockeræ–¹å¼å®‰è£…å•æœºç‰ˆesã€kibanaã€ikåˆ†è¯ã€å¯è§†åŒ–.md\":\"BtzVSU39\",\"01-dev_01.03-ç½‘ç»œå®‰å…¨_å®‰å…¨æ¼æ´_nacos-2.1ä»¥ä¸‹çš„æœªæˆæƒè®¿é—®æ¼æ´.md\":\"03naMc8y\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_01-æœç´¢_00-ç®€ä»‹.md\":\"Bu2XXCOG\",\"guide_index.md\":\"CSCKeaMZ\",\"02-person_02-åšæ–‡æˆé•¿_äº•åº•ä¹‹è›™_æå‰åšçš„æ€æƒ³å‡†å¤‡.md\":\"DdvBU4yA\",\"01-dev_01.04-è®¾è®¡æ¨¡å¼_00-å‰è¨€.md\":\"5e4nJ3M_\",\"01-dev_01.06-linux_è™šæ‹Ÿæœº_windowså®‰è£…linuxå­ç³»ç»Ÿ.md\":\"l9G817Lv\",\"02-person_04-seo_index.md\":\"C17SO8Iy\",\"01-dev_01.99-plugins_site.md\":\"DxXWYE_E\",\"02-person_03-ç‹¬ç«‹å¼€å‘è€…_ç‹¬ç«‹å¼€å‘è€…çš„æ€è€ƒ.md\":\"Ct0X-4yA\",\"02-person_05-å¥‡æŠ€æ·«å·§_javaä»£ç ä¼˜åŒ–å°æŠ€å·§.md\":\"CecmkR8I\",\"02-person_03-ç‹¬ç«‹å¼€å‘è€…_èµ„æºç«™ç‚¹.md\":\"D5SfG5t8\",\"01-dev_01.99-plugins_ob.md\":\"BiyuSPz-\",\"01-dev_01.07-å¤§æ•°æ®_æ•°ä»“.md\":\"BWGvAhON\",\"03-me_index.md\":\"DuelE0M5\",\"01-dev_01.99-plugins_obsidianæ’ä»¶å¼€å‘_obsidianæ’ä»¶å¼€å‘.md\":\"CbleEfyT\",\"01-dev_01.02-å‰ç«¯_npm_npmé•œåƒåˆ‡æ¢.md\":\"BjTEr0LK\",\"01-dev_01.02-å‰ç«¯_vue_00-å¿«é€Ÿå…¥é—¨.md\":\"DA6umoGe\",\"01-dev_01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ_æ—¥å¿—_traceidé—®é¢˜.md\":\"ZkBiWvLL\",\"01-dev_01.05-ç®—æ³•_ä¸šåŠ¡ç®—æ³•_è£…ç®±ç®—æ³•.md\":\"DRNoqHYl\",\"04-team_index.md\":\"Bn_B2pVR\",\"02-person_03-ç‹¬ç«‹å¼€å‘è€…_index.md\":\"Bz9StDk_\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _04-è·¨å¢ƒä¸šåŠ¡_ä»“é…é€»è¾‘è¾“å‡º.md\":\"H0w_azSR\",\"01-dev_01.04-è®¾è®¡æ¨¡å¼_02-åˆ›å»ºå‹_å•ä¾‹.md\":\"Cj0RaMD2\",\"01-dev_01.99-plugins_easy-inform_æœªå‘½åæ€ç»´å¯¼å›¾.md\":\"IqsrutFB\",\"01-dev_01.01-java_juc_01-å¹¶å‘ç¼–ç¨‹_å¹¶å‘ç¼–ç¨‹-02.md\":\"mE4ejqbD\",\"01-dev_01.03-ç½‘ç»œå®‰å…¨_00-å¤§çº²è·¯çº¿.md\":\"CAgDoWkK\",\"02-person_02-åšæ–‡æˆé•¿_index.md\":\"Bcs3UNWv\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_03-ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€_00-ç®€ä»‹.md\":\"DvgdDYlR\",\"01-dev_01.68-ddd_å……è¡€æ¨¡å‹ä¸è´«è¡€æ¨¡å‹.md\":\"d1d5b7pC\",\"01-dev_01.99-plugins_å¼€å‘ç›¸å…³.md\":\"CXgQ_8s-\",\"02-person_02-åšæ–‡æˆé•¿_guide_ç¨‹åºäººç”Ÿ_å¼€å‘åŒå­¦é¡»çŸ¥.md\":\"CJwxu0Ns\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _06-open_open api åœ¨ç”µå•†ä¸­çš„ä½œç”¨.md\":\"BDma2uGY\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _04-è·¨å¢ƒä¸šåŠ¡_åŸºç¡€æ‰«ç›².md\":\"Cku99968\",\"02-person_03-ç‹¬ç«‹å¼€å‘è€…_æˆ‘æ˜¯è°.md\":\"B1r8BKKT\",\"01-dev_01.05-ç®—æ³•_æ•°æ®ç»“æ„_æ•°æ®ç»“æ„.md\":\"BuD3aeCi\",\"02-person_05-å¥‡æŠ€æ·«å·§_æœºåœº.md\":\"Ft-x3bOb\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹_02-åè¯è§£é‡Š.md\":\"D8zHTGij\",\"01-dev_01.09-docker_dockerè½¯ä»¶å®‰è£…_linuxå®‰è£…docker.md\":\"U_UBXlVa\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹_01-æ¦‚è¿°.md\":\"BdZHw7bi\",\"01-dev_01.02-å‰ç«¯_02-å¸¸ç”¨ä»£ç æ®µ.md\":\"CicJxpfS\",\"01-dev_01.04-è®¾è®¡æ¨¡å¼_ã€Šç¾å›¢æŠ€æœ¯ã€‹è®¾è®¡æ¨¡å¼åœ¨å¤–å–è¥é”€ä¸šåŠ¡ä¸­çš„å®è·µ.md\":\"C6GfZLTz\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _01-ç®€ä»‹.md\":\"CCfkl4Ye\",\"01-dev_01.13-es_01-eså…¥é—¨.md\":\"D6WHWaZ9\",\"01-dev_01.05-ç®—æ³•_01-å‰è¨€.md\":\"Ckovyg3Y\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹_99-é—®é¢˜ç­”ç–‘.md\":\"C-iDVMKW\",\"01-dev_01.13-es_03-esæ•°æ®åŒæ­¥é—®é¢˜.md\":\"CfkmOJzB\",\"01-dev_01.08-æ•°æ®åº“_02-mysql_ç¢ç‰‡æ¸…ç†æ–¹æ¡ˆ.md\":\"DSx0TKuq\",\"01-dev_01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ_springboot_springbootapplicationæ³¨è§£.md\":\"CpmLJqj2\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _04-è·¨å¢ƒä¸šåŠ¡_ä»“é…é’ˆå¯¹ä¸œå—äºšåœ°åŒºçš„ç‰¹æ®Šé€»è¾‘.md\":\"CzSo1oAS\",\"index.md\":\"DmQuK4v5\",\"02-person_06-åšå®¢æ­å»º_vitepress.md\":\"DEbasTfJ\",\"01-dev_01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ_springboot_è‡ªå®šä¹‰-start_æœªå‘½å.md\":\"cda3mS7V\",\"02-person_05-å¥‡æŠ€æ·«å·§_ç¬”è®°æ•´ç†.md\":\"D8aRj4zb\",\"02-person_02-åšæ–‡æˆé•¿_äº•åº•ä¹‹è›™_ä¸šåŠ¡æ¨¡å¼.md\":\"AI5W0DL4\",\"01-dev_01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ_springboot_spelè¡¨è¾¾å¼.md\":\"DOf64Hli\",\"01-dev_01.99-plugins_mybatiscodehelperç¦»çº¿æ¿€æ´»åˆ†æ.md\":\"BoOOhJwR\",\"01-dev_index.md\":\"GBOMxLzy\",\"01-dev_01.05-ç®—æ³•_åŸºç¡€çŸ¥è¯†.md\":\"DlIfP06n\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_03-ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€_01-ç½‘çº¢ç³»ç»Ÿ_01-obsç›¸å…³åŠŸèƒ½ç®€ä»‹.md\":\"BZxSBwYl\",\"01-dev_01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ_å¹‚ç­‰å¤„ç†.md\":\"B5Vf9rtg\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _05-æœå¹¿æ¨_02-æ¨è_00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹_03-æ¶æ„è®¾è®¡.md\":\"BBQ6ufQl\",\"02-person_00-ä¸šåŠ¡å­¦ä¹ _03-å¦‚ä½•å¿«é€Ÿæ¥æ‰‹ç†è§£é¡¹ç›®.md\":\"CaQGKrAK\",\"01-dev_01.05-ç®—æ³•_02-å¯¼è¯».md\":\"tUIPlUL4\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"é™†è¿œçš„çŸ¥è¯†åº“\",\"description\":\"ä¸ªäººæŠ€æœ¯çŸ¥è¯†åº“ï¼Œè®°å½• & åˆ†äº«ä¸ªäººç¢ç‰‡åŒ–ã€ç»“æ„åŒ–ã€ä½“ç³»åŒ–çš„æŠ€æœ¯çŸ¥è¯†å†…å®¹ã€‚\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"carbonAds\":{\"code\":\"your-carbon-code\",\"placement\":\"your-carbon-placement\"},\"outline\":{\"label\":\"ç›®å½•\"},\"logo\":\"/favicon.jpg\",\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"ğŸš€é¦–é¡µ\",\"link\":\"/\"},{\"text\":\"ğŸŒ±æŒ‡å—\",\"items\":[{\"text\":\"Dev\",\"items\":[{\"text\":\"Dev\",\"link\":\"/01-Dev/\"}]},{\"text\":\"ä¸ªäºº\",\"items\":[{\"text\":\"ä¸šåŠ¡å­¦ä¹ \",\"link\":\"/02-Person/00-ä¸šåŠ¡å­¦ä¹ /01-ç®€ä»‹\"},{\"text\":\"SEO\",\"link\":\"/02-Person/04-SEO/\"},{\"text\":\"ç‹¬ç«‹å¼€å‘è€…\",\"link\":\"/02-Person/03-ç‹¬ç«‹å¼€å‘è€…/\"},{\"text\":\"åšæ–‡æˆé•¿\",\"link\":\"/02-Person/02-åšæ–‡æˆé•¿/\"},{\"text\":\"åšå®¢æ­å»º\",\"link\":\"/02-Person/06-åšå®¢æ­å»º/VitePress\"}]}]},{\"text\":\"ğŸ’«å…³äº\",\"items\":[{\"text\":\"ğŸ’«å…³äºæˆ‘\",\"link\":\"/03-Me/\"},{\"text\":\"ğŸ”ŠRSSè®¢é˜…\",\"link\":\"/rss.xml\"}]}],\"docFooter\":{\"prev\":false,\"next\":false},\"darkModeSwitchLabel\":\"æµ…/æ·±è‰²æ¨¡å¼åˆ‡æ¢\",\"darkModeSwitchTitle\":\"åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼\",\"lightModeSwitchTitle\":\"åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼\",\"sidebar\":[{\"text\":\"01 Dev\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01.01 Java\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Cloud\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Alibaba\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Nacos\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"æºç åˆ†æ\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\Cloud\\\\Alibaba\\\\Nacos\\\\æºç åˆ†æ.md\"}]},{\"text\":\"ç»„ä»¶\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\Cloud\\\\Alibaba\\\\ç»„ä»¶.md\"}]},{\"text\":\"Higress\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\Cloud\\\\Higress.md\"}]},{\"text\":\"Index\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\index.md\"},{\"text\":\"JavaåŸºç¡€\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Serializable\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JavaåŸºç¡€\\\\Serializable.md\"},{\"text\":\"æ³›å‹\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JavaåŸºç¡€\\\\æ³›å‹.md\"}]},{\"text\":\"JUC\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 å¹¶å‘ç¼–ç¨‹\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"å¹¶å‘ç¼–ç¨‹ 01\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\01-å¹¶å‘ç¼–ç¨‹\\\\å¹¶å‘ç¼–ç¨‹-01.md\"},{\"text\":\"å¹¶å‘ç¼–ç¨‹ 02\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\01-å¹¶å‘ç¼–ç¨‹\\\\å¹¶å‘ç¼–ç¨‹-02.md\"}]},{\"text\":\"Callable å®é™…åº”ç”¨åœºæ™¯\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\Callable å®é™…åº”ç”¨åœºæ™¯.md\"},{\"text\":\"Conditionæ¥å£\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\Conditionæ¥å£.md\"},{\"text\":\"Future\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\Future.md\"},{\"text\":\"Volatileå…³é”®å­—\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\Volatileå…³é”®å­—.md\"},{\"text\":\"ä¿¡å·é‡\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\ä¿¡å·é‡.md\"},{\"text\":\"å¤šçº¿ç¨‹\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\å¤šçº¿ç¨‹.md\"},{\"text\":\"çº¿ç¨‹æ± \",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\çº¿ç¨‹æ± .md\"},{\"text\":\"é”\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JUC\\\\é”.md\"}]},{\"text\":\"JVM\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 å‰è¨€\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JVM\\\\00-å‰è¨€.md\"},{\"text\":\"01 ç±»åŠ è½½æœºåˆ¶\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JVM\\\\01-ç±»åŠ è½½æœºåˆ¶.md\"},{\"text\":\"02 è¿è¡Œæ—¶æ•°æ®åŒº\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JVM\\\\02-è¿è¡Œæ—¶æ•°æ®åŒº.md\"},{\"text\":\"03 JVMå†…å­˜æ¨¡å‹\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JVM\\\\03-JVMå†…å­˜æ¨¡å‹.md\"},{\"text\":\"04 JVMçš„åƒåœ¾æ”¶é›†ç®—æ³•\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JVM\\\\04-JVMçš„åƒåœ¾æ”¶é›†ç®—æ³•.md\"},{\"text\":\"05 åŒäº²å§”æ´¾æ¨¡å‹\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JVM\\\\05-åŒäº²å§”æ´¾æ¨¡å‹.md\"},{\"text\":\"06 Javaå¯¹è±¡çš„å†…å­˜æ¨¡å‹å¸ƒå±€\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\JVM\\\\06-Javaå¯¹è±¡çš„å†…å­˜æ¨¡å‹å¸ƒå±€.md\"}]},{\"text\":\"ç³»ç»Ÿä¼˜åŒ–\",\"link\":\"\\\\01-Dev\\\\01.01-Java\\\\ç³»ç»Ÿä¼˜åŒ–.md\"}]},{\"text\":\"01.02 å‰ç«¯\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 å‰ç«¯å­¦ä¹ è·¯çº¿\",\"link\":\"\\\\01-Dev\\\\01.02-å‰ç«¯\\\\01-å‰ç«¯å­¦ä¹ è·¯çº¿.md\"},{\"text\":\"å¸¸ç”¨ä»£ç æ®µ\",\"link\":\"\\\\01-Dev\\\\01.02-å‰ç«¯\\\\02-å¸¸ç”¨ä»£ç æ®µ.md\"},{\"text\":\"Nodeç‰ˆæœ¬åˆ‡æ¢\",\"link\":\"\\\\01-Dev\\\\01.02-å‰ç«¯\\\\Nodeç‰ˆæœ¬åˆ‡æ¢.md\"},{\"text\":\"Npm\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Npmé•œåƒåˆ‡æ¢\",\"link\":\"\\\\01-Dev\\\\01.02-å‰ç«¯\\\\Npm\\\\Npmé•œåƒåˆ‡æ¢.md\"},{\"text\":\"Pnpm\",\"link\":\"\\\\01-Dev\\\\01.02-å‰ç«¯\\\\Npm\\\\pnpm.md\"}]},{\"text\":\"Vue\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 å¿«é€Ÿå…¥é—¨\",\"link\":\"\\\\01-Dev\\\\01.02-å‰ç«¯\\\\Vue\\\\00-å¿«é€Ÿå…¥é—¨.md\"},{\"text\":\"01 åŸºç¡€è¯­æ³•\",\"link\":\"\\\\01-Dev\\\\01.02-å‰ç«¯\\\\Vue\\\\01-åŸºç¡€è¯­æ³•.md\"}]},{\"text\":\"ç–‘é—®\",\"link\":\"\\\\01-Dev\\\\01.02-å‰ç«¯\\\\ç–‘é—®.md\"}]},{\"text\":\"01.03 ç½‘ç»œå®‰å…¨\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 å¤§çº²è·¯çº¿\",\"link\":\"\\\\01-Dev\\\\01.03-ç½‘ç»œå®‰å…¨\\\\00-å¤§çº²è·¯çº¿.md\"},{\"text\":\"00 å¸¸ç”¨ç½‘ç«™\",\"link\":\"\\\\01-Dev\\\\01.03-ç½‘ç»œå®‰å…¨\\\\00-å¸¸ç”¨ç½‘ç«™.md\"},{\"text\":\"01 ç½‘ç»œå®‰å…¨ç®€ä»‹\",\"link\":\"\\\\01-Dev\\\\01.03-ç½‘ç»œå®‰å…¨\\\\01-ç½‘ç»œå®‰å…¨ç®€ä»‹.md\"},{\"text\":\"02 å¸¸è§å®‰å…¨é—®é¢˜\",\"link\":\"\\\\01-Dev\\\\01.03-ç½‘ç»œå®‰å…¨\\\\02-å¸¸è§å®‰å…¨é—®é¢˜.md\"},{\"text\":\"å®‰å…¨æ¼æ´\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Nacos 2.1ä»¥ä¸‹çš„æœªæˆæƒè®¿é—®æ¼æ´\",\"link\":\"\\\\01-Dev\\\\01.03-ç½‘ç»œå®‰å…¨\\\\å®‰å…¨æ¼æ´\\\\Nacos-2.1ä»¥ä¸‹çš„æœªæˆæƒè®¿é—®æ¼æ´.md\"}]}]},{\"text\":\"01.04 è®¾è®¡æ¨¡å¼\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 å‰è¨€\",\"link\":\"\\\\01-Dev\\\\01.04-è®¾è®¡æ¨¡å¼\\\\00-å‰è¨€.md\"},{\"text\":\"01 æ·±å…¥è®¾è®¡æ¨¡å¼\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ç®€ä»‹\",\"link\":\"\\\\01-Dev\\\\01.04-è®¾è®¡æ¨¡å¼\\\\01-æ·±å…¥è®¾è®¡æ¨¡å¼\\\\01-é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ç®€ä»‹.md\"}]},{\"text\":\"02 åˆ›å»ºå‹\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"å•ä¾‹\",\"link\":\"\\\\01-Dev\\\\01.04-è®¾è®¡æ¨¡å¼\\\\02-åˆ›å»ºå‹\\\\å•ä¾‹.md\"}]},{\"text\":\"03 è¡Œä¸ºå‹\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"æ¨¡æ¿\",\"link\":\"\\\\01-Dev\\\\01.04-è®¾è®¡æ¨¡å¼\\\\03-è¡Œä¸ºå‹\\\\æ¨¡æ¿.md\"},{\"text\":\"ç­–ç•¥\",\"link\":\"\\\\01-Dev\\\\01.04-è®¾è®¡æ¨¡å¼\\\\03-è¡Œä¸ºå‹\\\\ç­–ç•¥.md\"},{\"text\":\"è´£ä»»é“¾\",\"link\":\"\\\\01-Dev\\\\01.04-è®¾è®¡æ¨¡å¼\\\\03-è¡Œä¸ºå‹\\\\è´£ä»»é“¾.md\"}]},{\"text\":\"04 ç»“æ„å‹\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"ä»£ç†\",\"link\":\"\\\\01-Dev\\\\01.04-è®¾è®¡æ¨¡å¼\\\\04-ç»“æ„å‹\\\\ä»£ç†.md\"},{\"text\":\"é—¨é¢\",\"link\":\"\\\\01-Dev\\\\01.04-è®¾è®¡æ¨¡å¼\\\\04-ç»“æ„å‹\\\\é—¨é¢.md\"}]},{\"text\":\"ã€Šç¾å›¢æŠ€æœ¯ã€‹è®¾è®¡æ¨¡å¼åœ¨å¤–å–è¥é”€ä¸šåŠ¡ä¸­çš„å®è·µ\",\"link\":\"\\\\01-Dev\\\\01.04-è®¾è®¡æ¨¡å¼\\\\ã€Šç¾å›¢æŠ€æœ¯ã€‹è®¾è®¡æ¨¡å¼åœ¨å¤–å–è¥é”€ä¸šåŠ¡ä¸­çš„å®è·µ.md\"}]},{\"text\":\"01.05 ç®—æ³•\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 å‰è¨€\",\"link\":\"\\\\01-Dev\\\\01.05-ç®—æ³•\\\\01-å‰è¨€.md\"},{\"text\":\"02 å¯¼è¯»\",\"link\":\"\\\\01-Dev\\\\01.05-ç®—æ³•\\\\02-å¯¼è¯».md\"},{\"text\":\"ä¸šåŠ¡ç®—æ³•\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"DFA\",\"link\":\"\\\\01-Dev\\\\01.05-ç®—æ³•\\\\ä¸šåŠ¡ç®—æ³•\\\\DFA.md\"},{\"text\":\"è£…ç®±ç®—æ³•\",\"link\":\"\\\\01-Dev\\\\01.05-ç®—æ³•\\\\ä¸šåŠ¡ç®—æ³•\\\\è£…ç®±ç®—æ³•.md\"}]},{\"text\":\"äºŒåˆ†\",\"link\":\"\\\\01-Dev\\\\01.05-ç®—æ³•\\\\äºŒåˆ†.md\"},{\"text\":\"åŸºç¡€çŸ¥è¯†\",\"link\":\"\\\\01-Dev\\\\01.05-ç®—æ³•\\\\åŸºç¡€çŸ¥è¯†.md\"},{\"text\":\"æ•°æ®ç»“æ„\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"æ•°æ®ç»“æ„\",\"link\":\"\\\\01-Dev\\\\01.05-ç®—æ³•\\\\æ•°æ®ç»“æ„\\\\æ•°æ®ç»“æ„.md\"}]},{\"text\":\"ç®—æ³•è·¯çº¿\",\"link\":\"\\\\01-Dev\\\\01.05-ç®—æ³•\\\\ç®—æ³•è·¯çº¿.md\"}]},{\"text\":\"01.06 Linux\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Linuxè‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡ æœåŠ¡è„šæœ¬ç¼–å†™ï¼ˆå¼€æœºè‡ªå¯ï¼‰\",\"link\":\"\\\\01-Dev\\\\01.06-Linux\\\\Linuxè‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡-æœåŠ¡è„šæœ¬ç¼–å†™ï¼ˆå¼€æœºè‡ªå¯ï¼‰.md\"},{\"text\":\"å¸¸ç”¨å‘½ä»¤\",\"link\":\"\\\\01-Dev\\\\01.06-Linux\\\\å¸¸ç”¨å‘½ä»¤.md\"},{\"text\":\"ç¯å¢ƒå®‰è£…\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Linuxå®‰è£…jdk\",\"link\":\"\\\\01-Dev\\\\01.06-Linux\\\\ç¯å¢ƒå®‰è£…\\\\Linuxå®‰è£…jdk.md\"},{\"text\":\"UbuntuåŸºç¡€ç¯å¢ƒå®‰è£…\",\"link\":\"\\\\01-Dev\\\\01.06-Linux\\\\ç¯å¢ƒå®‰è£…\\\\UbuntuåŸºç¡€ç¯å¢ƒå®‰è£….md\"},{\"text\":\"åŸºç¡€ç¯å¢ƒé—®é¢˜\",\"link\":\"\\\\01-Dev\\\\01.06-Linux\\\\ç¯å¢ƒå®‰è£…\\\\åŸºç¡€ç¯å¢ƒé—®é¢˜.md\"}]},{\"text\":\"è™šæ‹Ÿæœº\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"VirtualBox\",\"link\":\"\\\\01-Dev\\\\01.06-Linux\\\\è™šæ‹Ÿæœº\\\\VirtualBox.md\"},{\"text\":\"Windowså®‰è£…linuxå­ç³»ç»Ÿ\",\"link\":\"\\\\01-Dev\\\\01.06-Linux\\\\è™šæ‹Ÿæœº\\\\windowså®‰è£…linuxå­ç³»ç»Ÿ.md\"}]}]},{\"text\":\"01.07 å¤§æ•°æ®\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"æ•°ä»“\",\"link\":\"\\\\01-Dev\\\\01.07-å¤§æ•°æ®\\\\æ•°ä»“.md\"}]},{\"text\":\"01.08 æ•°æ®åº“\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 ã€ŠMySQLæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 ã€Šè£…ä½œè‡ªå·±æ˜¯ä¸ªå°ç™½ã€‹ åˆè¯†MySQL\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\00-ã€ŠMySQLæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹\\\\01-ã€Šè£…ä½œè‡ªå·±æ˜¯ä¸ªå°ç™½ã€‹-åˆè¯†MySQL.md\"},{\"text\":\"02 ã€ŠMysqlçš„è°ƒæ§æŒ‰é’®ã€‹ å¯åŠ¨é€‰é¡¹ä¸ç¯å¢ƒå˜é‡\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\00-ã€ŠMySQLæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹\\\\02-ã€ŠMysqlçš„è°ƒæ§æŒ‰é’®ã€‹-å¯åŠ¨é€‰é¡¹ä¸ç¯å¢ƒå˜é‡.md\"},{\"text\":\"03 ã€Šä¹±ç çš„å‰ä¸–ä»Šç”Ÿã€‹ å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\00-ã€ŠMySQLæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹\\\\03-ã€Šä¹±ç çš„å‰ä¸–ä»Šç”Ÿã€‹-å­—ç¬¦é›†å’Œæ¯”è¾ƒè§„åˆ™.md\"},{\"text\":\"04 ã€Šä»ä¸€æ¡è®°å½•è¯´èµ·ã€‹ InnoDBè®°å½•ç»“æ„\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\00-ã€ŠMySQLæ˜¯æ€ä¹ˆè¿è¡Œçš„ã€‹\\\\04-ã€Šä»ä¸€æ¡è®°å½•è¯´èµ·ã€‹-InnoDBè®°å½•ç»“æ„.md\"}]},{\"text\":\"01 ã€ŠMysql BinLogç¥ç§˜é¢çº±ã€‹\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 MySQL BinLog\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\01-ã€ŠMysql-BinLogç¥ç§˜é¢çº±ã€‹\\\\01-MySQL-BinLog.md\"}]},{\"text\":\"02 Mysql\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"MySQLæ•´ä½“æ¶æ„è§£æ\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\02-Mysql\\\\MySQLæ•´ä½“æ¶æ„è§£æ.md\"},{\"text\":\"Mysqlç‰¹æ®Šå‘½ä»¤\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\02-Mysql\\\\Mysqlç‰¹æ®Šå‘½ä»¤.md\"},{\"text\":\"ç¢ç‰‡æ¸…ç†æ–¹æ¡ˆ\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\02-Mysql\\\\ç¢ç‰‡æ¸…ç†æ–¹æ¡ˆ.md\"},{\"text\":\"é—®é¢˜å¼•å¯¼å­¦ä¹ \",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\02-Mysql\\\\é—®é¢˜å¼•å¯¼å­¦ä¹ .md\"}]},{\"text\":\"03 Redis\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Redis å…¥é—¨åŸºç¡€\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\03-Redis\\\\Redis-å…¥é—¨åŸºç¡€.md\"},{\"text\":\"Redis\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\03-Redis\\\\Redis.md\"}]},{\"text\":\"Mysql MVCC\",\"link\":\"\\\\01-Dev\\\\01.08-æ•°æ®åº“\\\\Mysql-MVCC.md\"}]},{\"text\":\"01.09 Docker\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 DockerCompose\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"å¸¸ç”¨ ç¯å¢ƒæœåŠ¡ DockerFile\",\"link\":\"\\\\01-Dev\\\\01.09-Docker\\\\01-DockerCompose\\\\å¸¸ç”¨-ç¯å¢ƒæœåŠ¡-DockerFile.md\"}]},{\"text\":\"Dockerè½¯ä»¶å®‰è£…\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 dockeræ–¹å¼å®‰è£…å•æœºç‰ˆesã€kibanaã€ikåˆ†è¯ã€å¯è§†åŒ–\",\"link\":\"\\\\01-Dev\\\\01.09-Docker\\\\dockerè½¯ä»¶å®‰è£…\\\\00-dockeræ–¹å¼å®‰è£…å•æœºç‰ˆesã€kibanaã€ikåˆ†è¯ã€å¯è§†åŒ–.md\"},{\"text\":\"00 Dockeré•œåƒæ–¹å¼æ­å»ºXXL\",\"link\":\"\\\\01-Dev\\\\01.09-Docker\\\\dockerè½¯ä»¶å®‰è£…\\\\00-Dockeré•œåƒæ–¹å¼æ­å»ºXXL.md\"},{\"text\":\"Linuxå®‰è£…docker\",\"link\":\"\\\\01-Dev\\\\01.09-Docker\\\\dockerè½¯ä»¶å®‰è£…\\\\Linuxå®‰è£…docker.md\"},{\"text\":\"MinIo\",\"link\":\"\\\\01-Dev\\\\01.09-Docker\\\\dockerè½¯ä»¶å®‰è£…\\\\MinIo.md\"},{\"text\":\"PowerJob\",\"link\":\"\\\\01-Dev\\\\01.09-Docker\\\\dockerè½¯ä»¶å®‰è£…\\\\PowerJob.md\"}]}]},{\"text\":\"01.10 DevOps\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"äº‘æ•ˆæµæ°´çº¿æ„å»º\",\"link\":\"\\\\01-Dev\\\\01.10-DevOps\\\\äº‘æ•ˆæµæ°´çº¿æ„å»º.md\"},{\"text\":\"å‰è¨€\",\"link\":\"\\\\01-Dev\\\\01.10-DevOps\\\\å‰è¨€.md\"}]},{\"text\":\"01.13 Es\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 ESå…¥é—¨\",\"link\":\"\\\\01-Dev\\\\01.13-Es\\\\01-ESå…¥é—¨.md\"},{\"text\":\"03 Esæ•°æ®åŒæ­¥é—®é¢˜\",\"link\":\"\\\\01-Dev\\\\01.13-Es\\\\03-Esæ•°æ®åŒæ­¥é—®é¢˜.md\"}]},{\"text\":\"01.60 ä¹¦ç±ç›¸å…³\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"ç»å…¸ç¼–ç¨‹ä¹¦å•500MB\",\"link\":\"\\\\01-Dev\\\\01.60-ä¹¦ç±ç›¸å…³\\\\ç»å…¸ç¼–ç¨‹ä¹¦å•500MB.md\"}]},{\"text\":\"01.68 DDD\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"å……è¡€æ¨¡å‹ä¸è´«è¡€æ¨¡å‹\",\"link\":\"\\\\01-Dev\\\\01.68-DDD\\\\å……è¡€æ¨¡å‹ä¸è´«è¡€æ¨¡å‹.md\"}]},{\"text\":\"01.69 æŠ€æœ¯è§„èŒƒ\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 æ¢ç´¢æ—¥å¿—è§„çº¦\",\"link\":\"\\\\01-Dev\\\\01.69-æŠ€æœ¯è§„èŒƒ\\\\01-æ¢ç´¢æ—¥å¿—è§„çº¦.md\"}]},{\"text\":\"01.70 ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Mybatis DOå¯¹è±¡åµŒå¥—çš„ç‰¹æ®Šå¤„ç† æ’ä»¶åŠŸèƒ½\",\"link\":\"\\\\01-Dev\\\\01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\\\\Mybatis-DOå¯¹è±¡åµŒå¥—çš„ç‰¹æ®Šå¤„ç†-æ’ä»¶åŠŸèƒ½.md\"},{\"text\":\"SpringBoot\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Eventè§‚å¯Ÿè€…\",\"link\":\"\\\\01-Dev\\\\01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\\\\SpringBoot\\\\Eventè§‚å¯Ÿè€….md\"},{\"text\":\"SpELè¡¨è¾¾å¼\",\"link\":\"\\\\01-Dev\\\\01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\\\\SpringBoot\\\\SpELè¡¨è¾¾å¼.md\"},{\"text\":\"SpringBoot Start\",\"link\":\"\\\\01-Dev\\\\01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\\\\SpringBoot\\\\SpringBoot-Start.md\"},{\"text\":\"SpringBootApplicationæ³¨è§£\",\"link\":\"\\\\01-Dev\\\\01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\\\\SpringBoot\\\\SpringBootApplicationæ³¨è§£.md\"},{\"text\":\"è‡ªå®šä¹‰ start\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"æœªå‘½å\",\"link\":\"\\\\01-Dev\\\\01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\\\\SpringBoot\\\\è‡ªå®šä¹‰-start\\\\æœªå‘½å.md\"}]}]},{\"text\":\"åŠ å¯†\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Excel&Wordæ–‡ä»¶åŠ å¯†\",\"link\":\"\\\\01-Dev\\\\01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\\\\åŠ å¯†\\\\Excel&Wordæ–‡ä»¶åŠ å¯†.md\"}]},{\"text\":\"å¹‚ç­‰å¤„ç†\",\"link\":\"\\\\01-Dev\\\\01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\\\\å¹‚ç­‰å¤„ç†.md\"},{\"text\":\"æ—¥å¿—\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"TraceIdé—®é¢˜\",\"link\":\"\\\\01-Dev\\\\01.70-ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ\\\\æ—¥å¿—\\\\TraceIdé—®é¢˜.md\"}]}]},{\"text\":\"01.99 PlugIns\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Easy Inform\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"å¯¼å›¾\",\"link\":\"\\\\01-Dev\\\\01.99-PlugIns\\\\Easy-Inform\\\\å¯¼å›¾.md\"},{\"text\":\"æœªå‘½åæ€ç»´å¯¼å›¾\",\"link\":\"\\\\01-Dev\\\\01.99-PlugIns\\\\Easy-Inform\\\\æœªå‘½åæ€ç»´å¯¼å›¾.md\"}]},{\"text\":\"MybatisCodeHelperç¦»çº¿æ¿€æ´»åˆ†æ\",\"link\":\"\\\\01-Dev\\\\01.99-PlugIns\\\\MybatisCodeHelperç¦»çº¿æ¿€æ´»åˆ†æ.md\"},{\"text\":\"Ob\",\"link\":\"\\\\01-Dev\\\\01.99-PlugIns\\\\ob.md\"},{\"text\":\"Obsidianæ’ä»¶å¼€å‘\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Obsidianæ’ä»¶å¼€å‘\",\"link\":\"\\\\01-Dev\\\\01.99-PlugIns\\\\obsidianæ’ä»¶å¼€å‘\\\\obsidianæ’ä»¶å¼€å‘.md\"},{\"text\":\"å¿«é€Ÿå…¥é—¨\",\"link\":\"\\\\01-Dev\\\\01.99-PlugIns\\\\obsidianæ’ä»¶å¼€å‘\\\\å¿«é€Ÿå…¥é—¨.md\"}]},{\"text\":\"Site\",\"link\":\"\\\\01-Dev\\\\01.99-PlugIns\\\\site.md\"},{\"text\":\"å¼€å‘ç›¸å…³\",\"link\":\"\\\\01-Dev\\\\01.99-PlugIns\\\\å¼€å‘ç›¸å…³.md\"}]},{\"text\":\"Index\",\"link\":\"\\\\01-Dev\\\\index.md\"}]},{\"text\":\"02 Person\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 ä¸šåŠ¡å­¦ä¹ \",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 ç®€ä»‹\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\01-ç®€ä»‹.md\"},{\"text\":\"02 è·¨å¢ƒç”µå•†å‰ç½®çŸ¥è¯†\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\02-è·¨å¢ƒç”µå•†å‰ç½®çŸ¥è¯†.md\"},{\"text\":\"03 å¦‚ä½•å¿«é€Ÿæ¥æ‰‹ç†è§£é¡¹ç›®\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\03-å¦‚ä½•å¿«é€Ÿæ¥æ‰‹ç†è§£é¡¹ç›®.md\"},{\"text\":\"04 è·¨å¢ƒä¸šåŠ¡\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"ä»“é…é€»è¾‘è¾“å‡º\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\04-è·¨å¢ƒä¸šåŠ¡\\\\ä»“é…é€»è¾‘è¾“å‡º.md\"},{\"text\":\"ä»“é…é’ˆå¯¹ä¸œå—äºšåœ°åŒºçš„ç‰¹æ®Šé€»è¾‘\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\04-è·¨å¢ƒä¸šåŠ¡\\\\ä»“é…é’ˆå¯¹ä¸œå—äºšåœ°åŒºçš„ç‰¹æ®Šé€»è¾‘.md\"},{\"text\":\"åŸºç¡€æ‰«ç›²\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\04-è·¨å¢ƒä¸šåŠ¡\\\\åŸºç¡€æ‰«ç›².md\"},{\"text\":\"ç»„ç½‘ä¼˜å…ˆçº§\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\04-è·¨å¢ƒä¸šåŠ¡\\\\ç»„ç½‘ä¼˜å…ˆçº§.md\"}]},{\"text\":\"05 æœå¹¿æ¨\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 æœç´¢\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 ç®€ä»‹\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\01-æœç´¢\\\\00-ç®€ä»‹.md\"},{\"text\":\"02.æœå¹¿æ¨æ ¸å¿ƒä¸šåŠ¡é“¾è·¯\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\01-æœç´¢\\\\02.æœå¹¿æ¨æ ¸å¿ƒä¸šåŠ¡é“¾è·¯.md\"},{\"text\":\"é˜¿é‡Œå·´å·´ æ™ºèƒ½å¼€æ”¾æœç´¢\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\01-æœç´¢\\\\é˜¿é‡Œå·´å·´-æ™ºèƒ½å¼€æ”¾æœç´¢.md\"}]},{\"text\":\"02 æ¨è\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 æ¦‚è¿°\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹\\\\01-æ¦‚è¿°.md\"},{\"text\":\"02 åè¯è§£é‡Š\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹\\\\02-åè¯è§£é‡Š.md\"},{\"text\":\"03 æ¶æ„è®¾è®¡\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹\\\\03-æ¶æ„è®¾è®¡.md\"},{\"text\":\"04 ç®—æ³•ç­–ç•¥\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹\\\\04-ç®—æ³•ç­–ç•¥.md\"},{\"text\":\"99 é—®é¢˜ç­”ç–‘\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\00-ã€Šæ¨èç³»ç»Ÿä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹\\\\99-é—®é¢˜ç­”ç–‘.md\"}]},{\"text\":\"01 äº¬ä¸œæ¨èç³»ç»Ÿ\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"æ¨èç³»ç»Ÿ å¹¿å‘Šæ’åº\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\01-äº¬ä¸œæ¨èç³»ç»Ÿ\\\\æ¨èç³»ç»Ÿ-å¹¿å‘Šæ’åº.md\"}]},{\"text\":\"10 ä¹°äº†åˆä¹°é¡µé€»è¾‘\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\10-ä¹°äº†åˆä¹°é¡µé€»è¾‘.md\"},{\"text\":\"å•†åŸä¸»é¡µæœç´¢ä¸šåŠ¡\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\å•†åŸä¸»é¡µæœç´¢ä¸šåŠ¡.md\"},{\"text\":\"å­¦ä¹ èµ„æº\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\å­¦ä¹ èµ„æº.md\"},{\"text\":\"æœæ¨ä¸šåŠ¡æ¢³ç†\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\02-æ¨è\\\\æœæ¨ä¸šåŠ¡æ¢³ç†.md\"}]},{\"text\":\"03 ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"00 å¹¿å‘Šå‰ç½®ä¸šåŠ¡çŸ¥è¯†\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\03-ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€\\\\00-å¹¿å‘Šå‰ç½®ä¸šåŠ¡çŸ¥è¯†.md\"},{\"text\":\"00 ç®€ä»‹\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\03-ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€\\\\00-ç®€ä»‹.md\"},{\"text\":\"01 ç½‘çº¢ç³»ç»Ÿ\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"01 OBSç›¸å…³åŠŸèƒ½ç®€ä»‹\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\03-ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€\\\\01-ç½‘çº¢ç³»ç»Ÿ\\\\01-OBSç›¸å…³åŠŸèƒ½ç®€ä»‹.md\"},{\"text\":\"æ ·å“ä¸šåŠ¡é€»è¾‘æ¢³ç†\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\05-æœå¹¿æ¨\\\\03-ç½‘çº¢è”ç›Ÿå¹¿å‘Šè¥é”€\\\\01-ç½‘çº¢ç³»ç»Ÿ\\\\æ ·å“ä¸šåŠ¡é€»è¾‘æ¢³ç†.md\"}]}]}]},{\"text\":\"06 Open\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Open Api åœ¨ç”µå•†ä¸­çš„ä½œç”¨\",\"link\":\"\\\\02-Person\\\\00-ä¸šåŠ¡å­¦ä¹ \\\\06-Open\\\\Open Api åœ¨ç”µå•†ä¸­çš„ä½œç”¨.md\"}]}]},{\"text\":\"01 é¡¹ç›®ç®¡ç†\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"åˆ˜æ¶¦å¯¹è¯æ¨Šç™»ï¼šåšå›¢é˜Ÿï¼Œæˆ‘ä»¬åªæ‹›æˆå¹´äºº\",\"link\":\"\\\\02-Person\\\\01-é¡¹ç›®ç®¡ç†\\\\åˆ˜æ¶¦å¯¹è¯æ¨Šç™»ï¼šåšå›¢é˜Ÿï¼Œæˆ‘ä»¬åªæ‹›æˆå¹´äºº.md\"}]},{\"text\":\"02 åšæ–‡æˆé•¿\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Guide\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"ç¨‹åºäººç”Ÿ\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"å¼€å‘åŒå­¦é¡»çŸ¥\",\"link\":\"\\\\02-Person\\\\02-åšæ–‡æˆé•¿\\\\Guide\\\\ç¨‹åºäººç”Ÿ\\\\å¼€å‘åŒå­¦é¡»çŸ¥.md\"}]}]},{\"text\":\"Index\",\"link\":\"\\\\02-Person\\\\02-åšæ–‡æˆé•¿\\\\index.md\"},{\"text\":\"ä¸ªäººæå‡\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"æŒæ¡ä¹ æƒ¯\",\"link\":\"\\\\02-Person\\\\02-åšæ–‡æˆé•¿\\\\ä¸ªäººæå‡\\\\æŒæ¡ä¹ æƒ¯.md\"}]},{\"text\":\"äº•åº•ä¹‹è›™\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"ä¸šåŠ¡æ¨¡å¼\",\"link\":\"\\\\02-Person\\\\02-åšæ–‡æˆé•¿\\\\äº•åº•ä¹‹è›™\\\\ä¸šåŠ¡æ¨¡å¼.md\"},{\"text\":\"æå‰åšçš„æ€æƒ³å‡†å¤‡\",\"link\":\"\\\\02-Person\\\\02-åšæ–‡æˆé•¿\\\\äº•åº•ä¹‹è›™\\\\æå‰åšçš„æ€æƒ³å‡†å¤‡.md\"}]}]},{\"text\":\"03 ç‹¬ç«‹å¼€å‘è€…\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Index\",\"link\":\"\\\\02-Person\\\\03-ç‹¬ç«‹å¼€å‘è€…\\\\index.md\"},{\"text\":\"æˆ‘æ˜¯è°\",\"link\":\"\\\\02-Person\\\\03-ç‹¬ç«‹å¼€å‘è€…\\\\æˆ‘æ˜¯è°.md\"},{\"text\":\"ç‹¬ç«‹å¼€å‘å¤šäººï¼ˆè¿œç¨‹ï¼‰åä½œç»éªŒåˆ†äº«\",\"link\":\"\\\\02-Person\\\\03-ç‹¬ç«‹å¼€å‘è€…\\\\ç‹¬ç«‹å¼€å‘å¤šäººï¼ˆè¿œç¨‹ï¼‰åä½œç»éªŒåˆ†äº«.md\"},{\"text\":\"ç‹¬ç«‹å¼€å‘è€…çš„æ€è€ƒ\",\"link\":\"\\\\02-Person\\\\03-ç‹¬ç«‹å¼€å‘è€…\\\\ç‹¬ç«‹å¼€å‘è€…çš„æ€è€ƒ.md\"},{\"text\":\"èµ„æºç«™ç‚¹\",\"link\":\"\\\\02-Person\\\\03-ç‹¬ç«‹å¼€å‘è€…\\\\èµ„æºç«™ç‚¹.md\"}]},{\"text\":\"04 SEO\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Index\",\"link\":\"\\\\02-Person\\\\04-SEO\\\\index.md\"}]},{\"text\":\"05 å¥‡æŠ€æ·«å·§\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Idea\",\"link\":\"\\\\02-Person\\\\05-å¥‡æŠ€æ·«å·§\\\\Idea.md\"},{\"text\":\"Javaä»£ç ä¼˜åŒ–å°æŠ€å·§\",\"link\":\"\\\\02-Person\\\\05-å¥‡æŠ€æ·«å·§\\\\Javaä»£ç ä¼˜åŒ–å°æŠ€å·§.md\"},{\"text\":\"æœºåœº\",\"link\":\"\\\\02-Person\\\\05-å¥‡æŠ€æ·«å·§\\\\æœºåœº.md\"},{\"text\":\"ç¬”è®°æ•´ç†\",\"link\":\"\\\\02-Person\\\\05-å¥‡æŠ€æ·«å·§\\\\ç¬”è®°æ•´ç†.md\"}]},{\"text\":\"06 åšå®¢æ­å»º\",\"collapsible\":false,\"collapsed\":true,\"items\":[{\"text\":\"Rsså¤„ç†\",\"link\":\"\\\\02-Person\\\\06-åšå®¢æ­å»º\\\\Rsså¤„ç†.md\"},{\"text\":\"VitePress\",\"link\":\"\\\\02-Person\\\\06-åšå®¢æ­å»º\\\\VitePress.md\"},{\"text\":\"åŸºäºGithubActionså®ç°Githubä¸Giteeçš„åŒæ­¥\",\"link\":\"\\\\02-Person\\\\06-åšå®¢æ­å»º\\\\åŸºäºGithubActionså®ç°Githubä¸Giteeçš„åŒæ­¥.md\"}]},{\"text\":\"Index\",\"link\":\"\\\\02-Person\\\\index.md\"}]}],\"footer\":{\"message\":\"waitingresult.com\",\"copyright\":\"Copyright Â© 2024 Luyuan\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/luyuan9870\"},{\"icon\":{\"svg\":\"<svg t=\\\"1710470546803\\\" class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" p-id=\\\"1442\\\" width=\\\"200\\\" height=\\\"200\\\"><path d=\\\"M512 512m-494.933333 0a494.933333 494.933333 0 1 0 989.866666 0 494.933333 494.933333 0 1 0-989.866666 0Z\\\" fill=\\\"#C71D23\\\" p-id=\\\"1443\\\"></path><path d=\\\"M762.538667 457.045333h-281.088a24.4736 24.4736 0 0 0-24.439467 24.405334v61.098666c-0.034133 13.5168 10.922667 24.439467 24.405333 24.439467h171.1104c13.5168 0 24.439467 10.922667 24.439467 24.439467v12.219733a73.3184 73.3184 0 0 1-73.3184 73.3184h-232.209067a24.439467 24.439467 0 0 1-24.439466-24.439467v-232.174933a73.3184 73.3184 0 0 1 73.3184-73.3184h342.152533c13.482667 0 24.405333-10.922667 24.439467-24.439467l0.034133-61.098666a24.405333 24.405333 0 0 0-24.405333-24.439467H420.352a183.296 183.296 0 0 0-183.296 183.296V762.538667c0 13.482667 10.922667 24.439467 24.405333 24.439466h360.516267a164.9664 164.9664 0 0 0 165.000533-165.000533v-140.526933a24.439467 24.439467 0 0 0-24.439466-24.439467z\\\" fill=\\\"#FFFFFF\\\" p-id=\\\"1444\\\"></path></svg>\"},\"link\":\"https://gitee.com/luyuan9870\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>